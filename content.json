[{"title":"React Hooksç³»åˆ—ä¹‹useReducer","date":"2020-01-17T08:23:44.931Z","path":"/posts/13/","text":"React Hooksç³»åˆ—ä¹‹useReducer å‰è¨€useReduceræ˜¯Reactæä¾›çš„ä¸€ä¸ªé«˜çº§Hookï¼Œå®ƒä¸useStateä¸€æ ·éƒ½æ˜¯ç”¨æ¥ç®¡ç†ç»„ä»¶çš„stateã€‚ä½†å½“stateæ•°æ®ç±»å‹è¶‹äºå¤æ‚æ—¶ï¼Œä¸€èˆ¬ä½¿ç”¨useReduceræ¥ä»£æ›¿useStateç®¡ç†ç»„ä»¶stateã€‚åœ¨å…·ä½“ä»‹ç»useReducerä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸‹reducer æ­£æ–‡ä»€ä¹ˆæ˜¯reducerç®€å•æ¥è¯´ï¼Œreducerå°±æ˜¯å½¢å¦‚(state, action) =&gt; newStateçš„ä¸€ä¸ªçº¯å‡½æ•°ï¼ˆæ¥æ”¶ç›¸åŒçš„è¾“å…¥å§‹ç»ˆè¿”å›ç›¸åŒçš„è¾“å‡ºï¼‰ï¼Œæ¥æ”¶å½“å‰åº”ç”¨çš„stateå’Œè§¦å‘çš„åŠ¨ä½œactionï¼Œè¿”å›æœ€æ–°çš„stateã€‚ 12345678910function countReducer(count, action) { switch(action.type) { case 'add': return count + 1; case 'del': return count - 1; default: return count; }} ä¸Šè¿°ä»£ç æ˜¯ä¸€ä¸ªç»å…¸çš„è®¡æ•°å™¨å‡½æ•°ï¼Œreduceræ ¹æ®actionçš„ä¸åŒç±»å‹æ¥æ“ä½œstateï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªæ–°çš„stateã€‚ reducerä½¿ç”¨åœºæ™¯æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä½¿ç”¨reducerçš„åœºæ™¯ å¦‚æœä½ çš„stateæ˜¯ä¸€ä¸ªæ•°ç»„æˆ–è€…å¯¹è±¡ å¦‚æœä½ çš„stateå˜åŒ–å¾ˆå¤æ‚ï¼Œç»å¸¸ä¸€ä¸ªæ“ä½œéœ€è¦ä¿®æ”¹å¾ˆå¤šstate å¦‚æœä½ å¸Œæœ›æ„å»ºè‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹æ¥ä¿è¯ç¨‹åºçš„ç¨³å®šæ€§ å¦‚æœä½ éœ€è¦åœ¨æ·±å±‚å­ç»„ä»¶é‡Œé¢å»ä¿®æ”¹ä¸€äº›çŠ¶æ€ å¦‚æœä½ ç”¨åº”ç”¨ç¨‹åºæ¯”è¾ƒå¤§ï¼Œå¸Œæœ›UIå’Œä¸šåŠ¡èƒ½å¤Ÿåˆ†å¼€ç»´æŠ¤ ä»€ä¹ˆæ˜¯useReducer1const [state, dispatch] = useReducer(reducer, initState); ç¬¬ä¸€ä¸ªå‚æ•°ï¼šreducerå‡½æ•°ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸Šé¢ä»‹ç»çš„ã€‚ç¬¬äºŒä¸ªå‚æ•°ï¼šåˆå§‹åŒ–çš„stateã€‚è¿”å›å€¼ä¸ºæœ€æ–°çš„stateå’Œdispatchå‡½æ•°ï¼ˆç”¨æ¥è§¦å‘reducerå‡½æ•°ï¼Œè®¡ç®—å¯¹åº”çš„stateï¼‰ã€‚æŒ‰ç…§å®˜æ–¹çš„è¯´æ³•ï¼šå¯¹äºå¤æ‚çš„stateæ“ä½œé€»è¾‘ï¼ŒåµŒå¥—çš„stateçš„å¯¹è±¡ï¼Œæ¨èä½¿ç”¨useReducerå¬èµ·æ¥æ¯”è¾ƒæŠ½è±¡ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­: 1234567891011121314151617181920212223242526// ç¬¬ä¸€ä¸ªå‚æ•°ï¼šstateçš„reducerå¤„ç†å‡½æ•°function reducer(state, action) { switch (action.type) { case 'increment': return {count: state.count + 1}; case 'decrement': return {count: state.count - 1}; default: throw new Error(); }}// ç¬¬äºŒä¸ªå‚æ•°ï¼šconst initialState = {count: 0};function Counter() { // è¿”å›å€¼ï¼šæœ€æ–°çš„stateå’Œdispatchå‡½æ•° const [state, dispatch] = useReducer(reducer, initialState); return ( &lt;&gt; // useReducerä¼šæ ¹æ®dispatchçš„actionï¼Œè¿”å›æœ€ç»ˆçš„stateï¼Œå¹¶è§¦å‘rerender Count: {state.count} // dispatch ç”¨æ¥æ¥æ”¶ä¸€ä¸ª actionå‚æ•°ã€Œreducerä¸­çš„actionã€ï¼Œç”¨æ¥è§¦å‘reducerå‡½æ•°ï¼Œæ›´æ–°æœ€æ–°çš„çŠ¶æ€ &lt;button onClick={() =&gt; dispatch({type: 'increment'})}&gt;+&lt;/button&gt; &lt;button onClick={() =&gt; dispatch({type: 'decrement'})}&gt;-&lt;/button&gt; &lt;/&gt; );} useStateç‰ˆloginæˆ‘ä»¬çœ‹çœ‹ä½¿ç”¨useStateå®ç°ç™»å½•çš„å®ç°æ–¹å¼: 12345678910111213141516171819202122232425function LoginPage() { const [name, setName] = useState(''); // ç”¨æˆ·å const [pwd, setPwd] = useState(''); // å¯†ç  const [isLoading, setIsLoading] = useState(false); // æ˜¯å¦å±•ç¤ºloadingï¼Œå‘é€è¯·æ±‚ä¸­ const [error, setError] = useState(''); // é”™è¯¯ä¿¡æ¯ const [isLoggedIn, setIsLoggedIn] = useState(false); // æ˜¯å¦ç™»å½• const login = (event) =&gt; { event.preventDefault(); setError(''); setIsLoading(true); login({ name, pwd }).then(() =&gt; { setIsLoggedIn(true); setIsLoading(false); }).catch((error) =&gt; { // ç™»å½•å¤±è´¥: æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€æ¸…ç©ºè¾“å…¥æ¡†ç”¨æˆ·åã€å¯†ç ã€æ¸…é™¤loadingæ ‡è¯† setError(error.message); setName(''); setPwd(''); setIsLoading(false); }); } return ( // è¿”å›é¡µé¢JSX Element )} ä¸Šé¢çš„Demoä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†5ä¸ªstateæ¥æè¿°é¡µé¢çš„çŠ¶æ€ï¼Œåœ¨loginå‡½æ•°ä¸­ï¼Œå½“ç™»å½•æˆåŠŸã€å¤±è´¥ä¼šè¿›è¡Œä¸€ç³»åˆ—å¤æ‚çš„stateè®¾ç½®ã€‚éšç€éœ€æ±‚è¶Šæ¥è¶Šå¤æ‚ï¼Œæ›´å¤šçš„stateå°†åŠ å…¥åˆ°é¡µé¢ï¼Œå¯ä»¥æƒ³è±¡ï¼Œç»´æŠ¤è¿™æ ·çš„ä»£ç ç®€ç›´å°±æ˜¯å™©æ¢¦ã€‚ useReduceræ”¹é€ ç‰ˆLogin12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152const initState = { name: '', pwd: '', isLoading: false, error: '', isLoggedIn: false,}function loginReducer(state, action) { switch(action.type) { case 'login': return { ...state, isLoading: true, error: '', } case 'success': return { ...state, isLoggedIn: true, isLoading: false, } case 'error': return { ...state, error: action.payload.error, name: '', pwd: '', isLoading: false, } default: return state; }}function LoginPage() { const [state, dispatch] = useReducer(loginReducer, initState); const { name, pwd, isLoading, error, isLoggedIn } = state; const login = (event) =&gt; { event.preventDefault(); dispatch({ type: 'login' }); login({ name, pwd }).then(() =&gt; { dispatch({ type: 'success' }); }).catch((error) =&gt; { dispatch({ type: 'error' payload: { error: error.message } }); }); } return ( // è¿”å›é¡µé¢JSX Element )} ä¹ä¸€çœ‹useReduceræ”¹é€ åçš„ä»£ç åè€Œæ›´é•¿äº†ï¼Œä½†å¾ˆæ˜æ˜¾ç¬¬äºŒç‰ˆæœ‰æ›´å¥½çš„å¯è¯»æ€§ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½æ›´æ¸…æ™°çš„äº†è§£stateçš„å˜åŒ–é€»è¾‘ã€‚ å¯ä»¥çœ‹åˆ°loginå‡½æ•°ç°åœ¨æ›´æ¸…æ™°çš„è¡¨è¾¾äº†ç”¨æˆ·çš„æ„å›¾ï¼Œå¼€å§‹ç™»å½•loginã€ç™»å½•successã€ç™»å½•errorã€‚LoginPageä¸éœ€è¦å…³å¿ƒå¦‚ä½•å¤„ç†è¿™å‡ ç§è¡Œä¸ºï¼Œé‚£æ˜¯loginReduceréœ€è¦å…³å¿ƒçš„ï¼Œè¡¨ç°å’Œä¸šåŠ¡åˆ†ç¦»ã€‚ å¦ä¸€ä¸ªå¥½å¤„æ˜¯æ‰€æœ‰çš„stateå¤„ç†éƒ½é›†ä¸­åˆ°äº†ä¸€èµ·ï¼Œä½¿å¾—æˆ‘ä»¬å¯¹stateçš„å˜åŒ–æ›´æœ‰æŒæ§åŠ›ï¼ŒåŒæ—¶ä¹Ÿæ›´å®¹æ˜“å¤ç”¨stateé€»è¾‘å˜åŒ–ä»£ç ï¼Œæ¯”å¦‚åœ¨å…¶ä»–å‡½æ•°ä¸­ä¹Ÿéœ€è¦è§¦å‘ç™»å½•errorçŠ¶æ€ï¼Œåªéœ€è¦dispatch({ type: â€˜errorâ€™ })ã€‚ useReducerå¯ä»¥è®©æˆ‘ä»¬å°†whatå’Œhowåˆ†å¼€ã€‚æ¯”å¦‚ç‚¹å‡»äº†ç™»å½•æŒ‰é’®ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯å‘èµ·ç™»é™†æ“ä½œdispatch({ type: â€˜loginâ€™ })ï¼Œç‚¹å‡»é€€å‡ºæŒ‰é’®å°±å‘èµ·é€€å‡ºæ“ä½œdispatch({ type: â€˜logoutâ€™ })ï¼Œæ‰€æœ‰å’Œhowç›¸å…³çš„ä»£ç éƒ½åœ¨reducerä¸­ç»´æŠ¤ï¼Œç»„ä»¶ä¸­åªéœ€è¦æ€è€ƒWhatï¼Œè®©æˆ‘ä»¬çš„ä»£ç å¯ä»¥åƒç”¨æˆ·çš„è¡Œä¸ºä¸€æ ·ï¼Œæ›´åŠ æ¸…æ™°ã€‚ é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œæˆ‘ä»¬åœ¨å‰æ–‡æè¿‡Reducerå…¶å®ä¸€ä¸ªUIæ— å…³çš„çº¯å‡½æ•°ï¼ŒuseReducerçš„æ–¹æ¡ˆæ˜¯çš„æˆ‘ä»¬æ›´å®¹æ˜“æ„å»ºè‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ã€‚ æˆ‘ä»¬ä»‹ç»äº†ä½¿ç”¨useReducerï¼Œå¸®åŠ©æˆ‘ä»¬é›†ä¸­å¼çš„å¤„ç†å¤æ‚çš„stateç®¡ç†ã€‚ä½†å¦‚æœæˆ‘ä»¬çš„é¡µé¢å¾ˆå¤æ‚ï¼Œæ‹†åˆ†æˆäº†å¤šå±‚å¤šä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬å¦‚æœåœ¨å­ç»„ä»¶è§¦å‘è¿™äº›stateå˜åŒ–å‘¢ï¼Œæ¯”å¦‚åœ¨LoginButtonè§¦å‘ç™»å½•æ“ä½œï¼Ÿ æˆ‘ä»¬å°†åœ¨ä¸‹é¢ä»‹ç»å¦‚ä½•å¤„ç†å¤æ‚ç»„ä»¶æ ‘ç»“æ„çš„reducerå…±äº«é—®é¢˜ã€‚ æ­é…useContextuseContextä»åå­—ä¸Šå°±å¯ä»¥çœ‹å‡ºï¼Œå®ƒæ˜¯ä»¥Hookçš„æ–¹å¼ä½¿ç”¨React Contextã€‚ä¸äº†è§£useContextæ¦‚å¿µçš„æœ‹å‹ï¼Œå¯ä»¥å…ˆçœ‹ä¸‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ã€‚å¦‚ä½•åˆ©ç”¨contextå»è§£å†³å­å­™ç±»ç»„ä»¶å‡ºå‘reducerçŠ¶æ€å˜åŒ–ï¼Ÿæ²¡é”™ï¼Œå°±æ˜¯å°†dispatchå‡½æ•°ä½œä¸ºcontextçš„valueï¼Œå…±äº«ç»™é¡µé¢çš„å­ç»„ä»¶ã€‚ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨useReduceræ­é…useContextå®ç°loginç™»å½•ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273// å®šä¹‰åˆå§‹åŒ–å€¼const initState = { name: '', pwd: '', isLoading: false, error: '', isLoggedIn: false,}// å®šä¹‰state[ä¸šåŠ¡]å¤„ç†é€»è¾‘ reducerå‡½æ•°function loginReducer(state, action) { switch(action.type) { case 'login': return { ...state, isLoading: true, error: '', } case 'success': return { ...state, isLoggedIn: true, isLoading: false, } case 'error': return { ...state, error: action.payload.error, name: '', pwd: '', isLoading: false, } default: return state; }}// å®šä¹‰ contextå‡½æ•°const LoginContext = React.createContext();function LoginPage() { const [state, dispatch] = useReducer(loginReducer, initState); const { name, pwd, isLoading, error, isLoggedIn } = state; const login = (event) =&gt; { event.preventDefault(); dispatch({ type: 'login' }); login({ name, pwd }).then(() =&gt; { dispatch({ type: 'success' }); }).catch((error) =&gt; { dispatch({ type: 'error' payload: { error: error.message } }); }); } // åˆ©ç”¨ context å…±äº«dispatch return ( &lt;LoginContext.Provider value={dispatch}&gt; &lt;...&gt; &lt;LoginButton /&gt; &lt;/LoginContext.Provider&gt; )}function LoginButton() { // å­ç»„ä»¶ä¸­ç›´æ¥é€šè¿‡contextæ‹¿åˆ°dispatchï¼Œå‡ºå‘reduceræ“ä½œstate const dispatch = useContext(LoginContext); const click = () =&gt; { if (error) { // å­ç»„ä»¶å¯ä»¥ç›´æ¥ dispatch action dispatch({ type: 'error' payload: { error: error.message } }); } }} å¯ä»¥çœ‹åˆ°åœ¨useReducerç»“åˆuseContextï¼Œé€šè¿‡contextæŠŠdispatchå‡½æ•°æä¾›ç»™ç»„ä»¶æ ‘ä¸­çš„æ‰€æœ‰ç»„ä»¶ä½¿ç”¨ï¼Œè€Œä¸ç”¨é€šè¿‡propsæ·»åŠ å›è°ƒå‡½æ•°çš„æ–¹å¼ä¸€å±‚å±‚ä¼ é€’ã€‚ä½¿ç”¨Contextç›¸æ¯”å›è°ƒå‡½æ•°çš„ä¼˜åŠ¿ï¼š å¯¹æ¯”å›è°ƒå‡½æ•°çš„è‡ªå®šä¹‰å‘½åï¼ŒContextçš„Apiæ›´åŠ æ˜ç¡®ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ¸…æ™°çš„çŸ¥é“å“ªäº›ç»„ä»¶ä½¿ç”¨äº†dispatchã€åº”ç”¨ä¸­çš„æ•°æ®æµåŠ¨å’Œå˜åŒ–ã€‚è¿™ä¹Ÿæ˜¯Reactä¸€ç›´ä»¥æ¥å•å‘æ•°æ®æµçš„ä¼˜åŠ¿ã€‚ æ›´å¥½çš„æ€§èƒ½ï¼šå¦‚æœä½¿ç”¨å›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’çš„è¯ï¼Œå› ä¸ºæ¯æ¬¡renderå‡½æ•°éƒ½ä¼šå˜åŒ–ï¼Œä¹Ÿä¼šå¯¼è‡´å­ç»„ä»¶rerenderã€‚å½“ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨useCallbackè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†ç›¸æ¯”useCallback,Reactå®˜æ–¹æ›´æ¨èä½¿ç”¨useReducerï¼Œå› ä¸ºReactä¼šä¿è¯dispatchå§‹ç»ˆæ˜¯ä¸å˜çš„ï¼Œä¸ä¼šå¼•èµ·consumerç»„ä»¶çš„rerenderã€‚ æ€»ç»“è‡³æ­¤useReducerç³»åˆ—ä»‹ç»å°±ç»“æŸäº†ï¼Œæˆ‘ä»¬ç®€å•å›é¡¾ä¸€ä¸‹ï¼š å¦‚æœä½ çš„é¡µé¢stateå¾ˆç®€å•ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨useState å¦‚æœä½ çš„é¡µé¢stateæ¯”è¾ƒå¤æ‚ï¼ˆstateæ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è€…stateéå¸¸å¤šæ•£è½åœ¨å„å¤„ï¼‰è¯·ä½¿ç”¨userReducer å¦‚æœä½ çš„é¡µé¢ç»„ä»¶å±‚çº§æ¯”è¾ƒæ·±ï¼Œå¹¶ä¸”éœ€è¦å­ç»„ä»¶è§¦å‘stateçš„å˜åŒ–ï¼Œå¯ä»¥è€ƒè™‘useReducer + useContext æ¥æº ä½œè€…ï¼šäººäººè´·å¤§å‰ç«¯æŠ€æœ¯ä¸­å¿ƒé“¾æ¥ï¼šhttps://juejin.im/post/5d072b5e518825490d53dee6æ¥æºï¼šæ˜é‡‘ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://lry61.cn/blog/tags/å‰ç«¯/"}]},{"title":"React Hooksç³»åˆ—ä¹‹useMemoä¸useCallback","date":"2020-01-09T14:03:30.353Z","path":"/posts/12/","text":"React Hooksç³»åˆ—ä¹‹useMemoä¸useCallback å‰è¨€åœ¨å‰é¢å‡ ç« ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨hookså®ç°äº†åœ¨å‡½æ•°ç»„ä»¶ä¸­åˆ›å»ºå†…éƒ¨stateã€‚ä½†æ˜¯ï¼Œä½¿ç”¨functionçš„å½¢å¼ï¼Œæˆ‘ä»¬å¤±å»äº†åŸºäºclassçš„å½¢å¼åˆ›å»ºç»„ä»¶çš„shouldComponentUpdateï¼Œæˆ‘ä»¬æ— æ³•å†é€šè¿‡åˆ¤æ–­å‰åçŠ¶æ€æ¥å†³å®šæ˜¯å¦æ›´æ–°ã€‚è€Œä¸”ï¼Œåœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œreactä¹Ÿä¸å†åŒºåˆ†mountå’Œupdateè¿™ä¸¤ä¸ªçŠ¶æ€ï¼Œè¿™æ„å‘³ç€æ¯ä¸€æ¬¡è°ƒç”¨å‡½æ•°ç»„ä»¶ï¼Œéƒ½ä¼šæ‰§è¡Œå®ƒå†…éƒ¨çš„æ‰€æœ‰é€»è¾‘ï¼Œä¼šå¸¦æ¥å¾ˆå¤§çš„æ€§èƒ½æŸè€—ã€‚å› æ­¤ï¼Œè§£å†³æ€§èƒ½é—®é¢˜çš„æ€æ‰‹é”â€”â€”useMemoå’ŒuseCallbackè¯ç”Ÿäº†ï¼ æ­£æ–‡ç®€å•çš„ä»‹ç»â€» useMemoç®€ä»‹useMemoå¯ä»¥ç”¨æ¥ç¼“å­˜è®¡ç®—ç»“æœã€‚å®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°ï¼ˆè®¡ç®—è¿‡ç¨‹ï¼Œå¿…é¡»è¿”å›ä¸€ä¸ªç»“æœï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä¾èµ–é¡¹æ•°ç»„ï¼Œå½“ä¾èµ–é¡¹ä¸­çš„æŸä¸€é¡¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç»“æœå°†ä¼šé‡æ–°è®¡ç®—ã€‚useMemoè°ƒç”¨ç­¾åå¦‚ä¸‹: 1function useMemo&lt;T&gt;(factory: () =&gt; T, deps: DependencyList | undefined): T; â€» useCallbackç®€ä»‹useCallbackçš„ä½¿ç”¨ä¸useMemoåŸºæœ¬ä¸€è‡´ï¼Œåªä¸è¿‡useCallbackç¼“å­˜çš„æ˜¯ä¸€ä¸ªå‡½æ•°ä½“ã€‚å½“ä¾èµ–é¡¹æ•°ç»„ä¸­çš„æŸä¸€é¡¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå‡½æ•°ä½“ä¼šé‡æ–°åˆ›å»ºã€‚useCallbackè°ƒç”¨ç­¾åå¦‚ä¸‹: 1function useCallback&lt;T extends (...args: any[]) =&gt; any&gt;(callback: T, deps: DepencyList | undefined): T; å¯¹æ¯”useEffectuseMemoä¸useCallbackçš„å‚æ•°ä¸useEffectçš„å‚æ•°ä¸€è‡´ï¼Œå®ƒä»¬æœ€å¤§çš„åŒºåˆ«å°±æ˜¯useEffectä¼šå¤„ç†å‰¯ä½œç”¨ã€‚useMemoå’ŒuseCallbackéƒ½ä¼šåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™æ‰§è¡Œï¼Œä¹‹ååªåœ¨ä¾èµ–é¡¹æ•°ç»„å‘ç”Ÿå˜åŒ–æ—¶å†æ¬¡æ‰§è¡Œã€‚ â€» useMemoæˆ‘ä»¬å…ˆçœ‹ä¸‹è¿™ä¸ªä¾‹å­ 1234567891011121314151617181920function Example() { const [count, setCount] = useState(0); const [val, setVal] = useState(\"\"); const sum = () =&gt; { console.log(\"é‡æ–°è®¡ç®—ä¸€æ¬¡\"); let _sum = 0; for (let i = 1; i &lt;= count; i++) { _sum += i; } return _sum; }; return ( &lt;div&gt; &lt;input value={val} onChange={e =&gt; setVal(e.target.value)} /&gt; &lt;div&gt;countå€¼ä¸º:{count}&lt;/div&gt; &lt;div&gt;_sumå€¼ä¸º:{sum()}&lt;/div&gt; &lt;button onClick={() =&gt; setCount(count + 1)}&gt;count+&lt;/button&gt; &lt;/div&gt; );} äº²è‡ªè¯•ä¸€è¯•ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°:æ— è®ºæ˜¯ä¿®æ”¹countè¿˜æ˜¯valï¼Œéƒ½ä¼šè§¦å‘sumçš„é‡æ–°æ‰§è¡Œã€‚ä½†æ˜¯æˆ‘ä»¬çš„sumè®¡ç®—å‡½æ•°åªä¾èµ–countï¼Œåœ¨ä¿®æ”¹valçš„æ—¶å€™ï¼Œæ˜¯æ²¡æœ‰å¿…è¦å†æ¬¡è¿›è¡Œé¢å¤–çš„è®¡ç®—çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨useMemoæ¥ç¼“å­˜è®¡ç®—å‡½æ•°sumï¼Œåªåœ¨countå˜åŒ–æ—¶æ‰æ‰§è¡Œã€‚äº²è‡ªè¯•ä¸€è¯• 1234567891011121314151617181920function Example() { const [count, setCount] = useState(0); const [val, setVal] = useState(\"\"); const sum = useMemo(() =&gt; {//æ³¨æ„è¿™é‡Œçš„å˜åŒ– console.log(\"é‡æ–°è®¡ç®—ä¸€æ¬¡\"); let _sum = 0; for (let i = 1; i &lt;= count; i++) { _sum += i; } return _sum; }, [count]); //æ³¨æ„è¿™é‡Œçš„å˜åŒ– return ( &lt;div&gt; &lt;input value={val} onChange={e =&gt; setVal(e.target.value)} /&gt; &lt;div&gt;countå€¼ä¸º:{count}&lt;/div&gt; &lt;div&gt;_sumå€¼ä¸º:{sum}&lt;/div&gt;{/* æ³¨æ„è¿™é‡Œçš„å˜åŒ– */} &lt;button onClick={() =&gt; setCount(count + 1)}&gt;count+&lt;/button&gt; &lt;/div&gt; );} â€» useCallbackç»å¸¸ä½¿ç”¨Reactçš„æœ‹å‹ï¼Œåº”è¯¥éƒ½æœ‰è¿‡è¿™æ ·çš„ä½¿ç”¨åœºæ™¯ï¼šå­˜åœ¨ä¸€ä¸ªçˆ¶ç»„ä»¶Parentï¼Œé‡Œé¢åŒ…å«ä¸€ä¸ªå­ç»„ä»¶Childï¼Œå­ç»„ä»¶Childæ¥æ”¶ä¸€ä¸ªå‡½æ•°callbackä½œä¸ºpropsã€‚å¦‚æœçˆ¶ç»„ä»¶æ›´æ–°äº†ï¼Œå­ç»„ä»¶ä¹Ÿä¼šæ›´æ–°ï¼ˆä¸ç®¡å½±å“çˆ¶ç»„ä»¶æ›´æ–°çš„å€¼å­ç»„ä»¶æœ‰æ²¡æœ‰ç”¨åˆ°ï¼‰ã€‚å…¶å®ï¼Œè¿™æ ·çš„æ›´æ–°æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚äº²è‡ªè¯•ä¸€è¯•ä¸‹é¢çš„ä¾‹å­ 1234567891011121314151617181920212223function Parent() { const [count, setCount] = useState(0); const [val, setVal] = useState(\"\"); const callback = () =&gt; { console.log(\"ç»„ä»¶æ›´æ–°æ—¶æ¸²æŸ“\"); return count; }; return ( &lt;div&gt; &lt;input value={val} onChange={e =&gt; setVal(e.target.value)} /&gt; &lt;div&gt;countå€¼ä¸º:{count}&lt;/div&gt; &lt;button onClick={() =&gt; setCount(count + 1)}&gt;count+&lt;/button&gt; &lt;Child callback={callback} /&gt; &lt;/div&gt; );}function Child({ callback }) { const [val, setVal] = useState(() =&gt; callback()); useEffect(() =&gt; { setVal(callback()); }, [callback]); return &lt;div&gt;Childç»„ä»¶å€¼ä¸º:{val}&lt;/div&gt;;} æˆ‘ä»¬å¯ä»¥å€ŸåŠ©useCallbackæ¥è¿”å›å‡½æ•°ï¼Œç„¶åæŠŠè¿™ä¸ªå‡½æ•°ä½œä¸ºpropsä¼ é€’ç»™å­ç»„ä»¶ï¼Œè¿™æ ·å­ç»„ä»¶å°±å¯ä»¥é¿å…ä¸å¿…è¦çš„æ›´æ–°ã€‚äº²è‡ªè¯•ä¸€è¯•ã€‚ 1234567891011121314151617181920212223function Parent() { const [count, setCount] = useState(0); const [val, setVal] = useState(\"\"); const callback = useCallback(() =&gt; {//æ³¨æ„è¿™é‡Œçš„å˜åŒ– console.log(\"ç»„ä»¶æ›´æ–°æ—¶æ¸²æŸ“\"); return count; }, [count]);//æ³¨æ„è¿™é‡Œçš„å˜åŒ– return ( &lt;div&gt; &lt;input value={val} onChange={e =&gt; setVal(e.target.value)} /&gt; &lt;div&gt;countå€¼ä¸º:{count}&lt;/div&gt; &lt;button onClick={() =&gt; setCount(count + 1)}&gt;count+&lt;/button&gt; &lt;Child callback={callback} /&gt; &lt;/div&gt; );}function Child({ callback }) { const [val, setVal] = useState(() =&gt; callback()); useEffect(() =&gt; { setVal(callback()); }, [callback]); return &lt;div&gt;Childç»„ä»¶å€¼ä¸º:{val}&lt;/div&gt;;} æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¾èµ–æœ¬åœ°çŠ¶æ€æˆ–propsæ¥åˆ›å»ºçš„å‡½æ•°ï¼Œéœ€è¦ç”¨åˆ°ç¼“å­˜å‡½æ•°çš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥ç”¨useCallbackæ¥è§£å†³ã€‚ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨åˆé€‚ï¼Ÿå½“æˆ‘ä»¬ä½¿ç”¨useMemoå’ŒuseCallbackæ—¶ï¼Œä¼šæ–°å¢è®¸å¤šçš„é—­åŒ…å‡½æ•°ï¼Œå¦‚æœç›²ç›®çš„ä½¿ç”¨ï¼Œå¯èƒ½ä¼šä½¿ä½ çš„ç»„ä»¶åè€Œå˜å¾—æ›´æ…¢ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬åº”è¯¥ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å®ƒä»¬å‘¢ï¼Ÿé€šå¸¸æƒ…å†µä¸‹ï¼Œå½“å‡½æ•°ä½“æˆ–è€…ç»“æœè®¡ç®—è¿‡äºå¤æ‚æ—¶ï¼Œæˆ‘ä»¬æ‰ä¼šè€ƒè™‘ä½¿ç”¨useMemoå’ŒuseCallbackã€‚ä¸è¿‡ï¼Œå¦‚æœä¾èµ–é¡¹æ•°ç»„å˜åŒ–å¤ªé¢‘ç¹ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦è€ƒè™‘ä½¿ç”¨useMemoå’ŒuseCallbackæ˜¯å¦åˆ’ç®—ã€‚ ç»“æŸè¯­ å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£~ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://lry61.cn/blog/tags/å‰ç«¯/"}]},{"title":"æ·±æ‹·è´ä¸æµ…æ‹·è´","date":"2020-01-06T09:11:21.363Z","path":"/posts/11/","text":"æ·±æ‹·è´ä¸æµ…æ‹·è´ å‰è¨€â€œæ·±æ‹·è´ä¸æµ…æ‹·è´â€ä¸€ç›´ä»¥æ¥éƒ½æ˜¯é«˜é¢‘é¢è¯•é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•åŒºåˆ†æ·±æ‹·è´ä¸æµ…æ‹·è´å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œå°±æ˜¯å‡è®¾Aå¤åˆ¶äº†Bï¼Œå½“ä¿®æ”¹Bæ—¶ï¼ŒæŸ¥çœ‹Aæ˜¯å¦ä¼šå‘ç”Ÿå˜åŒ–ã€‚å¦‚æœAè·Ÿç€å˜åŒ–ï¼Œåˆ™è¯´æ˜æ˜¯æµ…æ‹·è´ï¼Œå¦åˆ™å°±æ˜¯æ·±æ‹·è´ã€‚å…¶å®ï¼Œæµ…æ‹·è´æ˜¯æ‹·è´ä¸€å±‚ï¼Œæ·±å±‚æ¬¡çš„å¯¹è±¡çº§åˆ«æ‹·è´çš„æ˜¯å¼•ç”¨ï¼›æ·±æ‹·è´æ˜¯æ‹·è´å¤šå±‚ï¼Œæ¯ä¸€ä¸ªçº§åˆ«çš„æ•°æ®éƒ½ä¼šè¢«æ‹·è´å‡ºæ¥åœ¨æ·±å…¥äº†è§£æ·±æ‹·è´ä¸æµ…æ‹·è´ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸‹å †æ ˆå’ŒJavaScriptæ•°æ®ç±»å‹ã€‚ æ­£æ–‡JavaScriptæ•°æ®ç±»å‹JavaScriptæ•°æ®ç±»å‹åˆ†ä¸ºä¸¤å¤§ç§ï¼š åŸºæœ¬ç±»å‹ï¼ˆnumberã€stringã€booleanã€undefinedã€nullã€symbolï¼‰åŸºæœ¬æ•°æ®ç±»å‹å¯ä»¥ç›´æ¥è®¿é—®ï¼Œå®ƒä»¬æ˜¯æŒ‰å€¼åˆ†é…çš„ï¼Œå­˜æ”¾åœ¨æ ˆï¼ˆstackï¼‰å†…å­˜ä¸­çš„ç®€å•æ•°æ®æ®µï¼Œæ•°æ®å¤§å°ç¡®å®šï¼Œå†…å­˜ç©ºé—´å¤§å°å¯ä»¥åˆ†é…ã€‚åŸºæœ¬ç±»å‹çš„å¤åˆ¶ï¼Œä¼šåœ¨æ ˆå†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªæ–°çš„ç©ºé—´ï¼Œå•ç‹¬ä¿®æ”¹å˜é‡äº’ä¸å½±å“ã€‚ å¼•ç”¨ç±»å‹ï¼ˆobjectï¼‰å­˜æ”¾åœ¨å †ï¼ˆheapï¼‰å†…å­˜ä¸­çš„å¯¹è±¡ï¼Œå˜é‡å®é™…ä¿å­˜çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å¦ä¸€ä¸ªä½ç½®ã€‚å¼•ç”¨ç±»å‹çš„å¤åˆ¶ï¼Œä¹Ÿä¼šä¸ºæ–°å˜é‡è‡ªåŠ¨åˆ†é…ä¸€ä¸ªæ ˆå†…å­˜ç©ºé—´ï¼Œä½†æ˜¯ä¿å­˜çš„åªæ˜¯å¼•ç”¨ç±»å‹çš„ä¸€ä¸ªæŒ‡é’ˆã€‚å½“æŒ‡é’ˆåœ°å€ç›¸åŒæ—¶ï¼Œè®¿é—®åˆ°çš„å †å†…å­˜ä¸­çš„å…·ä½“å¯¹è±¡å®é™…æ˜¯åŒä¸€ä¸ªï¼Œå½“ä¸€ä¸ªæ”¹å˜æ—¶ï¼Œå¦ä¸€ä¸ªä¹Ÿè·Ÿç€æ”¹å˜ã€‚ å †å’Œæ ˆçš„åŒºåˆ«åœ¨è®¡ç®—æœºé¢†åŸŸä¸­ï¼Œå †æ ˆæ˜¯ä¸¤ç§æ•°æ®ç»“æ„ã€‚ æ ˆ(stack) è‡ªåŠ¨åˆ†é…å†…å­˜ç©ºé—´ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾ã€‚ å­˜æ”¾åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ã€å¼•ç”¨ç±»å‹çš„åœ°å€ï¼ˆå¯¹è±¡çš„å¼•ç”¨ï¼‰ï¼ŒæŒ‰å€¼è®¿é—®ï¼Œå…ˆè¿›åå‡ºã€‚ åŠ¨æ€åˆ†é…çš„ç©ºé—´ä¸€èˆ¬ç”±ç¨‹åºå‘˜åˆ†é…é‡Šæ”¾ï¼Œè‹¥ç¨‹åºå‘˜ä¸é‡Šæ”¾ï¼Œç¨‹åºç»“æŸæ—¶ç”±OSå›æ”¶ å¯¹è±¡å¤åˆ¶çš„æ—¶å€™ï¼Œå¤åˆ¶çš„æ˜¯æ ˆä¸­çš„åœ°å€è€Œä¸æ˜¯å †ä¸­çš„å¯¹è±¡ï¼Œä¸¤ä¸ªåœ°å€æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚ å †ï¼ˆheapï¼‰ åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œå¤§å°ä¸å®šï¼Œä¸ä¼šè‡ªåŠ¨é‡Šæ”¾ã€‚ å­˜æ”¾å¼•ç”¨æ•°æ®ç±»å‹çš„å¯¹è±¡å€¼ã€å‡½æ•°çš„å‚æ•°å€¼ã€å±€éƒ¨å˜é‡çš„å€¼ç­‰ï¼Œé˜Ÿåˆ—ä¼˜å…ˆï¼Œå…ˆè¿›å…ˆå‡ºã€‚ å¼•ç”¨æ•°æ®ç±»å‹çš„å€¼æ˜¯ä¿å­˜åœ¨å †å†…å­˜ä¸­çš„å¯¹è±¡ï¼ŒJavaScriptä¸å…è®¸ç›´æ¥è®¿é—®å †å†…å­˜ä¸­çš„ä½ç½®ã€‚ ä¸èƒ½ç›´æ¥æ“ä½œå¯¹è±¡çš„å †å†…å­˜ç©ºé—´ï¼Œæ“ä½œå¯¹è±¡æ—¶ï¼Œå®é™…æ“ä½œçš„æ˜¯å¯¹è±¡çš„å¼•ç”¨è€Œä¸æ˜¯å¯¹è±¡æœ¬èº«ã€‚ æˆ‘ä»¬ä»¥ä¸€ä¸ªç®€å•çš„èµ‹å€¼ä¾‹å­æ¥çœ‹ä¸‹: 1234567891011let a = 1;let b = a;a = 2;console.log(a); //2console.log(b); //1let c = {name: \"lry\"};let d = c;d.name = \"LRY0504\";console.log(c); //{name: \"LRY0504\"}console.log(d); //{name: \"LRY0504\"} ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå˜é‡è¿˜æœªå˜åŒ–æ—¶ï¼Œå¯ä»¥ç”»å‡ºå¦‚ä¸‹å †æ ˆå›¾: å½“å¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œèµ‹å€¼æ—¶ï¼Œéƒ½ä¼šåœ¨æ ˆå†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªæ–°çš„å†…å­˜ç©ºé—´ã€‚ä½†å¯¹äºåŸºç¡€æ•°æ®ç±»å‹è€Œè¨€ï¼Œæ–°çš„å†…å­˜ç©ºé—´å­˜çš„æ˜¯æ•°æ®æœ¬èº«ï¼Œä¸ä¼šç›¸äº’å½±å“ï¼›å¯¹äºå¼•ç”¨æ•°æ®ç±»å‹è€Œè¨€ï¼Œå†…å­˜ç©ºé—´å­˜çš„åªæ˜¯ä¸€ä¸ªåœ°å€æŒ‡é’ˆï¼ˆå¯¹è±¡çš„å¼•ç”¨ï¼‰ï¼ŒæŒ‡å‘å †å†…å­˜é‡Œçš„å®é™…å¯¹è±¡æ•°æ®ã€‚ç”±æ­¤å¯è§ï¼Œæ·±æµ…æ‹·è´æ˜¯ç›¸å¯¹äºå¼•ç”¨ç±»å‹çš„ èµ‹å€¼ä¸æµ…æ‹·è´æˆ‘ä»¬å…ˆçœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼Œæ¯”è¾ƒèµ‹å€¼ä¸æµ…æ‹·è´ä¼šå¯¹åŸå¯¹è±¡å¸¦æ¥å“ªäº›æ”¹å˜ã€‚å¯¹è±¡èµ‹å€¼ 1234567891011var obj1 = { name: \"lry\", age: 24, hobby: [\"music\", \"game\", \"basketball\"]};var obj2 = obj1;obj2.name = \"LRY0504\";obj2.hobby[0] = \"book\";console.log(obj1);console.log(obj2); è¿è¡Œä¸Šé¢çš„ä¾‹å­ï¼Œäº§ç”Ÿä¸‹é¢çš„ç»“æœ: æµ…æ‹·è´ 1234567891011121314151617181920var obj1 = { name: \"lry\", age: 24, hobby: [\"music\", \"game\", \"basketball\"]};var obj2 = shallowCopy(obj1);obj2.name = \"LRY0504\";obj2.hobby[0] = \"book\";function shallowCopy(obj) { var res = {}; for(var prop in obj) { if(obj.hasOwnProperty(prop)) { res[prop] = obj[prop]; } } return res;}console.log(obj1);console.log(obj2); è¿è¡Œä¸Šé¢çš„ä¾‹å­ï¼Œå…¶ä¸­å‡½æ•°shallowCopyæ˜¯ä¸€ä¸ªç®€å•çš„æµ…æ‹·è´å®ç°æ–¹å¼ï¼Œäº§ç”Ÿä¸‹é¢çš„ç»“æœ: ç”±ä¸Šé¢ä¸¤ä¸ªä¾‹å­å¯ä»¥çœ‹å‡º: æ‰€è°“â€œèµ‹å€¼â€ï¼Œèµ‹çš„å…¶å®æ˜¯è¯¥å¯¹è±¡åœ¨æ ˆä¸­çš„åœ°å€ï¼Œè€Œä¸æ˜¯å †ä¸­çš„æ•°æ®ã€‚å³ä¸¤ä¸ªå¯¹è±¡æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå­˜å‚¨ç©ºé—´ï¼Œæ— è®ºå“ªä¸ªå¯¹è±¡å‘ç”Ÿæ”¹å˜ï¼Œå…¶å®æ”¹å˜çš„éƒ½æ˜¯å­˜å‚¨ç©ºé—´çš„å†…å®¹ï¼Œå¦ä¸€ä¸ªå¯¹è±¡ä¹Ÿä¼šè·Ÿç€æ”¹å˜ã€‚ æµ…æ‹·è´ä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æœ‰ç€åŸå§‹å¯¹è±¡å±æ€§çš„ä¸€ä»½ç²¾ç¡®æ‹·è´ã€‚å¦‚æœå±æ€§æ˜¯åŸºæœ¬ç±»å‹ï¼Œæ‹·è´çš„å°±æ˜¯åŸºæœ¬ç±»å‹çš„å€¼ï¼›å¦‚æœå±æ€§æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‹·è´çš„å°±æ˜¯å†…å­˜åœ°å€ ã€‚å› æ­¤å¦‚æœå…¶ä¸­ä¸€ä¸ªå¯¹è±¡æ”¹å˜äº†è¿™ä¸ªåœ°å€ï¼Œå°±ä¼šå½±å“åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚ æµ…æ‹·è´çš„å®ç°â€» Object.assignObject.assign()æ–¹æ³•å¯ä»¥æŠŠä»»æ„å¤šä¸ªçš„æºå¯¹è±¡è‡ªèº«çš„å¯æšä¸¾å±æ€§æ‹·è´ç»™ç›®æ ‡å¯¹è±¡ï¼Œç„¶åè¿”å›ç›®æ ‡å¯¹è±¡ã€‚ 1234567891011121314151617var obj1 = { name: \"lry\", age: 24, hobby: [\"music\", \"basketball\", \"game\"], data: { name: \"è¯•é¢˜ä¿¡æ¯\", quesList: [1, 2, [3, 4]] }};var obj2 = Object.assign({}, obj1);obj2.name = \"LRY0504\";obj2.hobby[0] = \"book\";obj2.data.name = \"è¯•é¢˜åˆ—è¡¨\";obj2.data.quesList[0] = 5;obj2.data.quesList[2][0] = 6;console.log(obj1);console.log(obj2); ä¸Šé¢ä»£ç çš„è¿è¡Œç»“æœå¦‚ä¸‹å›¾: ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨Object.assign()æ‹·è´è¿‡çš„å¯¹è±¡ï¼Œç¬¬ä¸€å±‚æ•°æ®å¹¶æ²¡æœ‰éšç€obj2çš„æ”¹å˜è€Œæ”¹å˜ï¼Œç¬¬äºŒå±‚åŠæ›´æ·±å±‚çš„æ•°æ®éšç€obj2çš„æ”¹å˜è€Œæ”¹å˜ã€‚äº²è‡ªè¯•ä¸€è¯•å› æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®º:Object.assign()ç¬¬ä¸€å±‚æ˜¯æ·±æ‹·è´ï¼Œç¬¬äºŒåŠæ›´æ·±å±‚æ˜¯æµ…æ‹·è´ â€» concatä¸sliceconcatä¸sliceæ˜¯ç›¸å¯¹äºæ•°ç»„Arrayå±‚é¢çš„æµ…æ‹·è´ã€‚ 1234567891011121314151617181920var obj1 = [ { name: \"lry\", age: 24, hobby: [\"music\", \"basketball\", \"game\"], data: { name: \"è¯•é¢˜ä¿¡æ¯\", quesList: [1, 2, [3, 4]] } }];var obj2 = obj1.concat();// var obj2 = obj1.slice();obj2[0].name = \"LRY0504\";obj2[0].hobby[0] = \"book\";obj2[0].data.name = \"è¯•é¢˜åˆ—è¡¨\";obj2[0].data.quesList[0] = 5;obj2[0].data.quesList[2][0] = 6;console.log(obj1);console.log(obj2); è¿è¡Œä¸Šé¢çš„ä¾‹å­ï¼Œå¾—å‡ºå¦‚ä¸‹ç»“æœ: æ·±æ‹·è´çš„å®ç° ä¸ºäº†ç®€åŒ–ä»£ç ï¼Œä¸‹é¢æ‰€æœ‰ä¾‹å­éƒ½ä½¿ç”¨ä¸Šé¢Object.assign()çš„obj1ä½œä¸ºåŸºç¡€å¯¹è±¡ åºåˆ—åŒ–ååºåˆ—åŒ–æ³•ä½¿ç”¨JSON.parseå’ŒJSON.stringifyæ–¹æ³•å¯ä»¥å®ç°æ·±æ‹·è´ã€‚ 12345678var obj2 = JSON.parse(JSON.stringify(obj1));obj2.name = \"LRY0504\";obj2.hobby[0] = \"book\";obj2.data.name = \"è¯•é¢˜åˆ—è¡¨\";obj2.data.quesList[0] = 5;obj2.data.quesList[2][0] = 6;console.log(obj1);console.log(obj2); è¿è¡Œä¸Šé¢çš„ä¾‹å­ï¼Œç»“æœå¦‚å›¾: æ³¨æ„ï¼šè¿™ç§æ–¹æ³•åªèƒ½å®ç°å¯¹è±¡æˆ–æ•°æ®çš„æ·±æ‹·è´ï¼Œä¸èƒ½å¤„ç†å‡½æ•°function è¿­ä»£é€’å½’æ³•è¿­ä»£é€’å½’æ³•å®ç°æ·±æ‹·è´åŸç†ï¼šéå†å¯¹è±¡ã€æ•°ç»„ï¼Œç›´åˆ°é‡Œè¾¹éƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œç„¶åå†å»å¤åˆ¶ï¼Œå°±æ˜¯æ·±åº¦æ‹·è´ã€‚ 123456789101112131415function isObject(o) { return (typeof o === \"object\" || typeof o === \"function\") &amp;&amp; o !== null;}function deepClone(obj) { if (!isObject(obj)) { throw new Error(\"objä¸æ˜¯ä¸€ä¸ªå¯¹è±¡!\"); } let isArray = Array.isArray(obj); let cloneObj = isArray ? [] : {}; for (let key in obj) { cloneObj[key] = isObject(obj[key]) ? deepClone(obj[key]) : obj[key]; } return cloneObj;} è¿è¡Œä¸Šé¢çš„ä¾‹å­ï¼Œå‘ç°ç»“æœä¸ä¸Šé¢ç»“æœä¸€è‡´ã€‚äº²è‡ªè¯•ä¸€è¯• ç»“æŸè¯­ å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£~ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://lry61.cn/blog/tags/å‰ç«¯/"}]},{"title":"React Hooksç³»åˆ—ä¹‹useRef","date":"2019-12-29T14:59:50.490Z","path":"/posts/10/","text":"React Hooksç³»åˆ—ä¹‹useRef å‰è¨€åœ¨React Hooksåˆæ¢ä¸­æˆ‘ä»¬æåˆ°ï¼šå¦‚æœä½ å°†refä»¥&lt;div ref={myRef}&gt;&lt;/div&gt;è¿™ç§æ–¹å¼ä¼ å…¥ç»„ä»¶ï¼Œåˆ™æ— è®ºè¯¥èŠ‚ç‚¹å¦‚ä½•æ”¹å˜ï¼ŒReactéƒ½ä¼šå°†refå¯¹è±¡çš„.currentå±æ€§è®¾ç½®ä¸ºå¯¹åº”çš„DOMèŠ‚ç‚¹ã€‚ æ³¨æ„ï¼Œå½“refå¯¹è±¡å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒuseRefå¹¶ä¸ä¼šé€šçŸ¥ä½ ã€‚å˜æ›´.currentå±æ€§ä¸ä¼šå¼•å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚å¦‚æœæƒ³è¦åœ¨Reactç»‘å®šæˆ–è§£ç»‘DOMèŠ‚ç‚¹çš„refæ—¶è¿è¡ŒæŸäº›ä»£ç ï¼Œåˆ™éœ€è¦ä½¿ç”¨å›è°ƒrefæ¥å®ç°ã€‚ æ­£æ–‡åªåœ¨æ›´æ–°æ—¶è¿è¡Œeffectè¿™æ˜¯ä¸ªæ¯”è¾ƒç½•è§çš„åœºæ™¯ã€‚å¦‚æœä½ éœ€è¦å®ç°çš„è¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¯å˜çš„refæ‰‹åŠ¨å­˜å‚¨ä¸€ä¸ªå¸ƒå°”å€¼æ¥è¡¨ç¤ºæ˜¯é¦–æ¬¡æ¸²æŸ“è¿˜æ˜¯åç»­æ¸²æŸ“ï¼Œç„¶ååœ¨ä½ çš„effecté‡Œæ£€æŸ¥è¿™ä¸ªæ ‡è¯†ã€‚ å¦‚æœæˆ‘ä»¬æŒ‰ç…§ä¸‹é¢æ“ä½œï¼š æ‰“å¼€æ§åˆ¶å°ï¼ŒæŸ¥çœ‹æ§åˆ¶å°ä¿¡æ¯ ç‚¹å‡»æŒ‰é’®ï¼ŒæŸ¥çœ‹æ§åˆ¶å°ä¿¡æ¯ å†æ¬¡ç‚¹å‡»æŒ‰é’®ï¼ŒæŸ¥çœ‹æ§åˆ¶å°ä¿¡æ¯æˆ‘ä»¬ä¼šå‘ç°ï¼Œæ­¤æ—¶çš„effectåªåœ¨é‡æ–°æ¸²æŸ“çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œã€‚è‡ªå·±è¯•ä¸€è¯• ä½ ä¹Ÿå¯ä»¥å°†å®ƒæŠ½å–æˆè‡ªå®šä¹‰Hookï¼š é‡å¤ä¸Šé¢çš„æ“ä½œï¼Œä¼šäº§ç”Ÿä¸‹é¢çš„ç»“æœã€‚è‡ªå·±è¯•ä¸€è¯• æ¸²æŸ“å‘¨æœŸé—´å…±äº«æ•°æ®çš„å­˜å‚¨å‡è®¾æˆ‘ä»¬æœ‰ä¸ªéœ€æ±‚ï¼šéœ€è¦åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œæ¯éš”ä¸€ç§’è®©countåŠ 1ï¼›å½“countå¤§äºç­‰äº5æ—¶ï¼Œæ¸…é™¤è¿™ä¸ªå®šæ—¶å™¨ã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“å†™å‡ºè¿™æ ·çš„ä»£ç ï¼š è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œå½“countç­‰äº5çš„æ—¶å€™å¹¶æ²¡æœ‰åœæ­¢ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ å› ä¸ºåœ¨ç¬¬äºŒä¸ªeffectçš„clearIntervalä¸­ï¼Œtimerå¹¶ä¸æ˜¯setIntervalèµ‹å€¼çš„é‚£ä¸ªäº†ï¼Œæ¯æ¬¡æ¸²æŸ“ï¼Œç»„ä»¶éƒ½ä¼šé‡ç½®å®ƒã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨useRefæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ ä½¿ç”¨useRefåˆ›å»ºä¸€ä¸ªtimerï¼Œå°†setIntervalè¿”å›çš„ç»“æœèµ‹å€¼ç»™timerçš„currentå±æ€§ã€‚ä¾¿èƒ½å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœäº†ã€‚è‡ªå·±è¯•ä¸€è¯• ç»“æŸè¯­ å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£~ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://lry61.cn/blog/tags/å‰ç«¯/"}]},{"title":"React Hooksç³»åˆ—ä¹‹useContext","date":"2019-12-26T08:15:16.147Z","path":"/posts/9/","text":"React Hooksç³»åˆ—ä¹‹useContext å‰è¨€åœ¨äº†è§£useContextä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸‹Reactä¸­çš„Contextã€‚ Contextæä¾›äº†ä¸€ä¸ªæ— éœ€ä¸ºæ¯å±‚ç»„ä»¶æ‰‹åŠ¨æ·»åŠ propsï¼Œå°±èƒ½åœ¨ç»„ä»¶æ ‘é—´è¿›è¡Œæ•°æ®ä¼ é€’çš„æ–¹æ³•ã€‚ åœ¨ä¸€ä¸ªå…¸å‹çš„Reactåº”ç”¨ä¸­ï¼Œæ•°æ®æ˜¯é€šè¿‡propså±æ€§è‡ªä¸Šè€Œä¸‹ï¼ˆç”±çˆ¶åˆ°å­ï¼‰å±‚å±‚ä¼ é€’çš„ï¼Œä½†è¿™ç§åšæ³•åœ¨å¤šå±‚ç»„ä»¶åµŒå¥—ä¸­æ˜¾å¾—æå…¶ç¹çã€‚Contextæä¾›äº†ä¸€ç§åœ¨ç»„ä»¶é—´å…±äº«æ­¤ç±»å€¼çš„æ–¹å¼ï¼Œè€Œä¸å¿…æ˜¾å¼åœ°é€šè¿‡ç»„ä»¶æ ‘é€å±‚ä¼ é€’propsã€‚ æ­£æ–‡React.createContext1const myContext = React.createContext(defaultValue); åˆ›å»ºä¸€ä¸ªContextå¯¹è±¡ï¼ˆè¿”å›Providerå’ŒConsumerå¯¹è±¡ï¼‰ã€‚å½“Reactæ¸²æŸ“è®¢é˜…è¿™ä¸ªContextå¯¹è±¡çš„ç»„ä»¶æ—¶ï¼Œç»„ä»¶ä¼šä»ç»„ä»¶æ ‘ä¸­æ‰¾åˆ°ç¦»è‡ªèº«æœ€è¿‘çš„Providerï¼Œè¯»å–å½“å‰çš„contextå€¼ã€‚å¦‚æœç»„ä»¶æ ‘ä¸­æ²¡æœ‰åŒ¹é…åˆ°Providerï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤å€¼defalutValueã€‚ Context.Provider1&lt;MyContext.Provider value={...}&gt; Provideræ¥æ”¶ä¸€ä¸ªvalueå±æ€§ï¼Œä¼ é€’ç»™Consumerç»„ä»¶ï¼Œå½“valueå€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå†…éƒ¨çš„æ‰€æœ‰Consumerç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚ æ³¨æ„ï¼šå¦‚æœæ¥å—çš„valueå±æ€§ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™åº”æŠŠvalueçŠ¶æ€æå‡åˆ°stateï¼Œå¦åˆ™æ¯æ¬¡æ¸²æŸ“valueå±æ€§éƒ½ä¼šè¢«èµ‹å€¼ä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¯¼è‡´å­ç»„ä»¶å…¨éƒ¨éƒ½ä¼šé‡æ–°æ¸²æŸ“ Context.Consumer123&lt;MyContext.Consumer&gt;{value =&gt; /* åŸºäºcontextå€¼è¿›è¡Œæ¸²æŸ“*/}&lt;/MyContext.Consumer&gt; å‡½æ•°ç»„ä»¶ä¹Ÿå¯ä»¥è®¢é˜…Contextå¯¹è±¡ï¼Œä½†éœ€è¦å‡½æ•°ä½œä¸ºå­å…ƒç´ ã€‚è¿™ä¸ªå‡½æ•°æ¥æ”¶å½“å‰çš„contextå€¼ï¼Œè¿”å›ä¸€ä¸ªReactèŠ‚ç‚¹ã€‚ä¼ é€’ç»™å‡½æ•°çš„valueå€¼ç­‰åŒäºå¾€ä¸Šç»„ä»¶æ ‘ç¦»è¿™ä¸ªcontextæœ€è¿‘çš„Provideræä¾›çš„valueå€¼ã€‚å¦‚æœæ²¡æœ‰å¯¹åº”çš„Providerï¼Œvalueå‚æ•°ç­‰åŒäºä¼ é€’ç»™createContext()çš„defaultValueã€‚ 12345678910111213const MyContext = React.createContext();function App() { return ( &lt;MyContext.Provider value={\"lry\"}&gt; &lt;Child /&gt; &lt;/MyContext.Provider&gt; );}function Child() { const value = useContext(MyContext); return &lt;div&gt;My name is {value}&lt;/div&gt;;} ä¸€èµ·è¯•ä¸€è¯• ä½¿ç”¨useContext1const value = useContext(MyContext); æ¥æ”¶ä¸€ä¸ªContextå¯¹è±¡ï¼ˆReact.createContextçš„è¿”å›å€¼ï¼‰å¹¶è¿”å›è¯¥contextçš„å½“å‰å€¼ã€‚å½“å‰çš„contextå€¼ç”±ä¸Šå±‚ç»„ä»¶ä¸­è·ç¦»å½“å‰ç»„ä»¶æœ€è¿‘çš„&lt;MyContext.Provider&gt;çš„value propå†³å®šã€‚å½“ç»„ä»¶ä¸Šå±‚æœ€è¿‘çš„&lt;MyContext.Provider&gt;æ›´æ–°æ—¶ï¼Œè¯¥Hookä¼šè§¦å‘é‡æ¸²æŸ“ï¼Œå¹¶ä½¿ç”¨æœ€æ–°ä¼ é€’ç»™MyContext providerçš„context valueå€¼ã€‚ä½¿ç”¨useContextæ”¹å†™ä¸Šé¢çš„ä¾‹å­ï¼š 12345678910111213const MyContext = React.createContext();function App() { return ( &lt;MyContext.Provider value={\"lry\"}&gt; &lt;Child /&gt; &lt;/MyContext.Provider&gt; );}function Child() { const value = useContext(MyContext); return &lt;div&gt;My name is {value}&lt;/div&gt;;} ç»“æŸè¯­ å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£~ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://lry61.cn/blog/tags/å‰ç«¯/"}]},{"title":"React Hooksç³»åˆ—ä¹‹useEffectï¼ˆä¸‰ï¼‰","date":"2019-12-25T09:02:55.752Z","path":"/posts/8/","text":"React Hooksç³»åˆ—ä¹‹useEffectï¼ˆä¸‰ï¼‰ å‰è¨€è¿˜è®°å¾—æˆ‘ä»¬è¯´è¿‡åŒæ­¥æ‰æ˜¯ç†è§£effectsçš„å¿ƒæ™ºæ¨¡å‹å—ï¼ŸåŒæ­¥çš„ä¸€ä¸ªæœ‰è¶£åœ°æ–¹åœ¨äºä½ é€šå¸¸æƒ³è¦æŠŠåŒæ­¥çš„â€œä¿¡æ¯â€å’ŒçŠ¶æ€è§£è€¦ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä½ åœ¨Google Docsç¼–è¾‘æ–‡æ¡£çš„æ—¶å€™ï¼ŒGoogleå¹¶ä¸ä¼šæŠŠæ•´ç¯‡æ–‡ç« å‘é€ç»™æœåŠ¡å™¨ã€‚é‚£æ ·åšä¼šéå¸¸ä½æ•ˆã€‚ç›¸åçš„ï¼Œå®ƒåªæ˜¯æŠŠä½ çš„ä¿®æ”¹ä»¥ä¸€ç§å½¢å¼å‘é€ç»™æœåŠ¡ç«¯ã€‚ è™½ç„¶æˆ‘ä»¬effectçš„æƒ…å†µä¸å°½ç›¸åŒï¼Œä½†å¯ä»¥åº”ç”¨ç±»ä¼¼çš„æ€æƒ³ã€‚åªåœ¨effectsä¸­ä¼ é€’æœ€å°çš„ä¿¡æ¯ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚ç±»ä¼¼äºsetCount(c =&gt; c + 1)è¿™æ ·çš„æ›´æ–°å½¢å¼æ¯”setCount(count + 1)ä¼ é€’äº†æ›´å°‘çš„ä¿¡æ¯ï¼Œå› ä¸ºå®ƒä¸å†è¢«å½“å‰çš„countå€¼â€œæ±¡æŸ“â€ã€‚å®ƒåªæ˜¯è¡¨è¾¾äº†ä¸€ç§è¡Œä¸ºï¼ˆâ€œé€’å¢â€ï¼‰ã€‚â€œThinking in Reactâ€ä¹Ÿè®¨è®ºäº†å¦‚ä½•æ‰¾åˆ°æœ€å°çŠ¶æ€ã€‚åŸåˆ™æ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡ç°åœ¨å…³æ³¨çš„æ˜¯å¦‚ä½•æ›´æ–°ã€‚ è¡¨è¾¾æ„å›¾ï¼ˆè€Œä¸æ˜¯ç»“æœï¼‰å’ŒGoogle Docså¦‚ä½•å¤„ç†å…±åŒç¼–è¾‘å¼‚æ›²åŒå·¥ã€‚è™½ç„¶è¿™ä¸ªç±»æ¯”ç•¥å¾®å»¶ä¼¸äº†ä¸€ç‚¹ï¼Œå‡½æ•°å¼æ›´æ–°åœ¨Reactä¸­æ‰®æ¼”äº†ç±»ä¼¼çš„è§’è‰²ã€‚å®ƒä»¬ç¡®ä¿èƒ½ä»¥æ‰¹é‡åœ°å’Œå¯é¢„æµ‹çš„æ–¹å¼æ¥å¤„ç†å„ç§æºå¤´ï¼ˆäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffectä¸­çš„è®¢é˜…ï¼Œç­‰ç­‰ï¼‰çš„çŠ¶æ€æ›´æ–°ã€‚ ç„¶è€Œï¼Œå³ä½¿æ˜¯setCount(c =&gt; c + 1)ä¹Ÿå¹¶ä¸å®Œç¾ã€‚å®ƒçœ‹èµ·æ¥æœ‰ç‚¹æ€ªï¼Œå¹¶ä¸”éå¸¸å—é™äºå®ƒèƒ½åšçš„äº‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸¤ä¸ªäº’ç›¸ä¾èµ–çš„çŠ¶æ€ï¼Œæˆ–è€…æˆ‘ä»¬æƒ³åŸºäºä¸€ä¸ªpropæ¥è®¡ç®—ä¸‹ä¸€æ¬¡çš„stateï¼Œå®ƒå¹¶ä¸èƒ½åšåˆ°ã€‚å¹¸è¿çš„æ˜¯ï¼Œ setCount(c =&gt; c + 1)æœ‰ä¸€ä¸ªæ›´å¼ºå¤§çš„å§å¦¹æ¨¡å¼ï¼Œå®ƒçš„åå­—å«useReducerã€‚ æ­£æ–‡è§£è€¦æ¥è‡ªActionsçš„æ›´æ–°æˆ‘ä»¬æ¥ä¿®æ”¹ä¸Šé¢çš„ä¾‹å­è®©å®ƒåŒ…å«ä¸¤ä¸ªçŠ¶æ€ï¼šcount å’Œ stepã€‚æˆ‘ä»¬çš„å®šæ—¶å™¨ä¼šæ¯æ¬¡åœ¨countä¸Šå¢åŠ ä¸€ä¸ªstepå€¼ï¼š 123456789101112131415161718function Counter() { const [count, setCount] = useState(0); const [step, setStep] = useState(1); useEffect(() =&gt; { const id = setInterval(() =&gt; { setCount(c =&gt; c + step); }, 1000); return () =&gt; clearInterval(id); }, [step]); return ( &lt;&gt; &lt;h1&gt;{count}&lt;/h1&gt; &lt;input value={step} onChange={e =&gt; setStep(Number(e.target.value))} /&gt; &lt;/&gt; );} (è¿™é‡Œæ˜¯demo) æ³¨æ„æˆ‘ä»¬æ²¡æœ‰æ’’è°ã€‚æ—¢ç„¶æˆ‘ä»¬åœ¨effecté‡Œä½¿ç”¨äº†stepï¼Œæˆ‘ä»¬å°±æŠŠå®ƒåŠ åˆ°ä¾èµ–é‡Œã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä»£ç èƒ½è¿è¡Œæ­£ç¡®ã€‚ è¿™ä¸ªä¾‹å­ç›®å‰çš„è¡Œä¸ºæ˜¯ä¿®æ”¹stepä¼šé‡å¯å®šæ—¶å™¨ - å› ä¸ºå®ƒæ˜¯ä¾èµ–é¡¹ä¹‹ä¸€ã€‚åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œè¿™æ­£æ˜¯ä½ æ‰€éœ€è¦çš„ã€‚æ¸…é™¤ä¸Šä¸€æ¬¡çš„effectç„¶åé‡æ–°è¿è¡Œæ–°çš„effectå¹¶æ²¡æœ‰ä»»ä½•é”™ã€‚é™¤éæˆ‘ä»¬æœ‰å¾ˆå¥½çš„ç†ç”±ï¼Œæˆ‘ä»¬ä¸åº”è¯¥æ”¹å˜è¿™ä¸ªé»˜è®¤è¡Œä¸ºã€‚ ä¸è¿‡ï¼Œå‡å¦‚æˆ‘ä»¬ä¸æƒ³åœ¨stepæ”¹å˜åé‡å¯å®šæ—¶å™¨ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•ä»effectä¸­ç§»é™¤å¯¹stepçš„ä¾èµ–å‘¢ï¼Ÿ å½“ä½ æƒ³æ›´æ–°ä¸€ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸”è¿™ä¸ªçŠ¶æ€æ›´æ–°ä¾èµ–äºå¦ä¸€ä¸ªçŠ¶æ€çš„å€¼æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ç”¨useReducerå»æ›¿æ¢å®ƒä»¬ã€‚ å½“ä½ å†™ç±»ä¼¼setSomething(something =&gt; â€¦)è¿™ç§ä»£ç çš„æ—¶å€™ï¼Œä¹Ÿè®¸å°±æ˜¯è€ƒè™‘ä½¿ç”¨reducerçš„å¥‘æœºã€‚reducerå¯ä»¥è®©ä½ æŠŠç»„ä»¶å†…å‘ç”Ÿäº†ä»€ä¹ˆ(actions)å’ŒçŠ¶æ€å¦‚ä½•å“åº”å¹¶æ›´æ–°åˆ†å¼€è¡¨è¿°ã€‚ æˆ‘ä»¬ç”¨ä¸€ä¸ªdispatchä¾èµ–å»æ›¿æ¢effectçš„stepä¾èµ–ï¼š 123456789const [state, dispatch] = useReducer(reducer, initialState);const { count, step } = state;useEffect(() =&gt; { const id = setInterval(() =&gt; { dispatch({ type: 'tick' }); // Instead of setCount(c =&gt; c + step); }, 1000); return () =&gt; clearInterval(id);}, [dispatch]); (æŸ¥çœ‹demo) ä½ å¯èƒ½ä¼šé—®ï¼šâ€œè¿™æ€ä¹ˆå°±æ›´å¥½äº†ï¼Ÿâ€ç­”æ¡ˆæ˜¯Reactä¼šä¿è¯dispatchåœ¨ç»„ä»¶çš„å£°æ˜å‘¨æœŸå†…ä¿æŒä¸å˜ã€‚æ‰€ä»¥ä¸Šé¢ä¾‹å­ä¸­ä¸å†éœ€è¦é‡æ–°è®¢é˜…å®šæ—¶å™¨ã€‚ æˆ‘ä»¬è§£å†³äº†é—®é¢˜! ï¼ˆä½ å¯ä»¥ä»ä¾èµ–ä¸­å»é™¤dispatch, setState, å’ŒuseRefåŒ…è£¹çš„å€¼å› ä¸ºReactä¼šç¡®ä¿å®ƒä»¬æ˜¯é™æ€çš„ã€‚ä¸è¿‡ä½ è®¾ç½®äº†å®ƒä»¬ä½œä¸ºä¾èµ–ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ã€‚ï¼‰ ç›¸æ¯”äºç›´æ¥åœ¨effecté‡Œé¢è¯»å–çŠ¶æ€ï¼Œå®ƒdispatchäº†ä¸€ä¸ªactionæ¥æè¿°å‘ç”Ÿäº†ä»€ä¹ˆã€‚è¿™ä½¿å¾—æˆ‘ä»¬çš„effectå’ŒstepçŠ¶æ€è§£è€¦ã€‚æˆ‘ä»¬çš„effectä¸å†å…³å¿ƒæ€ä¹ˆæ›´æ–°çŠ¶æ€ï¼Œå®ƒåªè´Ÿè´£å‘Šè¯‰æˆ‘ä»¬å‘ç”Ÿäº†ä»€ä¹ˆã€‚æ›´æ–°çš„é€»è¾‘å…¨éƒ½äº¤ç”±reducerå»ç»Ÿä¸€å¤„ç†: 123456789101112131415const initialState = { count: 0, step: 1,};function reducer(state, action) { const { count, step } = state; if (action.type === 'tick') { return { count: count + step, step }; } else if (action.type === 'step') { return { count, step: action.step }; } else { throw new Error(); }} (è¿™é‡Œæ˜¯demoå¦‚æœä½ ä¹‹å‰é”™è¿‡äº†ã€‚) ä¸ºä»€ä¹ˆuseReduceræ˜¯Hooksçš„ä½œå¼Šæ¨¡å¼æˆ‘ä»¬å·²ç»å­¦ä¹ åˆ°å¦‚ä½•ç§»é™¤effectçš„ä¾èµ–ï¼Œä¸ç®¡çŠ¶æ€æ›´æ–°æ˜¯ä¾èµ–ä¸Šä¸€ä¸ªçŠ¶æ€è¿˜æ˜¯ä¾èµ–å¦ä¸€ä¸ªçŠ¶æ€ã€‚ä½†å‡å¦‚æˆ‘ä»¬éœ€è¦ä¾èµ–propså»è®¡ç®—ä¸‹ä¸€ä¸ªçŠ¶æ€å‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œä¹Ÿè®¸æˆ‘ä»¬çš„APIæ˜¯&lt;Counter step={1} /&gt;ã€‚ç¡®å®šçš„æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ²¡æ³•é¿å…ä¾èµ–props.step ã€‚æ˜¯å—ï¼Ÿ å®é™…ä¸Šï¼Œ æˆ‘ä»¬å¯ä»¥é¿å…ï¼æˆ‘ä»¬å¯ä»¥æŠŠreducerå‡½æ•°æ”¾åˆ°ç»„ä»¶å†…å»è¯»å–propsï¼š 1234567891011121314151617181920function Counter({ step }) { const [count, dispatch] = useReducer(reducer, 0); function reducer(state, action) { if (action.type === 'tick') { return state + step; } else { throw new Error(); } } useEffect(() =&gt; { const id = setInterval(() =&gt; { dispatch({ type: 'tick' }); }, 1000); return () =&gt; clearInterval(id); }, [dispatch]); return &lt;h1&gt;{count}&lt;/h1&gt;;} è¿™ç§æ¨¡å¼ä¼šä½¿ä¸€äº›ä¼˜åŒ–å¤±æ•ˆï¼Œæ‰€ä»¥ä½ åº”è¯¥é¿å…æ»¥ç”¨å®ƒï¼Œä¸è¿‡å¦‚æœä½ éœ€è¦ä½ å®Œå…¨å¯ä»¥åœ¨reduceré‡Œé¢è®¿é—®propsã€‚ï¼ˆè¿™é‡Œæ˜¯demoï¼‰ å³ä½¿æ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒReactä¹Ÿä¿è¯dispatchåœ¨æ¯æ¬¡æ¸²æŸ“ä¸­éƒ½æ˜¯ä¸€æ ·çš„ã€‚ æ‰€ä»¥ä½ å¯ä»¥åœ¨ä¾èµ–ä¸­å»æ‰å®ƒã€‚å®ƒä¸ä¼šå¼•èµ·effectä¸å¿…è¦çš„é‡å¤æ‰§è¡Œã€‚ ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼šè¿™æ€ä¹ˆå¯èƒ½ï¼Ÿåœ¨ä¹‹å‰æ¸²æŸ“ä¸­è°ƒç”¨çš„reduceræ€ä¹ˆâ€œçŸ¥é“â€æ–°çš„propsï¼Ÿç­”æ¡ˆæ˜¯å½“ä½ dispatchçš„æ—¶å€™ï¼ŒReactåªæ˜¯è®°ä½äº†action - å®ƒä¼šåœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“ä¸­å†æ¬¡è°ƒç”¨reducerã€‚åœ¨é‚£ä¸ªæ—¶å€™ï¼Œæ–°çš„propså°±å¯ä»¥è¢«è®¿é—®åˆ°ï¼Œè€Œä¸”reducerè°ƒç”¨ä¹Ÿä¸æ˜¯åœ¨effecté‡Œã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘å€¾å‘è®¤ä¸ºuseReduceræ˜¯Hooksçš„â€œä½œå¼Šæ¨¡å¼â€ã€‚å®ƒå¯ä»¥æŠŠæ›´æ–°é€»è¾‘å’Œæè¿°å‘ç”Ÿäº†ä»€ä¹ˆåˆ†å¼€ã€‚ç»“æœæ˜¯ï¼Œè¿™å¯ä»¥å¸®åŠ©æˆ‘ç§»é™¤ä¸å¿…éœ€çš„ä¾èµ–ï¼Œé¿å…ä¸å¿…è¦çš„effectè°ƒç”¨ã€‚ æŠŠå‡½æ•°ç§»åˆ°Effectsé‡Œä¸€ä¸ªå…¸å‹çš„è¯¯è§£æ˜¯è®¤ä¸ºå‡½æ•°ä¸åº”è¯¥æˆä¸ºä¾èµ–ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢çš„ä»£ç çœ‹ä¸Šå»å¯ä»¥è¿è¡Œæ­£å¸¸ï¼š 12345678910111213141516function SearchResults() { const [data, setData] = useState({ hits: [] }); async function fetchData() { const result = await axios( 'https://hn.algolia.com/api/v1/search?query=react', ); setData(result.data); } useEffect(() =&gt; { fetchData(); }, []); // Is this okay? // ...} (è¿™ä¸ªä¾‹å­æ”¹ç¼–è‡ªRobin Wieruchè¿™ç¯‡å¾ˆæ£’çš„æ–‡ç«  â€” ç‚¹å‡»æŸ¥çœ‹ï¼) éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ä½†è¿™æ ·åšåœ¨ç»„ä»¶æ—¥æ¸å¤æ‚çš„è¿­ä»£è¿‡ç¨‹ä¸­æˆ‘ä»¬å¾ˆéš¾ç¡®ä¿å®ƒåœ¨å„ç§æƒ…å†µä¸‹è¿˜èƒ½æ­£å¸¸è¿è¡Œã€‚ æƒ³è±¡ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç åšä¸‹é¢è¿™æ ·çš„åˆ†ç¦»ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªå‡½æ•°çš„ä½“é‡æ˜¯ç°åœ¨çš„äº”å€ï¼š 123456789101112131415161718function SearchResults() { // Imagine this function is long function getFetchUrl() { return 'https://hn.algolia.com/api/v1/search?query=react'; } // Imagine this function is also long async function fetchData() { const result = await axios(getFetchUrl()); setData(result.data); } useEffect(() =&gt; { fetchData(); }, []); // ...} ç„¶åæˆ‘ä»¬åœ¨æŸäº›å‡½æ•°å†…ä½¿ç”¨äº†æŸäº›stateæˆ–è€…propï¼š 1234567891011121314151617181920function SearchResults() { const [query, setQuery] = useState('react'); // Imagine this function is also long function getFetchUrl() { return 'https://hn.algolia.com/api/v1/search?query=' + query; } // Imagine this function is also long async function fetchData() { const result = await axios(getFetchUrl()); setData(result.data); } useEffect(() =&gt; { fetchData(); }, []); // ...} å¦‚æœæˆ‘ä»¬å¿˜è®°å»æ›´æ–°ä½¿ç”¨è¿™äº›å‡½æ•°ï¼ˆå¾ˆå¯èƒ½é€šè¿‡å…¶ä»–å‡½æ•°è°ƒç”¨ï¼‰çš„effectsçš„ä¾èµ–ï¼Œæˆ‘ä»¬çš„effectså°±ä¸ä¼šåŒæ­¥propså’Œstateå¸¦æ¥çš„å˜æ›´ã€‚è¿™å½“ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚ å¹¸è¿çš„æ˜¯ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜æœ‰ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚å¦‚æœæŸäº›å‡½æ•°ä»…åœ¨effectä¸­è°ƒç”¨ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬çš„å®šä¹‰ç§»åˆ°effectä¸­ï¼š 12345678910111213141516function SearchResults() { // ... useEffect(() =&gt; { // We moved these functions inside! function getFetchUrl() { return 'https://hn.algolia.com/api/v1/search?query=react'; } async function fetchData() { const result = await axios(getFetchUrl()); setData(result.data); } fetchData(); }, []); // âœ… Deps are OK // ...} (è¿™é‡Œæ˜¯demo) è¿™ä¹ˆåšæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿæˆ‘ä»¬ä¸å†éœ€è¦å»è€ƒè™‘è¿™äº›â€œé—´æ¥ä¾èµ–â€ã€‚æˆ‘ä»¬çš„ä¾èµ–æ•°ç»„ä¹Ÿä¸å†æ’’è°ï¼šåœ¨æˆ‘ä»¬çš„effectä¸­ç¡®å®æ²¡æœ‰å†ä½¿ç”¨ç»„ä»¶èŒƒå›´å†…çš„ä»»ä½•ä¸œè¥¿ã€‚ å¦‚æœæˆ‘ä»¬åé¢ä¿®æ”¹ getFetchUrlå»ä½¿ç”¨queryçŠ¶æ€ï¼Œæˆ‘ä»¬æ›´å¯èƒ½ä¼šæ„è¯†åˆ°æˆ‘ä»¬æ­£åœ¨effecté‡Œé¢ç¼–è¾‘å®ƒ - å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŠŠqueryæ·»åŠ åˆ°effectçš„ä¾èµ–é‡Œï¼š 123456789101112131415161718function SearchResults() { const [query, setQuery] = useState('react'); useEffect(() =&gt; { function getFetchUrl() { return 'https://hn.algolia.com/api/v1/search?query=' + query; } async function fetchData() { const result = await axios(getFetchUrl()); setData(result.data); } fetchData(); }, [query]); // âœ… Deps are OK // ...} (è¿™é‡Œæ˜¯demo) æ·»åŠ è¿™ä¸ªä¾èµ–ï¼Œæˆ‘ä»¬ä¸ä»…ä»…æ˜¯åœ¨â€œå–æ‚¦Reactâ€ã€‚åœ¨queryæ”¹å˜åå»é‡æ–°è¯·æ±‚æ•°æ®æ˜¯åˆç†çš„ã€‚useEffectçš„è®¾è®¡æ„å›¾å°±æ˜¯è¦å¼ºè¿«ä½ å…³æ³¨æ•°æ®æµçš„æ”¹å˜ï¼Œç„¶åå†³å®šæˆ‘ä»¬çš„effectsè¯¥å¦‚ä½•å’Œå®ƒåŒæ­¥ - è€Œä¸æ˜¯å¿½è§†å®ƒç›´åˆ°æˆ‘ä»¬çš„ç”¨æˆ·é‡åˆ°äº†bugã€‚ æ„Ÿè°¢eslint-plugin-react-hooks æ’ä»¶çš„exhaustive-depslintè§„åˆ™ï¼Œå®ƒä¼šåœ¨ä½ ç¼–ç çš„æ—¶å€™å°±åˆ†æeffectså¹¶ä¸”æä¾›å¯èƒ½é—æ¼ä¾èµ–çš„å»ºè®®ã€‚æ¢å¥è¯è¯´ï¼Œæœºå™¨ä¼šå‘Šè¯‰ä½ ç»„ä»¶ä¸­å“ªäº›æ•°æ®æµå˜æ›´æ²¡æœ‰è¢«æ­£ç¡®åœ°å¤„ç†ã€‚ éå¸¸æ£’ã€‚ ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åˆ°Effecté‡Œæœ‰æ—¶å€™ä½ å¯èƒ½ä¸æƒ³æŠŠå‡½æ•°ç§»å…¥effecté‡Œã€‚æ¯”å¦‚ï¼Œç»„ä»¶å†…æœ‰å‡ ä¸ªeffectä½¿ç”¨äº†ç›¸åŒçš„å‡½æ•°ï¼Œä½ ä¸æƒ³åœ¨æ¯ä¸ªeffecté‡Œå¤åˆ¶é»è´´ä¸€éè¿™ä¸ªé€»è¾‘ã€‚ä¹Ÿæˆ–è®¸è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªpropã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ä½ åº”è¯¥å¿½ç•¥å¯¹å‡½æ•°çš„ä¾èµ–å—ï¼Ÿæˆ‘ä¸è¿™ä¹ˆè®¤ä¸ºã€‚å†æ¬¡å¼ºè°ƒï¼Œefffectsä¸åº”è¯¥å¯¹å®ƒçš„ä¾èµ–æ’’è°ã€‚é€šå¸¸æˆ‘ä»¬è¿˜æœ‰æ›´å¥½çš„è§£å†³åŠæ³•ã€‚ä¸€ä¸ªå¸¸è§çš„è¯¯è§£æ˜¯ï¼Œâ€œå‡½æ•°ä»æ¥ä¸ä¼šæ”¹å˜â€ã€‚ä½†æ˜¯è¿™ç¯‡æ–‡ç« ä½ è¯»åˆ°ç°åœ¨ï¼Œä½ çŸ¥é“è¿™æ˜¾ç„¶ä¸æ˜¯äº‹å®ã€‚å®é™…ä¸Šï¼Œåœ¨ç»„ä»¶å†…å®šä¹‰çš„å‡½æ•°æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½åœ¨å˜ã€‚ å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ”¹å˜è¿™ä¸ªäº‹å®æœ¬èº«å°±æ˜¯ä¸ªé—®é¢˜ã€‚ æ¯”å¦‚æœ‰ä¸¤ä¸ªeffectsä¼šè°ƒç”¨ getFetchUrl: 1234567891011121314151617function SearchResults() { function getFetchUrl(query) { return 'https://hn.algolia.com/api/v1/search?query=' + query; } useEffect(() =&gt; { const url = getFetchUrl('react'); // ... Fetch data and do something ... }, []); // ğŸ”´ Missing dep: getFetchUrl useEffect(() =&gt; { const url = getFetchUrl('redux'); // ... Fetch data and do something ... }, []); // ğŸ”´ Missing dep: getFetchUrl // ...} åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ å¯èƒ½ä¸æƒ³æŠŠgetFetchUrl ç§»åˆ°effectsä¸­ï¼Œå› ä¸ºä½ æƒ³å¤ç”¨é€»è¾‘ã€‚ å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ å¯¹ä¾èµ–å¾ˆâ€œè¯šå®â€ï¼Œä½ å¯èƒ½ä¼šæ‰åˆ°é™·é˜±é‡Œã€‚æˆ‘ä»¬çš„ä¸¤ä¸ªeffectséƒ½ä¾èµ–getFetchUrlï¼Œè€Œå®ƒæ¯æ¬¡æ¸²æŸ“éƒ½ä¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¾èµ–æ•°ç»„ä¼šå˜å¾—æ— ç”¨ï¼š 123456789101112131415161718function SearchResults() { // ğŸ”´ Re-triggers all effects on every render function getFetchUrl(query) { return 'https://hn.algolia.com/api/v1/search?query=' + query; } useEffect(() =&gt; { const url = getFetchUrl('react'); // ... Fetch data and do something ... }, [getFetchUrl]); // ğŸš§ Deps are correct but they change too often useEffect(() =&gt; { const url = getFetchUrl('redux'); // ... Fetch data and do something ... }, [getFetchUrl]); // ğŸš§ Deps are correct but they change too often // ...} ä¸€ä¸ªå¯èƒ½çš„è§£å†³åŠæ³•æ˜¯æŠŠgetFetchUrlä»ä¾èµ–ä¸­å»æ‰ã€‚ä½†æ˜¯ï¼Œæˆ‘ä¸è®¤ä¸ºè¿™æ˜¯å¥½çš„è§£å†³æ–¹å¼ã€‚è¿™ä¼šä½¿æˆ‘ä»¬åé¢å¯¹æ•°æ®æµçš„æ”¹å˜å¾ˆéš¾è¢«å‘ç°ä»è€Œå¿˜è®°å»å¤„ç†ã€‚è¿™ä¼šå¯¼è‡´ç±»ä¼¼äºä¸Šé¢â€œå®šæ—¶å™¨ä¸æ›´æ–°å€¼â€çš„é—®é¢˜ã€‚ ç›¸åçš„ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ›´ç®€å•çš„è§£å†³åŠæ³•ã€‚ ç¬¬ä¸€ä¸ªï¼Œ å¦‚æœä¸€ä¸ªå‡½æ•°æ²¡æœ‰ä½¿ç”¨ç»„ä»¶å†…çš„ä»»ä½•å€¼ï¼Œä½ åº”è¯¥æŠŠå®ƒæåˆ°ç»„ä»¶å¤–é¢å»å®šä¹‰ï¼Œç„¶åå°±å¯ä»¥è‡ªç”±åœ°åœ¨effectsä¸­ä½¿ç”¨ï¼š 123456789101112131415161718// âœ… Not affected by the data flowfunction getFetchUrl(query) { return 'https://hn.algolia.com/api/v1/search?query=' + query;}function SearchResults() { useEffect(() =&gt; { const url = getFetchUrl('react'); // ... Fetch data and do something ... }, []); // âœ… Deps are OK useEffect(() =&gt; { const url = getFetchUrl('redux'); // ... Fetch data and do something ... }, []); // âœ… Deps are OK // ...} ä½ ä¸å†éœ€è¦æŠŠå®ƒè®¾ä¸ºä¾èµ–ï¼Œå› ä¸ºå®ƒä»¬ä¸åœ¨æ¸²æŸ“èŒƒå›´å†…ï¼Œå› æ­¤ä¸ä¼šè¢«æ•°æ®æµå½±å“ã€‚å®ƒä¸å¯èƒ½çªç„¶æ„å¤–åœ°ä¾èµ–äºpropsæˆ–stateã€‚ æˆ–è€…ï¼Œ ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒåŒ…è£…æˆuseCallback Hook: 123456789101112131415161718function SearchResults() { // âœ… Preserves identity when its own deps are the same const getFetchUrl = useCallback((query) =&gt; { return 'https://hn.algolia.com/api/v1/search?query=' + query; }, []); // âœ… Callback deps are OK useEffect(() =&gt; { const url = getFetchUrl(â€˜reactâ€™); // â€¦ Fetch data and do something â€¦ }, [getFetchUrl]); // âœ… Effect deps are OK useEffect(() =&gt; { const url = getFetchUrl(â€˜reduxâ€™); // â€¦ Fetch data and do something â€¦ }, [getFetchUrl]); // âœ… Effect deps are OK // â€¦} useCallbackæœ¬è´¨ä¸Šæ˜¯æ·»åŠ äº†ä¸€å±‚ä¾èµ–æ£€æŸ¥ã€‚å®ƒä»¥å¦ä¸€ç§æ–¹å¼è§£å†³äº†é—®é¢˜ - æˆ‘ä»¬ä½¿å‡½æ•°æœ¬èº«åªåœ¨éœ€è¦çš„æ—¶å€™æ‰æ”¹å˜ï¼Œè€Œä¸æ˜¯å»æ‰å¯¹å‡½æ•°çš„ä¾èµ–ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆè¿™ç§æ–¹å¼æ˜¯æœ‰ç”¨çš„ã€‚ä¹‹å‰ï¼Œæˆ‘ä»¬çš„ä¾‹å­ä¸­å±•ç¤ºäº†ä¸¤ç§æœç´¢ç»“æœï¼ˆæŸ¥è¯¢æ¡ä»¶åˆ†åˆ«ä¸ºâ€™reactâ€™å’Œâ€™reduxâ€™ï¼‰ã€‚ä½†å¦‚æœæˆ‘ä»¬æƒ³æ·»åŠ ä¸€ä¸ªè¾“å…¥æ¡†å…è®¸ä½ è¾“å…¥ä»»æ„çš„æŸ¥è¯¢æ¡ä»¶(query)ã€‚ä¸åŒäºä¼ é€’queryå‚æ•°çš„æ–¹å¼ï¼Œç°åœ¨getFetchUrlä¼šä»çŠ¶æ€ä¸­è¯»å–ã€‚ æˆ‘ä»¬å¾ˆå¿«å‘ç°å®ƒé—æ¼äº†queryä¾èµ–ï¼š 1234567function SearchResults() { const [query, setQuery] = useState(â€˜reactâ€™); const getFetchUrl = useCallback(() =&gt; { // No query argument return â€˜https://hn.algolia.com/api/v1/search?query=â€˜ + query; }, []); // ğŸ”´ Missing dep: query // â€¦} å¦‚æœæˆ‘æŠŠqueryæ·»åŠ åˆ°useCallbackçš„ä¾èµ–ä¸­ï¼Œä»»ä½•è°ƒç”¨äº†getFetchUrlçš„effectåœ¨queryæ”¹å˜åéƒ½ä¼šé‡æ–°è¿è¡Œï¼š 123456789101112131415function SearchResults() { const [query, setQuery] = useState(â€˜reactâ€™); // âœ… Preserves identity until query changes const getFetchUrl = useCallback(() =&gt; { return â€˜https://hn.algolia.com/api/v1/search?query=â€˜ + query; }, [query]); // âœ… Callback deps are OK useEffect(() =&gt; { const url = getFetchUrl(); // â€¦ Fetch data and do something â€¦ }, [getFetchUrl]); // âœ… Effect deps are OK // â€¦} æˆ‘ä»¬è¦æ„Ÿè°¢useCallbackï¼Œå› ä¸ºå¦‚æœqueryä¿æŒä¸å˜ï¼ŒgetFetchUrlä¹Ÿä¼šä¿æŒä¸å˜ï¼Œæˆ‘ä»¬çš„effectä¹Ÿä¸ä¼šé‡æ–°è¿è¡Œã€‚ä½†æ˜¯å¦‚æœqueryä¿®æ”¹äº†ï¼ŒgetFetchUrlä¹Ÿä¼šéšä¹‹æ”¹å˜ï¼Œå› æ­¤ä¼šé‡æ–°è¯·æ±‚æ•°æ®ã€‚è¿™å°±åƒä½ åœ¨Excelé‡Œä¿®æ”¹äº†ä¸€ä¸ªå•å…ƒæ ¼çš„å€¼ï¼Œå¦ä¸€ä¸ªä½¿ç”¨å®ƒçš„å•å…ƒæ ¼ä¼šè‡ªåŠ¨é‡æ–°è®¡ç®—ä¸€æ ·ã€‚ è¿™æ­£æ˜¯æ‹¥æŠ±æ•°æ®æµå’ŒåŒæ­¥æ€ç»´çš„ç»“æœã€‚å¯¹äºé€šè¿‡å±æ€§ä»çˆ¶ç»„ä»¶ä¼ å…¥çš„å‡½æ•°è¿™ä¸ªæ–¹æ³•ä¹Ÿé€‚ç”¨ï¼š 123456789101112131415161718192021function Parent() { const [query, setQuery] = useState(â€˜reactâ€™); // âœ… Preserves identity until query changes const fetchData = useCallback(() =&gt; { const url = â€˜https://hn.algolia.com/api/v1/search?query=â€˜ + query; // â€¦ Fetch data and return it â€¦ }, [query]); // âœ… Callback deps are OK return &lt;Child fetchData={fetchData} /&gt;}function Child({ fetchData }) { let [data, setData] = useState(null); useEffect(() =&gt; { fetchData().then(setData); }, [fetchData]); // âœ… Effect deps are OK // â€¦} å› ä¸ºfetchDataåªæœ‰åœ¨Parentçš„queryçŠ¶æ€å˜æ›´æ—¶æ‰ä¼šæ”¹å˜ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„Childåªä¼šåœ¨éœ€è¦çš„æ—¶å€™æ‰å»é‡æ–°è¯·æ±‚æ•°æ®ã€‚ å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿæœ‰è¶£çš„æ˜¯ï¼Œè¿™ç§æ¨¡å¼åœ¨classç»„ä»¶ä¸­è¡Œä¸é€šï¼Œå¹¶ä¸”è¿™ç§è¡Œä¸é€šæ°åˆ°å¥½å¤„åœ°æ­ç¤ºäº†effectå’Œç”Ÿå‘½å‘¨æœŸèŒƒå¼ä¹‹é—´çš„åŒºåˆ«ã€‚è€ƒè™‘ä¸‹é¢çš„è½¬æ¢ï¼š 123456789101112131415161718192021222324class Parent extends Component { state = { query: â€˜reactâ€™ }; fetchData = () =&gt; { const url = â€˜https://hn.algolia.com/api/v1/search?query=â€˜ + this.state.query; // â€¦ Fetch data and do something â€¦ }; render() { return &lt;Child fetchData={this.fetchData} /&gt;; }}class Child extends Component { state = { data: null }; componentDidMount() { this.props.fetchData(); } render() { // â€¦ }} ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œå°‘æ¥äº†Danï¼Œæˆ‘ä»¬éƒ½çŸ¥é“useEffectå°±åƒcomponentDidMountå’ŒcomponentDidUpdateçš„ç»“åˆï¼Œä½ ä¸èƒ½è€æ˜¯ç ´åè¿™ä¸€æ¡ï¼â€å¥½å§ï¼Œå°±ç®—åŠ äº†componentDidUpdateç…§æ ·æ— ç”¨ï¼š 1234567891011121314151617class Child extends Component { state = { data: null }; componentDidMount() { this.props.fetchData(); } componentDidUpdate(prevProps) { // ğŸ”´ This condition will never be true if (this.props.fetchData !== prevProps.fetchData) { this.props.fetchData(); } } render() { // â€¦ }} å½“ç„¶å¦‚æ­¤ï¼ŒfetchDataæ˜¯ä¸€ä¸ªclassæ–¹æ³•ï¼ï¼ˆæˆ–è€…ä½ ä¹Ÿå¯ä»¥è¯´æ˜¯classå±æ€§ - ä½†è¿™ä¸èƒ½æ”¹å˜ä»€ä¹ˆã€‚ï¼‰å®ƒä¸ä¼šå› ä¸ºçŠ¶æ€çš„æ”¹å˜è€Œä¸åŒï¼Œæ‰€ä»¥this.props.fetchDataå’Œ prevProps.fetchDataå§‹ç»ˆç›¸ç­‰ï¼Œå› æ­¤ä¸ä¼šé‡æ–°è¯·æ±‚ã€‚é‚£æˆ‘ä»¬åˆ æ‰æ¡ä»¶åˆ¤æ–­æ€ä¹ˆæ ·ï¼Ÿ 123componentDidUpdate(prevProps) { this.props.fetchData();} ç­‰ç­‰ï¼Œè¿™æ ·ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½å»è¯·æ±‚ã€‚(æ·»åŠ ä¸€ä¸ªåŠ è½½åŠ¨ç”»å¯èƒ½æ˜¯ä¸€ç§æœ‰è¶£çš„å‘ç°è¿™ç§æƒ…å†µçš„æ–¹å¼ã€‚)ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥ç»‘å®šä¸€ä¸ªç‰¹å®šçš„query? 123render() { return &lt;Child fetchData={this.fetchData.bind(this, this.state.query)} /&gt;;} ä½†è¿™æ ·ä¸€æ¥ï¼Œthis.props.fetchData !== prevProps.fetchDataè¡¨è¾¾å¼æ°¸è¿œæ˜¯trueï¼Œå³ä½¿queryå¹¶æœªæ”¹å˜ã€‚è¿™ä¼šå¯¼è‡´æˆ‘ä»¬æ€»æ˜¯å»è¯·æ±‚ã€‚ æƒ³è¦è§£å†³è¿™ä¸ªclassç»„ä»¶ä¸­çš„éš¾é¢˜ï¼Œå”¯ä¸€ç°å®å¯è¡Œçš„åŠæ³•æ˜¯ç¡¬ç€å¤´çš®æŠŠqueryæœ¬èº«ä¼ å…¥Childç»„ä»¶ã€‚ Childè™½ç„¶å®é™…å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨è¿™ä¸ªqueryçš„å€¼ï¼Œä½†èƒ½åœ¨å®ƒæ”¹å˜çš„æ—¶å€™è§¦å‘ä¸€æ¬¡é‡æ–°è¯·æ±‚ï¼š 1234567891011121314151617181920212223242526272829class Parent extends Component { state = { query: â€˜reactâ€™ }; fetchData = () =&gt; { const url = â€˜https://hn.algolia.com/api/v1/search?query=â€˜ + this.state.query; // â€¦ Fetch data and do something â€¦ }; render() { return &lt;Child fetchData={this.fetchData} query={this.state.query} /&gt;; }}class Child extends Component { state = { data: null }; componentDidMount() { this.props.fetchData(); } componentDidUpdate(prevProps) { if (this.props.query !== prevProps.query) { this.props.fetchData(); } } render() { // â€¦ }} åœ¨ä½¿ç”¨Reactçš„classç»„ä»¶è¿™ä¹ˆå¤šå¹´åï¼Œæˆ‘å·²ç»å¦‚æ­¤ä¹ æƒ¯äºæŠŠä¸å¿…è¦çš„propsä¼ é€’ä¸‹å»å¹¶ä¸”ç ´åçˆ¶ç»„ä»¶çš„å°è£…ä»¥è‡³äºæˆ‘åœ¨ä¸€å‘¨ä¹‹å‰æ‰æ„è¯†åˆ°æˆ‘ä¸ºä»€ä¹ˆä¸€å®šè¦è¿™æ ·åšã€‚ åœ¨classç»„ä»¶ä¸­ï¼Œå‡½æ•°å±æ€§æœ¬èº«å¹¶ä¸æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†ã€‚ç»„ä»¶çš„æ–¹æ³•ä¸­åŒ…å«äº†å¯å˜çš„thiså˜é‡å¯¼è‡´æˆ‘ä»¬ä¸èƒ½ç¡®å®šæ— ç–‘åœ°è®¤ä¸ºå®ƒæ˜¯ä¸å˜çš„ã€‚å› æ­¤ï¼Œå³ä½¿æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»æŠŠä¸€å †æ•°æ®ä¼ é€’ä¸‹å»ä»…ä»…æ˜¯ä¸ºäº†åšâ€œdiffâ€ã€‚æˆ‘ä»¬æ— æ³•çŸ¥é“ä¼ å…¥çš„this.props.fetchDataæ˜¯å¦ä¾èµ–çŠ¶æ€ï¼Œå¹¶ä¸”ä¸çŸ¥é“å®ƒä¾èµ–çš„çŠ¶æ€æ˜¯å¦æ”¹å˜äº†ã€‚ ä½¿ç”¨useCallbackï¼Œå‡½æ•°å®Œå…¨å¯ä»¥å‚ä¸åˆ°æ•°æ®æµä¸­ã€‚æˆ‘ä»¬å¯ä»¥è¯´å¦‚æœä¸€ä¸ªå‡½æ•°çš„è¾“å…¥æ”¹å˜äº†ï¼Œè¿™ä¸ªå‡½æ•°å°±æ”¹å˜äº†ã€‚å¦‚æœæ²¡æœ‰ï¼Œå‡½æ•°ä¹Ÿä¸ä¼šæ”¹å˜ã€‚æ„Ÿè°¢å‘¨åˆ°çš„useCallbackï¼Œå±æ€§æ¯”å¦‚props.fetchDataçš„æ”¹å˜ä¹Ÿä¼šè‡ªåŠ¨ä¼ é€’ä¸‹å»ã€‚ ç±»ä¼¼çš„ï¼ŒuseMemoå¯ä»¥è®©æˆ‘ä»¬å¯¹å¤æ‚å¯¹è±¡åšç±»ä¼¼çš„äº‹æƒ…ã€‚ 1234567function ColorPicker() { // Doesnâ€™t break Childâ€™s shallow equality prop check // unless the color actually changes. const [color, setColor] = useState(â€˜pinkâ€™); const style = useMemo(() =&gt; ({ color }), [color]); return &lt;Child style={style} /&gt;;} æˆ‘æƒ³å¼ºè°ƒçš„æ˜¯ï¼Œåˆ°å¤„ä½¿ç”¨useCallbackæ˜¯ä»¶æŒºç¬¨æ‹™çš„äº‹ã€‚å½“æˆ‘ä»¬éœ€è¦å°†å‡½æ•°ä¼ é€’ä¸‹å»å¹¶ä¸”å‡½æ•°ä¼šåœ¨å­ç»„ä»¶çš„effectä¸­è¢«è°ƒç”¨çš„æ—¶å€™ï¼ŒuseCallbackæ˜¯å¾ˆå¥½çš„æŠ€å·§ä¸”éå¸¸æœ‰ç”¨ã€‚æˆ–è€…ä½ æƒ³è¯•å›¾å‡å°‘å¯¹å­ç»„ä»¶çš„è®°å¿†è´Ÿæ‹…ï¼Œä¹Ÿä¸å¦¨ä¸€è¯•ã€‚ä½†æ€»çš„æ¥è¯´Hooksæœ¬èº«èƒ½æ›´å¥½åœ°é¿å…ä¼ é€’å›è°ƒå‡½æ•°ã€‚ åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘æ›´å€¾å‘äºæŠŠfetchDataæ”¾åœ¨æˆ‘çš„effecté‡Œï¼ˆå®ƒå¯ä»¥æŠ½ç¦»æˆä¸€ä¸ªè‡ªå®šä¹‰Hookï¼‰æˆ–è€…æ˜¯ä»é¡¶å±‚å¼•å…¥ã€‚æˆ‘æƒ³è®©effectsä¿æŒç®€å•ï¼Œè€Œåœ¨é‡Œé¢è°ƒç”¨å›è°ƒä¼šè®©äº‹æƒ…å˜å¾—å¤æ‚ã€‚ï¼ˆâ€œå¦‚æœæŸä¸ªprops.onCompleteå›è°ƒæ”¹å˜äº†è€Œè¯·æ±‚è¿˜åœ¨è¿›è¡Œä¸­ä¼šæ€ä¹ˆæ ·ï¼Ÿâ€ï¼‰ä½ å¯ä»¥æ¨¡æ‹Ÿclassçš„è¡Œä¸ºä½†é‚£æ ·å¹¶ä¸èƒ½è§£å†³ç«æ€çš„é—®é¢˜ã€‚ è¯´è¯´ç«æ€ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„åœ¨classç»„ä»¶é‡Œå‘è¯·æ±‚çš„ä¾‹å­ï¼š 12345678910111213class Article extends Component { state = { article: null }; componentDidMount() { this.fetchData(this.props.id); } async fetchData(id) { const article = await API.fetchArticle(id); this.setState({ article }); } // â€¦} ä½ å¾ˆå¯èƒ½å·²ç»çŸ¥é“ï¼Œä¸Šé¢çš„ä»£ç åŸ‹ä¼äº†ä¸€äº›é—®é¢˜ã€‚å®ƒå¹¶æ²¡æœ‰å¤„ç†æ›´æ–°çš„æƒ…å†µã€‚æ‰€ä»¥ç¬¬äºŒä¸ªä½ èƒ½å¤Ÿåœ¨ç½‘ä¸Šæ‰¾åˆ°çš„ç»å…¸ä¾‹å­æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š 123456789101112131415161718class Article extends Component { state = { article: null }; componentDidMount() { this.fetchData(this.props.id); } componentDidUpdate(prevProps) { if (prevProps.id !== this.props.id) { this.fetchData(this.props.id); } } async fetchData(id) { const article = await API.fetchArticle(id); this.setState({ article }); } // â€¦} è¿™æ˜¾ç„¶å¥½å¤šäº†ï¼ä½†ä¾æ—§æœ‰é—®é¢˜ã€‚æœ‰é—®é¢˜çš„åŸå› æ˜¯è¯·æ±‚ç»“æœè¿”å›çš„é¡ºåºä¸èƒ½ä¿è¯ä¸€è‡´ã€‚æ¯”å¦‚æˆ‘å…ˆè¯·æ±‚ {id: 10}ï¼Œç„¶åæ›´æ–°åˆ°{id: 20}ï¼Œä½†{id: 20}çš„è¯·æ±‚æ›´å…ˆè¿”å›ã€‚è¯·æ±‚æ›´æ—©ä½†è¿”å›æ›´æ™šçš„æƒ…å†µä¼šé”™è¯¯åœ°è¦†ç›–çŠ¶æ€å€¼ã€‚ è¿™è¢«å«åšç«æ€ï¼Œè¿™åœ¨æ··åˆäº†async / awaitï¼ˆå‡è®¾åœ¨ç­‰å¾…ç»“æœè¿”å›ï¼‰å’Œè‡ªé¡¶å‘ä¸‹æ•°æ®æµçš„ä»£ç ä¸­éå¸¸å…¸å‹ï¼ˆpropså’Œstateå¯èƒ½ä¼šåœ¨asyncå‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­å‘ç”Ÿæ”¹å˜ï¼‰ã€‚ Effectså¹¶æ²¡æœ‰ç¥å¥‡åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°½ç®¡å®ƒä¼šè­¦å‘Šä½ å¦‚æœä½ ç›´æ¥ä¼ äº†ä¸€ä¸ªasyncå‡½æ•°ç»™effectã€‚ï¼ˆæˆ‘ä»¬ä¼šæ”¹å–„è¿™ä¸ªè­¦å‘Šæ¥æ›´å¥½åœ°è§£é‡Šä½ å¯èƒ½ä¼šé‡åˆ°çš„è¿™äº›é—®é¢˜ã€‚ï¼‰ å¦‚æœä½ ä½¿ç”¨çš„å¼‚æ­¥æ–¹å¼æ”¯æŒå–æ¶ˆï¼Œé‚£å¤ªæ£’äº†ã€‚ä½ å¯ä»¥ç›´æ¥åœ¨æ¸…é™¤å‡½æ•°ä¸­å–æ¶ˆå¼‚æ­¥è¯·æ±‚ã€‚ æˆ–è€…ï¼Œæœ€ç®€å•çš„æƒå®œä¹‹è®¡æ˜¯ç”¨ä¸€ä¸ªå¸ƒå°”å€¼æ¥è·Ÿè¸ªå®ƒï¼š 12345678910111213141516171819202122function Article({ id }) { const [article, setArticle] = useState(null); useEffect(() =&gt; { let didCancel = false; async function fetchData() { const article = await API.fetchArticle(id); if (!didCancel) { setArticle(article); } } fetchData(); return () =&gt; { didCancel = true; }; }, [id]); // â€¦} è¿™ç¯‡æ–‡ç« è®¨è®ºäº†æ›´å¤šå…³äºå¦‚ä½•å¤„ç†é”™è¯¯å’ŒåŠ è½½çŠ¶æ€ï¼Œä»¥åŠæŠ½ç¦»é€»è¾‘åˆ°è‡ªå®šä¹‰çš„Hookã€‚æˆ‘æ¨èä½ è®¤çœŸé˜…è¯»ä¸€ä¸‹å¦‚æœä½ æƒ³å­¦ä¹ æ›´å¤šå…³äºå¦‚ä½•åœ¨Hooksé‡Œè¯·æ±‚æ•°æ®çš„å†…å®¹ã€‚ æé«˜æ°´å‡†åœ¨classç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ€ç»´æ¨¡å‹ä¸­ï¼Œå‰¯ä½œç”¨çš„è¡Œä¸ºå’Œæ¸²æŸ“è¾“å‡ºæ˜¯ä¸åŒçš„ã€‚UIæ¸²æŸ“æ˜¯è¢«propså’Œstateé©±åŠ¨çš„ï¼Œå¹¶ä¸”èƒ½ç¡®ä¿æ­¥è°ƒä¸€è‡´ï¼Œä½†å‰¯ä½œç”¨å¹¶ä¸æ˜¯è¿™æ ·ã€‚è¿™æ˜¯ä¸€ç±»å¸¸è§é—®é¢˜çš„æ¥æºã€‚ è€Œåœ¨useEffectçš„æ€ç»´æ¨¡å‹ä¸­ï¼Œé»˜è®¤éƒ½æ˜¯åŒæ­¥çš„ã€‚å‰¯ä½œç”¨å˜æˆäº†Reactæ•°æ®æµçš„ä¸€éƒ¨åˆ†ã€‚å¯¹äºæ¯ä¸€ä¸ªuseEffectè°ƒç”¨ï¼Œä¸€æ—¦ä½ å¤„ç†æ­£ç¡®ï¼Œä½ çš„ç»„ä»¶èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†è¾¹ç¼˜æƒ…å†µã€‚ ç„¶è€Œï¼Œç”¨å¥½useEffectçš„å‰æœŸå­¦ä¹ æˆæœ¬æ›´é«˜ã€‚è¿™å¯èƒ½è®©äººæ°”æ¼ã€‚ç”¨åŒæ­¥çš„ä»£ç å»å¤„ç†è¾¹ç¼˜æƒ…å†µå¤©ç„¶å°±æ¯”è§¦å‘ä¸€æ¬¡ä¸ç”¨å’Œæ¸²æŸ“ç»“æœæ­¥è°ƒä¸€è‡´çš„å‰¯ä½œç”¨æ›´éš¾ã€‚ è¿™éš¾å…è®©äººæ‹…å¿§å¦‚æœuseEffectæ˜¯ä½ ç°åœ¨ä½¿ç”¨æœ€å¤šçš„å·¥å…·ã€‚ä¸è¿‡ï¼Œç›®å‰å¤§æŠµè¿˜å¤„ç†ä½æ°´å¹³ä½¿ç”¨é˜¶æ®µã€‚å› ä¸ºHookså¤ªæ–°äº†æ‰€ä»¥å¤§å®¶éƒ½è¿˜åœ¨ä½æ°´å¹³åœ°ä½¿ç”¨å®ƒï¼Œå°¤å…¶æ˜¯åœ¨ä¸€äº›æ•™ç¨‹ç¤ºä¾‹ä¸­ã€‚ä½†åœ¨å®è·µä¸­ï¼Œç¤¾åŒºå¾ˆå¯èƒ½å³å°†å¼€å§‹é«˜æ°´å¹³åœ°ä½¿ç”¨Hooksï¼Œå› ä¸ºå¥½çš„APIä¼šæœ‰æ›´å¥½çš„åŠ¨é‡å’Œå†²åŠ²ã€‚ æˆ‘çœ‹åˆ°ä¸åŒçš„åº”ç”¨åœ¨åˆ›é€ ä»–ä»¬è‡ªå·±çš„Hooksï¼Œæ¯”å¦‚å°è£…äº†åº”ç”¨é‰´æƒé€»è¾‘çš„useFetchæˆ–è€…ä½¿ç”¨theme contextçš„useTheme ã€‚ä½ ä¸€æ—¦æœ‰äº†åŒ…å«è¿™äº›çš„å·¥å…·ç®±ï¼Œä½ å°±ä¸ä¼šé‚£ä¹ˆé¢‘ç¹åœ°ç›´æ¥ä½¿ç”¨useEffectã€‚ä½†æ¯ä¸€ä¸ªåŸºäºå®ƒçš„Hookéƒ½èƒ½ä»å®ƒçš„é€‚åº”èƒ½åŠ›ä¸­å¾—åˆ°ç›Šå¤„ã€‚ ç›®å‰ä¸ºæ­¢ï¼ŒuseEffectä¸»è¦ç”¨äºæ•°æ®è¯·æ±‚ã€‚ä½†æ˜¯æ•°æ®è¯·æ±‚å‡†ç¡®è¯´å¹¶ä¸æ˜¯ä¸€ä¸ªåŒæ­¥é—®é¢˜ã€‚å› ä¸ºæˆ‘ä»¬çš„ä¾èµ–ç»å¸¸æ˜¯[]æ‰€ä»¥è¿™ä¸€ç‚¹å°¤å…¶æ˜æ˜¾ã€‚é‚£æˆ‘ä»¬ç©¶ç«Ÿåœ¨åŒæ­¥ä»€ä¹ˆï¼Ÿ é•¿è¿œæ¥çœ‹ï¼Œ Suspenseç”¨äºæ•°æ®è¯·æ±‚ä¼šå…è®¸ç¬¬ä¸‰æ–¹åº“é€šè¿‡ç¬¬ä¸€ç­‰çš„é€”å¾„å‘Šè¯‰Reactæš‚åœæ¸²æŸ“ç›´åˆ°æŸäº›å¼‚æ­¥äº‹ç‰©ï¼ˆä»»ä½•ä¸œè¥¿ï¼šä»£ç ï¼Œæ•°æ®ï¼Œå›¾ç‰‡ï¼‰å·²ç»å‡†å¤‡å°±ç»ªã€‚ å½“Suspenseé€æ¸åœ°è¦†ç›–åˆ°æ›´å¤šçš„æ•°æ®è¯·æ±‚ä½¿ç”¨åœºæ™¯ï¼Œæˆ‘é¢„æ–™useEffectä¼šé€€å±…å¹•åä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºåŒæ­¥propså’Œstateåˆ°æŸäº›å‰¯ä½œç”¨ã€‚ä¸åƒæ•°æ®è¯·æ±‚ï¼Œå®ƒå¯ä»¥å¾ˆå¥½åœ°å¤„ç†è¿™äº›åœºæ™¯å› ä¸ºå®ƒå°±æ˜¯ä¸ºæ­¤è€Œè®¾è®¡çš„ã€‚ä¸è¿‡åœ¨é‚£ä¹‹å‰ï¼Œè‡ªå®šä¹‰çš„Hooksæ¯”å¦‚è¿™å„¿æåˆ°çš„æ˜¯å¤ç”¨æ•°æ®è¯·æ±‚é€»è¾‘å¾ˆå¥½çš„æ–¹å¼ã€‚ ç»“æŸè¯­ åŸæ–‡ä½œè€…ï¼šDan AbramovåŸæ–‡é“¾æ¥ï¼šhttps://overreacted.io/a-complete-guide-to-useeffect/ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://lry61.cn/blog/tags/å‰ç«¯/"}]},{"title":"React Hooksç³»åˆ—ä¹‹useEffectï¼ˆäºŒï¼‰","date":"2019-12-25T05:36:10.603Z","path":"/posts/7/","text":"React Hooksç³»åˆ—ä¹‹useEffectï¼ˆäºŒï¼‰ å‰è¨€åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥æ˜ç¡®åœ°å–Šå‡ºä¸‹é¢é‡è¦çš„äº‹å®ï¼šæ¯ä¸€ä¸ªç»„ä»¶å†…çš„å‡½æ•°ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffectsï¼Œå®šæ—¶å™¨æˆ–è€…APIè°ƒç”¨ç­‰ç­‰ï¼‰ä¼šæ•è·æŸæ¬¡æ¸²æŸ“ä¸­å®šä¹‰çš„propså’Œstateã€‚ æ‰€ä»¥ä¸‹é¢çš„ä¸¤ä¸ªä¾‹å­æ˜¯ç›¸ç­‰çš„ï¼š 12345678function Example(props) { useEffect(() =&gt; { setTimeout(() =&gt; { console.log(props.counter); }, 1000); }); // ...} 123456789function Example(props) { const counter = props.counter; useEffect(() =&gt; { setTimeout(() =&gt; { console.log(counter); }, 1000); }); // ...} åœ¨ç»„ä»¶å†…ä»€ä¹ˆæ—¶å€™å»è¯»å–propsæˆ–è€…stateæ˜¯æ— å…³ç´§è¦çš„ã€‚å› ä¸ºå®ƒä»¬ä¸ä¼šæ”¹å˜ã€‚åœ¨å•æ¬¡æ¸²æŸ“çš„èŒƒå›´å†…ï¼Œpropså’Œstateå§‹ç»ˆä¿æŒä¸å˜ã€‚ï¼ˆè§£æ„èµ‹å€¼çš„propsä½¿å¾—è¿™ä¸€ç‚¹æ›´æ˜æ˜¾ã€‚ï¼‰ å½“ç„¶ï¼Œæœ‰æ—¶å€™ä½ å¯èƒ½æƒ³åœ¨effectçš„å›è°ƒå‡½æ•°é‡Œè¯»å–æœ€æ–°çš„å€¼è€Œä¸æ˜¯æ•è·çš„å€¼ã€‚æœ€ç®€å•çš„å®ç°æ–¹æ³•æ˜¯ä½¿ç”¨refsï¼Œè¿™ç¯‡æ–‡ç« çš„æœ€åä¸€éƒ¨åˆ†ä»‹ç»äº†ç›¸å…³å†…å®¹ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯å½“ä½ æƒ³è¦ä»è¿‡å»æ¸²æŸ“ä¸­çš„å‡½æ•°é‡Œè¯»å–æœªæ¥çš„propså’Œstateï¼Œä½ æ˜¯åœ¨é€†æ½®è€ŒåŠ¨ã€‚è™½ç„¶å®ƒå¹¶æ²¡æœ‰é”™ï¼ˆæœ‰æ—¶å€™å¯èƒ½ä¹Ÿéœ€è¦è¿™æ ·åšï¼‰ï¼Œä½†å®ƒå› ä¸ºæ‰“ç ´äº†é»˜è®¤èŒƒå¼ä¼šä½¿ä»£ç æ˜¾å¾—ä¸å¤Ÿâ€œå¹²å‡€â€ã€‚è¿™æ˜¯æˆ‘ä»¬æœ‰æ„ä¸ºä¹‹çš„ï¼Œå› ä¸ºå®ƒèƒ½å¸®åŠ©çªå‡ºå“ªäº›ä»£ç æ˜¯è„†å¼±çš„ï¼Œæ˜¯éœ€è¦ä¾èµ–æ—¶é—´æ¬¡åºçš„ã€‚åœ¨classä¸­ï¼Œå¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µå°±æ²¡é‚£ä¹ˆæ˜¾è€Œæ˜“è§äº†ã€‚ ä¸‹é¢è¿™ä¸ªè®¡æ•°å™¨ç‰ˆæœ¬æ¨¡æ‹Ÿäº†classä¸­çš„è¡Œä¸ºï¼š 12345678910111213function Example() { const [count, setCount] = useState(0); const latestCount = useRef(count); useEffect(() =&gt; { // Set the mutable latest value latestCount.current = count; setTimeout(() =&gt; { // Read the mutable latest value console.log(`You clicked ${latestCount.current} times`); }, 3000); }); // ... åœ¨Reactä¸­å»ç›´æ¥ä¿®æ”¹å€¼çœ‹ä¸Šå»æœ‰ç‚¹æ€ªå¼‚ã€‚ç„¶è€Œï¼Œåœ¨classç»„ä»¶ä¸­Reactæ­£æ˜¯è¿™æ ·å»ä¿®æ”¹this.stateçš„ã€‚ä¸åƒæ•è·çš„propså’Œstateï¼Œä½ æ²¡æ³•ä¿è¯åœ¨ä»»æ„ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­è¯»å–çš„latestCount.currentæ˜¯ä¸å˜çš„ã€‚æ ¹æ®å®šä¹‰ï¼Œä½ å¯ä»¥éšæ—¶ä¿®æ”¹å®ƒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä¸æ˜¯é»˜è®¤è¡Œä¸ºï¼Œè€Œæ˜¯éœ€è¦ä½ ä¸»åŠ¨é€‰æ‹©è¿™æ ·åšã€‚ æ­£æ–‡Effectä¸­çš„æ¸…ç†åƒæ–‡æ¡£ä¸­è§£é‡Šçš„, æœ‰äº›effectså¯èƒ½éœ€è¦æœ‰ä¸€ä¸ªæ¸…ç†æ­¥éª¤ã€‚æœ¬è´¨ä¸Šï¼Œå®ƒçš„ç›®çš„æ˜¯æ¶ˆé™¤å‰¯ä½œç”¨ï¼ˆeffect)ï¼Œæ¯”å¦‚å–æ¶ˆè®¢é˜…ã€‚ æ€è€ƒä¸‹é¢çš„ä»£ç : 123456useEffect(() =&gt; { ChatAPI.subscribeToFriendStatus(props.id, handleStatusChange); return () =&gt; { ChatAPI.unsubscribeFromFriendStatus(props.id, handleStatusChange); };}); å‡è®¾ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™propsæ˜¯{id: 10}ï¼Œç¬¬äºŒæ¬¡æ¸²æŸ“çš„æ—¶å€™æ˜¯{id: 20}ã€‚ä½ å¯èƒ½ä¼šè®¤ä¸ºå‘ç”Ÿäº†ä¸‹é¢çš„è¿™äº›äº‹ï¼š React æ¸…é™¤äº† {id: 10}çš„effectã€‚ React æ¸²æŸ“{id: 20}çš„UIã€‚ React è¿è¡Œ{id: 20}çš„effectã€‚ (äº‹å®å¹¶ä¸æ˜¯è¿™æ ·ã€‚) å¦‚æœä¾èµ–è¿™ç§å¿ƒæ™ºæ¨¡å‹ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºæ¸…é™¤è¿‡ç¨‹â€œçœ‹åˆ°â€çš„æ˜¯æ—§çš„propså› ä¸ºå®ƒæ˜¯åœ¨é‡æ–°æ¸²æŸ“ä¹‹å‰è¿è¡Œçš„ï¼Œæ–°çš„effectâ€œçœ‹åˆ°â€çš„æ˜¯æ–°çš„propså› ä¸ºå®ƒæ˜¯åœ¨é‡æ–°æ¸²æŸ“ä¹‹åè¿è¡Œçš„ã€‚è¿™ç§å¿ƒæ™ºæ¨¡å‹ç›´æ¥æ¥æºäºclassç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¸è¿‡å®ƒå¹¶ä¸ç²¾ç¡®ã€‚è®©æˆ‘ä»¬æ¥ä¸€æ¢ç©¶ç«Ÿã€‚ Reactåªä¼šåœ¨æµè§ˆå™¨ç»˜åˆ¶åè¿è¡Œeffectsã€‚è¿™ä½¿å¾—ä½ çš„åº”ç”¨æ›´æµç•…å› ä¸ºå¤§å¤šæ•°effectså¹¶ä¸ä¼šé˜»å¡å±å¹•çš„æ›´æ–°ã€‚Effectçš„æ¸…é™¤åŒæ ·è¢«å»¶è¿Ÿäº†ã€‚ä¸Šä¸€æ¬¡çš„effectä¼šåœ¨é‡æ–°æ¸²æŸ“åè¢«æ¸…é™¤ï¼š React æ¸²æŸ“{id: 20}çš„UIã€‚ æµè§ˆå™¨ç»˜åˆ¶ã€‚æˆ‘ä»¬åœ¨å±å¹•ä¸Šçœ‹åˆ°{id: 20}çš„UIã€‚ React æ¸…é™¤{id: 10}çš„effectã€‚ React è¿è¡Œ{id: 20}çš„effectã€‚ ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼šå¦‚æœæ¸…é™¤ä¸Šä¸€æ¬¡çš„effectå‘ç”Ÿåœ¨propså˜æˆ{id: 20}ä¹‹åï¼Œé‚£å®ƒä¸ºä»€ä¹ˆè¿˜èƒ½â€œçœ‹åˆ°â€æ—§çš„{id: 10}ï¼Ÿ å¼•ç”¨ä¸Šä¸€ç« å¾—åˆ°çš„ç»“è®º: ç»„ä»¶å†…çš„æ¯ä¸€ä¸ªå‡½æ•°ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffectsï¼Œå®šæ—¶å™¨æˆ–è€…APIè°ƒç”¨ç­‰ç­‰ï¼‰ä¼šæ•è·å®šä¹‰å®ƒä»¬çš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„propså’Œstateã€‚ ç°åœ¨ç­”æ¡ˆæ˜¾è€Œæ˜“è§ã€‚effectçš„æ¸…é™¤å¹¶ä¸ä¼šè¯»å–â€œæœ€æ–°â€çš„propsã€‚å®ƒåªèƒ½è¯»å–åˆ°å®šä¹‰å®ƒçš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„propså€¼ï¼š 12345678910111213141516171819202122232425262728293031// First render, props are {id: 10}function Example() { // ... useEffect( // Effect from first render () =&gt; { ChatAPI.subscribeToFriendStatus(10, handleStatusChange); // Cleanup for effect from first render return () =&gt; { ChatAPI.unsubscribeFromFriendStatus(10, handleStatusChange); }; } ); // ...}// Next render, props are {id: 20}function Example() { // ... useEffect( // Effect from second render () =&gt; { ChatAPI.subscribeToFriendStatus(20, handleStatusChange); // Cleanup for effect from second render return () =&gt; { ChatAPI.unsubscribeFromFriendStatus(20, handleStatusChange); }; } ); // ...} ç‹å›½ä¼šå´›èµ·è½¬è€Œå¤å½’å°˜åœŸï¼Œå¤ªé˜³ä¼šè„±è½å¤–å±‚å˜ä¸ºç™½çŸ®æ˜Ÿï¼Œæœ€åçš„æ–‡æ˜ä¹Ÿè¿Ÿæ—©ä¼šç»“æŸã€‚ä½†æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­effectçš„æ¸…é™¤å‡½æ•°åªèƒ½çœ‹åˆ°{id: 10}è¿™ä¸ªpropsã€‚ è¿™æ­£æ˜¯ä¸ºä»€ä¹ˆReactèƒ½åšåˆ°åœ¨ç»˜åˆ¶åç«‹å³å¤„ç†effects â€” å¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹ä½¿ä½ çš„åº”ç”¨è¿è¡Œæ›´æµç•…ã€‚å¦‚æœä½ çš„ä»£ç éœ€è¦ä¾ç„¶å¯ä»¥è®¿é—®åˆ°è€çš„propsã€‚ åŒæ­¥ï¼Œ è€Œéç”Ÿå‘½å‘¨æœŸæˆ‘æœ€å–œæ¬¢Reactçš„ä¸€ç‚¹æ˜¯å®ƒç»Ÿä¸€æè¿°äº†åˆå§‹æ¸²æŸ“å’Œä¹‹åçš„æ›´æ–°ã€‚è¿™é™ä½äº†ä½ ç¨‹åºçš„ç†µã€‚ æ¯”å¦‚æˆ‘æœ‰ä¸ªç»„ä»¶åƒä¸‹é¢è¿™æ ·ï¼š 1234567function Greeting({ name }) { return ( &lt;h1 className=\"Greeting\"&gt; Hello, {name} &lt;/h1&gt; );} æˆ‘å…ˆæ¸²æŸ“&lt;Greeting name=\"Dan\" /&gt;ç„¶åæ¸²æŸ“&lt;Greeting name=\"Yuzhi\" /&gt;ï¼Œå’Œæˆ‘ç›´æ¥æ¸²æŸ“&lt;Greeting name=\"Yuzhi\" /&gt;å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸­ï¼Œæˆ‘æœ€åçœ‹åˆ°çš„éƒ½æ˜¯â€œHello, Yuzhiâ€ã€‚ äººä»¬æ€»æ˜¯è¯´ï¼šâ€œé‡è¦çš„æ˜¯æ—…è¡Œè¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ç›®çš„åœ°â€ã€‚åœ¨Reactä¸–ç•Œä¸­ï¼Œæ°å¥½ç›¸åã€‚é‡è¦çš„æ˜¯ç›®çš„ï¼Œè€Œä¸æ˜¯è¿‡ç¨‹ã€‚è¿™å°±æ˜¯JQueryä»£ç ä¸­$.addClassæˆ–$.removeClassè¿™æ ·çš„è°ƒç”¨ï¼ˆè¿‡ç¨‹ï¼‰å’ŒReactä»£ç ä¸­å£°æ˜CSSç±»ååº”è¯¥æ˜¯ä»€ä¹ˆï¼ˆç›®çš„ï¼‰ä¹‹é—´çš„åŒºåˆ«ã€‚ Reactä¼šæ ¹æ®æˆ‘ä»¬å½“å‰çš„propså’ŒstateåŒæ­¥åˆ°DOMã€‚â€œmountâ€å’Œâ€œupdateâ€ä¹‹äºæ¸²æŸ“å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ ä½ åº”è¯¥ä»¥ç›¸åŒçš„æ–¹å¼å»æ€è€ƒeffectsã€‚useEffectä½¿ä½ èƒ½å¤Ÿæ ¹æ®propså’ŒstateåŒæ­¥React treeä¹‹å¤–çš„ä¸œè¥¿ã€‚ 12345678910function Greeting({ name }) { useEffect(() =&gt; { document.title = 'Hello, ' + name; }); return ( &lt;h1 className=\"Greeting\"&gt; Hello, {name} &lt;/h1&gt; );} è¿™å°±æ˜¯å’Œå¤§å®¶ç†ŸçŸ¥çš„mount/update/unmountå¿ƒæ™ºæ¨¡å‹ä¹‹é—´ç»†å¾®çš„åŒºåˆ«ã€‚ç†è§£å’Œå†…åŒ–è¿™ç§åŒºåˆ«æ˜¯éå¸¸é‡è¦çš„ã€‚å¦‚æœä½ è¯•å›¾å†™ä¸€ä¸ªeffectä¼šæ ¹æ®æ˜¯å¦ç¬¬ä¸€æ¬¡æ¸²æŸ“è€Œè¡¨ç°ä¸ä¸€è‡´ï¼Œä½ æ­£åœ¨é€†æ½®è€ŒåŠ¨ã€‚å¦‚æœæˆ‘ä»¬çš„ç»“æœä¾èµ–äºè¿‡ç¨‹è€Œä¸æ˜¯ç›®çš„ï¼Œæˆ‘ä»¬ä¼šåœ¨åŒæ­¥ä¸­çŠ¯é”™ã€‚ å…ˆæ¸²æŸ“å±æ€§Aï¼ŒBå†æ¸²æŸ“Cï¼Œå’Œç«‹å³æ¸²æŸ“Cå¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚è™½ç„¶ä»–ä»¬å¯èƒ½çŸ­æš‚åœ°ä¼šæœ‰ç‚¹ä¸åŒï¼ˆæ¯”å¦‚è¯·æ±‚æ•°æ®æ—¶ï¼‰ï¼Œä½†æœ€ç»ˆçš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ ä¸è¿‡è¯è¯´å›æ¥ï¼Œåœ¨æ¯ä¸€æ¬¡æ¸²æŸ“åéƒ½å»è¿è¡Œæ‰€æœ‰çš„effectså¯èƒ½å¹¶ä¸é«˜æ•ˆã€‚ï¼ˆå¹¶ä¸”åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ— é™å¾ªç¯ã€‚ï¼‰ æ‰€ä»¥æˆ‘ä»¬è¯¥æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ å‘Šè¯‰Reactå»æ¯”å¯¹ä½ çš„Effectså…¶å®æˆ‘ä»¬å·²ç»ä»Reactå¤„ç†DOMçš„æ–¹å¼ä¸­å­¦ä¹ åˆ°äº†è§£å†³åŠæ³•ã€‚Reactåªä¼šæ›´æ–°DOMçœŸæ­£å‘ç”Ÿæ”¹å˜çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ¸²æŸ“éƒ½å¤§åŠ¨å¹²æˆˆã€‚ å½“ä½ æŠŠ 123&lt;h1 className=\"Greeting\"&gt; Hello, Dan&lt;/h1&gt; æ›´æ–°åˆ° 123&lt;h1 className=\"Greeting\"&gt; Hello, Yuzhi&lt;/h1&gt; React èƒ½å¤Ÿçœ‹åˆ°ä¸¤ä¸ªå¯¹è±¡: 12const oldProps = {className: 'Greeting', children: 'Hello, Dan'};const newProps = {className: 'Greeting', children: 'Hello, Yuzhi'}; å®ƒä¼šæ£€æµ‹æ¯ä¸€ä¸ªpropsï¼Œå¹¶ä¸”å‘ç°childrenå‘ç”Ÿæ”¹å˜éœ€è¦æ›´æ–°DOMï¼Œä½†classNameå¹¶æ²¡æœ‰ã€‚æ‰€ä»¥å®ƒåªéœ€è¦è¿™æ ·åšï¼š 12domNode.innerText = 'Hello, Yuzhi';// No need to touch domNode.className æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹å¼å¤„ç†effectså—ï¼Ÿå¦‚æœèƒ½å¤Ÿåœ¨ä¸éœ€è¦çš„æ—¶å€™é¿å…è°ƒç”¨effectå°±å¤ªå¥½äº†ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çš„ç»„ä»¶å¯èƒ½å› ä¸ºçŠ¶æ€å˜æ›´è€Œé‡æ–°æ¸²æŸ“ï¼š 12345678910111213141516function Greeting({ name }) { const [counter, setCounter] = useState(0); useEffect(() =&gt; { document.title = 'Hello, ' + name; }); return ( &lt;h1 className=\"Greeting\"&gt; Hello, {name} &lt;button onClick={() =&gt; setCounter(counter + 1)}&gt; Increment &lt;/button&gt; &lt;/h1&gt; );} ä½†æ˜¯æˆ‘ä»¬çš„effectå¹¶æ²¡æœ‰ä½¿ç”¨counterè¿™ä¸ªçŠ¶æ€ã€‚æˆ‘ä»¬çš„effectåªä¼šåŒæ­¥nameå±æ€§ç»™document.titleï¼Œä½†nameå¹¶æ²¡æœ‰å˜ã€‚åœ¨æ¯ä¸€æ¬¡counteræ”¹å˜åé‡æ–°ç»™document.titleèµ‹å€¼å¹¶ä¸æ˜¯ç†æƒ³çš„åšæ³•ã€‚ å¥½äº†ï¼Œé‚£Reactå¯ä»¥åŒºåˆ†effectsçš„ä¸åŒå—ï¼Ÿ 123let oldEffect = () =&gt; { document.title = 'Hello, Dan'; };let newEffect = () =&gt; { document.title = 'Hello, Dan'; };// Can React see these functions do the same thing? å¹¶ä¸èƒ½ã€‚Reactå¹¶ä¸èƒ½çŒœæµ‹åˆ°å‡½æ•°åšäº†ä»€ä¹ˆå¦‚æœä¸å…ˆè°ƒç”¨çš„è¯ã€‚ï¼ˆæºç ä¸­å¹¶æ²¡æœ‰åŒ…å«ç‰¹æ®Šçš„å€¼ï¼Œå®ƒä»…ä»…æ˜¯å¼•ç”¨äº†nameå±æ€§ã€‚ï¼‰ è¿™æ˜¯ä¸ºä»€ä¹ˆä½ å¦‚æœæƒ³è¦é¿å…effectsä¸å¿…è¦çš„é‡å¤è°ƒç”¨ï¼Œä½ å¯ä»¥æä¾›ç»™useEffectä¸€ä¸ªä¾èµ–æ•°ç»„å‚æ•°(deps)ï¼š 123useEffect(() =&gt; { document.title = 'Hello, ' + name;}, [name]); // Our deps è¿™å¥½æ¯”ä½ å‘Šè¯‰Reactï¼šâ€œHeyï¼Œæˆ‘çŸ¥é“ä½ çœ‹ä¸åˆ°è¿™ä¸ªå‡½æ•°é‡Œçš„ä¸œè¥¿ï¼Œä½†æˆ‘å¯ä»¥ä¿è¯åªä½¿ç”¨äº†æ¸²æŸ“ä¸­çš„nameï¼Œåˆ«æ— å…¶ä»–ã€‚â€ å¦‚æœå½“å‰æ¸²æŸ“ä¸­çš„è¿™äº›ä¾èµ–é¡¹å’Œä¸Šä¸€æ¬¡è¿è¡Œè¿™ä¸ªeffectçš„æ—¶å€™å€¼ä¸€æ ·ï¼Œå› ä¸ºæ²¡æœ‰ä»€ä¹ˆéœ€è¦åŒæ­¥Reactä¼šè‡ªåŠ¨è·³è¿‡è¿™æ¬¡effectï¼š 12345678const oldEffect = () =&gt; { document.title = 'Hello, Dan'; };const oldDeps = ['Dan'];const newEffect = () =&gt; { document.title = 'Hello, Dan'; };const newDeps = ['Dan'];// React can't peek inside of functions, but it can compare deps.// Since all deps are the same, it doesnâ€™t need to run the new effect. å³ä½¿ä¾èµ–æ•°ç»„ä¸­åªæœ‰ä¸€ä¸ªå€¼åœ¨ä¸¤æ¬¡æ¸²æŸ“ä¸­ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½è·³è¿‡effectçš„è¿è¡Œã€‚è¦åŒæ­¥æ‰€æœ‰ï¼ å…³äºä¾èµ–é¡¹ä¸è¦å¯¹Reactæ’’è°å…³äºä¾èµ–é¡¹å¯¹Reactæ’’è°ä¼šæœ‰ä¸å¥½çš„ç»“æœã€‚ç›´è§‰ä¸Šï¼Œè¿™å¾ˆå¥½ç†è§£ï¼Œä½†æˆ‘æ›¾çœ‹åˆ°å‡ ä¹æ‰€æœ‰ä¾èµ–classå¿ƒæ™ºæ¨¡å‹ä½¿ç”¨useEffectçš„äººéƒ½è¯•å›¾è¿åè¿™ä¸ªè§„åˆ™ã€‚ï¼ˆæˆ‘åˆšå¼€å§‹ä¹Ÿè¿™ä¹ˆå¹²äº†ï¼ï¼‰ 1234567891011function SearchResults() { async function fetchData() { // ... } useEffect(() =&gt; { fetchData(); }, []); // Is this okay? Not always -- and there's a better way to write it. // ...} (å®˜ç½‘çš„Hooks FAQè§£é‡Šäº†åº”è¯¥æ€ä¹ˆåšã€‚ æˆ‘ä»¬åœ¨ä¸‹é¢ä¼šé‡æ–°å›é¡¾è¿™ä¸ªä¾‹å­ã€‚) â€œä½†æˆ‘åªæ˜¯æƒ³åœ¨æŒ‚è½½çš„æ—¶å€™è¿è¡Œå®ƒï¼â€ï¼Œä½ å¯èƒ½ä¼šè¯´ã€‚ç°åœ¨åªéœ€è¦è®°ä½ï¼šå¦‚æœä½ è®¾ç½®äº†ä¾èµ–é¡¹ï¼Œeffectä¸­ç”¨åˆ°çš„æ‰€æœ‰ç»„ä»¶å†…çš„å€¼éƒ½è¦åŒ…å«åœ¨ä¾èµ–ä¸­ã€‚è¿™åŒ…æ‹¬propsï¼Œstateï¼Œå‡½æ•° â€” ç»„ä»¶å†…çš„ä»»ä½•ä¸œè¥¿ã€‚ æœ‰æ—¶å€™ä½ æ˜¯è¿™æ ·åšäº†ï¼Œä½†å¯èƒ½ä¼šå¼•èµ·ä¸€ä¸ªé—®é¢˜ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°æ— é™è¯·æ±‚çš„é—®é¢˜ï¼Œæˆ–è€…socketè¢«é¢‘ç¹åˆ›å»ºçš„é—®é¢˜ã€‚è§£å†³é—®é¢˜çš„æ–¹æ³•ä¸æ˜¯ç§»é™¤ä¾èµ–é¡¹ã€‚æˆ‘ä»¬ä¼šå¾ˆå¿«äº†è§£å…·ä½“çš„è§£å†³æ–¹æ¡ˆã€‚ ä¸è¿‡åœ¨æˆ‘ä»¬æ·±å…¥è§£å†³æ–¹æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå°è¯•æ›´å¥½åœ°ç†è§£é—®é¢˜ã€‚ å¦‚æœè®¾ç½®äº†é”™è¯¯çš„ä¾èµ–ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿå¦‚æœä¾èµ–é¡¹åŒ…å«äº†æ‰€æœ‰effectä¸­ä½¿ç”¨åˆ°çš„å€¼ï¼ŒReactå°±èƒ½çŸ¥é“ä½•æ—¶éœ€è¦è¿è¡Œå®ƒï¼š 123useEffect(() =&gt; { document.title = 'Hello, ' + name;}, [name]); (ä¾èµ–å‘ç”Ÿäº†å˜æ›´ï¼Œæ‰€ä»¥ä¼šé‡æ–°è¿è¡Œeffectã€‚) ä½†æ˜¯å¦‚æœæˆ‘ä»¬å°†[]è®¾ä¸ºeffectçš„ä¾èµ–ï¼Œæ–°çš„effectå‡½æ•°ä¸ä¼šè¿è¡Œï¼š 123useEffect(() =&gt; { document.title = 'Hello, ' + name;}, []); // Wrong: name is missing in deps (ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œeffectã€‚) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé—®é¢˜çœ‹èµ·æ¥æ˜¾è€Œæ˜“è§ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹å¦‚æœä½ è„‘å­é‡Œâ€œè·³å‡ºâ€classç»„ä»¶çš„è§£å†³åŠæ³•ï¼Œä½ çš„ç›´è§‰å¾ˆå¯èƒ½ä¼šæ¬ºéª—ä½ ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æ¥å†™ä¸€ä¸ªæ¯ç§’é€’å¢çš„è®¡æ•°å™¨ã€‚åœ¨Classç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬çš„ç›´è§‰æ˜¯ï¼šâ€œå¼€å¯ä¸€æ¬¡å®šæ—¶å™¨ï¼Œæ¸…é™¤ä¹Ÿæ˜¯ä¸€æ¬¡â€ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­è¯´æ˜æ€ä¹ˆå®ç°å®ƒã€‚å½“æˆ‘ä»¬ç†æ‰€å½“ç„¶åœ°æŠŠå®ƒç”¨useEffectçš„æ–¹å¼ç¿»è¯‘ï¼Œç›´è§‰ä¸Šæˆ‘ä»¬ä¼šè®¾ç½®ä¾èµ–ä¸º[]ã€‚â€œæˆ‘åªæƒ³è¿è¡Œä¸€æ¬¡effectâ€ï¼Œå¯¹å—ï¼Ÿ 123456789101112function Counter() { const [count, setCount] = useState(0); useEffect(() =&gt; { const id = setInterval(() =&gt; { setCount(count + 1); }, 1000); return () =&gt; clearInterval(id); }, []); return &lt;h1&gt;{count}&lt;/h1&gt;;} ç„¶è€Œï¼Œè¿™ä¸ªä¾‹å­åªä¼šé€’å¢ä¸€æ¬¡ã€‚å¤©äº†å™œã€‚ å¦‚æœä½ çš„å¿ƒæ™ºæ¨¡å‹æ˜¯â€œåªæœ‰å½“æˆ‘æƒ³é‡æ–°è§¦å‘effectçš„æ—¶å€™æ‰éœ€è¦å»è®¾ç½®ä¾èµ–â€ï¼Œè¿™ä¸ªä¾‹å­å¯èƒ½ä¼šè®©ä½ äº§ç”Ÿå­˜åœ¨å±æœºã€‚ä½ æƒ³è¦è§¦å‘ä¸€æ¬¡å› ä¸ºå®ƒæ˜¯å®šæ—¶å™¨ â€” ä½†ä¸ºä»€ä¹ˆä¼šæœ‰é—®é¢˜ï¼Ÿ å¦‚æœä½ çŸ¥é“ä¾èµ–æ˜¯æˆ‘ä»¬ç»™Reactçš„æš—ç¤ºï¼Œå‘Šè¯‰å®ƒeffectæ‰€æœ‰éœ€è¦ä½¿ç”¨çš„æ¸²æŸ“ä¸­çš„å€¼ï¼Œä½ å°±ä¸ä¼šåƒæƒŠäº†ã€‚effectä¸­ä½¿ç”¨äº†countä½†æˆ‘ä»¬æ’’è°è¯´å®ƒæ²¡æœ‰ä¾èµ–ã€‚å¦‚æœæˆ‘ä»¬è¿™æ ·åšè¿Ÿæ—©ä¼šå‡ºå¹ºè›¾å­ã€‚ åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œcountæ˜¯0ã€‚å› æ­¤ï¼ŒsetCount(count + 1)åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ç­‰ä»·äºsetCount(0 + 1)ã€‚æ—¢ç„¶æˆ‘ä»¬è®¾ç½®äº†[]ä¾èµ–ï¼Œeffectä¸ä¼šå†é‡æ–°è¿è¡Œï¼Œå®ƒåé¢æ¯ä¸€ç§’éƒ½ä¼šè°ƒç”¨setCount(0 + 1) ï¼š 1234567891011121314151617181920212223242526272829303132// First render, state is 0function Counter() { // ... useEffect( // Effect from first render () =&gt; { const id = setInterval(() =&gt; { setCount(0 + 1); // Always setCount(1) }, 1000); return () =&gt; clearInterval(id); }, [] // Never re-runs ); // ...}// Every next render, state is 1function Counter() { // ... useEffect( // This effect is always ignored because // we lied to React about empty deps. () =&gt; { const id = setInterval(() =&gt; { setCount(1 + 1); }, 1000); return () =&gt; clearInterval(id); }, [] ); // ...} æˆ‘ä»¬å¯¹Reactæ’’è°è¯´æˆ‘ä»¬çš„effectä¸ä¾èµ–ç»„ä»¶å†…çš„ä»»ä½•å€¼ï¼Œå¯å®é™…ä¸Šæˆ‘ä»¬çš„effectæœ‰ä¾èµ–ï¼ æˆ‘ä»¬çš„effectä¾èµ–count - å®ƒæ˜¯ç»„ä»¶å†…çš„å€¼ï¼ˆä¸è¿‡åœ¨effectå¤–é¢å®šä¹‰ï¼‰ï¼š 12345678const count = // ...useEffect(() =&gt; { const id = setInterval(() =&gt; { setCount(count + 1); }, 1000); return () =&gt; clearInterval(id);}, []); å› æ­¤ï¼Œè®¾ç½®[]ä¸ºä¾èµ–ä¼šå¼•å…¥ä¸€ä¸ªbugã€‚Reactä¼šå¯¹æ¯”ä¾èµ–ï¼Œå¹¶ä¸”è·³è¿‡åé¢çš„effectï¼š (ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œeffectã€‚) ç±»ä¼¼äºè¿™æ ·çš„é—®é¢˜æ˜¯å¾ˆéš¾è¢«æƒ³åˆ°çš„ã€‚å› æ­¤ï¼Œæˆ‘é¼“åŠ±ä½ å°†è¯šå®åœ°å‘ŠçŸ¥effectä¾èµ–ä½œä¸ºä¸€æ¡ç¡¬æ€§è§„åˆ™ï¼Œå¹¶ä¸”è¦åˆ—å‡ºæ‰€ä»¥ä¾èµ–ã€‚ï¼ˆæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªlintè§„åˆ™å¦‚æœä½ æƒ³åœ¨ä½ çš„å›¢é˜Ÿå†…åšç¡¬æ€§è§„å®šã€‚ï¼‰ ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„æ–¹æ³•æœ‰ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„ç­–ç•¥ã€‚ä½ åº”è¯¥ä»ç¬¬ä¸€ç§å¼€å§‹ï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™åº”ç”¨ç¬¬äºŒç§ã€‚ ç¬¬ä¸€ç§ç­–ç•¥æ˜¯åœ¨ä¾èµ–ä¸­åŒ…å«æ‰€æœ‰effectä¸­ç”¨åˆ°çš„ç»„ä»¶å†…çš„å€¼ã€‚è®©æˆ‘ä»¬åœ¨ä¾èµ–ä¸­åŒ…å«countï¼š 123456useEffect(() =&gt; { const id = setInterval(() =&gt; { setCount(count + 1); }, 1000); return () =&gt; clearInterval(id);}, [count]); ç°åœ¨ä¾èµ–æ•°ç»„æ­£ç¡®äº†ã€‚è™½ç„¶å®ƒå¯èƒ½ä¸æ˜¯å¤ªç†æƒ³ä½†ç¡®å®è§£å†³äº†ä¸Šé¢çš„é—®é¢˜ã€‚ç°åœ¨ï¼Œæ¯æ¬¡countä¿®æ”¹éƒ½ä¼šé‡æ–°è¿è¡Œeffectï¼Œå¹¶ä¸”å®šæ—¶å™¨ä¸­çš„setCount(count + 1)ä¼šæ­£ç¡®å¼•ç”¨æŸæ¬¡æ¸²æŸ“ä¸­çš„ countå€¼ï¼š 12345678910111213141516171819202122232425262728293031// First render, state is 0function Counter() { // ... useEffect( // Effect from first render () =&gt; { const id = setInterval(() =&gt; { setCount(0 + 1); // setCount(count + 1) }, 1000); return () =&gt; clearInterval(id); }, [0] // [count] ); // ...}// Second render, state is 1function Counter() { // ... useEffect( // Effect from second render () =&gt; { const id = setInterval(() =&gt; { setCount(1 + 1); // setCount(count + 1) }, 1000); return () =&gt; clearInterval(id); }, [1] // [count] ); // ...} è¿™èƒ½è§£å†³é—®é¢˜ä½†æ˜¯æˆ‘ä»¬çš„å®šæ—¶å™¨ä¼šåœ¨æ¯ä¸€æ¬¡countæ”¹å˜åæ¸…é™¤å’Œé‡æ–°è®¾å®šã€‚è¿™åº”è¯¥ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼š (ä¾èµ–å‘ç”Ÿäº†å˜æ›´ï¼Œæ‰€ä»¥ä¼šé‡æ–°è¿è¡Œeffectã€‚) ç¬¬äºŒç§ç­–ç•¥æ˜¯ä¿®æ”¹effectå†…éƒ¨çš„ä»£ç ä»¥ç¡®ä¿å®ƒåŒ…å«çš„å€¼åªä¼šåœ¨éœ€è¦çš„æ—¶å€™å‘ç”Ÿå˜æ›´ã€‚æˆ‘ä»¬ä¸æƒ³å‘ŠçŸ¥é”™è¯¯çš„ä¾èµ– - æˆ‘ä»¬åªæ˜¯ä¿®æ”¹effectä½¿å¾—ä¾èµ–æ›´å°‘ã€‚ è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›ç§»é™¤ä¾èµ–çš„å¸¸ç”¨æŠ€å·§ã€‚ è®©Effectsè‡ªç»™è‡ªè¶³æˆ‘ä»¬æƒ³å»æ‰effectçš„countä¾èµ–ã€‚ 123456useEffect(() =&gt; { const id = setInterval(() =&gt; { setCount(count + 1); }, 1000); return () =&gt; clearInterval(id);}, [count]); ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦é—®è‡ªå·±ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨countï¼Ÿå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªåœ¨setCountè°ƒç”¨ä¸­ç”¨åˆ°äº†countã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å…¶å®å¹¶ä¸éœ€è¦åœ¨effectä¸­ä½¿ç”¨countã€‚å½“æˆ‘ä»¬æƒ³è¦æ ¹æ®å‰ä¸€ä¸ªçŠ¶æ€æ›´æ–°çŠ¶æ€çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨setStateçš„å‡½æ•°å½¢å¼ï¼š 123456useEffect(() =&gt; { const id = setInterval(() =&gt; { setCount(c =&gt; c + 1); }, 1000); return () =&gt; clearInterval(id);}, []); æˆ‘å–œæ¬¢æŠŠç±»ä¼¼è¿™ç§æƒ…å†µç§°ä¸ºâ€œé”™è¯¯çš„ä¾èµ–â€ã€‚æ˜¯çš„ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨effectä¸­å†™äº†setCount(count + 1)æ‰€ä»¥countæ˜¯ä¸€ä¸ªå¿…éœ€çš„ä¾èµ–ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çœŸæ­£æƒ³è¦çš„æ˜¯æŠŠcountè½¬æ¢ä¸ºcount+1ï¼Œç„¶åè¿”å›ç»™Reactã€‚å¯æ˜¯Reactå…¶å®å·²ç»çŸ¥é“å½“å‰çš„countã€‚æˆ‘ä»¬éœ€è¦å‘ŠçŸ¥Reactçš„ä»…ä»…æ˜¯å»é€’å¢çŠ¶æ€ - ä¸ç®¡å®ƒç°åœ¨å…·ä½“æ˜¯ä»€ä¹ˆå€¼ã€‚ è¿™æ­£æ˜¯setCount(c =&gt; c + 1)åšçš„äº‹æƒ…ã€‚ä½ å¯ä»¥è®¤ä¸ºå®ƒæ˜¯åœ¨ç»™Reactâ€œå‘é€æŒ‡ä»¤â€å‘ŠçŸ¥å¦‚ä½•æ›´æ–°çŠ¶æ€ã€‚è¿™ç§â€œæ›´æ–°å½¢å¼â€åœ¨å…¶ä»–æƒ…å†µä¸‹ä¹Ÿæœ‰å¸®åŠ©ï¼Œæ¯”å¦‚ä½ éœ€è¦æ‰¹é‡æ›´æ–°ã€‚ æ³¨æ„æˆ‘ä»¬åšåˆ°äº†ç§»é™¤ä¾èµ–ï¼Œå¹¶ä¸”æ²¡æœ‰æ’’è°ã€‚æˆ‘ä»¬çš„effectä¸å†è¯»å–æ¸²æŸ“ä¸­çš„countå€¼ã€‚ (ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œeffectã€‚) ä½ å¯ä»¥è‡ªå·±è¯•è¯•ã€‚ å°½ç®¡effectåªè¿è¡Œäº†ä¸€æ¬¡ï¼Œç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­çš„å®šæ—¶å™¨å›è°ƒå‡½æ•°å¯ä»¥å®Œç¾åœ°åœ¨æ¯æ¬¡è§¦å‘çš„æ—¶å€™ç»™Reactå‘é€c =&gt; c + 1æ›´æ–°æŒ‡ä»¤ã€‚å®ƒä¸å†éœ€è¦çŸ¥é“å½“å‰çš„countå€¼ã€‚å› ä¸ºReactå·²ç»çŸ¥é“äº†ã€‚ ç»“æŸè¯­ åŸæ–‡ä½œè€…ï¼šDan AbramovåŸæ–‡é“¾æ¥ï¼šhttps://overreacted.io/a-complete-guide-to-useeffect/ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://lry61.cn/blog/tags/å‰ç«¯/"}]},{"title":"React Hooksç³»åˆ—ä¹‹useEffectï¼ˆä¸€ï¼‰","date":"2019-12-17T11:47:08.984Z","path":"/posts/6/","text":"React Hooksç³»åˆ—ä¹‹useEffectï¼ˆä¸€ï¼‰ å‰è¨€ä½ ç”¨Hookså†™äº†ä¸€äº›ç»„ä»¶ï¼Œç”šæˆ–å†™äº†ä¸€ä¸ªå°å‹åº”ç”¨ã€‚ä½ å¯èƒ½å¾ˆæ»¡æ„ï¼Œä½¿ç”¨å®ƒçš„APIå¾ˆèˆ’æœå¹¶ä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è·å¾—äº†ä¸€äº›å°æŠ€å·§ã€‚ä½ ç”šè‡³å¯èƒ½å†™äº†ä¸€äº›custom Hookså»æŠ½ç¦»é‡å¤çš„é€»è¾‘ï¼ˆç²¾ç®€æ‰äº†300è¡Œä»£ç ï¼‰ï¼Œå¹¶ä¸”å¾—æ„åœ°å±•ç¤ºç»™ä½ çš„åŒäº‹çœ‹ï¼Œâ€œå¹²å¾—æ¼‚äº®â€ï¼Œä»–ä»¬å¦‚æ˜¯è¯´ã€‚ ä½†æœ‰æ—¶å€™å½“ä½ ä½¿ç”¨useEffectä½ æ€»è§‰å¾—å“ªå„¿æœ‰ç‚¹ä¸å¯¹åŠ²ã€‚ä½ ä¼šå˜€å’•ä½ å¯èƒ½é—æ¼äº†ä»€ä¹ˆã€‚å®ƒçœ‹èµ·æ¥åƒclassçš„ç”Ÿå‘½å‘¨æœŸâ€¦ä½†çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿä½ å‘è§‰è‡ªå·±åœ¨é—®ç±»ä¼¼ä¸‹é¢çš„è¿™äº›é—®é¢˜ï¼š ğŸ¤” å¦‚ä½•ç”¨useEffectæ¨¡æ‹ŸcomponentDidMountç”Ÿå‘½å‘¨æœŸï¼Ÿ ğŸ¤” å¦‚ä½•æ­£ç¡®åœ°åœ¨useEffecté‡Œè¯·æ±‚æ•°æ®ï¼Ÿ[]åˆæ˜¯ä»€ä¹ˆï¼Ÿ ğŸ¤” æˆ‘åº”è¯¥æŠŠå‡½æ•°å½“åšeffectçš„ä¾èµ–å—ï¼Ÿ ğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šå‡ºç°æ— é™é‡å¤è¯·æ±‚çš„é—®é¢˜ï¼Ÿ ğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™åœ¨effecté‡Œæ‹¿åˆ°çš„æ˜¯æ—§çš„stateæˆ–propï¼Ÿ å½“æˆ‘åˆšå¼€å§‹ä½¿ç”¨Hooksçš„æ—¶å€™ï¼Œæˆ‘ä¹ŸåŒæ ·è¢«ä¸Šé¢è¿™äº›é—®é¢˜æ‰€å›°æ‰°ã€‚ç”šè‡³å½“æˆ‘å†™æœ€åˆçš„æ–‡æ¡£æ—¶ï¼Œæˆ‘ä¹Ÿå¹¶æ²¡æœ‰æ‰å®åœ°æŒæ¡æŸäº›ç»†èŠ‚ã€‚æˆ‘ç»å†äº†ä¸€äº›â€œå•Šå“ˆâ€çš„å¼€çªæ—¶åˆ»ï¼Œæˆ‘æƒ³æŠŠè¿™äº›åˆ†äº«ç»™ä½ ã€‚ åœ¨çœ‹ç­”æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¾€åé€€ä¸€æ­¥ã€‚è¿™ç¯‡æ–‡ç« çš„ç›®çš„ä¸æ˜¯ç»™ä½ ä¸€ä¸ªè¦ç‚¹æ¸…å•ï¼Œè€Œæ˜¯æƒ³å¸®ä½ çœŸæ­£åœ°é¢†ä¼šuseEffectã€‚å…¶å®æˆ‘ä»¬å¹¶æ²¡æœ‰å¤ªå¤šéœ€è¦å­¦ä¹ çš„ï¼Œäº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¼šèŠ±å¾ˆå¤šæ—¶é—´è¯•å›¾å¿˜è®°æŸäº›å·²ç»ä¹ å¾—çš„æ¦‚å¿µï¼ˆunlearningï¼‰ã€‚ å½“æˆ‘ä¸å†é€è¿‡ç†Ÿæ‚‰çš„classç”Ÿå‘½å‘¨æœŸæ–¹æ³•å»çª¥è§†useEffectè¿™ä¸ªHookçš„æ—¶å€™ï¼Œæˆ‘æ‰å¾—ä»¥èä¼šè´¯é€šã€‚ â€œå¿˜è®°ä½ å·²ç»å­¦åˆ°çš„ã€‚â€ â€” Yoda å¦‚æœä½ å¯¹äºæ·±å…¥ç ”ç©¶æ„Ÿè§‰ä¸æ˜¯å¾ˆé€‚åº”çš„è¯ï¼Œä½ æˆ–è®¸å¯ä»¥ç­‰ä¸‹é¢è¿™äº›è§£é‡Šå‡ºç°åœ¨å…¶ä»–æ–‡ç« ä¸­å†å»äº†è§£ä¹Ÿè¡Œã€‚å°±åƒ2013å¹´Reactåˆšå‡ºä¸–çš„æ—¶å€™ï¼Œå¤§å®¶éœ€è¦æ—¶é—´å»ç†è§£æ¶ˆåŒ–ä¸€ç§ä¸åŒçš„å¿ƒæ™ºæ¨¡å‹ã€‚çŸ¥è¯†ä¹Ÿéœ€è¦æ—¶é—´å»æ™®åŠã€‚ æ‘˜è¦å¦‚æœä½ ä¸æƒ³é˜…è¯»æ•´ç¯‡æ–‡ç« ï¼Œå¯ä»¥å¿«é€Ÿæµè§ˆè¿™ä»½æ‘˜è¦ã€‚è¦æ˜¯æŸäº›éƒ¨åˆ†ä¸å®¹æ˜“ç†è§£ï¼Œä½ å¯ä»¥å¾€ä¸‹æ»šåŠ¨å¯»æ‰¾ç›¸å…³çš„å†…å®¹å»é˜…è¯»ã€‚ ğŸ¤” Question: å¦‚ä½•ç”¨useEffectæ¨¡æ‹ŸcomponentDidMountç”Ÿå‘½å‘¨æœŸï¼Ÿ è™½ç„¶å¯ä»¥ä½¿ç”¨useEffect(fn, [])ï¼Œä½†å®ƒä»¬å¹¶ä¸å®Œå…¨ç›¸ç­‰ã€‚å’ŒcomponentDidMountä¸ä¸€æ ·ï¼ŒuseEffectä¼šæ•è·propså’Œstateã€‚æ‰€ä»¥å³ä¾¿åœ¨å›è°ƒå‡½æ•°é‡Œï¼Œä½ æ‹¿åˆ°çš„è¿˜æ˜¯åˆå§‹çš„propså’Œstateã€‚å¦‚æœä½ æƒ³å¾—åˆ°â€œæœ€æ–°â€çš„å€¼ï¼Œä½ å¯ä»¥ä½¿ç”¨refã€‚ä¸è¿‡ï¼Œé€šå¸¸ä¼šæœ‰æ›´ç®€å•çš„å®ç°æ–¹å¼ï¼Œæ‰€ä»¥ä½ å¹¶ä¸ä¸€å®šè¦ç”¨refã€‚è®°ä½ï¼Œeffectsçš„å¿ƒæ™ºæ¨¡å‹å’ŒcomponentDidMountä»¥åŠå…¶ä»–ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸åŒçš„ï¼Œè¯•å›¾æ‰¾åˆ°å®ƒä»¬ä¹‹é—´å®Œå…¨ä¸€è‡´çš„è¡¨è¾¾åè€Œæ›´å®¹æ˜“ä½¿ä½ æ··æ·†ã€‚æƒ³è¦æ›´æœ‰æ•ˆï¼Œä½ éœ€è¦â€œthink in effectsâ€ï¼Œå®ƒçš„å¿ƒæ™ºæ¨¡å‹æ›´æ¥è¿‘äºå®ç°çŠ¶æ€åŒæ­¥ï¼Œè€Œä¸æ˜¯å“åº”ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚ ğŸ¤” Question: å¦‚ä½•æ­£ç¡®åœ°åœ¨useEffecté‡Œè¯·æ±‚æ•°æ®ï¼Ÿ[]åˆæ˜¯ä»€ä¹ˆï¼Ÿ è¿™ç¯‡æ–‡ç« æ˜¯å¾ˆå¥½çš„å…¥é—¨ï¼Œä»‹ç»äº†å¦‚ä½•åœ¨useEffecté‡Œåšæ•°æ®è¯·æ±‚ã€‚è¯·åŠ¡å¿…è¯»å®Œå®ƒï¼å®ƒæ²¡æœ‰æˆ‘çš„è¿™ç¯‡è¿™ä¹ˆé•¿ã€‚[] è¡¨ç¤ºeffectæ²¡æœ‰ä½¿ç”¨ä»»ä½•Reactæ•°æ®æµé‡Œçš„å€¼ï¼Œå› æ­¤è¯¥effectä»…è¢«è°ƒç”¨ä¸€æ¬¡æ˜¯å®‰å…¨çš„ã€‚[]åŒæ ·ä¹Ÿæ˜¯ä¸€ç±»å¸¸è§é—®é¢˜çš„æ¥æºï¼Œä¹Ÿå³ä½ ä»¥ä¸ºæ²¡ä½¿ç”¨æ•°æ®æµé‡Œçš„å€¼ä½†å…¶å®ä½¿ç”¨äº†ã€‚ä½ éœ€è¦å­¦ä¹ ä¸€äº›ç­–ç•¥ï¼ˆä¸»è¦æ˜¯useReducer å’Œ useCallbackï¼‰æ¥ç§»é™¤è¿™äº›effectä¾èµ–ï¼Œè€Œä¸æ˜¯é”™è¯¯åœ°å¿½ç•¥å®ƒä»¬ã€‚ ğŸ¤” Question: æˆ‘åº”è¯¥æŠŠå‡½æ•°å½“åšeffectçš„ä¾èµ–å—ï¼Ÿ ä¸€èˆ¬å»ºè®®æŠŠä¸ä¾èµ–propså’Œstateçš„å‡½æ•°æåˆ°ä½ çš„ç»„ä»¶å¤–é¢ï¼Œå¹¶ä¸”æŠŠé‚£äº›ä»…è¢«effectä½¿ç”¨çš„å‡½æ•°æ”¾åˆ°effecté‡Œé¢ã€‚å¦‚æœè¿™æ ·åšäº†ä»¥åï¼Œä½ çš„effectè¿˜æ˜¯éœ€è¦ç”¨åˆ°ç»„ä»¶å†…çš„å‡½æ•°ï¼ˆåŒ…æ‹¬é€šè¿‡propsä¼ è¿›æ¥çš„å‡½æ•°ï¼‰ï¼Œå¯ä»¥åœ¨å®šä¹‰å®ƒä»¬çš„åœ°æ–¹ç”¨useCallbackåŒ…ä¸€å±‚ã€‚ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢ï¼Ÿå› ä¸ºè¿™äº›å‡½æ•°å¯ä»¥è®¿é—®åˆ°propså’Œstateï¼Œå› æ­¤å®ƒä»¬ä¼šå‚ä¸åˆ°æ•°æ®æµä¸­ã€‚æˆ‘ä»¬å®˜ç½‘çš„FAQæœ‰æ›´è¯¦ç»†çš„ç­”æ¡ˆã€‚ ğŸ¤” Question: ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šå‡ºç°æ— é™é‡å¤è¯·æ±‚çš„é—®é¢˜ï¼Ÿ è¿™ä¸ªé€šå¸¸å‘ç”Ÿäºä½ åœ¨effecté‡Œåšæ•°æ®è¯·æ±‚å¹¶ä¸”æ²¡æœ‰è®¾ç½®effectä¾èµ–å‚æ•°çš„æƒ…å†µã€‚æ²¡æœ‰è®¾ç½®ä¾èµ–ï¼Œeffectä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åæ‰§è¡Œä¸€æ¬¡ï¼Œç„¶ååœ¨effectä¸­æ›´æ–°äº†çŠ¶æ€å¼•èµ·æ¸²æŸ“å¹¶å†æ¬¡è§¦å‘effectã€‚æ— é™å¾ªç¯çš„å‘ç”Ÿä¹Ÿå¯èƒ½æ˜¯å› ä¸ºä½ è®¾ç½®çš„ä¾èµ–æ€»æ˜¯ä¼šæ”¹å˜ã€‚ä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªä¸€ä¸ªç§»é™¤çš„æ–¹å¼æ’æŸ¥å‡ºå“ªä¸ªä¾èµ–å¯¼è‡´äº†é—®é¢˜ã€‚ä½†æ˜¯ï¼Œç§»é™¤ä½ ä½¿ç”¨çš„ä¾èµ–ï¼ˆæˆ–è€…ç›²ç›®åœ°ä½¿ç”¨[]ï¼‰é€šå¸¸æ˜¯ä¸€ç§é”™è¯¯çš„è§£å†³æ–¹å¼ã€‚ä½ åº”è¯¥åšçš„æ˜¯è§£å†³é—®é¢˜çš„æ ¹æºã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡½æ•°å¯èƒ½ä¼šå¯¼è‡´è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬æ”¾åˆ°effecté‡Œï¼Œæˆ–è€…æåˆ°ç»„ä»¶å¤–é¢ï¼Œæˆ–è€…ç”¨useCallbackåŒ…ä¸€å±‚ã€‚useMemoå¯ä»¥åšç±»ä¼¼çš„äº‹æƒ…ä»¥é¿å…é‡å¤ç”Ÿæˆå¯¹è±¡ã€‚ ğŸ¤” Question: ä¸ºä»€ä¹ˆæœ‰æ—¶å€™åœ¨effecté‡Œæ‹¿åˆ°çš„æ˜¯æ—§çš„stateæˆ–propå‘¢ï¼Ÿ Effectæ‹¿åˆ°çš„æ€»æ˜¯å®šä¹‰å®ƒçš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„propså’Œstateã€‚è¿™èƒ½å¤Ÿé¿å…ä¸€äº›bugsï¼Œä½†åœ¨ä¸€äº›åœºæ™¯ä¸­åˆä¼šæœ‰äº›è®¨äººå«Œã€‚å¯¹äºè¿™äº›åœºæ™¯ï¼Œä½ å¯ä»¥æ˜ç¡®åœ°ä½¿ç”¨å¯å˜çš„refä¿å­˜ä¸€äº›å€¼ï¼ˆä¸Šé¢æ–‡ç« çš„æœ«å°¾è§£é‡Šäº†è¿™ä¸€ç‚¹ï¼‰ã€‚å¦‚æœä½ è§‰å¾—åœ¨æ¸²æŸ“ä¸­æ‹¿åˆ°äº†ä¸€äº›æ—§çš„propså’Œstateï¼Œä¸”ä¸æ˜¯ä½ æƒ³è¦çš„ï¼Œä½ å¾ˆå¯èƒ½é—æ¼äº†ä¸€äº›ä¾èµ–ã€‚å¯ä»¥å°è¯•ä½¿ç”¨è¿™ä¸ªlintè§„åˆ™æ¥è®­ç»ƒä½ å‘ç°è¿™äº›ä¾èµ–ã€‚å¯èƒ½æ²¡è¿‡å‡ å¤©ï¼Œè¿™ç§èƒ½åŠ›ä¼šå˜å¾—åƒæ˜¯ä½ çš„ç¬¬äºŒå¤©æ€§ã€‚åŒæ ·å¯ä»¥çœ‹æˆ‘ä»¬å®˜ç½‘FAQä¸­çš„è¿™ä¸ªå›ç­”ã€‚ æˆ‘å¸Œæœ›è¿™ä¸ªæ‘˜è¦å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼è¦ä¸ï¼Œæˆ‘ä»¬å¼€å§‹æ­£æ–‡ã€‚ æ­£æ–‡æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„Props and Stateåœ¨æˆ‘ä»¬è®¨è®ºeffectsä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè®¨è®ºä¸€ä¸‹æ¸²æŸ“ï¼ˆrenderingï¼‰ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªè®¡æ•°å™¨ç»„ä»¶Counterï¼Œæ³¨æ„&lt;p&gt;You clicked {count} times&lt;/p&gt;è¿™ä¸€è¡Œï¼š 123456789101112function Counter() { const [count, setCount] = useState(0); return ( &lt;div&gt; &lt;p&gt;You clicked {count} times&lt;/p&gt; &lt;button onClick={() =&gt; setCount(count + 1)}&gt; Click me &lt;/button&gt; &lt;/div&gt; );} æ³¨æ„çš„ä»£ç ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿcount ä¼šâ€œç›‘å¬â€çŠ¶æ€çš„å˜åŒ–å¹¶è‡ªåŠ¨æ›´æ–°å—ï¼Ÿè¿™ä¹ˆæƒ³å¯èƒ½æ˜¯å­¦ä¹ Reactçš„æ—¶å€™æœ‰ç”¨çš„ç¬¬ä¸€ç›´è§‰ï¼Œä½†å®ƒå¹¶ä¸æ˜¯ç²¾ç¡®çš„å¿ƒæ™ºæ¨¡å‹ã€‚ ä¸Šé¢ä¾‹å­ä¸­ï¼Œcountä»…æ˜¯ä¸€ä¸ªæ•°å­—è€Œå·²ã€‚å®ƒä¸æ˜¯ç¥å¥‡çš„â€œdata bindingâ€, â€œwatcherâ€, â€œproxyâ€ï¼Œæˆ–è€…å…¶ä»–ä»»ä½•ä¸œè¥¿ã€‚å®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•°å­—åƒä¸‹é¢è¿™ä¸ªä¸€æ ·ï¼š 1234const count = 42;// ...&lt;p&gt;You clicked {count} times&lt;/p&gt;// ... æˆ‘ä»¬çš„ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼Œä»useState()æ‹¿åˆ°countçš„åˆå§‹å€¼0ã€‚å½“æˆ‘ä»¬è°ƒç”¨setCount(1)ï¼ŒReactä¼šå†æ¬¡æ¸²æŸ“ç»„ä»¶ï¼Œè¿™ä¸€æ¬¡countæ˜¯1ã€‚å¦‚æ­¤ç­‰ç­‰ï¼š 1234567891011121314151617181920212223// During first renderfunction Counter() { const count = 0; // Returned by useState() // ... &lt;p&gt;You clicked {count} times&lt;/p&gt; // ...}// After a click, our function is called againfunction Counter() { const count = 1; // Returned by useState() // ... &lt;p&gt;You clicked {count} times&lt;/p&gt; // ...}// After another click, our function is called againfunction Counter() { const count = 2; // Returned by useState() // ... &lt;p&gt;You clicked {count} times&lt;/p&gt; // ...} å½“æˆ‘ä»¬æ›´æ–°çŠ¶æ€çš„æ—¶å€™ï¼ŒReactä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½èƒ½æ‹¿åˆ°ç‹¬ç«‹çš„count çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€å€¼æ˜¯å‡½æ•°ä¸­çš„ä¸€ä¸ªå¸¸é‡ã€‚ æ‰€ä»¥ä¸‹é¢çš„è¿™è¡Œä»£ç æ²¡æœ‰åšä»»ä½•ç‰¹æ®Šçš„æ•°æ®ç»‘å®šï¼š 1&lt;p&gt;You clicked {count} times&lt;/p&gt; å®ƒä»…ä»…åªæ˜¯åœ¨æ¸²æŸ“è¾“å‡ºä¸­æ’å…¥äº†countè¿™ä¸ªæ•°å­—ã€‚è¿™ä¸ªæ•°å­—ç”±Reactæä¾›ã€‚å½“setCountçš„æ—¶å€™ï¼ŒReactä¼šå¸¦ç€ä¸€ä¸ªä¸åŒçš„countå€¼å†æ¬¡è°ƒç”¨ç»„ä»¶ã€‚ç„¶åï¼ŒReactä¼šæ›´æ–°DOMä»¥ä¿æŒå’Œæ¸²æŸ“è¾“å‡ºä¸€è‡´ã€‚ è¿™é‡Œå…³é”®çš„ç‚¹åœ¨äºä»»æ„ä¸€æ¬¡æ¸²æŸ“ä¸­çš„countå¸¸é‡éƒ½ä¸ä¼šéšç€æ—¶é—´æ”¹å˜ã€‚æ¸²æŸ“è¾“å‡ºä¼šå˜æ˜¯å› ä¸ºæˆ‘ä»¬çš„ç»„ä»¶è¢«ä¸€æ¬¡æ¬¡è°ƒç”¨ï¼Œè€Œæ¯ä¸€æ¬¡è°ƒç”¨å¼•èµ·çš„æ¸²æŸ“ä¸­ï¼Œå®ƒåŒ…å«çš„countå€¼ç‹¬ç«‹äºå…¶ä»–æ¸²æŸ“ã€‚ ï¼ˆå…³äºè¿™ä¸ªè¿‡ç¨‹æ›´æ·±å…¥çš„æ¢è®¨å¯ä»¥æŸ¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« React as a UI Runtimeï¼‰ æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°åˆ°ç›®å‰ä¸ºæ­¢ä¸€åˆ‡éƒ½è¿˜å¥½ã€‚é‚£ä¹ˆäº‹ä»¶å¤„ç†å‡½æ•°å‘¢ï¼Ÿ çœ‹ä¸‹é¢çš„è¿™ä¸ªä¾‹å­ã€‚å®ƒåœ¨ä¸‰ç§’åä¼šalertç‚¹å‡»æ¬¡æ•°countï¼š 123456789101112131415161718192021function Counter() { const [count, setCount] = useState(0); function handleAlertClick() { setTimeout(() =&gt; { alert('You clicked on: ' + count); }, 3000); } return ( &lt;div&gt; &lt;p&gt;You clicked {count} times&lt;/p&gt; &lt;button onClick={() =&gt; setCount(count + 1)}&gt; Click me &lt;/button&gt; &lt;button onClick={handleAlertClick}&gt; Show alert &lt;/button&gt; &lt;/div&gt; );} å¦‚æœæˆ‘æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤å»æ“ä½œï¼š ç‚¹å‡»å¢åŠ countåˆ°3 ç‚¹å‡»ä¸€ä¸‹ â€œShow alertâ€ ç‚¹å‡»å¢åŠ countåˆ°5å¹¶ä¸”åœ¨å®šæ—¶å™¨å›è°ƒè§¦å‘å‰å®Œæˆ ä½ çŒœalertä¼šå¼¹å‡ºä»€ä¹ˆå‘¢ï¼Ÿä¼šæ˜¯5å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯alertçš„æ—¶å€™countçš„å®æ—¶çŠ¶æ€ã€‚æˆ–è€…ä¼šæ˜¯3å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯æˆ‘ç‚¹å‡»æ—¶å€™çš„çŠ¶æ€ã€‚ æ¥è‡ªå·±è¯•è¯•å§ï¼ å¦‚æœç»“æœå’Œä½ é¢„æ–™ä¸ä¸€æ ·ï¼Œä½ å¯ä»¥æƒ³è±¡ä¸€ä¸ªæ›´å®é™…çš„ä¾‹å­ï¼šä¸€ä¸ªèŠå¤©åº”ç”¨åœ¨stateä¸­ä¿å­˜äº†å½“å‰æ¥æ”¶è€…çš„IDï¼Œä»¥åŠä¸€ä¸ªå‘é€æŒ‰é’®ã€‚è¿™ç¯‡æ–‡ç« æ·±å…¥æ¢ç´¢äº†ä¸ªä¸­ç¼˜ç”±ã€‚æ­£ç¡®çš„ç­”æ¡ˆå°±æ˜¯3ã€‚ alertä¼šâ€œæ•è·â€æˆ‘ç‚¹å‡»æŒ‰é’®æ—¶å€™çš„çŠ¶æ€ã€‚ ï¼ˆè™½ç„¶æœ‰å…¶ä»–åŠæ³•å¯ä»¥å®ç°ä¸åŒçš„è¡Œä¸ºï¼Œä½†ç°åœ¨æˆ‘ä¼šä¸“æ³¨äºè¿™ä¸ªé»˜è®¤çš„åœºæ™¯ã€‚å½“æˆ‘ä»¬åœ¨æ„å»ºä¸€ç§å¿ƒæ™ºæ¨¡å‹çš„æ—¶å€™ï¼Œåœ¨å¯é€‰çš„ç­–ç•¥ä¸­åˆ†è¾¨å‡ºâ€œæœ€å°é˜»åŠ›è·¯å¾„â€æ˜¯éå¸¸é‡è¦çš„ã€‚ï¼‰ ä½†å®ƒç©¶ç«Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ æˆ‘ä»¬å‘ç°countåœ¨æ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­éƒ½æ˜¯ä¸€ä¸ªå¸¸é‡å€¼ã€‚å€¼å¾—å¼ºè°ƒçš„æ˜¯ â€” æˆ‘ä»¬çš„ç»„ä»¶å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¢«è°ƒç”¨ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡è°ƒç”¨ä¸­countå€¼éƒ½æ˜¯å¸¸é‡ï¼Œå¹¶ä¸”å®ƒè¢«èµ‹äºˆäº†å½“å‰æ¸²æŸ“ä¸­çš„çŠ¶æ€å€¼ã€‚ è¿™å¹¶ä¸æ˜¯Reactç‰¹æœ‰çš„ï¼Œæ™®é€šçš„å‡½æ•°ä¹Ÿæœ‰ç±»ä¼¼çš„è¡Œä¸ºï¼š 123456789101112131415function sayHi(person) { const name = person.name; setTimeout(() =&gt; { alert('Hello, ' + name); }, 3000);}let someone = {name: 'Dan'};sayHi(someone);someone = {name: 'Yuzhi'};sayHi(someone);someone = {name: 'Dominic'};sayHi(someone); åœ¨è¿™ä¸ªä¾‹å­ä¸­, å¤–å±‚çš„someoneä¼šè¢«èµ‹å€¼å¾ˆå¤šæ¬¡ï¼ˆå°±åƒåœ¨Reactä¸­ï¼Œå½“å‰çš„ç»„ä»¶çŠ¶æ€ä¼šæ”¹å˜ä¸€æ ·ï¼‰ã€‚ç„¶åï¼Œåœ¨sayHiå‡½æ•°ä¸­ï¼Œå±€éƒ¨å¸¸é‡nameä¼šå’ŒæŸæ¬¡è°ƒç”¨ä¸­çš„personå…³è”ã€‚å› ä¸ºè¿™ä¸ªå¸¸é‡æ˜¯å±€éƒ¨çš„ï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡è°ƒç”¨éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ç»“æœå°±æ˜¯ï¼Œå½“å®šæ—¶å™¨å›è°ƒè§¦å‘çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªalertéƒ½ä¼šå¼¹å‡ºå®ƒæ‹¥æœ‰çš„nameã€‚ è¿™å°±è§£é‡Šäº†æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†å‡½æ•°å¦‚ä½•æ•è·äº†ç‚¹å‡»æ—¶å€™çš„countå€¼ã€‚å¦‚æœæˆ‘ä»¬åº”ç”¨ç›¸åŒçš„æ›¿æ¢åŸç†ï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“â€œçœ‹åˆ°â€çš„æ˜¯å®ƒè‡ªå·±çš„countï¼š 1234567891011121314151617181920212223242526272829303132333435// During first renderfunction Counter() { const count = 0; // Returned by useState() // ... function handleAlertClick() { setTimeout(() =&gt; { alert('You clicked on: ' + count); }, 3000); } // ...}// After a click, our function is called againfunction Counter() { const count = 1; // Returned by useState() // ... function handleAlertClick() { setTimeout(() =&gt; { alert('You clicked on: ' + count); }, 3000); } // ...}// After another click, our function is called againfunction Counter() { const count = 2; // Returned by useState() // ... function handleAlertClick() { setTimeout(() =&gt; { alert('You clicked on: ' + count); }, 3000); } // ...} æ‰€ä»¥å®é™…ä¸Šï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰ä¸€ä¸ªâ€œæ–°ç‰ˆæœ¬â€çš„handleAlertClickã€‚æ¯ä¸€ä¸ªç‰ˆæœ¬çš„handleAlertClickâ€œè®°ä½â€ äº†å®ƒè‡ªå·±çš„ countï¼š 1234567891011121314151617181920212223242526272829303132333435363738// During first renderfunction Counter() { // ... function handleAlertClick() { setTimeout(() =&gt; { alert('You clicked on: ' + 0); }, 3000); } // ... &lt;button onClick={handleAlertClick} /&gt; // The one with 0 inside // ...}// After a click, our function is called againfunction Counter() { // ... function handleAlertClick() { setTimeout(() =&gt; { alert('You clicked on: ' + 1); }, 3000); } // ... &lt;button onClick={handleAlertClick} /&gt; // The one with 1 inside // ...}// After another click, our function is called againfunction Counter() { // ... function handleAlertClick() { setTimeout(() =&gt; { alert('You clicked on: ' + 2); }, 3000); } // ... &lt;button onClick={handleAlertClick} /&gt; // The one with 2 inside // ...} è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨è¿™ä¸ªdemoä¸­ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°â€œå±äºâ€æŸä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ï¼Œå½“ä½ ç‚¹å‡»çš„æ—¶å€™ï¼Œå®ƒä¼šä½¿ç”¨é‚£æ¬¡æ¸²æŸ“ä¸­countçš„çŠ¶æ€å€¼ã€‚ åœ¨ä»»æ„ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œpropså’Œstateæ˜¯å§‹ç»ˆä¿æŒä¸å˜çš„ã€‚å¦‚æœpropså’Œstateåœ¨ä¸åŒçš„æ¸²æŸ“ä¸­æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œé‚£ä¹ˆä½¿ç”¨åˆ°å®ƒä»¬çš„ä»»ä½•å€¼ä¹Ÿæ˜¯ç‹¬ç«‹çš„ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼‰ã€‚å®ƒä»¬éƒ½â€œå±äºâ€ä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ã€‚å³ä¾¿æ˜¯äº‹ä»¶å¤„ç†ä¸­çš„å¼‚æ­¥å‡½æ•°è°ƒç”¨â€œçœ‹åˆ°â€çš„ä¹Ÿæ˜¯è¿™æ¬¡æ¸²æŸ“ä¸­çš„countå€¼ã€‚ å¤‡æ³¨ï¼šä¸Šé¢æˆ‘å°†å…·ä½“çš„countå€¼ç›´æ¥å†…è”åˆ°äº†handleAlertClickå‡½æ•°ä¸­ã€‚è¿™ç§å¿ƒæ™ºä¸Šçš„æ›¿æ¢æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºcountå€¼åœ¨æŸæ¬¡ç‰¹å®šæ¸²æŸ“ä¸­ä¸å¯èƒ½è¢«æ”¹å˜ã€‚å®ƒè¢«å£°æ˜æˆäº†ä¸€ä¸ªå¸¸é‡å¹¶ä¸”æ˜¯ä¸€ä¸ªæ•°å­—ã€‚è¿™æ ·å»æ€è€ƒå…¶ä»–ç±»å‹çš„å€¼æ¯”å¦‚å¯¹è±¡ä¹ŸåŒæ ·æ˜¯å®‰å…¨çš„ï¼Œå½“ç„¶éœ€è¦åœ¨æˆ‘ä»¬éƒ½åŒæ„åº”è¯¥é¿å…ç›´æ¥ä¿®æ”¹stateè¿™ä¸ªå‰æä¸‹ã€‚é€šè¿‡è°ƒç”¨setSomething(newObj)çš„æ–¹å¼å»ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡è€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹å®ƒæ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºè¿™æ ·èƒ½ä¿è¯ä¹‹å‰æ¸²æŸ“ä¸­çš„stateä¸ä¼šè¢«æ±¡æŸ“ã€‚ æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„Effectsè¿™ç¯‡æ–‡ç« æ˜¯å…³äºeffectsçš„ï¼Œä½†ç›®å‰æˆ‘ä»¬å±…ç„¶è¿˜æ²¡æœ‰è®¨è®ºeffectsï¼ è¨€å½’æ­£ä¼ ï¼Œç”±ä¸Šé¢çš„åˆ†æå¾—å‡ºä¸€ä¸ªç»“æœï¼Œeffectså…¶å®å¹¶æ²¡æœ‰ä»€ä¹ˆä¸¤æ ·ã€‚ è®©æˆ‘ä»¬å›åˆ°å®˜ç½‘æ–‡æ¡£ä¸­çš„è¿™ä¸ªä¾‹å­ï¼š 12345678910111213141516function Counter() { const [count, setCount] = useState(0); useEffect(() =&gt; { document.title = `You clicked ${count} times`; }); return ( &lt;div&gt; &lt;p&gt;You clicked {count} times&lt;/p&gt; &lt;button onClick={() =&gt; setCount(count + 1)}&gt; Click me &lt;/button&gt; &lt;/div&gt; );} æŠ›ä¸€ä¸ªé—®é¢˜ç»™ä½ ï¼šeffectæ˜¯å¦‚ä½•è¯»å–åˆ°æœ€æ–°çš„count çŠ¶æ€å€¼çš„å‘¢ï¼Ÿ ä¹Ÿè®¸ï¼Œæ˜¯æŸç§â€œdata bindingâ€æˆ–â€œwatchingâ€æœºåˆ¶ä½¿å¾—countèƒ½å¤Ÿåœ¨effectå‡½æ•°å†…æ›´æ–°ï¼Ÿä¹Ÿæˆ–è®¸countæ˜¯ä¸€ä¸ªå¯å˜çš„å€¼ï¼ŒReactä¼šåœ¨æˆ‘ä»¬ç»„ä»¶å†…éƒ¨ä¿®æ”¹å®ƒä»¥ä½¿æˆ‘ä»¬çš„effectå‡½æ•°æ€»èƒ½æ‹¿åˆ°æœ€æ–°çš„å€¼ï¼Ÿ éƒ½ä¸æ˜¯ã€‚ æˆ‘ä»¬å·²ç»çŸ¥é“countæ˜¯æŸä¸ªç‰¹å®šæ¸²æŸ“ä¸­çš„å¸¸é‡ã€‚äº‹ä»¶å¤„ç†å‡½æ•°â€œçœ‹åˆ°â€çš„æ˜¯å±äºå®ƒé‚£æ¬¡ç‰¹å®šæ¸²æŸ“ä¸­çš„countçŠ¶æ€å€¼ã€‚å¯¹äºeffectsä¹ŸåŒæ ·å¦‚æ­¤ï¼š å¹¶ä¸æ˜¯countçš„å€¼åœ¨â€œä¸å˜â€çš„effectä¸­å‘ç”Ÿäº†æ”¹å˜ï¼Œè€Œæ˜¯effectå‡½æ•°æœ¬èº«åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“ä¸­éƒ½ä¸ç›¸åŒã€‚ æ¯ä¸€ä¸ªeffectç‰ˆæœ¬â€œçœ‹åˆ°â€çš„countå€¼éƒ½æ¥è‡ªäºå®ƒå±äºçš„é‚£æ¬¡æ¸²æŸ“ï¼š 1234567891011121314151617181920212223242526272829303132333435// During first renderfunction Counter() { // ... useEffect( // Effect function from first render () =&gt; { document.title = `You clicked ${0} times`; } ); // ...}// After a click, our function is called againfunction Counter() { // ... useEffect( // Effect function from second render () =&gt; { document.title = `You clicked ${1} times`; } ); // ...}// After another click, our function is called againfunction Counter() { // ... useEffect( // Effect function from third render () =&gt; { document.title = `You clicked ${2} times`; } ); // ..} Reactä¼šè®°ä½ä½ æä¾›çš„effectå‡½æ•°ï¼Œå¹¶ä¸”ä¼šåœ¨æ¯æ¬¡æ›´æ”¹ä½œç”¨äºDOMå¹¶è®©æµè§ˆå™¨ç»˜åˆ¶å±å¹•åå»è°ƒç”¨å®ƒã€‚ æ‰€ä»¥è™½ç„¶æˆ‘ä»¬è¯´çš„æ˜¯ä¸€ä¸ªeffectï¼ˆè¿™é‡ŒæŒ‡æ›´æ–°documentçš„titleï¼‰ï¼Œä½†å…¶å®æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯ä¸€ä¸ªä¸åŒçš„å‡½æ•° â€” å¹¶ä¸”æ¯ä¸ªeffectå‡½æ•°â€œçœ‹åˆ°â€çš„propså’Œstateéƒ½æ¥è‡ªäºå®ƒå±äºçš„é‚£æ¬¡ç‰¹å®šæ¸²æŸ“ã€‚ æ¦‚å¿µä¸Šï¼Œä½ å¯ä»¥æƒ³è±¡effectsæ˜¯æ¸²æŸ“ç»“æœçš„ä¸€éƒ¨åˆ†ã€‚ ä¸¥æ ¼åœ°è¯´ï¼Œå®ƒä»¬å¹¶ä¸æ˜¯ï¼ˆä¸ºäº†å…è®¸Hookçš„ç»„åˆå¹¶ä¸”ä¸å¼•å…¥ç¬¨æ‹™çš„è¯­æ³•æˆ–è€…è¿è¡Œæ—¶ï¼‰ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬æ„å»ºçš„å¿ƒæ™ºæ¨¡å‹ä¸Šï¼Œeffectå‡½æ•°å±äºæŸä¸ªç‰¹å®šçš„æ¸²æŸ“ï¼Œå°±åƒäº‹ä»¶å¤„ç†å‡½æ•°ä¸€æ ·ã€‚ ä¸ºäº†ç¡®ä¿æˆ‘ä»¬å·²ç»æœ‰äº†æ‰å®çš„ç†è§£ï¼Œæˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹ç¬¬ä¸€æ¬¡çš„æ¸²æŸ“è¿‡ç¨‹ï¼š React: ç»™æˆ‘çŠ¶æ€ä¸º0æ—¶å€™çš„UIã€‚ ä½ çš„ç»„ä»¶: ç»™ä½ éœ€è¦æ¸²æŸ“çš„å†…å®¹: &lt;p&gt;You clicked 0 times&lt;/p&gt;ã€‚ è®°å¾—åœ¨æ¸²æŸ“å®Œäº†ä¹‹åè°ƒç”¨è¿™ä¸ªeffect: () =&gt; { document.title = â€˜You clicked 0 timesâ€™ }ã€‚ React: æ²¡é—®é¢˜ã€‚å¼€å§‹æ›´æ–°UIï¼Œå–‚æµè§ˆå™¨ï¼Œæˆ‘è¦ç»™DOMæ·»åŠ ä¸€äº›ä¸œè¥¿ã€‚ æµè§ˆå™¨: é…·ï¼Œæˆ‘å·²ç»æŠŠå®ƒç»˜åˆ¶åˆ°å±å¹•ä¸Šäº†ã€‚ React: å¥½çš„ï¼Œ æˆ‘ç°åœ¨å¼€å§‹è¿è¡Œç»™æˆ‘çš„effect è¿è¡Œ () =&gt; { document.title = â€˜You clicked 0 timesâ€™ }ã€‚ ç°åœ¨æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æˆ‘ä»¬ç‚¹å‡»ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆï¼š ä½ çš„ç»„ä»¶: å–‚ React, æŠŠæˆ‘çš„çŠ¶æ€è®¾ç½®ä¸º1ã€‚ React: ç»™æˆ‘çŠ¶æ€ä¸º1æ—¶å€™çš„UIã€‚ ä½ çš„ç»„ä»¶: ç»™ä½ éœ€è¦æ¸²æŸ“çš„å†…å®¹: &lt;p&gt;You clicked 1 times&lt;/p&gt;ã€‚ è®°å¾—åœ¨æ¸²æŸ“å®Œäº†ä¹‹åè°ƒç”¨è¿™ä¸ªeffectï¼š () =&gt; { document.title = â€˜You clicked 1 timesâ€™ }ã€‚ React: æ²¡é—®é¢˜ã€‚å¼€å§‹æ›´æ–°UIï¼Œå–‚æµè§ˆå™¨ï¼Œæˆ‘ä¿®æ”¹äº†DOMã€‚ Browser: é…·ï¼Œæˆ‘å·²ç»å°†æ›´æ”¹ç»˜åˆ¶åˆ°å±å¹•ä¸Šäº†ã€‚ React: å¥½çš„ï¼Œ æˆ‘ç°åœ¨å¼€å§‹è¿è¡Œå±äºè¿™æ¬¡æ¸²æŸ“çš„effect è¿è¡Œ () =&gt; { document.title = â€˜You clicked 1 timesâ€™ }ã€‚ æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„â€¦æˆ‘ä»¬ç°åœ¨çŸ¥é“effectsä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åè¿è¡Œï¼Œå¹¶ä¸”æ¦‚å¿µä¸Šå®ƒæ˜¯ç»„ä»¶è¾“å‡ºçš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥â€œçœ‹åˆ°â€å±äºæŸæ¬¡ç‰¹å®šæ¸²æŸ“çš„propså’Œstateã€‚ æˆ‘ä»¬æ¥åšä¸€ä¸ªæ€æƒ³å®éªŒï¼Œæ€è€ƒä¸‹é¢çš„ä»£ç ï¼š 123456789101112131415161718function Counter() { const [count, setCount] = useState(0); useEffect(() =&gt; { setTimeout(() =&gt; { console.log(`You clicked ${count} times`); }, 3000); }); return ( &lt;div&gt; &lt;p&gt;You clicked {count} times&lt;/p&gt; &lt;button onClick={() =&gt; setCount(count + 1)}&gt; Click me &lt;/button&gt; &lt;/div&gt; );} å¦‚æœæˆ‘ç‚¹å‡»äº†å¾ˆå¤šæ¬¡å¹¶ä¸”åœ¨effecté‡Œè®¾ç½®äº†å»¶æ—¶ï¼Œæ‰“å°å‡ºæ¥çš„ç»“æœä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ ä½ å¯èƒ½ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¾ˆç»•çš„é¢˜å¹¶ä¸”ç»“æœæ˜¯åç›´è§‰çš„ã€‚å®Œå…¨é”™äº†ï¼æˆ‘ä»¬çœ‹åˆ°çš„å°±æ˜¯é¡ºåºçš„æ‰“å°è¾“å‡º â€” æ¯ä¸€ä¸ªéƒ½å±äºæŸæ¬¡ç‰¹å®šçš„æ¸²æŸ“ï¼Œå› æ­¤æœ‰å®ƒè¯¥æœ‰çš„countå€¼ã€‚ä½ å¯ä»¥è‡ªå·±è¯•ä¸€è¯•ï¼š ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œå®ƒå½“ç„¶åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚å¦åˆ™è¿˜ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿâ€ ä¸è¿‡ï¼Œclassä¸­çš„this.stateå¹¶ä¸æ˜¯è¿™æ ·è¿ä½œçš„ã€‚ä½ å¯èƒ½ä¼šæƒ³å½“ç„¶ä»¥ä¸ºä¸‹é¢çš„classå®ç°å’Œä¸Šé¢æ˜¯ç›¸ç­‰çš„ï¼š 12345componentDidUpdate() { setTimeout(() =&gt; { console.log(`You clicked ${this.state.count} times`); }, 3000);} ç„¶è€Œï¼Œthis.state.countæ€»æ˜¯æŒ‡å‘æœ€æ–°çš„countå€¼ï¼Œè€Œä¸æ˜¯å±äºæŸæ¬¡ç‰¹å®šæ¸²æŸ“çš„å€¼ã€‚æ‰€ä»¥ä½ ä¼šçœ‹åˆ°æ¯æ¬¡æ‰“å°è¾“å‡ºéƒ½æ˜¯5ï¼š æˆ‘è§‰å¾—Hooksè¿™ä¹ˆä¾èµ–Javascripté—­åŒ…æ˜¯æŒºè®½åˆºçš„ä¸€ä»¶äº‹ã€‚æœ‰æ—¶å€™ç»„ä»¶çš„classå®ç°æ–¹å¼ä¼šå—é—­åŒ…ç›¸å…³çš„è‹¦ï¼ˆthe canonical wrong-value-in-a-timeout confusionï¼‰ï¼Œä½†å…¶å®è¿™ä¸ªä¾‹å­ä¸­çœŸæ­£çš„æ··ä¹±æ¥æºæ˜¯å¯å˜æ•°æ®ï¼ˆReactä¿®æ”¹äº†classä¸­çš„this.stateä½¿å…¶æŒ‡å‘æœ€æ–°çŠ¶æ€ï¼‰ï¼Œå¹¶ä¸æ˜¯é—­åŒ…æœ¬èº«çš„é”™ã€‚ å½“å°é—­çš„å€¼å§‹ç»ˆä¸ä¼šå˜çš„æƒ…å†µä¸‹é—­åŒ…æ˜¯éå¸¸æ£’çš„ã€‚è¿™ä½¿å®ƒä»¬éå¸¸å®¹æ˜“æ€è€ƒå› ä¸ºä½ æœ¬è´¨ä¸Šåœ¨å¼•ç”¨å¸¸é‡ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€è®¨è®ºçš„ï¼Œpropså’Œstateåœ¨æŸä¸ªç‰¹å®šæ¸²æŸ“ä¸­æ˜¯ä¸ä¼šæ”¹å˜çš„ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é—­åŒ…ä¿®å¤ä¸Šé¢çš„classç‰ˆæœ¬â€¦ ç»“æŸè¯­ åŸæ–‡ä½œè€…ï¼šDan AbramovåŸæ–‡é“¾æ¥ï¼šhttps://overreacted.io/a-complete-guide-to-useeffect/ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://lry61.cn/blog/tags/å‰ç«¯/"}]},{"title":"React Hooksåˆæ¢","date":"2019-12-06T02:24:43.194Z","path":"/posts/5/","text":"React Hooksåˆæ¢ å‰è¨€Hook æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚ æ­£æ–‡èƒŒæ™¯ä»‹ç»å¦‚æœä½ ä½¿ç”¨è¿‡Reactä¸€æ®µæ—¶é—´ï¼Œä½ ä¼šå‘ç°åœ¨Reactç»„ä»¶ä¹‹é—´å¤ç”¨é€»è¾‘çŠ¶æ€å¾ˆéš¾ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡render props å’ŒHOCé«˜é˜¶ç»„ä»¶è¿™ç±»æ–¹æ¡ˆè§£å†³ï¼Œä½†æ˜¯å¾ˆå®¹æ˜“è®©ä»£ç å˜å¾—éš¾ä»¥ç†è§£ã€‚ Hookç»™äºˆäº†å‡½æ•°å¼ç»„ä»¶ç±»ä¼¼äºç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µï¼Œæ‰©å¤§äº†å‡½æ•°å¼ç»„ä»¶çš„åº”ç”¨èŒƒå›´ã€‚Hooks çš„å‡ºç°ä½¿å¾—å‡½æ•°ç»„ä»¶ä¹Ÿæœ‰äº†è‡ªå·±çš„çŠ¶æ€ä¸ä¸šåŠ¡é€»è¾‘ï¼Œç®€å•é€»è¾‘åœ¨è‡ªå·±å†…éƒ¨å¤„ç†å³å¯ï¼Œä¸å†éœ€è¦é€šè¿‡ Props çš„ä¼ é€’ï¼Œä½¿ç®€å•é€»è¾‘ç»„ä»¶æŠ½ç¦»æ›´åŠ æ–¹ä¾¿ï¼Œä¹Ÿä½¿ä½¿ç”¨è€…æ— éœ€å…³å¿ƒç»„ä»¶å†…éƒ¨çš„é€»è¾‘ï¼Œåªå…³å¿ƒ Hooks ç»„ä»¶è¿”å›çš„ç»“æœå³å¯ Hookåˆæ¢æˆ‘ä»¬é€šè¿‡å®˜ç½‘è®¡æ•°å™¨çš„ä¾‹å­ï¼Œæ¥çœ‹çœ‹ class ç»„ä»¶ä¸ hooks çš„åŒºåˆ«ã€‚ é‡‡ç”¨classç»„ä»¶å†™æ³•: é‡‡ç”¨hooksåä»£ç : é€šè¿‡ä¸Šè¯‰ä¸¤ç§æ–¹æ³•æ¯”è¾ƒå¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨Hooksï¼Œç›¸å…³çš„çŠ¶æ€é€»è¾‘å¯ä»¥æ”¾åœ¨å•ä¸ªæ–¹æ³•ä¸­ç®¡ç†ï¼Œè€Œä¸”ä¸éœ€è¦å†™æˆReact.Componentç»„ä»¶å½¢å¼ï¼Œè€Œæ˜¯ä½œä¸ºä¸€ä¸ªé€»è¾‘çŠ¶æ€ç®¡ç†çš„æ–¹æ³•ï¼Œæ–¹ä¾¿åæœŸå¤ç”¨ã€‚ åŸºç¡€Hooksâ€» useStateuseStateæ˜¯ä¸€ä¸ªåŸºç¡€çš„çŠ¶æ€ç®¡ç†Hooksï¼Œå®ƒå°†åˆ†æ•£çš„åˆå§‹çŠ¶æ€ã€è·å–çŠ¶æ€å’Œä¿®æ”¹çŠ¶æ€ç»Ÿä¸€åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œè¿™æ ·æœ‰åˆ©äºå°†å•ä¸ªçŠ¶æ€çš„ç›¸å…³å†…å®¹ç»Ÿä¸€ç»´æŠ¤ï¼Œå¤ç”¨æ›´åŠ ç®€ä¾¿ã€‚å…·ä½“ä½¿ç”¨å¦‚ä¸‹: 1const [count, setCount] = useState(initialState); initialStateæ˜¯åˆå§‹åŒ–çŠ¶æ€ï¼Œä¸Šè¿°ä»£ç æœ‰ä¸¤ä¸ªè¿”å›å€¼countå’ŒsetCount()ã€‚ä¸€ä¸ªç”¨æ¥è·å–æœ€æ–°çš„çŠ¶æ€å€¼ï¼Œä¸€ä¸ªç”¨æ¥ä¿®æ”¹çŠ¶æ€ï¼Œåé¢æ‰€æœ‰ä¸è¯¥çŠ¶æ€ç›¸å…³çš„ä»£ç éƒ½åœ¨åŒä¸€ä¸ªæ–¹æ³•ä¸­ã€‚å¦‚æœä½ éœ€è¦å¤šä¸ªçŠ¶æ€ï¼Œä½ å¯ä»¥ä½¿ç”¨å¤šä¸ªuseStateç®¡ç†ç›¸å¯¹åº”çš„çŠ¶æ€ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦è·å–ä¸Šä¸€è½®è¯¥stateçš„å€¼ï¼Œåªéœ€è¦åœ¨setCountä½¿ç”¨æ—¶ï¼Œä¼ å…¥ä¸Šä¸€è½®çš„stateå€¼ï¼Œå³setCount(count =&gt; count + 1) â€» useEffectuseEffectå…¶å®å°±æ˜¯ä¸€ä¸ªEffect Hookï¼Œå®ƒç»™å‡½æ•°ç»„ä»¶å¢åŠ äº†æ“ä½œå‰¯ä½œç”¨ï¼ˆåœ¨Reactç»„ä»¶ä¸­æœ‰è¿‡æ•°æ®è·å–ã€è®¢é˜…æˆ–æ‰‹åŠ¨ä¿®æ”¹DOMï¼‰çš„èƒ½åŠ›ã€‚å®ƒä¸classç»„ä»¶ä¸­çš„componentDidMountã€componentDidUpdateã€componentWillUnMountå…·æœ‰ç›¸åŒçš„ç”¨é€”ï¼Œåªä¸è¿‡è¢«åˆå¹¶æˆäº†ä¸€ä¸ªAPIã€‚å…·ä½“ä½¿ç”¨å¦‚ä¸‹: 123456useEffect(() =&gt; { //è¿™é‡Œæ“ä½œå‰¯ä½œç”¨ return () =&gt; { //æ¸…é™¤effectï¼Œç»„ä»¶å¸è½½æ—¶æ‰§è¡Œ }}, Drip) ä¸Šè¿°ä»£ç ä¸­returnè¿”å›çš„å‡½æ•°ï¼Œå…¶å®æ˜¯effectå¯é€‰çš„æ¸…é™¤æœºåˆ¶ã€‚æ¯ä¸ªeffectéƒ½å¯ä»¥è¿”å›ä¸€ä¸ªæ¸…é™¤å‡½æ•°ï¼ŒReactä¼šåœ¨ç»„ä»¶å¸è½½æ—¶æ‰§è¡Œå®ƒä»¬ã€‚Dripæ˜¯effectçš„ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¯é€‰ï¼‰ï¼Œå®ƒå¯ä»¥ç”¨æ¥æ§åˆ¶effectæ˜¯å¦æ¯æ¬¡æ›´æ–°æ¸²æŸ“éƒ½éœ€è¦æ‰§è¡Œã€‚effectåœ¨æ¯æ¬¡æ¸²æŸ“çš„æ—¶å€™éƒ½ä¼šæ‰§è¡Œã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆReactä¼šåœ¨æ‰§è¡Œå½“å‰effectä¹‹å‰å¯¹ä¸Šä¸€ä¸ªeffectè¿›è¡Œæ¸…é™¤ã€‚åŒstateä¸€æ ·ï¼Œeffectä¹Ÿå¯ä»¥ä½¿ç”¨å¤šæ¬¡ï¼Œä½†éœ€è¦æ³¨æ„Reactä¼šæŒ‰ç…§effectå£°æ˜çš„é¡ºåºä¾æ¬¡è°ƒç”¨ç»„ä»¶ä¸­çš„effect â€» useContextåœ¨Reactä¸­ï¼Œä¸ºäº†é¿å…å‚æ•°æ·±å±‚æ¬¡çš„ä¼ é€’ï¼Œä¸€èˆ¬ä¼šåœ¨çˆ¶ç»„ä»¶ä¸Šåˆ›å»ºä¸€ä¸ªContextï¼Œåœ¨å­å­™ç»„ä»¶éƒ½å¯ä»¥è·å–åˆ°è¿™ä¸ªContextï¼Œè¿™æ ·å°±é¿å…äº†å‚æ•°éœ€è¦ä¸€å±‚å±‚ä¼ é€’ä¸‹å»ã€‚å…·ä½“ä½¿ç”¨å¦‚ä¸‹: 1const context = useContext(Context) useContextæ¥æ”¶ä¸€ä¸ªContextå¯¹è±¡(React.createContextçš„è¿”å›å€¼)ï¼Œè¿”å›è¯¥contextçš„å½“å‰å€¼ã€‚contextçš„å½“å‰å€¼ç”±ä¸Šå±‚ç»„ä»¶ä¸­è·ç¦»å½“å‰ç»„ä»¶æœ€è¿‘çš„&lt;Context.Provider&gt;çš„value propå†³å®šã€‚ é¢å¤–çš„Hooksâ€» useReduceruseReduceræ˜¯useStateçš„æ›¿ä»£æ–¹æ¡ˆï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå½¢å¦‚(state, action) =&gt; newStateçš„reducer(ä¸Reduxç±»ä¼¼)ï¼Œå¹¶è¿”å›å½“å‰çš„stateå€¼ä»¥åŠé…å¥—çš„dispatchæ–¹æ³•ã€‚å…·ä½“ä½¿ç”¨å¦‚ä¸‹ï¼š 1const [state, dispatch] = useReducer(reducer, initialState) åœ¨æŸäº›åº”ç”¨åœºæ™¯ä¸‹ï¼ŒuseReduceræ¯”useStateæ›´é€‚ç”¨ã€‚ä¾‹å¦‚stateé€»è¾‘å¤æ‚å¹¶ä¸”åŒ…å«å¤šä¸ªå­å€¼ï¼Œæˆ–è€…ä¸‹ä¸€ä¸ªstateä¾èµ–ä¹‹å‰çš„stateã€‚Reactä¼šç¡®ä¿dispatchå‡½æ•°çš„æ ‡è¯†æ˜¯ç¨³å®šçš„ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶æ”¹å˜ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¯ä»¥å®‰å…¨åœ°ä»useEffectæˆ–useCallbackçš„ä¾èµ–åˆ—è¡¨ä¸­çœç•¥dispatch â€» useMemoåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨æ¸²æŸ“æ—¶è®¡ç®—ä¸€ä¸ªå€¼éœ€è¦è¿›è¡Œé«˜å¼€é”€çš„è®¡ç®—ï¼Œè€Œè¿™ä¸ªå€¼ä¼šå—ä¸€äº›å‚æ•°çš„å½±å“ã€‚å½“å‚æ•°æ²¡æœ‰å˜åŒ–æ—¶ï¼Œè¿™ä¸ªå€¼ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼›å½“å‚æ•°å˜åŒ–æ—¶ï¼Œéœ€è¦é‡æ–°è®¡ç®—ã€‚ä¸ºäº†æå‡æ•ˆç‡ï¼Œå°±å¯ä»¥ä½¿ç”¨useMemoè¿™ä¸ªHooksã€‚useMemoæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯è®¡ç®—å€¼çš„æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯ä¾èµ–é¡¹æ•°ç»„(é‡Œé¢æ˜¯å½±å“å€¼çš„å‚æ•°)ã€‚å…·ä½“ä½¿ç”¨å¦‚ä¸‹: 1const memoizedValue = useMemo(() =&gt; computeExpensiveValue(a, b), [a, b]) ä¸Šè¿°ä»£ç ä¸­ï¼Œè®¡ç®—å¾—åˆ°çš„memoizedValueä¼šå—ä¾èµ–é¡¹æ•°ç»„ä¸­çš„å‚æ•°a, bå½±å“ã€‚å½“å‚æ•°ä¸å˜æ—¶ï¼Œä¸ä¼šé‡æ–°è®¡ç®—memoizedValueçš„å€¼ï¼›å½“ä»»ä¸€å‚æ•°å˜åŒ–æ—¶ï¼Œéƒ½ä¼šè§¦å‘é‡æ–°æ‰§è¡ŒcomputeExpensiveValueæ–¹æ³•è®¡ç®—æ–°çš„memoizedValueã€‚å¦‚æœæ²¡æœ‰æä¾›ä¾èµ–é¡¹æ•°ç»„ï¼ŒuseMemoåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šæ‰§è¡Œè®¡ç®—æ–°çš„å€¼ â€» useCallbackuseCallbackæ–¹æ³•ä¸useMemoæ–¹æ³•ç±»ä¼¼ï¼Œä¹Ÿæ˜¯é¿å…é‡å¤è®¡ç®—ï¼ŒåŒºåˆ«åœ¨äºuseCallbackè¿”å›çš„æ˜¯ä¸€ä¸ªmemoizedå›è°ƒå‡½æ•°ã€‚è¯¥å›è°ƒå‡½æ•°åªæœ‰åœ¨æŸä¸ªä¾èµ–é¡¹æ”¹å˜æ—¶æ‰ä¼šæ›´æ–°ã€‚å…·ä½“ä½¿ç”¨å¦‚ä¸‹: 1const callbackFn = useCallback(() =&gt; doSomething(a, b), [a, b]) ç›´æ¥è°ƒç”¨callbackFn()æ–¹æ³•ï¼Œæœ€ç»ˆæ‰§è¡Œçš„æ˜¯doSomething()çš„ä»£ç  â€» useRefåœ¨Hooksä¹‹å‰ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨refå»æ‰¾ç‰¹å®šçš„DOMå…ƒç´ ï¼Œå¦‚æœä½ å°†refä»¥&lt;div ref={myRef}&gt;&lt;/div&gt;è¿™ç§æ–¹å¼ä¼ å…¥ç»„ä»¶ï¼Œåˆ™æ— è®ºè¯¥èŠ‚ç‚¹å¦‚ä½•æ”¹å˜ï¼ŒReactéƒ½ä¼šå°†refå¯¹è±¡çš„.currentå±æ€§è®¾ç½®ä¸ºå¯¹åº”çš„DOMèŠ‚ç‚¹ã€‚useRefè¿”å›ä¸€ä¸ªå¯å˜çš„refå¯¹è±¡ï¼Œå…¶.currentå±æ€§åˆå§‹åŒ–ä¸ºä¼ å…¥çš„å‚æ•°(initialValue),è¿”å›çš„refå¯¹è±¡åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä¿æŒä¸å˜ã€‚å…·ä½“ä½¿ç”¨å¦‚ä¸‹: 1const ref = useRef(initialValue) useRefä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶è¿”å›åŒä¸€ä¸ªrefå¯¹è±¡ï¼Œå˜æ›´.currentå±æ€§ä¸ä¼šå¼•å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚å¦‚æœæƒ³è¦åœ¨Reactç»‘å®šæˆ–è§£ç»‘DOMèŠ‚ç‚¹çš„refæ—¶è¿è¡ŒæŸäº›ä»£ç ï¼Œåˆ™éœ€è¦ä½¿ç”¨å›è°ƒrefæ¥å®ç°ã€‚ ç»“æŸè¯­ å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://lry61.cn/blog/tags/å‰ç«¯/"}]},{"title":"Jsæ•°ç»„å»é‡","date":"2019-10-15T02:08:22.198Z","path":"/posts/4/","text":"Jsæ•°ç»„å»é‡çš„å‡ ç§å®ç°æ–¹å¼ å‰è¨€Jsæ•°ç»„å»é‡é—®é¢˜ï¼Œæ˜¯é¢è¯•å½“ä¸­çš„ç»å…¸é—®é¢˜ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒåŸºç¡€çš„é—®é¢˜äº†ï¼Œä¸‹é¢æ€»ç»“å‡ ç§æ¯”è¾ƒå¸¸è§çš„æ“ä½œ æ­£æ–‡åŒå±‚å¾ªç¯ æ€è·¯ï¼šåˆ©ç”¨åŒå±‚å¾ªç¯åµŒå¥—ï¼Œç„¶åç”¨spliceå»é‡ã€‚å½“å¾ªç¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå€¼å’Œç¬¬äºŒä¸ªå€¼ç›¸åŒçš„æ—¶å€™ï¼Œç”¨spliceåˆ é™¤ç¬¬äºŒä¸ªå€¼ 12345678910111213var arr = [1,1,\"true\",true,\"false\",false,NaN,null,NaN,\"NaN\",null,undefined,15,undefined,15,{},0,\"a\",{},0,\"a\"];function unique(arr) { for(var i = 0; i &lt; arr.length; i++) { for(var j = i + 1; j &lt; arr.length; j++) { if(arr[i] === arr[j]) { arr.splice(j, 1); j--; } } } return arr;}console.log(unique(arr)); //[1, \"true\", true, \"false\", false, NaN, null, NaN, \"NaN\", undefined, 15, {â€¦}, 0, \"a\", {â€¦}] ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼ŒåŒå±‚å¾ªç¯ä¸èƒ½å»é‡ NaN å’Œ {} indexOfå¾ªç¯ æ€è·¯ï¼šåˆ©ç”¨indexOfå¾ªç¯æ•°ç»„ï¼Œåˆ¤æ–­ç»“æœæ•°ç»„resä¸­æ˜¯å¦å­˜åœ¨å½“å‰å…ƒç´ ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è·³è¿‡ï¼Œå¦åˆ™æŠŠå½“å‰å…ƒç´ æ·»åŠ åˆ°ç»“æœæ•°ç»„resä¸­ 1234567891011var arr = [1,1,\"true\",true,\"false\",false,NaN,null,NaN,\"NaN\",null,undefined,15,undefined,15,{},0,\"a\",{},0,\"a\"];function unique(arr) { var res = []; for(var i = 0; i &lt; arr.length; i++) { if(res.indexOf(arr[i]) === -1) { res.push(arr[i]); } } return res;}console.log(unique(arr)); //[1, \"true\", true, \"false\", false, NaN, null, NaN, \"NaN\", undefined, 15, {â€¦}, 0, \"a\", {â€¦}] ä»æ‰“å°ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨indexOfå¾ªç¯æ•°ç»„ï¼Œä¹Ÿä¸èƒ½å»é‡ NaN å’Œ {} æ’åºåå»é‡ æ€è·¯ï¼šå°†æ•°ç»„ä½¿ç”¨sortæ’åºåï¼Œç›¸åŒçš„å€¼ä¾¿ä¼šæ’åœ¨ä¸€èµ·ï¼Œè¿™æ ·æˆ‘ä»¬åªéœ€è¦åˆ¤æ–­å½“å‰çš„å…ƒç´ ä¸ä¸Šä¸€ä¸ªå…ƒç´ æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒï¼Œå°±è¯´æ˜é‡å¤ï¼Œå¦åˆ™pushè¿›res 123456789101112var arr = [1,1,\"true\",true,\"false\",false,NaN,null,NaN,\"NaN\",null,undefined,15,undefined,15,{},0,\"a\",{},0,\"a\"];function unique(arr) { arr = arr.sort(); var res = [arr[0]]; for(var i = 1; i &lt; arr.length; i++) { if(arr[i] !== arr[i-1]) { res.push(arr[i]); } } return res;}console.log(unique(arr)); //[0, 1, 15, NaN, NaN, \"NaN\", {â€¦}, {â€¦}, \"a\", \"false\", false, null, \"true\", true, undefined] ä»æ‰“å°ç»“æœæ¥çœ‹ï¼Œä½¿ç”¨sortæ’åºåå»é‡ï¼Œä¹Ÿä¸èƒ½å»é‡ NaN å’Œ {} åˆ©ç”¨includes æ€è·¯ï¼šincludesä¸»è¦ç”¨æ¥æµ‹è¯•æ•°ç»„ä¸­æ˜¯å¦å«æœ‰æŸä¸ªå€¼ 1234567891011var arr = [1,1,\"true\",true,\"false\",false,NaN,null,NaN,\"NaN\",null,undefined,15,undefined,15,{},0,\"a\",{},0,\"a\"];function unique(arr) { var res = []; for(var i = 0; i &lt; arr.length; i++) { if(!res.includes(arr[i])) { res.push(arr[i]); } } return res;}console.log(unique(arr)); //[1, \"true\", true, \"false\", false, NaN, null, \"NaN\", undefined, 15, {â€¦}, 0, \"a\", {â€¦}] ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåˆ©ç”¨includeså»é‡ï¼Œä¸èƒ½å»é‡ {} åˆ©ç”¨filter æ€è·¯ï¼šfåˆ¤æ–­æ•°ç»„ä¸­ï¼Œå½“å‰å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªç´¢å¼•æ˜¯å¦æ˜¯filterä¸­å½“å‰ç´¢å¼•å€¼ 1234567var arr = [1,1,\"true\",true,\"false\",false,NaN,null,NaN,\"NaN\",null,undefined,15,undefined,15,{},0,\"a\",{},0,\"a\"];function unique(arr) { return arr.filter(function(item, index, arr) { return arr.indexOf(item) === index; })}console.log(unique(arr)); //[1, \"true\", true, \"false\", false, null, \"NaN\", undefined, 15, {â€¦}, 0, \"a\", {â€¦}] ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåˆ©ç”¨filterå»é‡ï¼ŒæŠŠ NaN å»æ‰äº†ï¼Œå¹¶ä¸”ä¸èƒ½å»é‡ {} åˆ©ç”¨reduce+includes1234567var arr = [1,1,\"true\",true,\"false\",false,NaN,null,NaN,\"NaN\",null,undefined,15,undefined,15,{},0,\"a\",{},0,\"a\"];function unique(arr) { return arr.reduce((acc, cur) =&gt; acc.includes(cur) ? acc : [...acc, cur], [] )}console.log(unique(arr)); //[1, \"true\", true, \"false\", false, NaN, null, \"NaN\", undefined, 15, {â€¦}, 0, \"a\", {â€¦}] ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåˆ©ç”¨reduce+includeså»é‡ï¼Œä¸èƒ½å»é‡ {} åˆ©ç”¨Set æ€è·¯ï¼šSetå¯¹è±¡æ˜¯å€¼çš„é›†åˆï¼Œä½ å¯ä»¥æŒ‰ç…§æ’å…¥çš„é¡ºåºè¿­ä»£å®ƒçš„å…ƒç´ ã€‚ Setä¸­çš„å…ƒç´ åªä¼šå‡ºç°ä¸€æ¬¡ï¼Œå³ Set ä¸­çš„å…ƒç´ æ˜¯å”¯ä¸€çš„ 12345var arr = [1,1,\"true\",true,\"false\",false,NaN,null,NaN,\"NaN\",null,undefined,15,undefined,15,{},0,\"a\",{},0,\"a\"];function unique(arr) { return Array.from(new Set(arr));}console.log(unique(arr)); // [1, \"true\", true, \"false\", false, NaN, null, \"NaN\", undefined, 15, {â€¦}, 0, \"a\", {â€¦}] ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåˆ©ç”¨ES6æ–°è¯­æ³•Setå»é‡ï¼Œä¸èƒ½å»é‡ {}ã€‚ä¸Šé¢ä»£ç ä¸­ï¼ŒArray.from(new Set(arr))å¯ä»¥ç®€åŒ–ä¸º[... new Set(arr)] åˆ©ç”¨hasOwnPropertyhasOwnPropertyæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºå¯¹è±¡è‡ªèº«å±æ€§ä¸­æ˜¯å¦å…·æœ‰æŒ‡å®šçš„å±æ€§ï¼ˆæ˜¯å¦æœ‰æŒ‡å®šçš„é”®ï¼‰ï¼Œæ­¤æ–¹æ³•æ— æ³•æ£€æŸ¥è¯¥å¯¹è±¡çš„åŸå‹é“¾ä¸­æ˜¯å¦å…·æœ‰è¯¥å±æ€§ï¼Œè¯¥å±æ€§å¿…é¡»æ˜¯å¯¹è±¡æœ¬èº«çš„ä¸€ä¸ªæˆå‘˜ã€‚ æ€è·¯ï¼šåˆ©ç”¨ä¸€ä¸ªç©ºå¯¹è±¡objï¼ŒæŠŠæ•°ç»„çš„å€¼å­˜æˆobjå¯¹è±¡çš„keyå€¼ï¼Œå¦‚obj[arr[item1]] = trueï¼Œåˆ¤æ–­å¦ä¸€ä¸ªå€¼obj[arr[item2]]æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ˜¯ç›¸åŒçš„å€¼ 12345678var arr = [1,\"1\",2,2,1];function unique(arr) { var obj = {}; return arr.filter(function(item, index, arr) { return obj.hasOwnProperty(item) ? false : (obj[item] = true) })}console.log(unique(arr)); //[1,2] ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å­˜åœ¨é—®é¢˜çš„ã€‚â€1â€å’Œ1æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯Object[1]å’ŒObject[â€œ1â€]å´æ˜¯åŒä¸€ä¸ªå¼•ç”¨ï¼ˆå¯¹è±¡keyå€¼åªèƒ½æ˜¯å­—ç¬¦ä¸²ï¼‰è§£å†³åŠæ³•ï¼šä½¿ç”¨typeof item + itemæ‹¼æˆå­—ç¬¦ä¸²ä½œä¸ºkeyå€¼ 12345678var arr = [1,\"1\",2,2,1,{value: 1},{value: 1},{value: 2}];function unique(arr) { var obj = {}; return arr.filter(function(item, index, arr) { return obj.hasOwnProperty(typeof item + item) ? false : (obj[typeof item + item] = true) })}console.log(unique(arr)); //[1, \"1\", 2, {value: 1}] ä»æ‰“å°ç»“æœä»èƒ½çœ‹å‡ºï¼Œå¦‚æœæ•°ç»„ä¸­å­˜åœ¨å¯¹è±¡æ—¶ï¼Œå¦‚{value: 1}ï¼Œtypeof item + itemçš„ç»“æœéƒ½æ˜¯object[object Object]è§£å†³æ–¹æ³•ï¼šä½¿ç”¨JSON.stringify()å°†å¯¹è±¡åºåˆ—åŒ–æ¥é¿å…ç›¸åŒçš„é”®å€¼ 12345678var arr = [1,\"1\",2,2,1,{value: 1},{value: 1},{value: 2}];function unique(arr) { var obj = {}; return arr.filter(function(item, index, arr) { return obj.hasOwnProperty(typeof item + JSON.stringify(item)) ? false : (obj[typeof item + JSON.stringify(item)] = true) })}console.log(unique(arr)); //[1, \"1\", 2, {value: 1}, {value: 2}] åˆ©ç”¨hasOwnPropertyå»é‡ï¼Œå¯ä»¥å»é‡æ‰€æœ‰æƒ…å†µ åˆ©ç”¨Map æ€è·¯ï¼šåˆ›å»ºä¸€ä¸ªç©ºçš„Mapæ•°æ®ç»“æ„ï¼Œéå†éœ€è¦å»é‡çš„æ•°ç»„ï¼ŒæŠŠæ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ ä½œä¸ºkeyå­˜åˆ°Mapä¸­ã€‚ç”±äºMapä¸­ä¸ä¼šå‡ºç°ç›¸åŒçš„keyå€¼ï¼Œæ‰€ä»¥æœ€ç»ˆå¾—åˆ°çš„å°±æ˜¯å»é‡åçš„ç»“æœ 123456789101112131415var arr = [1,1,\"true\",true,\"false\",false,NaN,null,NaN,\"NaN\",null,undefined,15,undefined,15,{},0,\"a\",{},0,\"a\"];function unique(arr) { let map = new Map(); let array = []; for(let i = 0; i &lt; arr.length; i++) { if(map.has(arr[i])) { //å¦‚æœæœ‰è¯¥keyå€¼ map.set(arr[i], true); } else { map.set(arr[i], false); array.push(arr[i]); } } return array;}console.log(unique(arr)); //[1, \"true\", true, \"false\", false, NaN, null, \"NaN\", undefined, 15, {â€¦}, 0, \"a\", {â€¦}] ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåˆ©ç”¨mapæ•°æ®ç»“æ„ ä¸èƒ½å»é‡ {} åˆ©ç”¨é€’å½’1234567891011121314151617var arr = [1,1,\"true\",true,\"false\",false,NaN,null,NaN,\"NaN\",null,undefined,15,undefined,15,{},0,\"a\",{},0,\"a\"];function unique(arr) { arr.sort(function(a, b) { return a- b; }) function loop(index) { if(index &gt;= 1) { if(arr[index] === arr[index - 1]) { arr.splice(index, 1); } loop(index - 1); //é€’å½’loop } } loop(arr.length - 1); return arr;}console.log(unique(arr)); //[1, \"true\", true, \"false\", false, NaN, null, NaN, \"NaN\", null, 15, {â€¦}, 0, \"a\", {â€¦}, 0, \"a\", undefined] ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåˆ©ç”¨é€’å½’å»é‡æ•°ç»„ï¼Œä¸èƒ½å»é‡ NaN null 0 â€œaâ€ {} ç»“æŸè¯­ å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£~ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://lry61.cn/blog/tags/å‰ç«¯/"}]},{"title":"Jsæ•°ç»„æ‰å¹³åŒ–","date":"2019-10-14T03:12:25.688Z","path":"/posts/3/","text":"Jsæ•°ç»„æ‰å¹³åŒ–çš„å‡ ç§å®ç°æ–¹å¼ å‰è¨€æ•°ç»„æ‰å¹³åŒ–ï¼Œå°±æ˜¯å°†ä¸€ä¸ªå­˜åœ¨å¤šå±‚åµŒå¥—çš„æ•°ç»„arrayï¼Œè½¬åŒ–ä¸ºåªæœ‰ä¸€å±‚çš„æ•°ç»„ã€‚å‡è®¾å­˜åœ¨ä¸€ä¸ªå‡½æ•°flattenå¯ä»¥å°†æ•°ç»„æ‰å¹³åŒ–ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾—åˆ°å¦‚ä¸‹æ•ˆæœï¼š 12var array = [1, [2], [[3]]];console.log(flatten(array)); //[1,2,3] æ­£æ–‡é€’å½’è°ƒç”¨ æ€è·¯ï¼šå¾ªç¯éå†è¯¥æ•°ç»„ï¼Œåˆ¤æ–­å¾ªç¯çš„å…ƒç´ æ˜¯å¦ä»æ˜¯æ•°ç»„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™é€’å½’è°ƒç”¨è¯¥æ–¹æ³• 123456789101112var array = [[1,2,3],4,5,6,[[7]],[]];function flatten(arr, result = []) { for(let item of arr) { if(Array.isArray(item)) { flatten(item, result); } else { result.push(item); } } return result;}console.log(flatten(array)); //[1,2,3,4,5,6,7] reduceè°ƒç”¨ æ€è·¯ï¼šåˆ©ç”¨reduceæ­é…concatã€‚reduceéå†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå¦‚æœè¯¥å…ƒç´ ä»ç„¶æ˜¯æ•°ç»„ï¼Œåˆ™é‡æ–°è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¦åˆ™å°†è¯¥å…ƒç´ concatåˆ°æ•°ç»„ä¸­ 1234567var array = [[1,2,3],4,5,6,[[7]],[]];function flatten(arr) { return arr.reduce(function(acc, cur) { return acc.concat(Array.isArray(cur) ? flatten(cur) : cur); }, [])}console.log(flatten(array)); ES6æ‰©å±•è¿ç®—ç¬¦ES6ä¸­çš„æ‰©å±•è¿ç®—ç¬¦ç”¨æ¥å–å‡ºå‚æ•°å¯¹è±¡ä¸­çš„æ‰€æœ‰å¯éå†å±æ€§ï¼Œæ‹·è´åˆ°å½“å‰å¯¹è±¡ä¸­ 12var arr = [1,2,[3,[4]]];console.log([].concat(...arr)); //[1,2,3,[4]] [].concat(...arr)åªèƒ½æ‹‰å¹³ä¸€å±‚æ•°ç»„ï¼Œä½†æ˜¯æˆ‘ä»¬å¾ˆå®¹æ˜“æ®æ­¤æƒ³åˆ°ï¼Œåˆ©ç”¨whileå¾ªç¯åˆ¤æ–­æ•°ç»„ä¸­æŸä¸ªå…ƒç´ æ˜¯å¦ä»ä¸ºæ•°ç»„ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªå…ƒç´ ä¸ºæ•°ç»„ï¼Œåˆ™ç»§ç»­æ‹‰å¹³ 12345678var array = [[1,2,3],4,5,6,[[7]],[]];function flatten(arr) { while(arr.some(item =&gt; Array.isArray(item))) { arr = [].concat(...arr); } return arr;}console.log(flatten(array)); //[1,2,3,4,5,6,7] flatè°ƒç”¨arr.flat(index)å¯ä»¥æ‹‰å¹³æ•°ç»„ï¼Œå…¶ä¸­indexè¡¨ç¤ºæ‹‰å¹³å¤šå°‘å±‚æ•°ç»„ï¼Œå¦‚æœè¦æ‹‰å¹³æ— é™å±‚æ•°ç»„ï¼Œåˆ™å¯ä»¥è¡¨ç¤ºä¸ºarr.flat(Infinity) 12var arr = [1,[2,[3,4,[]]]];console.log(arr.flat(Infinity)); //[1,2,3,4] toStringè°ƒç”¨å¦‚æœæ•°ç»„ä¸­çš„å…ƒç´ éƒ½æ˜¯æ•°å­—ï¼Œæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘toStringæ–¹æ³• 1[1,[2,[3,4]]].toString(); //\"1,2,3,4\" æ€è·¯ï¼šè°ƒç”¨toStringæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªç”¨é€—å·åˆ†éš”çš„æ‰å¹³å­—ç¬¦ä¸²ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨splitåˆ†éš”é€—å·ï¼Œå¾—åˆ°ä¸€ä¸ªstringç±»å‹çš„æ•°ç»„ï¼Œå†éå†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå°†å…¶è½¬åŒ–æˆnumberç±»å‹ 1234567var arr = [1,[2,[3,4]]];function flatten(arr) { return arr.toString().split(\",\").map(function(item) { return +item; })}console.log(flatten(arr)); //[1,2,3,4] ç„¶è€Œï¼Œä¸Šé¢çš„æ–¹æ³•å­˜åœ¨å¾ˆå¤§çš„å±€é™æ€§ï¼š å¦‚æœarrä¸­å­˜åœ¨ç©ºæ•°ç»„ï¼Œåˆ™ç©ºæ•°ç»„å°†ä¼šè¢«è½¬æ¢ä¸ºç©ºå­—ç¬¦ä¸² å¦‚æœæ•°ç»„ä¸­å­˜åœ¨éæ•°å­—ï¼Œæ¯”å¦‚[1,â€1â€]ï¼Œåˆ™ä¼šäº§ç”Ÿé”™è¯¯çš„ç»“æœ ç»“æŸè¯­ å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://lry61.cn/blog/tags/å‰ç«¯/"}]},{"title":"å‡½æ•°é˜²æŠ–ä¸èŠ‚æµ","date":"2019-10-12T03:07:29.083Z","path":"/posts/2/","text":"é˜²æŠ–debounceä¸èŠ‚æµthrottleçš„å®ç° å‰è¨€åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°ä¸€äº›é¢‘ç¹çš„äº‹ä»¶è§¦å‘ï¼ˆæ»šåŠ¨æ¡æ»‘åŠ¨ã€é¼ æ ‡äº‹ä»¶ã€æœç´¢æ¡†æœç´¢â€¦ï¼‰ï¼Œå¦‚æœä¸åŠ ä»¥é™åˆ¶çš„è¯ï¼Œå¯èƒ½ä¼šé€ æˆæµè§ˆå™¨å¡é¡¿ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå‡ºç°äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š debounceé˜²æŠ– throttleèŠ‚æµ æ­£æ–‡é˜²æŠ–å‡½æ•°å®šä¹‰ï¼šè§¦å‘äº‹ä»¶åï¼Œåœ¨nç§’åæ‰ä¼šæ‰§è¡Œï¼›å¦‚æœåœ¨nç§’å†…åˆé‡æ–°è§¦å‘äº†è¯¥äº‹ä»¶ï¼Œåˆ™ä»¥é‡æ–°è§¦å‘è¯¥äº‹ä»¶çš„æ—¶é—´ä¸ºå‡†ï¼Œnç§’åå†æ‰§è¡Œã€‚æ€»ä¹‹å°±æ˜¯ï¼šè§¦å‘äº‹ä»¶nç§’å†…ä¸å†è§¦å‘è¯¥äº‹ä»¶æ‰æ‰§è¡Œï¼Œå¦‚æœnç§’å†…å†æ¬¡è§¦å‘è¯¥äº‹ä»¶ï¼Œåˆ™é‡æ–°è®¡ç®—nç§’åå†æ‰§è¡Œï¼ˆä»»æ€§å•Šâ€¦ï¼‰ åˆç‰ˆé˜²æŠ–å‡½æ•°çš„å®ç° å®ç°æ€è·¯ï¼šé€šè¿‡å®šæ—¶å™¨æ§åˆ¶funcæ˜¯å¦å®ç°1ã€æ¯æ¬¡è§¦å‘é˜²æŠ–å‡½æ•°æ—¶ï¼Œå…ˆæ¸…é™¤ä¸Šä¸€æ¬¡çš„å®šæ—¶å™¨ï¼Œå†å¼€å¯æœ¬æ¬¡è§¦å‘å®šæ—¶å™¨2ã€ç»‘å®šthisæŒ‡å‘ï¼šä½¿ç”¨é˜²æŠ–å‡½æ•°åï¼Œfuncä¸­çš„thisä¼šæŒ‡å‘windowï¼Œè¦è®©thisæŒ‡å‘funcä¸Šä¸‹æ–‡ï¼Œåˆ™éœ€è¦ç»‘å®šthisæŒ‡å‘ -&gt; func.apply(context)3ã€ç»‘å®ševentäº‹ä»¶ï¼šäº‹ä»¶å¤„ç†å‡½æ•°ä¸­ä¼šæä¾›äº‹ä»¶å¯¹è±¡eventï¼Œä½†æ˜¯åœ¨debounceå‡½æ•°ä¸­æ‰“å°ä¼šæ˜¯undefinedï¼Œæ‰€ä»¥éœ€è¦å¯¹eventå¯¹è±¡ç‰¹æ®Šå¤„ç† -&gt; func.apply(context, args) 1234567891011function debounce(func, wait) { var timeout; return function() { var context = this; var args = arguments; clearTimeout(timeout); timeout = setTimeout(function() { func.apply(context, args); },wait); }} é˜²æŠ–å‡½æ•°çš„ç«‹å³æ‰§è¡Œåœ¨åˆç‰ˆå‡½æ•°çš„åŸºç¡€ä¸Šï¼Œè€ƒè™‘ä¸ªæ–°çš„éœ€æ±‚ï¼šæˆ‘ä¸å¸Œæœ›è¦ç­‰åˆ°äº‹ä»¶åœæ­¢è§¦å‘nç§’åæ‰æ‰§è¡Œï¼Œæˆ‘å¸Œæœ›å®ƒèƒ½å¤Ÿç«‹å³æ‰§è¡Œï¼Œç„¶ååœæ­¢è§¦å‘nç§’åæ‰å¯ä»¥é‡æ–°è§¦å‘æ‰§è¡Œ 12345678910111213141516171819202122function debounce(func, wait, immediate) { var timeout,result; return function() { var context = this; var args = arguments; if(timeout) clearTimeout(timeout); if(immediate) { //å¦‚æœå·²ç»æ‰§è¡Œè¿‡ï¼Œä¸å†æ‰§è¡Œ var callNow = !timeout; //å®šæ—¶å™¨ç»“æŸå¹¶è®¾ç½®ä¸ºnullï¼Œåˆ™å¯ä»¥å†æ¬¡ç‚¹å‡»æ‰§è¡Œäº† timeout = setTimeout(function() { timeout = null; }, wait); if(callNow) result = func.apply(context, args); } else { timeout = setTimeout(function() { func.apply(context, args); }, wait); } return result; }} ä¸Šé¢ä»£ç å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šfuncå‡½æ•°æ—¶å¯èƒ½æœ‰è¿”å›å€¼çš„ï¼Œæ‰€ä»¥debounceå‡½æ•°æˆ‘ä»¬ä¹Ÿéœ€è¦æ·»åŠ è¿”å›ç»“æœresultã€‚å½“immediateä¸ºfalseæ—¶ï¼Œå› ä¸ºsetTimeoutå‡½æ•°çš„å­˜åœ¨ï¼Œreturnå‡ºæ¥çš„å€¼ä¸€ç›´éƒ½æ˜¯undefinedï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åœ¨immediateä¸ºtrueçš„æ—¶å€™æ‰æ·»åŠ è¿”å›ç»“æœã€‚ èŠ‚æµå‡½æ•°å®šä¹‰ï¼šåœ¨è§„å®šçš„æ—¶é—´å†…ï¼Œåªèƒ½è§¦å‘ä¸€æ¬¡äº‹ä»¶ï¼›å¦‚æœè§„å®šæ—¶é—´å†…å†è§¦å‘å¤šæ¬¡ï¼Œåˆ™ä»€ä¹ˆä¹Ÿä¸åšã€‚ ä½¿ç”¨æ—¶é—´æˆ³ å®ç°æ€è·¯ï¼šè®¾ç½®æ—¶é—´æˆ³previouså¼€å§‹å€¼ä¸º0ï¼Œå½“è§¦å‘äº‹ä»¶æ—¶ï¼Œå–å‡ºå½“å‰çš„æ—¶é—´æˆ³nowï¼Œå‡å»ä¹‹å‰çš„æ—¶é—´æˆ³previousï¼Œå¦‚æœå¾—åˆ°çš„å€¼å¤§äºè®¾ç½®çš„è§„å®šæ—¶é—´waitï¼Œåˆ™æ‰§è¡Œå‡½æ•°funcï¼Œå¹¶æ›´æ–°æ—¶é—´æˆ³previousä¸ºå½“å‰æ—¶é—´nowï¼›å¦‚æœå°äºï¼Œåˆ™ä¸æ‰§è¡Œã€‚ 12345678910111213function throttle(func, wait) { var context,args; var previous = 0; return function() { var now = +new Date(); context = this; args = arguments; if(now - previous &gt; wait) { func.apply(context, args); previous = now; } }} ä½¿ç”¨å®šæ—¶å™¨ å®ç°æ€è·¯ï¼šå½“è§¦å‘äº‹ä»¶çš„æ—¶å€™ï¼Œè®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå†æ¬¡è§¦å‘è¯¥äº‹ä»¶çš„æ—¶å€™ï¼Œå¦‚æœå®šæ—¶å™¨å­˜åœ¨ï¼Œå°±ä¸æ‰§è¡Œfuncï¼Œç›´åˆ°ä¸Šä¸€è½®å®šæ—¶å™¨æ‰§è¡Œå®Œå¹¶ä¸”ä¸ºnullï¼Œæ‰ä¼šæ‰§è¡Œfuncï¼Œå¹¶æ¸…é™¤æœ¬æ¬¡å®šæ—¶å™¨ã€‚ 12345678910111213function throttle(func, wait) { var timeout; return function() { var context = this; var args = arguments; if(!timeout) { timeout = setTimeout(function() { timeout = null; func.apply(context, args); }, wait); } }} æ¯”è¾ƒä¸Šé¢ä½¿ç”¨æ—¶é—´æˆ³å’Œä½¿ç”¨å®šæ—¶å™¨ä¸¤ä¸ªæ–¹æ³•ä½ ä¼šå‘ç°ï¼š1ã€ä½¿ç”¨æ—¶é—´æˆ³ï¼šè§¦å‘äº‹ä»¶ä¼šç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œåœæ­¢è§¦å‘äº‹ä»¶ä¾¿ä¸å†æ‰§è¡Œ2ã€ä½¿ç”¨å®šæ—¶å™¨ï¼šè§¦å‘äº‹ä»¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œåœ¨nç§’åæ‰æ‰§è¡Œç¬¬ä¸€æ¬¡ï¼›åœæ­¢è§¦å‘äº‹ä»¶åä»ä¼šå†æ‰§è¡Œä¸€æ¬¡ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºä¸€ä¸ªâ€œåŒå‰‘åˆç’§â€ç‰ˆçš„èŠ‚æµå‡½æ•°ï¼šè§¦å‘äº‹ä»¶èƒ½å¤Ÿç«‹å³æ‰§è¡Œï¼Œåœæ­¢è§¦å‘è¿˜èƒ½å†æ‰§è¡Œä¸€æ¬¡ åŒå‰‘åˆç’§ç‰ˆèŠ‚æµ1234567891011121314151617181920212223242526272829function throttle(func, wait) { var timeout, context, args; var previous = 0; var later = function() { previous = +new Date(); timeout = null; func.apply(context, args) }; var throttled = function() { var now = +new Date(); //ä¸‹æ¬¡è§¦å‘ func å‰©ä½™çš„æ—¶é—´ var remaining = wait - (now - previous); context = this; args = arguments; if (remaining &lt;= 0) { if (timeout) { clearTimeout(timeout); timeout = null; } previous = now; func.apply(context, args); } else if (!timeout) { timeout = setTimeout(later, remaining); } }; return throttled;} ç»“æŸè¯­ å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£~ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://lry61.cn/blog/tags/å‰ç«¯/"}]},{"title":"æ­£åˆ™è¡¨è¾¾å¼å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰","date":"2019-09-29T00:58:23.390Z","path":"/posts/1/","text":"æ­£åˆ™è¡¨è¾¾å¼çš„å­¦ä¹ ä¹‹è·¯â€¦ å‰è¨€åœ¨æˆ‘çš„å·¥ä½œå½“ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ˜¯ä½¿ç”¨éå¸¸é¢‘ç¹çš„ï¼Œä½†æ˜¯æœ¬äººå¯¹äºæ­£åˆ™è¡¨è¾¾å¼çš„ç ”ç©¶æ¯”è¾ƒæµ…æ˜¾ï¼Œä¾¿åªå¥½æŠŠå¯¹æ­£åˆ™çš„ä¸€äº›å­¦ä¹ ç†è§£è®°å½•ä¸‹æ¥ï¼Œæ–¹ä¾¿ä»¥åç¿»é˜…ã€‚ï¼ˆæ„Ÿå…´è¶£çš„æœ‹å‹å¯è‡ªè¡Œæœç´¢è€å§šçš„JavaScriptæ­£åˆ™è¡¨è¾¾å¼ç³»åˆ—æ–‡ç« ï¼‰ æ­£æ–‡æ­£åˆ™è¡¨è¾¾å¼æ˜¯åŒ¹é…æ¨¡å¼ï¼Œè¦ä¹ˆåŒ¹é…å­—ç¬¦ï¼Œè¦ä¹ˆåŒ¹é…ä½ç½® ä¸¤ç§æ¨¡ç³ŠåŒ¹é… æ¨ªå‘æ¨¡ç³ŠåŒ¹é…ï¼šå¯åŒ¹é…çš„å­—ç¬¦ä¸²é•¿åº¦æ˜¯ä¸å›ºå®šçš„ã€‚å®ç°æ–¹å¼æ˜¯ä½¿ç”¨é‡è¯eg1ï¼š{m, n}è¡¨ç¤ºè¿ç»­å‡ºç°æœ€å°‘mæ¬¡ï¼Œæœ€å¤šnæ¬¡eg2ï¼š/ab{2,3}c/è¡¨ç¤ºç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯â€œaâ€ï¼Œåé¢æ˜¯2åˆ°5ä¸ªâ€bâ€ï¼Œæœ€åæ˜¯â€câ€ çºµå‘æ¨¡ç³ŠåŒ¹é…ï¼šåŒ¹é…çš„å­—ç¬¦ä¸²å…·ä½“åˆ°æŸä¸€ä½æ—¶ï¼Œå¯ä»¥ä¸æ˜¯æŸä¸ªç¡®å®šçš„å­—ç¬¦ã€‚å®ç°æ–¹å¼æ˜¯ä½¿ç”¨å­—ç¬¦ç»„eg1ï¼š[abc]è¡¨ç¤ºåŒ¹é…â€aâ€ã€â€bâ€ã€â€câ€ä¸­çš„ä»»ä¸€å­—ç¬¦eg2ï¼š/a[123]b/å¯ä»¥åŒ¹é…ä¸‰ç§å­—ç¬¦ï¼šâ€a1bâ€ã€â€a2bâ€ã€â€a3bâ€ å­—ç¬¦ç»„å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè™½ç„¶å«åšå­—ç¬¦ç»„ï¼ˆå­—ç¬¦ç±»ï¼‰ï¼Œä½†åªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªå­—ç¬¦ã€‚è­¬å¦‚[abc]åŒ¹é…çš„æ˜¯â€aâ€ã€â€bâ€ã€â€câ€å…¶ä¸­ä¹‹ä¸€ èŒƒå›´è¡¨ç¤ºæ³•å¦‚æœä¸€ä¸ªå­—ç¬¦ç»„é‡Œé¢å­—ç¬¦å¤ªå¤šçš„è¯ï¼Œå¯ä»¥ç”¨è¿å­—ç¬¦â€œ-â€æ¥çœç•¥å’Œç®€å†™ã€‚è­¬å¦‚åŒ¹é…å­—æ¯ï¼Œå¯ä»¥å†™ä¸ºï¼š[a-zA-Z] å¦‚æœéœ€è¦åŒ¹é…çš„å­—ç¬¦å¸¦æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œåˆ™åº”è¯¥æ”¾åœ¨å¼€å¤´ã€ç»“å°¾æˆ–è€…è½¬ä¹‰ï¼Œé¿å…å¼•æ“è®¤ä¸ºæ˜¯ç‰¹æ®Šç”¨æ³• æ’é™¤å­—ç¬¦ç»„ï¼ˆå–åï¼‰[^abc]è¡¨ç¤ºä¸€ä¸ªé™¤â€aâ€ã€â€bâ€ã€â€câ€ä¹‹å¤–çš„ä»»æ„å­—ç¬¦ã€‚å­—ç¬¦ç»„ç¬¬ä¸€ä½æ”¾^ï¼ˆè„±å­—ç¬¦ï¼‰è¡¨ç¤ºå–å å¸¸è§ç®€å†™å½¢å¼ å­—ç¬¦ç»„ å…·ä½“å«ä¹‰ \\d [0-9]ï¼Œè¡¨ç¤ºä¸€ä½æ•°å­— \\D [^0-9]ï¼Œè¡¨ç¤ºé™¤æ•°å­—å¤–çš„ä»»æ„å­—ç¬¦ \\w [0-9a-zA-Z_]ï¼Œè¡¨ç¤ºæ•°å­—ã€å¤§å°å†™å­—æ¯ã€ä¸‹åˆ’çº¿ \\W [^0-9a-zA-Z]ï¼Œè¡¨ç¤ºéå•è¯å­—ç¬¦ \\s [\\t\\n\\v\\r\\f]ï¼Œè¡¨ç¤ºç©ºç™½ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€æ°´å¹³å‚ç›´åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ã€æ¢é¡µç¬¦ã€å›è½¦ç¬¦ \\S [^\\t\\n\\v\\r\\f]ï¼Œè¡¨ç¤ºéç©ºç™½ç¬¦ . é€šé…ç¬¦ï¼Œè¡¨ç¤ºå‡ ä¹ä»»æ„å­—ç¬¦ é‡è¯ ç®€å†™å½¢å¼ é‡è¯ å…·ä½“å«ä¹‰ {m,} è¡¨ç¤ºè‡³å°‘å‡ºç°mæ¬¡ {m} è¡¨ç¤ºå‡ºç°mæ¬¡ ? ç­‰ä»·äº{0,1}ï¼Œè¡¨ç¤ºå‡ºç°æˆ–è€…ä¸å‡ºç° + ç­‰ä»·äº{1,}ï¼Œè¡¨ç¤ºè‡³å°‘å‡ºç°ä¸€æ¬¡ * ç­‰ä»·äº{0,}ï¼Œè¡¨ç¤ºæœ‰å¯èƒ½ä¸å‡ºç°ï¼Œæˆ–å‡ºç°ä»»æ„æ¬¡ è´ªå©ªåŒ¹é…ä¸æƒ°æ€§åŒ¹é…è´ªå©ªåŒ¹é…ï¼šåœ¨æ»¡è¶³æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œå°½å¯èƒ½å¤šçš„åŒ¹é…æƒ°æ€§åŒ¹é…ï¼šåœ¨æ»¡è¶³æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œå°½å¯èƒ½å°‘çš„åŒ¹é… 12345var reg1 = /\\d{2,5}/g;var reg2 = /\\d{2,5}?/g;var str = \"123 1234 12345 123456\";console.log(str.match(reg1)); //[\"123\", \"1234\", \"12345\", \"12345\"]console.log(str.match(reg2)); //[\"12\", \"12\", \"34\" \"12\", \"34\", \"12\", \"34\", \"56\"] ä¸Šé¢ä»£ç å•ç‹¬è¿ç®—æ—¶ï¼Œå‘ˆç°å‡ºäº†ä¸¤ç§ä¸åŒçš„ç»“æœï¼›å…¶ä¸­reg1è¿ç®—æ˜¯è´ªå©ªåŒ¹é…ï¼Œreg2æ˜¯æƒ°æ€§åŒ¹é…(é€šè¿‡åœ¨é‡è¯åé¢åŠ â€ï¼Ÿâ€œå°±èƒ½å®ç°ï¼‰ å¤šé€‰åˆ†æ”¯å¤šé€‰åˆ†æ”¯å¯ä»¥æ”¯æŒå¤šä¸ªå­æ¨¡å¼ä»»é€‰å…¶ä¸€ã€‚è­¬å¦‚(p1|p2|p3)ï¼Œå…¶ä¸­p1ï¼Œp2ï¼Œp3æ˜¯å­æ¨¡å¼ï¼Œç”¨ç®¡é“ç¬¦ï¼ˆ|ï¼‰åˆ†éš”è¡¨ç¤ºå…¶ä¸­ä»»ä½•ä¹‹ä¸€ã€‚ 123var reg = /good|nice/g;var str = \"good idea, nice boy.\";console.log(str.match(reg)); //[\"good\",\"nice\"] å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåˆ†æ”¯ç»“æ„å±äºæƒ°æ€§åŒ¹é…ï¼Œå°±æ˜¯å½“å‰é¢çš„åŒ¹é…ä¸Šäº†ï¼Œåé¢çš„å°±ä¸åœ¨å°è¯•äº† 123var reg = /good|goodbye/g;var str = \"goodbye\";console.log(str.match(reg)); //[\"good\"] ç»å…¸æ¡ˆä¾‹åˆ†æåŒ¹é…å­—ç¬¦ï¼Œå…¶å®å°±æ˜¯å­—ç¬¦ä¸²ã€é‡è¯ã€åˆ†æ”¯ç»“æ„çš„ç»„åˆä½¿ç”¨(æ³¨æ„ï¼šæ¡ˆä¾‹ä»£ç ä½¿ç”¨äº†å…¨å±€åŒ¹é…gï¼Œéœ€è¦å•ç‹¬éªŒè¯ï¼Œå¦åˆ™ä¼šå‡ºé”™) åŒ¹é…16è¿›åˆ¶é¢œè‰² åˆ†æï¼šè¡¨ç¤ºä¸€ä¸ª16è¿›åˆ¶å­—ç¬¦ï¼Œå¯ä»¥ç”¨å­—ç¬¦ç»„[0-9a-fA-F]å…¶ä¸­å­—ç¬¦å¯ä»¥å‡ºç°3æ¬¡æˆ–è€…6æ¬¡ï¼Œéœ€è¦ç”¨é‡è¯å’Œåˆ†æ”¯ç»“æ„ï¼Œä½¿ç”¨åˆ†æ”¯ç»“æ„æ—¶éœ€è¦æ³¨æ„é¡ºåº 123var reg = /#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})/g;var str = \"#FF6600 #fff #CCc\";console.log(str.match(reg)); //[\"#FF6600\",\"#fff\",\"#CCc\"] åŒ¹é…24å°æ—¶åˆ¶æ—¶é—´ åˆ†æï¼š24å°æ—¶åˆ¶æ—¶é—´å±•ç¤ºä¸»è¦å¦‚ï¼š23ï¼š59ã€02ï¼š01å…±æœ‰4ä¸ªæ•°å­—ï¼Œç¬¬ä¸€ä½æ•°å­—å¯ä»¥æ˜¯[0-2]å½“ç¬¬ä¸€ä½æ•°å­—æ˜¯â€2â€æ—¶ï¼Œç¬¬äºŒä½å¯ä»¥æ˜¯[0-3]ï¼Œå¦åˆ™ç¬¬äºŒä½æ˜¯[0-9]ç¬¬ä¸‰ä½å¯ä»¥æ˜¯[0-5]ï¼Œç¬¬å››ä½å¯æ˜¯æ˜¯[0-9]å¦‚æœè¦æ±‚åŒ¹é…â€2:2â€è¿™ç§æ—¶é—´æ ¼å¼ï¼Œåˆ™å‰é¢çš„0æ˜¯å¯ä»¥çœç•¥çš„ 1234var reg = /^(0?[0-9]|1[0-9]|[2][0-3]):(0?[0-9]|[1-5][0-9])$/g;console.log(reg.test(\"23:59\")); //trueconsole.log(reg.test(\"02:03\")); //trueconsole.log(reg.test(\"2:2\")); //true åŒ¹é…æ—¥æœŸï¼ˆyyyy-mm-ddæ ¼å¼ï¼‰ åˆ†æï¼šå¹´ï¼šå››ä½æ•°å³å¯ï¼Œå¯ä»¥è¡¨ç¤ºä¸º[0-9]{4}æœˆï¼šåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼šâ€01â€ã€â€02â€ã€â€¦ã€â€09â€å’Œâ€10â€ã€â€11â€ã€â€12â€ï¼Œå¯ä»¥è¡¨ç¤ºä¸º(0[1-9]|1[0-2])æ—¥ï¼šæœ€å¤§ä¸º31æ—¥ï¼Œå¯ä»¥è¡¨ç¤ºä¸º(0[1-9]|[12][0-9]|3[01]) 12var reg = /^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])$/g;console.log(reg.test(\"2017-02-05\")); //true ç»“æŸè¯­æŒæ¡å­—ç¬¦ç»„å’Œé‡è¯çš„å¤§è‡´çŸ¥è¯†ï¼ŒåŸºæœ¬ä¸Šå°±ç®—æ˜¯æ­£åˆ™å…¥é—¨äº†â€¦åç»­å†å­¦ä¹ æœ‰å…³äºæ­£åˆ™è¡¨è¾¾å¼çš„ä½ç½®åŒ¹é…~ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","tags":[{"name":"æ­£åˆ™","slug":"æ­£åˆ™","permalink":"http://lry61.cn/blog/tags/æ­£åˆ™/"}]},{"title":"ArrayçŸ¥è¯†æ¸…å•","date":"2019-09-24T14:18:08.775Z","path":"/posts/0/","text":"ArrayçŸ¥è¯†æ¸…å• æ­£æ–‡æ„é€ å‡½æ•°Arrayæ˜¯JSçš„åŸç”Ÿå¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¯ä»¥ç”¨å®ƒæ¥ç”Ÿæˆæ–°æ•°ç»„ 123var arr = new Array(3);arr.length; //3arr; //[empty x 3] ä¸Šé¢ä»£ç ä¸­ï¼ŒArrayæ„é€ å‡½æ•°çš„å‚æ•°3ï¼Œè¡¨ç¤ºç”Ÿæˆä¸€ä¸ªä¸‰ä½æˆå‘˜çš„æ•°ç»„ï¼Œæ¯ä¸ªä½ç½®éƒ½æ˜¯ç©ºå€¼ã€‚var arr = new Array(3)ç­‰åŒäºvar arr = Array(3) é™æ€æ–¹æ³• .isArrayArray.isArray()æ–¹æ³•è¿”å›ä¸€ä¸ªBooleanå€¼ï¼Œè¡¨ç¤ºå‚æ•°æ˜¯å¦ä¸ºæ•°ç»„ 123var arr = [1,2,3];typeof arr; //\"object\"Array.isArray(arr); //true valueOfã€toStringæ•°ç»„çš„valueOfæ–¹æ³•è¿”å›æ•°ç»„æœ¬èº«ï¼Œè€ŒtoStringæ–¹æ³•è¿”å›æ•°ç»„çš„å­—ç¬¦ä¸²å½¢å¼ 123var arr = [1, 2, 3];arr.valueOf(); //[1, 2, 3]arr.toString(); //\"1, 2, 3\" popã€pushpushæ–¹æ³•ç”¨äºåœ¨æ•°ç»„çš„æœ«ç«¯æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›æ·»åŠ æ–°å…ƒç´ åçš„æ•°ç»„é•¿åº¦ã€‚è¯¥æ–¹æ³•ä¼šæ”¹å˜åŸæ•°ç»„ 12345var arr = [];arr.push(1); //1arr.push(\"a\"); //2arr.push(true,{}); //4arr; //[1,\"a\",true,{}] popæ–¹æ³•ç”¨äºåˆ é™¤æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ ã€‚è¯¥æ–¹æ³•ä¼šæ”¹å˜åŸæ•°ç»„ 123var arr = [1,2,3];arr.pop(); //3arr; //[1,2] å¯¹ç©ºæ•°ç»„ä½¿ç”¨popæ–¹æ³•ï¼Œä¸ä¼šæŠ¥é”™ï¼Œè¿”å›undefined [ ].pop(); //undefined shiftã€unshiftshiftæ–¹æ³•ç”¨äºåˆ é™¤æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ ã€‚è¯¥æ–¹æ³•ä¼šæ”¹å˜åŸæ•°ç»„ 123var arr = [1,2,3];arr.shift(); //1arr; //[2,3] unshiftæ–¹æ³•ç”¨äºåœ¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®æ·»åŠ å…ƒç´ ï¼Œå¹¶è¿”å›æ·»åŠ æ–°å…ƒç´ åçš„æ•°ç»„é•¿åº¦ã€‚è¯¥æ–¹æ³•ä¼šæ”¹å˜åŸæ•°ç»„ 123var arr = [1,2,3];arr.unshift(4); //4arr; //[4,1,2,3] joinjoinæ–¹æ³•ä»¥æŒ‡å®šå‚æ•°ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå°†æ‰€æœ‰æ•°ç»„æˆå‘˜è¿æ¥ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›ã€‚å¦‚æœä¸æä¾›å‚æ•°ï¼Œé»˜è®¤ç”¨é€—å·åˆ†éš”ã€‚ 1234var a = [1, 2, 3, 4];a.join(' '); //\"1 2 3 4\"a.join(' | '); //\"1 | 2 | 3 | 4\"a.join(); //\"1,2,3,4\" å¦‚æœæ•°ç»„æˆå‘˜æ˜¯undefinedæˆ–nullæˆ–ç©ºä½ï¼Œä¼šè¢«è½¬æˆç©ºå­—ç¬¦ä¸²ã€‚ 12[undefined, null].join(' '); //' '['a',, 'b'].join('-'); //'a--b' é€šè¿‡callæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥ç”¨äºå­—ç¬¦ä¸²æˆ–ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ã€‚ 123Array.prototype.join.call('hello', '-'); // \"h-e-l-l-o\"var obj = { 0: 'a', 1: 'b', length: 2 };Array.prototype.join.call(obj, '-'); // 'a-b' concatconcatæ–¹æ³•ç”¨äºå¤šä¸ªæ•°ç»„çš„åˆå¹¶ã€‚å®ƒå°†æ–°æ•°ç»„çš„æˆå‘˜ï¼Œæ·»åŠ åˆ°åŸæ•°ç»„æˆå‘˜çš„åéƒ¨ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼ŒåŸæ•°ç»„ä¸å˜ 12345678910['hello'].concat(['world']); //[\"hello\", \"world\"]['hello'].concat(['world'], ['!']); //[\"hello\", \"world\", \"!\"][].concat({a: 1}, {b: 2}); //[{ a: 1 }, { b: 2 }][2].concat({a: 1}); //[2, {a: 1}]var arr1 = [1,2];var arr2 = [3,4];var arr3 = arr1.concat(arr2);console.log(arr1); //[1,2]console.log(arr3); //[1,2,3,4] é™¤äº†æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œconcatä¹Ÿæ¥å—å…¶ä»–ç±»å‹çš„å€¼ä½œä¸ºå‚æ•°ï¼Œæ·»åŠ åˆ°ç›®æ ‡æ•°ç»„å°¾éƒ¨ã€‚ 1[1, 2, 3].concat(4, 5, 6); // [1, 2, 3, 4, 5, 6] å¦‚æœæ•°ç»„æˆå‘˜åŒ…æ‹¬å¯¹è±¡ï¼Œconcatæ–¹æ³•è¿”å›å½“å‰æ•°ç»„çš„ä¸€ä¸ªæµ…æ‹·è´ã€‚æ‰€è°“â€œæµ…æ‹·è´â€ï¼ŒæŒ‡çš„æ˜¯æ–°æ•°ç»„æ‹·è´çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨ã€‚ 12345var obj = { a: 1 };var oldArray = [obj];var newArray = oldArray.concat();obj.a = 2;newArray[0].a; //2 ä¸Šé¢ä»£ç ä¸­ï¼ŒåŸæ•°ç»„åŒ…å«ä¸€ä¸ªå¯¹è±¡ï¼Œconcatæ–¹æ³•ç”Ÿæˆçš„æ–°æ•°ç»„åŒ…å«è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚æ‰€ä»¥ï¼Œæ”¹å˜åŸå¯¹è±¡ä»¥åï¼Œæ–°æ•°ç»„è·Ÿç€æ”¹å˜ã€‚ reversereverseæ–¹æ³•ç”¨äºé¢ å€’æ’åˆ—æ•°ç»„å…ƒç´ ï¼Œè¿”å›æ”¹å˜åçš„æ•°ç»„ã€‚è¯¥æ–¹æ³•å°†æ”¹å˜åŸæ•°ç»„ 123var a = ['a', 'b', 'c'];a.reverse(); //[\"c\", \"b\", \"a\"]a; //[\"c\", \"b\", \"a\"] slicesliceæ–¹æ³•ç”¨äºæå–ç›®æ ‡æ•°ç»„çš„ä¸€éƒ¨åˆ†ï¼Œè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼ŒåŸæ•°ç»„ä¸å˜1.arr.slice(start, end)å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºèµ·å§‹ä½ç½®ï¼ˆä»0å¼€å§‹ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç»ˆæ­¢ä½ç½®ï¼ˆä½†è¯¥ä½ç½®çš„å…ƒç´ æœ¬èº«ä¸åŒ…æ‹¬åœ¨å†…ï¼‰ã€‚å¦‚æœçœç•¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™ä¸€ç›´è¿”å›åˆ°åŸæ•°ç»„çš„æœ€åä¸€ä¸ªæˆå‘˜ã€‚ 123456var a = ['a', 'b', 'c'];a.slice(0); //[\"a\", \"b\", \"c\"]a.slice(1); //[\"b\", \"c\"]a.slice(1, 2); //[\"b\"]a.slice(2, 6); //[\"c\"]a.slice(); //[\"a\", \"b\", \"c\"] ä¸Šé¢ä»£ç ä¸­ï¼Œæœ€åä¸€ä¸ªä¾‹å­sliceæ²¡æœ‰å‚æ•°ï¼Œå®é™…ä¸Šç­‰äºè¿”å›ä¸€ä¸ªåŸæ•°ç»„çš„æ‹·è´ã€‚ å¦‚æœsliceæ–¹æ³•çš„å‚æ•°æ˜¯è´Ÿæ•°ï¼Œåˆ™è¡¨ç¤ºå€’æ•°è®¡ç®—çš„ä½ç½®ã€‚ 123var a = ['a', 'b', 'c'];a.slice(-2); //[\"b\", \"c\"]a.slice(-2, -1); //[\"b\"] ä¸Šé¢ä»£ç ä¸­ï¼Œ-2è¡¨ç¤ºå€’æ•°è®¡ç®—çš„ç¬¬äºŒä¸ªä½ç½®ï¼Œ-1è¡¨ç¤ºå€’æ•°è®¡ç®—çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚ å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å¤§äºç­‰äºæ•°ç»„é•¿åº¦ï¼Œæˆ–è€…ç¬¬äºŒä¸ªå‚æ•°å°äºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåˆ™è¿”å›ç©ºæ•°ç»„ã€‚ 123var a = ['a', 'b', 'c'];a.slice(4); //[]a.slice(2, 1); //[] 2.Array.prototype.slice.callï¼ˆthisï¼‰sliceæ–¹æ³•çš„ä¸€ä¸ªé‡è¦åº”ç”¨ï¼Œæ˜¯å°†ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ 123Array.prototype.slice.call({ 0: 'a', 1: 'b', length: 2 }); //['a', 'b']Array.prototype.slice.call(document.querySelectorAll(\"div\"));Array.prototype.slice.call(arguments); ä¸Šé¢ä»£ç çš„å‚æ•°éƒ½ä¸æ˜¯æ•°ç»„ï¼Œä½†æ˜¯é€šè¿‡callæ–¹æ³•ï¼Œåœ¨å®ƒä»¬ä¸Šé¢è°ƒç”¨sliceæ–¹æ³•ï¼Œå°±å¯ä»¥æŠŠå®ƒä»¬è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚ splicespliceæ–¹æ³•ç”¨äºåˆ é™¤åŸæ•°ç»„çš„ä¸€éƒ¨åˆ†æˆå‘˜ï¼Œå¹¶å¯ä»¥åœ¨åˆ é™¤çš„ä½ç½®æ·»åŠ æ–°çš„æ•°ç»„æˆå‘˜ï¼Œè¿”å›å€¼æ˜¯è¢«åˆ é™¤çš„å…ƒç´ ã€‚è¯¥æ–¹æ³•ä¼šæ”¹å˜åŸæ•°ç»„arr.splice(start, count, addElement1, addElement2, ...)spliceçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åˆ é™¤çš„èµ·å§‹ä½ç½®ï¼ˆä»0å¼€å§‹ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¢«åˆ é™¤çš„å…ƒç´ ä¸ªæ•°ã€‚å¦‚æœåé¢è¿˜æœ‰æ›´å¤šçš„å‚æ•°ï¼Œåˆ™è¡¨ç¤ºè¿™äº›å°±æ˜¯è¦è¢«æ’å…¥æ•°ç»„çš„æ–°å…ƒç´ ã€‚ 123var a = ['a', 'b', 'c', 'd', 'e', 'f'];a.splice(4, 2); //[\"e\", \"f\"]a; //[\"a\", \"b\", \"c\", \"d\"] ä¸Šé¢ä»£ç ä»åŸæ•°ç»„4å·ä½ç½®ï¼Œåˆ é™¤äº†ä¸¤ä¸ªæ•°ç»„æˆå‘˜ã€‚ 123var a = ['a', 'b', 'c', 'd', 'e', 'f'];a.splice(4, 2, 1, 2); //[\"e\", \"f\"]a; //[\"a\", \"b\", \"c\", \"d\", 1, 2] ä¸Šé¢ä»£ç é™¤äº†åˆ é™¤æˆå‘˜ï¼Œè¿˜æ’å…¥äº†ä¸¤ä¸ªæ–°æˆå‘˜ã€‚ èµ·å§‹ä½ç½®å¦‚æœæ˜¯è´Ÿæ•°ï¼Œå°±è¡¨ç¤ºä»å€’æ•°ä½ç½®å¼€å§‹åˆ é™¤ã€‚ 12var a = ['a', 'b', 'c', 'd', 'e', 'f'];a.splice(-4, 2); //[\"c\", \"d\"] ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œä»å€’æ•°ç¬¬å››ä¸ªä½ç½®cå¼€å§‹åˆ é™¤ä¸¤ä¸ªæˆå‘˜ã€‚ å¦‚æœåªæ˜¯å•çº¯åœ°æ’å…¥å…ƒç´ ï¼Œspliceæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥è®¾ä¸º0ã€‚ 123var a = [1, 1, 1];a.splice(1, 0, 2); //[]a; //[1, 2, 1, 1] å¦‚æœåªæä¾›ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç­‰åŒäºå°†åŸæ•°ç»„åœ¨æŒ‡å®šä½ç½®æ‹†åˆ†æˆä¸¤ä¸ªæ•°ç»„ã€‚ 123var a = [1, 2, 3, 4];a.splice(2); //[3, 4]a; //[1, 2] sortsortæ–¹æ³•å¯¹æ•°ç»„æˆå‘˜è¿›è¡Œæ’åºï¼Œé»˜è®¤æ˜¯æŒ‰ç…§å­—å…¸é¡ºåºæ’åºã€‚æ’åºåï¼ŒåŸæ•°ç»„å°†è¢«æ”¹å˜ 1234['d', 'c', 'b', 'a'].sort(); //['a', 'b', 'c', 'd'][4, 3, 2, 1].sort(); //[1, 2, 3, 4][11, 101].sort(); //[101, 11][10111, 1101, 111].sort(); //[10111, 1101, 111] ä¸Šé¢ä»£ç çš„æœ€åä¸¤ä¸ªä¾‹å­ï¼Œéœ€è¦ç‰¹æ®Šæ³¨æ„ã€‚sortæ–¹æ³•ä¸æ˜¯æŒ‰ç…§å¤§å°æ’åºï¼Œè€Œæ˜¯æŒ‰ç…§å­—å…¸é¡ºåºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°å€¼ä¼šè¢«å…ˆè½¬æˆå­—ç¬¦ä¸²ï¼Œå†æŒ‰ç…§å­—å…¸é¡ºåºè¿›è¡Œæ¯”è¾ƒï¼Œæ‰€ä»¥101æ’åœ¨11çš„å‰é¢ã€‚ å¦‚æœæƒ³è®©sortæ–¹æ³•æŒ‰ç…§è‡ªå®šä¹‰æ–¹å¼æ’åºï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€‚ 123[10111, 1101, 111].sort(function (a, b) { return a - b;}); //[111, 1101, 10111] ä¸Šé¢ä»£ç ä¸­ï¼Œsortçš„å‚æ•°å‡½æ•°æœ¬èº«æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºè¿›è¡Œæ¯”è¾ƒçš„ä¸¤ä¸ªæ•°ç»„æˆå‘˜ã€‚å¦‚æœè¯¥å‡½æ•°çš„è¿”å›å€¼å¤§äº0ï¼Œè¡¨ç¤ºç¬¬ä¸€ä¸ªæˆå‘˜æ’åœ¨ç¬¬äºŒä¸ªæˆå‘˜åé¢ï¼›å…¶ä»–æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ æ’åœ¨ç¬¬äºŒä¸ªå…ƒç´ å‰é¢ã€‚ 123456789101112[ { name: \"å¼ ä¸‰\", age: 30 }, { name: \"æå››\", age: 24 }, { name: \"ç‹äº”\", age: 28 }].sort(function (o1, o2) { return o1.age - o2.age;});//[//{ name: \"æå››\", age: 24 },//{ name: \"ç‹äº”\", age: 28 },//{ name: \"å¼ ä¸‰\", age: 30 }//] mapmapæ–¹æ³•å°†æ•°ç»„çš„æ‰€æœ‰æˆå‘˜ä¾æ¬¡ä¼ å…¥å‚æ•°å‡½æ•°ï¼Œç„¶åæŠŠæ¯ä¸€æ¬¡çš„æ‰§è¡Œç»“æœç»„æˆä¸€ä¸ªæ–°æ•°ç»„è¿”å›ã€‚ 12345var numbers = [1, 2, 3];numbers.map(function (n) { return n + 1;}); //[2, 3, 4]numbers; //[1, 2, 3] ä¸Šé¢ä»£ç ä¸­ï¼Œnumbersæ•°ç»„çš„æ‰€æœ‰æˆå‘˜ä¾æ¬¡æ‰§è¡Œå‚æ•°å‡½æ•°ï¼Œè¿è¡Œç»“æœç»„æˆä¸€ä¸ªæ–°æ•°ç»„è¿”å›ã€‚åŸæ•°ç»„æ²¡æœ‰å˜åŒ– mapæ–¹æ³•æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€‚è¯¥å‡½æ•°è°ƒç”¨æ—¶ï¼Œmapæ–¹æ³•å‘å®ƒä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼šå½“å‰æˆå‘˜ã€å½“å‰ä½ç½®å’Œæ•°ç»„æœ¬èº«ã€‚ 123[1, 2, 3].map(function(elem, index, arr) { return elem * index;}); //[0, 2, 6] ä¸Šé¢ä»£ç ä¸­ï¼Œmapæ–¹æ³•çš„å›è°ƒå‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œelemä¸ºå½“å‰æˆå‘˜çš„å€¼ï¼Œindexä¸ºå½“å‰æˆå‘˜çš„ä½ç½®ï¼Œarrä¸ºåŸæ•°ç»„ï¼ˆ[1, 2, 3]ï¼‰ mapæ–¹æ³•è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šå›è°ƒå‡½æ•°å†…éƒ¨çš„thiså˜é‡ã€‚ 1234var arr = ['a', 'b', 'c'];[1, 2].map(function (e) { return this[e];}, arr); //['b', 'c'] ä¸Šé¢ä»£ç é€šè¿‡mapæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œå°†å›è°ƒå‡½æ•°å†…éƒ¨çš„thiså¯¹è±¡ï¼ŒæŒ‡å‘arræ•°ç»„ã€‚ å¦‚æœæ•°ç»„æœ‰ç©ºä½ï¼Œmapæ–¹æ³•çš„å›è°ƒå‡½æ•°åœ¨è¿™ä¸ªä½ç½®ä¸ä¼šæ‰§è¡Œï¼Œä¼šè·³è¿‡æ•°ç»„çš„ç©ºä½ã€‚ 1234var f = function (n) { return 'a' };[1, undefined, 2].map(f); //[\"a\", \"a\", \"a\"][1, null, 2].map(f); //[\"a\", \"a\", \"a\"][1, , 2].map(f); //[\"a\", , \"a\"] ä¸Šé¢ä»£ç ä¸­ï¼Œmapæ–¹æ³•ä¸ä¼šè·³è¿‡undefinedå’Œnullï¼Œä½†æ˜¯ä¼šè·³è¿‡ç©ºä½ forEachforEachæ–¹æ³•ä¸mapæ–¹æ³•å¾ˆç›¸ä¼¼ï¼Œä¹Ÿæ˜¯å¯¹æ•°ç»„çš„æ‰€æœ‰æˆå‘˜ä¾æ¬¡æ‰§è¡Œå‚æ•°å‡½æ•°ã€‚ä½†æ˜¯ï¼ŒforEachæ–¹æ³•ä¸è¿”å›å€¼ï¼Œåªç”¨æ¥æ“ä½œæ•°æ®ã€‚è¿™å°±æ˜¯è¯´ï¼Œå¦‚æœæ•°ç»„éå†çš„ç›®çš„æ˜¯ä¸ºäº†å¾—åˆ°è¿”å›å€¼ï¼Œé‚£ä¹ˆä½¿ç”¨mapæ–¹æ³•ï¼Œå¦åˆ™ä½¿ç”¨forEachæ–¹æ³•ã€‚forEachçš„ç”¨æ³•ä¸mapæ–¹æ³•ä¸€è‡´ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°åŒæ ·æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šå½“å‰å€¼ã€å½“å‰ä½ç½®ã€æ•´ä¸ªæ•°ç»„ã€‚ 1234567function log(element, index, array) { console.log('[' + index + '] = ' + element);}[2, 5, 9].forEach(log);//[0] = 2//[1] = 5//[2] = 9 ä¸Šé¢ä»£ç ä¸­ï¼ŒforEachéå†æ•°ç»„ä¸æ˜¯ä¸ºäº†å¾—åˆ°è¿”å›å€¼ï¼Œè€Œæ˜¯ä¸ºäº†åœ¨å±å¹•è¾“å‡ºå†…å®¹ï¼Œæ‰€ä»¥ä¸å¿…ä½¿ç”¨mapæ–¹æ³•ã€‚ forEachæ–¹æ³•ä¹Ÿå¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œç»‘å®šå‚æ•°å‡½æ•°çš„thiså˜é‡ã€‚ 12345var out = [];[1, 2, 3].forEach(function(elem) { this.push(elem * elem);}, out);out; //[1, 4, 9] ä¸Šé¢ä»£ç ä¸­ï¼Œç©ºæ•°ç»„outæ˜¯forEachæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œç»“æœï¼Œå›è°ƒå‡½æ•°å†…éƒ¨çš„thiså…³é”®å­—å°±æŒ‡å‘outã€‚ æ³¨æ„ï¼ŒforEachæ–¹æ³•æ— æ³•ä¸­æ–­æ‰§è¡Œï¼Œæ€»æ˜¯ä¼šå°†æ‰€æœ‰æˆå‘˜éå†å®Œã€‚å¦‚æœå¸Œæœ›ç¬¦åˆæŸç§æ¡ä»¶æ—¶ï¼Œå°±ä¸­æ–­éå†ï¼Œè¦ä½¿ç”¨forå¾ªç¯ã€‚ 12345var arr = [1, 2, 3];for (var i = 0; i &lt; arr.length; i++) { if (arr[i] === 2) break; console.log(arr[i]);} //1 ä¸Šé¢ä»£ç ä¸­ï¼Œæ‰§è¡Œåˆ°æ•°ç»„çš„ç¬¬äºŒä¸ªæˆå‘˜æ—¶ï¼Œå°±ä¼šä¸­æ–­æ‰§è¡Œã€‚forEachæ–¹æ³•åšä¸åˆ°è¿™ä¸€ç‚¹ã€‚ forEachæ–¹æ³•ä¹Ÿä¼šè·³è¿‡æ•°ç»„çš„ç©ºä½ã€‚ 1234567891011121314var log = function (n) { console.log(n + 1);};[1, undefined, 2].forEach(log);//2//NaN//3[1, null, 2].forEach(log);//2//1//3[1, , 2].forEach(log);//2//3 ä¸Šé¢ä»£ç ä¸­ï¼ŒforEachæ–¹æ³•ä¸ä¼šè·³è¿‡undefinedå’Œnullï¼Œä½†ä¼šè·³è¿‡ç©ºä½ã€‚ filterfilteræ–¹æ³•ç”¨äºè¿‡æ»¤æ•°ç»„æˆå‘˜ï¼Œæ»¡è¶³æ¡ä»¶çš„æˆå‘˜ç»„æˆä¸€ä¸ªæ–°æ•°ç»„è¿”å›ã€‚å®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€æœ‰æ•°ç»„æˆå‘˜ä¾æ¬¡æ‰§è¡Œè¯¥å‡½æ•°ï¼Œè¿”å›ç»“æœä¸ºtrueçš„æˆå‘˜ç»„æˆä¸€ä¸ªæ–°æ•°ç»„è¿”å›ã€‚è¯¥æ–¹æ³•ä¸ä¼šæ”¹å˜åŸæ•°ç»„ 1234[1, 2, 3, 4, 5].filter(function (elem) { return (elem &gt; 3);});//[4, 5] ä¸Šé¢ä»£ç å°†å¤§äº3çš„æ•°ç»„æˆå‘˜ï¼Œä½œä¸ºä¸€ä¸ªæ–°æ•°ç»„è¿”å›ã€‚ 123var arr = [0, 1, 'a', false]; arr.filter(Boolean);//[1, \"a\"] ä¸Šé¢ä»£ç ä¸­ï¼Œfilteræ–¹æ³•è¿”å›æ•°ç»„arré‡Œé¢æ‰€æœ‰å¸ƒå°”å€¼ä¸ºtrueçš„æˆå‘˜ã€‚ filteræ–¹æ³•çš„å‚æ•°å‡½æ•°å¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šå½“å‰æˆå‘˜ï¼Œå½“å‰ä½ç½®å’Œæ•´ä¸ªæ•°ç»„ã€‚ 1234[1, 2, 3, 4, 5].filter(function (elem, index, arr) { return index % 2 === 0;});//[1, 3, 5] ä¸Šé¢ä»£ç è¿”å›å¶æ•°ä½ç½®çš„æˆå‘˜ç»„æˆçš„æ–°æ•°ç»„ã€‚ filteræ–¹æ³•è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šå‚æ•°å‡½æ•°å†…éƒ¨çš„thiså˜é‡ã€‚ 123456var obj = { MAX: 3 };var myFilter = function (item) { if (item &gt; this.MAX) return true;};var arr = [2, 8, 3, 4, 1, 3, 2, 9];arr.filter(myFilter, obj); //[8, 4, 9] ä¸Šé¢ä»£ç ä¸­ï¼Œè¿‡æ»¤å™¨myFilterå†…éƒ¨æœ‰thiså˜é‡ï¼Œå®ƒå¯ä»¥è¢«filteræ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°objç»‘å®šï¼Œè¿”å›å¤§äº3çš„æˆå‘˜ã€‚ someã€everyè¿™ä¸¤ä¸ªæ–¹æ³•ç±»ä¼¼â€œæ–­è¨€â€ï¼ˆassertï¼‰ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºåˆ¤æ–­æ•°ç»„æˆå‘˜æ˜¯å¦ç¬¦åˆæŸç§æ¡ä»¶ã€‚å®ƒä»¬æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæ‰€æœ‰æ•°ç»„æˆå‘˜ä¾æ¬¡æ‰§è¡Œè¯¥å‡½æ•°ã€‚è¯¥å‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šå½“å‰æˆå‘˜ã€å½“å‰ä½ç½®å’Œæ•´ä¸ªæ•°ç»„ï¼Œç„¶åè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚someæ–¹æ³•æ˜¯åªè¦ä¸€ä¸ªæˆå‘˜çš„è¿”å›å€¼æ˜¯trueï¼Œåˆ™æ•´ä¸ªsomeæ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯trueï¼Œå¦åˆ™è¿”å›falseã€‚ 12345var arr = [1, 2, 3, 4, 5];arr.some(function (elem, index, arr) { return elem &gt;= 3;});//true ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœæ•°ç»„arræœ‰ä¸€ä¸ªæˆå‘˜å¤§äºç­‰äº3ï¼Œsomeæ–¹æ³•å°±è¿”å›trueã€‚ everyæ–¹æ³•æ˜¯æ‰€æœ‰æˆå‘˜çš„è¿”å›å€¼éƒ½æ˜¯trueï¼Œæ•´ä¸ªeveryæ–¹æ³•æ‰è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚ 12345var arr = [1, 2, 3, 4, 5];arr.every(function (elem, index, arr) { return elem &gt;= 3;});//false ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°ç»„arrå¹¶éæ‰€æœ‰æˆå‘˜å¤§äºç­‰äº3ï¼Œæ‰€ä»¥è¿”å›falseã€‚ æ³¨æ„ï¼Œå¯¹äºç©ºæ•°ç»„ï¼Œsomeæ–¹æ³•è¿”å›falseï¼Œeveryæ–¹æ³•è¿”å›trueï¼Œå›è°ƒå‡½æ•°éƒ½ä¸ä¼šæ‰§è¡Œã€‚ 123function isEven(x) { return x % 2 === 0 }[].some(isEven); //false[].every(isEven); //true someå’Œeveryæ–¹æ³•è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šå‚æ•°å‡½æ•°å†…éƒ¨çš„thiså˜é‡ã€‚ reduceã€reduceRightreduceæ–¹æ³•å’ŒreduceRightæ–¹æ³•ä¾æ¬¡å¤„ç†æ•°ç»„çš„æ¯ä¸ªæˆå‘˜ï¼Œæœ€ç»ˆç´¯è®¡ä¸ºä¸€ä¸ªå€¼ã€‚å®ƒä»¬çš„å·®åˆ«æ˜¯ï¼Œreduceæ˜¯ä»å·¦åˆ°å³å¤„ç†ï¼ˆä»ç¬¬ä¸€ä¸ªæˆå‘˜åˆ°æœ€åä¸€ä¸ªæˆå‘˜ï¼‰ï¼ŒreduceRightåˆ™æ˜¯ä»å³åˆ°å·¦ï¼ˆä»æœ€åä¸€ä¸ªæˆå‘˜åˆ°ç¬¬ä¸€ä¸ªæˆå‘˜ï¼‰ï¼Œå…¶ä»–å®Œå…¨ä¸€æ ·ã€‚ 123456789[1, 2, 3, 4, 5].reduce(function (a, b) { console.log(a, b); return a + b;});//1 2//3 3//6 4//10 5//æœ€åç»“æœï¼š15 ä¸Šé¢ä»£ç ä¸­ï¼Œreduceæ–¹æ³•æ±‚å‡ºæ•°ç»„æ‰€æœ‰æˆå‘˜çš„å’Œã€‚ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œaæ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªæˆå‘˜1ï¼Œbæ˜¯æ•°ç»„çš„ç¬¬äºŒä¸ªæˆå‘˜2ã€‚ç¬¬äºŒæ¬¡æ‰§è¡Œï¼Œaä¸ºä¸Šä¸€è½®çš„è¿”å›å€¼3ï¼Œbä¸ºç¬¬ä¸‰ä¸ªæˆå‘˜3ã€‚ç¬¬ä¸‰æ¬¡æ‰§è¡Œï¼Œaä¸ºä¸Šä¸€è½®çš„è¿”å›å€¼6ï¼Œbä¸ºç¬¬å››ä¸ªæˆå‘˜4ã€‚ç¬¬å››æ¬¡æ‰§è¡Œï¼Œaä¸ºä¸Šä¸€è½®è¿”å›å€¼10ï¼Œbä¸ºç¬¬äº”ä¸ªæˆå‘˜5ã€‚è‡³æ­¤æ‰€æœ‰æˆå‘˜éå†å®Œæˆï¼Œæ•´ä¸ªæ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯æœ€åä¸€è½®çš„è¿”å›å€¼15ã€‚ reduceæ–¹æ³•å’ŒreduceRightæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚è¯¥å‡½æ•°æ¥å—ä»¥ä¸‹å››ä¸ªå‚æ•°ã€‚ç´¯ç§¯å˜é‡ï¼šé»˜è®¤ä¸ºæ•°ç»„çš„ç¬¬ä¸€ä¸ªæˆå‘˜ï¼›å½“å‰å˜é‡ï¼šé»˜è®¤ä¸ºæ•°ç»„çš„ç¬¬äºŒä¸ªæˆå‘˜ï¼›å½“å‰ä½ç½®ï¼ˆä»0å¼€å§‹ï¼‰ï¼›åŸæ•°ç»„è¿™å››ä¸ªå‚æ•°ä¹‹ä¸­ï¼Œåªæœ‰å‰ä¸¤ä¸ªæ˜¯å¿…é¡»çš„ï¼Œåä¸¤ä¸ªåˆ™æ˜¯å¯é€‰çš„ã€‚å¦‚æœè¦å¯¹ç´¯ç§¯å˜é‡æŒ‡å®šåˆå€¼ï¼Œå¯ä»¥æŠŠå®ƒæ”¾åœ¨reduceæ–¹æ³•å’ŒreduceRightæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚ 1234[1, 2, 3, 4, 5].reduce(function (a, b) { return a + b;}, 10);//25 ä¸Šé¢ä»£ç æŒ‡å®šå‚æ•°açš„åˆå€¼ä¸º10ï¼Œæ‰€ä»¥æ•°ç»„ä»10å¼€å§‹ç´¯åŠ ï¼Œæœ€ç»ˆç»“æœä¸º25ã€‚æ³¨æ„ï¼Œè¿™æ—¶bæ˜¯ä»æ•°ç»„çš„ç¬¬ä¸€ä¸ªæˆå‘˜å¼€å§‹éå†ã€‚ä¸Šé¢çš„ç¬¬äºŒä¸ªå‚æ•°ç›¸å½“äºè®¾å®šäº†é»˜è®¤å€¼ï¼Œå¤„ç†ç©ºæ•°ç»„æ—¶å°¤å…¶æœ‰ç”¨ã€‚ 1234567function add(prev, cur) { return prev + cur;}[].reduce(add);//TypeError: Reduce of empty array with no initial value[].reduce(add, 1);//1 ä¸Šé¢ä»£ç ä¸­ï¼Œç”±äºç©ºæ•°ç»„å–ä¸åˆ°åˆå§‹å€¼ï¼Œreduceæ–¹æ³•ä¼šæŠ¥é”™ã€‚è¿™æ—¶ï¼ŒåŠ ä¸Šç¬¬äºŒä¸ªå‚æ•°ï¼Œå°±èƒ½ä¿è¯æ€»æ˜¯ä¼šè¿”å›ä¸€ä¸ªå€¼ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªreduceRightæ–¹æ³•çš„ä¾‹å­ã€‚ 12345function subtract(prev, cur) { return prev - cur;}[3, 2, 1].reduce(subtract); //0[3, 2, 1].reduceRight(subtract); //-4 ä¸Šé¢ä»£ç ä¸­ï¼Œreduceæ–¹æ³•ç›¸å½“äº3å‡å»2å†å‡å»1ï¼ŒreduceRightæ–¹æ³•ç›¸å½“äº1å‡å»2å†å‡å»3ã€‚ ç”±äºè¿™ä¸¤ä¸ªæ–¹æ³•ä¼šéå†æ•°ç»„ï¼Œæ‰€ä»¥å®é™…ä¸Šè¿˜å¯ä»¥ç”¨æ¥åšä¸€äº›éå†ç›¸å…³çš„æ“ä½œã€‚æ¯”å¦‚ï¼Œæ‰¾å‡ºå­—ç¬¦é•¿åº¦æœ€é•¿çš„æ•°ç»„æˆå‘˜ã€‚ 123456function findLongest(entries) { return entries.reduce(function (longest, entry) { return entry.length &gt; longest.length ? entry : longest;}, '');}findLongest(['aaa', 'bb', 'c']); //\"aaa\" ä¸Šé¢ä»£ç ä¸­ï¼Œreduceçš„å‚æ•°å‡½æ•°ä¼šå°†å­—ç¬¦é•¿åº¦è¾ƒé•¿çš„é‚£ä¸ªæ•°ç»„æˆå‘˜ï¼Œä½œä¸ºç´¯ç§¯å€¼ã€‚è¿™å¯¼è‡´éå†æ‰€æœ‰æˆå‘˜ä¹‹åï¼Œç´¯ç§¯å€¼å°±æ˜¯å­—ç¬¦é•¿åº¦æœ€é•¿çš„é‚£ä¸ªæˆå‘˜ã€‚ indexOfã€lastIndexOfindexOfæ–¹æ³•è¿”å›ç»™å®šå…ƒç´ åœ¨æ•°ç»„ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰å‡ºç°åˆ™è¿”å›-1ã€‚ 123var a = ['a', 'b', 'c'];a.indexOf('b'); //1a.indexOf('y'); //-1 indexOfæ–¹æ³•è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨ç¤ºæœç´¢çš„å¼€å§‹ä½ç½®ã€‚ 1['a', 'b', 'c'].indexOf('a', 1); //-1 ä¸Šé¢ä»£ç ä»1å·ä½ç½®å¼€å§‹æœç´¢å­—ç¬¦aï¼Œç»“æœä¸º-1ï¼Œè¡¨ç¤ºæ²¡æœ‰æœç´¢åˆ°ã€‚ lastIndexOfæ–¹æ³•è¿”å›ç»™å®šå…ƒç´ åœ¨æ•°ç»„ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰å‡ºç°åˆ™è¿”å›-1ã€‚ 123var a = [2, 5, 9, 2];a.lastIndexOf(2); //3a.lastIndexOf(7); //-1 æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¸èƒ½ç”¨æ¥æœç´¢NaNçš„ä½ç½®ï¼Œå³å®ƒä»¬æ— æ³•ç¡®å®šæ•°ç»„æˆå‘˜æ˜¯å¦åŒ…å«NaNã€‚ 12[NaN].indexOf(NaN); //-1[NaN].lastIndexOf(NaN); //-1 è¿™æ˜¯å› ä¸ºè¿™ä¸¤ä¸ªæ–¹æ³•å†…éƒ¨ï¼Œä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ===ï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œè€ŒNaNæ˜¯å”¯ä¸€ä¸€ä¸ªä¸ç­‰äºè‡ªèº«çš„å€¼ã€‚ ç»“æŸè¯­ArrayçŸ¥è¯†æ¸…å•å°†ä¸å®šæ—¶æ›´æ–°æ‰€åŒ…å«çš„çŸ¥è¯†ï¼Œå¦‚æœæœ‰ä¹¦å†™é”™è¯¯è¯·æŒ‡æ­£~ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://lry61.cn/blog/tags/å‰ç«¯/"}]},{"title":"æ¬¢è¿æ¥åˆ°ç‹—å­èµ–çš„åšå®¢","date":"2019-08-22T07:14:46.311Z","path":"/posts/fbf759eb/","text":"æ¬¢è¿æ¥åˆ°ç‹—å­èµ–çš„åšå®¢ ç»ˆäºå¼€é€šäº†è‡ªå·±çš„åšå®¢äº†~å¾ˆä¹…ä¹‹å‰å°±èŒç”Ÿäº†å†™åšå®¢çš„æƒ³æ³•ï¼Œå¥ˆä½•ä¸€ç›´æ²¡æœ‰å®ç°ã€‚å‡ å‘¨å‰åœ¨å­¦ä¹ æŸä¸ªçŸ¥è¯†ç‚¹çš„æ—¶å€™åˆšå¥½çœ‹åˆ°ä¸€ä¸ªåšä¸»çš„åšå®¢ï¼Œè§‰å¾—å®åœ¨æ˜¯å¤ªå¸å¼•æˆ‘äº†(âœªÏ‰âœª)ï¼Œäºæ˜¯åœ¨ç½‘ä¸Šå‚è€ƒäº†è®¸å¤šæ–¹å¼æ­äº†è¿™ä¸ªåšå®¢ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","tags":[]}]
<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ç‹—å­èµ–çš„åšå®¢</title>
  
  
  <link href="/blog/atom.xml" rel="self"/>
  
  <link href="http://Lry0504.github.io/"/>
  <updated>2019-12-29T15:04:11.555Z</updated>
  <id>http://Lry0504.github.io/</id>
  
  <author>
    <name>ç‹—å­èµ–</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>React Hooksç³»åˆ—ä¹‹useRef</title>
    <link href="http://Lry0504.github.io//posts/10/"/>
    <id>http://Lry0504.github.io//posts/10/</id>
    <published>2019-12-29T14:59:50.490Z</published>
    <updated>2019-12-29T15:04:11.555Z</updated>
    
    <content type="html"><![CDATA[<p>React Hooksç³»åˆ—ä¹‹useRef</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨<a href="https://lry0504.github.io/blog/posts/5/#%E2%80%BB-useRef">React Hooksåˆæ¢</a>ä¸­æˆ‘ä»¬æåˆ°ï¼šå¦‚æœä½ å°†refä»¥<code>&lt;div ref={myRef}&gt;&lt;/div&gt;</code>è¿™ç§æ–¹å¼ä¼ å…¥ç»„ä»¶ï¼Œåˆ™æ— è®ºè¯¥èŠ‚ç‚¹å¦‚ä½•æ”¹å˜ï¼ŒReactéƒ½ä¼šå°†refå¯¹è±¡çš„<code>.current</code>å±æ€§è®¾ç½®ä¸ºå¯¹åº”çš„DOMèŠ‚ç‚¹ã€‚</p><blockquote><p>æ³¨æ„ï¼Œå½“refå¯¹è±¡å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒuseRefå¹¶ä¸ä¼šé€šçŸ¥ä½ ã€‚å˜æ›´.currentå±æ€§ä¸ä¼šå¼•å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚å¦‚æœæƒ³è¦åœ¨Reactç»‘å®šæˆ–è§£ç»‘DOMèŠ‚ç‚¹çš„refæ—¶è¿è¡ŒæŸäº›ä»£ç ï¼Œåˆ™éœ€è¦ä½¿ç”¨å›è°ƒrefæ¥å®ç°ã€‚</p></blockquote><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/react%20hook/useRef0.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><h3 id="åªåœ¨æ›´æ–°æ—¶è¿è¡Œeffect"><a href="#åªåœ¨æ›´æ–°æ—¶è¿è¡Œeffect" class="headerlink" title="åªåœ¨æ›´æ–°æ—¶è¿è¡Œeffect"></a>åªåœ¨æ›´æ–°æ—¶è¿è¡Œeffect</h3><p>è¿™æ˜¯ä¸ªæ¯”è¾ƒç½•è§çš„åœºæ™¯ã€‚å¦‚æœä½ éœ€è¦å®ç°çš„è¯ï¼Œä½ å¯ä»¥<strong>ä½¿ç”¨ä¸€ä¸ªå¯å˜çš„ref</strong>æ‰‹åŠ¨å­˜å‚¨ä¸€ä¸ªå¸ƒå°”å€¼æ¥è¡¨ç¤ºæ˜¯é¦–æ¬¡æ¸²æŸ“è¿˜æ˜¯åç»­æ¸²æŸ“ï¼Œç„¶ååœ¨ä½ çš„effecté‡Œæ£€æŸ¥è¿™ä¸ªæ ‡è¯†ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/react%20hook/useRef1.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>å¦‚æœæˆ‘ä»¬æŒ‰ç…§ä¸‹é¢æ“ä½œï¼š</p><ol><li>æ‰“å¼€æ§åˆ¶å°ï¼ŒæŸ¥çœ‹æ§åˆ¶å°ä¿¡æ¯</li><li>ç‚¹å‡»æŒ‰é’®ï¼ŒæŸ¥çœ‹æ§åˆ¶å°ä¿¡æ¯</li><li>å†æ¬¡ç‚¹å‡»æŒ‰é’®ï¼ŒæŸ¥çœ‹æ§åˆ¶å°ä¿¡æ¯<br>æˆ‘ä»¬ä¼šå‘ç°ï¼Œæ­¤æ—¶çš„effectåªåœ¨é‡æ–°æ¸²æŸ“çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œã€‚<a href="https://codesandbox.io/s/useref-koj06" target="_blank" rel="noopener">è‡ªå·±è¯•ä¸€è¯•</a></li></ol><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/react%20hook/useRef1.gif" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>ä½ ä¹Ÿå¯ä»¥å°†å®ƒæŠ½å–æˆè‡ªå®šä¹‰Hookï¼š</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/react%20hook/useRef2.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>é‡å¤ä¸Šé¢çš„æ“ä½œï¼Œä¼šäº§ç”Ÿä¸‹é¢çš„ç»“æœã€‚<a href="https://codesandbox.io/s/useref-6utd6" target="_blank" rel="noopener">è‡ªå·±è¯•ä¸€è¯•</a></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/react%20hook/useRef2.gif" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h3 id="æ¸²æŸ“å‘¨æœŸé—´å…±äº«æ•°æ®çš„å­˜å‚¨"><a href="#æ¸²æŸ“å‘¨æœŸé—´å…±äº«æ•°æ®çš„å­˜å‚¨" class="headerlink" title="æ¸²æŸ“å‘¨æœŸé—´å…±äº«æ•°æ®çš„å­˜å‚¨"></a>æ¸²æŸ“å‘¨æœŸé—´å…±äº«æ•°æ®çš„å­˜å‚¨</h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸ªéœ€æ±‚ï¼šéœ€è¦åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œæ¯éš”ä¸€ç§’è®©countåŠ 1ï¼›å½“countå¤§äºç­‰äº5æ—¶ï¼Œæ¸…é™¤è¿™ä¸ªå®šæ—¶å™¨ã€‚<br>æˆ‘ä»¬å¾ˆå®¹æ˜“å†™å‡ºè¿™æ ·çš„ä»£ç ï¼š</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/react%20hook/useRef3.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p><a href="https://codesandbox.io/s/useref3-yoiup" target="_blank" rel="noopener">è¿è¡Œä¸Šé¢çš„ä»£ç </a>ï¼Œå½“countç­‰äº5çš„æ—¶å€™å¹¶æ²¡æœ‰åœæ­¢ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/react%20hook/useRef3.gif" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>å› ä¸ºåœ¨ç¬¬äºŒä¸ªeffectçš„clearIntervalä¸­ï¼Œtimerå¹¶ä¸æ˜¯setIntervalèµ‹å€¼çš„é‚£ä¸ªäº†ï¼Œæ¯æ¬¡æ¸²æŸ“ï¼Œç»„ä»¶éƒ½ä¼šé‡ç½®å®ƒã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨useRefæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/react%20hook/useRef4.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>ä½¿ç”¨useRefåˆ›å»ºä¸€ä¸ªtimerï¼Œå°†setIntervalè¿”å›çš„ç»“æœèµ‹å€¼ç»™timerçš„currentå±æ€§ã€‚ä¾¿èƒ½å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœäº†ã€‚<a href="https://codesandbox.io/s/useref4-zmgz3" target="_blank" rel="noopener">è‡ªå·±è¯•ä¸€è¯•</a></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/react%20hook/useRef4.gif" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><blockquote><p>å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£~</p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;React Hooksç³»åˆ—ä¹‹useRef&lt;/p&gt;
    
    </summary>
    
      <category term="React" scheme="http://Lry0504.github.io/categories/React/"/>
    
    
      <category term="å‰ç«¯" scheme="http://Lry0504.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>React Hooksç³»åˆ—ä¹‹useContext</title>
    <link href="http://Lry0504.github.io//posts/9/"/>
    <id>http://Lry0504.github.io//posts/9/</id>
    <published>2019-12-26T08:15:16.147Z</published>
    <updated>2019-12-26T08:31:02.005Z</updated>
    
    <content type="html"><![CDATA[<p>React Hooksç³»åˆ—ä¹‹useContext</p><a id="more"></a><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/react%20hook/useContext.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨äº†è§£useContextä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸‹<a href="https://zh-hans.reactjs.org/docs/context.html" target="_blank" rel="noopener">Reactä¸­çš„Context</a>ã€‚</p><blockquote><p>Contextæä¾›äº†ä¸€ä¸ªæ— éœ€ä¸ºæ¯å±‚ç»„ä»¶æ‰‹åŠ¨æ·»åŠ propsï¼Œå°±èƒ½åœ¨ç»„ä»¶æ ‘é—´è¿›è¡Œæ•°æ®ä¼ é€’çš„æ–¹æ³•ã€‚</p></blockquote><p>åœ¨ä¸€ä¸ªå…¸å‹çš„Reactåº”ç”¨ä¸­ï¼Œæ•°æ®æ˜¯é€šè¿‡propså±æ€§è‡ªä¸Šè€Œä¸‹ï¼ˆç”±çˆ¶åˆ°å­ï¼‰å±‚å±‚ä¼ é€’çš„ï¼Œä½†è¿™ç§åšæ³•åœ¨å¤šå±‚ç»„ä»¶åµŒå¥—ä¸­æ˜¾å¾—æå…¶ç¹çã€‚Contextæä¾›äº†ä¸€ç§åœ¨ç»„ä»¶é—´å…±äº«æ­¤ç±»å€¼çš„æ–¹å¼ï¼Œè€Œä¸å¿…æ˜¾å¼åœ°é€šè¿‡ç»„ä»¶æ ‘é€å±‚ä¼ é€’propsã€‚</p><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><h3 id="React-createContext"><a href="#React-createContext" class="headerlink" title="React.createContext"></a>React.createContext</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const myContext = React.createContext(defaultValue);</span><br></pre></td></tr></tbody></table></figure><p>åˆ›å»ºä¸€ä¸ªContextå¯¹è±¡ï¼ˆè¿”å›Providerå’ŒConsumerå¯¹è±¡ï¼‰ã€‚å½“Reactæ¸²æŸ“è®¢é˜…è¿™ä¸ªContextå¯¹è±¡çš„ç»„ä»¶æ—¶ï¼Œç»„ä»¶ä¼šä»ç»„ä»¶æ ‘ä¸­æ‰¾åˆ°ç¦»è‡ªèº«æœ€è¿‘çš„Providerï¼Œè¯»å–å½“å‰çš„contextå€¼ã€‚å¦‚æœç»„ä»¶æ ‘ä¸­æ²¡æœ‰åŒ¹é…åˆ°Providerï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤å€¼defalutValueã€‚</p><h3 id="Context-Provider"><a href="#Context-Provider" class="headerlink" title="Context.Provider"></a>Context.Provider</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyContext.Provider value={...}&gt;</span><br></pre></td></tr></tbody></table></figure><p>Provideræ¥æ”¶ä¸€ä¸ªvalueå±æ€§ï¼Œä¼ é€’ç»™Consumerç»„ä»¶ï¼Œå½“valueå€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå†…éƒ¨çš„æ‰€æœ‰Consumerç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚</p><blockquote><p>æ³¨æ„ï¼šå¦‚æœæ¥å—çš„valueå±æ€§ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™åº”æŠŠvalueçŠ¶æ€æå‡åˆ°stateï¼Œå¦åˆ™æ¯æ¬¡æ¸²æŸ“valueå±æ€§éƒ½ä¼šè¢«èµ‹å€¼ä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¯¼è‡´å­ç»„ä»¶å…¨éƒ¨éƒ½ä¼šé‡æ–°æ¸²æŸ“</p></blockquote><h3 id="Context-Consumer"><a href="#Context-Consumer" class="headerlink" title="Context.Consumer"></a>Context.Consumer</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyContext.Consumer&gt;</span><br><span class="line">{value =&gt; /* åŸºäºcontextå€¼è¿›è¡Œæ¸²æŸ“*/}</span><br><span class="line">&lt;/MyContext.Consumer&gt;</span><br></pre></td></tr></tbody></table></figure><p>å‡½æ•°ç»„ä»¶ä¹Ÿå¯ä»¥è®¢é˜…Contextå¯¹è±¡ï¼Œä½†éœ€è¦å‡½æ•°ä½œä¸ºå­å…ƒç´ ã€‚è¿™ä¸ªå‡½æ•°æ¥æ”¶å½“å‰çš„contextå€¼ï¼Œè¿”å›ä¸€ä¸ªReactèŠ‚ç‚¹ã€‚ä¼ é€’ç»™å‡½æ•°çš„valueå€¼ç­‰åŒäºå¾€ä¸Šç»„ä»¶æ ‘ç¦»è¿™ä¸ªcontextæœ€è¿‘çš„Provideræä¾›çš„valueå€¼ã€‚å¦‚æœæ²¡æœ‰å¯¹åº”çš„Providerï¼Œvalueå‚æ•°ç­‰åŒäºä¼ é€’ç»™createContext()çš„defaultValueã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const MyContext = React.createContext();</span><br><span class="line">function App() {</span><br><span class="line">  return (</span><br><span class="line">    &lt;MyContext.Provider value={"lry"}&gt;</span><br><span class="line">      &lt;Child /&gt;</span><br><span class="line">    &lt;/MyContext.Provider&gt;</span><br><span class="line">  );</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">function Child() {</span><br><span class="line">  const value = useContext(MyContext);</span><br><span class="line">  return &lt;div&gt;My name is {value}&lt;/div&gt;;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><a href="https://codesandbox.io/s/context-l9ohh" target="_blank" rel="noopener">ä¸€èµ·è¯•ä¸€è¯•</a></p><h3 id="ä½¿ç”¨useContext"><a href="#ä½¿ç”¨useContext" class="headerlink" title="ä½¿ç”¨useContext"></a>ä½¿ç”¨useContext</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const value = useContext(MyContext);</span><br></pre></td></tr></tbody></table></figure><p>æ¥æ”¶ä¸€ä¸ªContextå¯¹è±¡ï¼ˆReact.createContextçš„è¿”å›å€¼ï¼‰å¹¶è¿”å›è¯¥contextçš„å½“å‰å€¼ã€‚å½“å‰çš„contextå€¼ç”±ä¸Šå±‚ç»„ä»¶ä¸­è·ç¦»å½“å‰ç»„ä»¶æœ€è¿‘çš„<code>&lt;MyContext.Provider&gt;</code>çš„value propå†³å®šã€‚<br>å½“ç»„ä»¶ä¸Šå±‚æœ€è¿‘çš„<code>&lt;MyContext.Provider&gt;</code>æ›´æ–°æ—¶ï¼Œè¯¥Hookä¼šè§¦å‘é‡æ¸²æŸ“ï¼Œå¹¶ä½¿ç”¨æœ€æ–°ä¼ é€’ç»™MyContext providerçš„context valueå€¼ã€‚<br><a href="https://codesandbox.io/s/usecontext-cqvxr" target="_blank" rel="noopener">ä½¿ç”¨useContextæ”¹å†™ä¸Šé¢çš„ä¾‹å­</a>ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const MyContext = React.createContext();</span><br><span class="line">function App() {</span><br><span class="line">  return (</span><br><span class="line">    &lt;MyContext.Provider value={"lry"}&gt;</span><br><span class="line">      &lt;Child /&gt;</span><br><span class="line">    &lt;/MyContext.Provider&gt;</span><br><span class="line">  );</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">function Child() {</span><br><span class="line">  const value = useContext(MyContext);</span><br><span class="line">  return &lt;div&gt;My name is {value}&lt;/div&gt;;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><blockquote><p>å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£~</p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;React Hooksç³»åˆ—ä¹‹useContext&lt;/p&gt;
    
    </summary>
    
      <category term="React" scheme="http://Lry0504.github.io/categories/React/"/>
    
    
      <category term="å‰ç«¯" scheme="http://Lry0504.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>React Hooksç³»åˆ—ä¹‹useEffectï¼ˆä¸‰ï¼‰</title>
    <link href="http://Lry0504.github.io//posts/8/"/>
    <id>http://Lry0504.github.io//posts/8/</id>
    <published>2019-12-25T09:02:55.752Z</published>
    <updated>2019-12-25T12:13:38.768Z</updated>
    
    <content type="html"><![CDATA[<p>React Hooksç³»åˆ—ä¹‹useEffectï¼ˆä¸‰ï¼‰</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿˜è®°å¾—æˆ‘ä»¬è¯´è¿‡åŒæ­¥æ‰æ˜¯ç†è§£effectsçš„å¿ƒæ™ºæ¨¡å‹å—ï¼ŸåŒæ­¥çš„ä¸€ä¸ªæœ‰è¶£åœ°æ–¹åœ¨äºä½ é€šå¸¸æƒ³è¦æŠŠåŒæ­¥çš„â€œä¿¡æ¯â€å’ŒçŠ¶æ€è§£è€¦ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä½ åœ¨Google Docsç¼–è¾‘æ–‡æ¡£çš„æ—¶å€™ï¼ŒGoogleå¹¶ä¸ä¼šæŠŠæ•´ç¯‡æ–‡ç« å‘é€ç»™æœåŠ¡å™¨ã€‚é‚£æ ·åšä¼šéå¸¸ä½æ•ˆã€‚ç›¸åçš„ï¼Œå®ƒåªæ˜¯æŠŠä½ çš„ä¿®æ”¹ä»¥ä¸€ç§å½¢å¼å‘é€ç»™æœåŠ¡ç«¯ã€‚</p><p>è™½ç„¶æˆ‘ä»¬effectçš„æƒ…å†µä¸å°½ç›¸åŒï¼Œä½†å¯ä»¥åº”ç”¨ç±»ä¼¼çš„æ€æƒ³ã€‚åªåœ¨effectsä¸­ä¼ é€’æœ€å°çš„ä¿¡æ¯ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚ç±»ä¼¼äºsetCount(c =&gt; c + 1)è¿™æ ·çš„æ›´æ–°å½¢å¼æ¯”setCount(count + 1)ä¼ é€’äº†æ›´å°‘çš„ä¿¡æ¯ï¼Œå› ä¸ºå®ƒä¸å†è¢«å½“å‰çš„countå€¼â€œæ±¡æŸ“â€ã€‚å®ƒåªæ˜¯è¡¨è¾¾äº†ä¸€ç§è¡Œä¸ºï¼ˆâ€œé€’å¢â€ï¼‰ã€‚â€œThinking in Reactâ€ä¹Ÿè®¨è®ºäº†<a href="https://reactjs.org/docs/thinking-in-react.html#step-3-identify-the-minimal-but-complete-representation-of-ui-state" target="_blank" rel="noopener">å¦‚ä½•æ‰¾åˆ°æœ€å°çŠ¶æ€</a>ã€‚åŸåˆ™æ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡ç°åœ¨å…³æ³¨çš„æ˜¯å¦‚ä½•æ›´æ–°ã€‚</p><p>è¡¨è¾¾æ„å›¾ï¼ˆè€Œä¸æ˜¯ç»“æœï¼‰å’ŒGoogle Docs<a href="https://medium.com/@srijancse/how-real-time-collaborative-editing-work-operational-transformation-ac4902d75682" target="_blank" rel="noopener">å¦‚ä½•å¤„ç†</a>å…±åŒç¼–è¾‘å¼‚æ›²åŒå·¥ã€‚è™½ç„¶è¿™ä¸ªç±»æ¯”ç•¥å¾®å»¶ä¼¸äº†ä¸€ç‚¹ï¼Œå‡½æ•°å¼æ›´æ–°åœ¨Reactä¸­æ‰®æ¼”äº†ç±»ä¼¼çš„è§’è‰²ã€‚å®ƒä»¬ç¡®ä¿èƒ½ä»¥æ‰¹é‡åœ°å’Œå¯é¢„æµ‹çš„æ–¹å¼æ¥å¤„ç†å„ç§æºå¤´ï¼ˆäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffectä¸­çš„è®¢é˜…ï¼Œç­‰ç­‰ï¼‰çš„çŠ¶æ€æ›´æ–°ã€‚</p><p>ç„¶è€Œï¼Œå³ä½¿æ˜¯setCount(c =&gt; c + 1)ä¹Ÿå¹¶ä¸å®Œç¾ã€‚å®ƒçœ‹èµ·æ¥æœ‰ç‚¹æ€ªï¼Œå¹¶ä¸”éå¸¸å—é™äºå®ƒèƒ½åšçš„äº‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸¤ä¸ªäº’ç›¸ä¾èµ–çš„çŠ¶æ€ï¼Œæˆ–è€…æˆ‘ä»¬æƒ³åŸºäºä¸€ä¸ªpropæ¥è®¡ç®—ä¸‹ä¸€æ¬¡çš„stateï¼Œå®ƒå¹¶ä¸èƒ½åšåˆ°ã€‚å¹¸è¿çš„æ˜¯ï¼Œ setCount(c =&gt; c + 1)æœ‰ä¸€ä¸ªæ›´å¼ºå¤§çš„å§å¦¹æ¨¡å¼ï¼Œå®ƒçš„åå­—å«useReducerã€‚</p><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><h3 id="è§£è€¦æ¥è‡ªActionsçš„æ›´æ–°"><a href="#è§£è€¦æ¥è‡ªActionsçš„æ›´æ–°" class="headerlink" title="è§£è€¦æ¥è‡ªActionsçš„æ›´æ–°"></a>è§£è€¦æ¥è‡ªActionsçš„æ›´æ–°</h3><p>æˆ‘ä»¬æ¥ä¿®æ”¹ä¸Šé¢çš„ä¾‹å­è®©å®ƒåŒ…å«ä¸¤ä¸ªçŠ¶æ€ï¼šcount å’Œ stepã€‚æˆ‘ä»¬çš„å®šæ—¶å™¨ä¼šæ¯æ¬¡åœ¨countä¸Šå¢åŠ ä¸€ä¸ªstepå€¼ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function Counter() {</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  const [step, setStep] = useState(1);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    const id = setInterval(() =&gt; {</span><br><span class="line">      setCount(c =&gt; c + step);</span><br><span class="line">    }, 1000);</span><br><span class="line">    return () =&gt; clearInterval(id);</span><br><span class="line">  }, [step]);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;h1&gt;{count}&lt;/h1&gt;</span><br><span class="line">      &lt;input value={step} onChange={e =&gt; setStep(Number(e.target.value))} /&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(è¿™é‡Œæ˜¯<a href="https://codesandbox.io/s/zxn70rnkx" target="_blank" rel="noopener">demo</a>)</p><p>æ³¨æ„æˆ‘ä»¬æ²¡æœ‰æ’’è°ã€‚æ—¢ç„¶æˆ‘ä»¬åœ¨effecté‡Œä½¿ç”¨äº†stepï¼Œæˆ‘ä»¬å°±æŠŠå®ƒåŠ åˆ°ä¾èµ–é‡Œã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä»£ç èƒ½è¿è¡Œæ­£ç¡®ã€‚</p><p>è¿™ä¸ªä¾‹å­ç›®å‰çš„è¡Œä¸ºæ˜¯ä¿®æ”¹stepä¼šé‡å¯å®šæ—¶å™¨ - å› ä¸ºå®ƒæ˜¯ä¾èµ–é¡¹ä¹‹ä¸€ã€‚åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œè¿™æ­£æ˜¯ä½ æ‰€éœ€è¦çš„ã€‚æ¸…é™¤ä¸Šä¸€æ¬¡çš„effectç„¶åé‡æ–°è¿è¡Œæ–°çš„effectå¹¶æ²¡æœ‰ä»»ä½•é”™ã€‚é™¤éæˆ‘ä»¬æœ‰å¾ˆå¥½çš„ç†ç”±ï¼Œæˆ‘ä»¬ä¸åº”è¯¥æ”¹å˜è¿™ä¸ªé»˜è®¤è¡Œä¸ºã€‚</p><p>ä¸è¿‡ï¼Œå‡å¦‚æˆ‘ä»¬ä¸æƒ³åœ¨stepæ”¹å˜åé‡å¯å®šæ—¶å™¨ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•ä»effectä¸­ç§»é™¤å¯¹stepçš„ä¾èµ–å‘¢ï¼Ÿ</p><p>å½“ä½ æƒ³æ›´æ–°ä¸€ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸”è¿™ä¸ªçŠ¶æ€æ›´æ–°ä¾èµ–äºå¦ä¸€ä¸ªçŠ¶æ€çš„å€¼æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ç”¨useReducerå»æ›¿æ¢å®ƒä»¬ã€‚</p><p>å½“ä½ å†™ç±»ä¼¼setSomething(something =&gt; â€¦)è¿™ç§ä»£ç çš„æ—¶å€™ï¼Œä¹Ÿè®¸å°±æ˜¯è€ƒè™‘ä½¿ç”¨reducerçš„å¥‘æœºã€‚reducerå¯ä»¥è®©ä½ æŠŠç»„ä»¶å†…å‘ç”Ÿäº†ä»€ä¹ˆ(actions)å’ŒçŠ¶æ€å¦‚ä½•å“åº”å¹¶æ›´æ–°åˆ†å¼€è¡¨è¿°ã€‚</p><p>æˆ‘ä»¬ç”¨ä¸€ä¸ªdispatchä¾èµ–å»æ›¿æ¢effectçš„stepä¾èµ–ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const [state, dispatch] = useReducer(reducer, initialState);</span><br><span class="line">const { count, step } = state;</span><br><span class="line"></span><br><span class="line">useEffect(() =&gt; {</span><br><span class="line">  const id = setInterval(() =&gt; {</span><br><span class="line">    dispatch({ type: 'tick' }); // Instead of setCount(c =&gt; c + step);</span><br><span class="line">  }, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">}, [dispatch]);</span><br></pre></td></tr></tbody></table></figure><p>(æŸ¥çœ‹<a href="https://codesandbox.io/s/xzr480k0np" target="_blank" rel="noopener">demo</a>)</p><p>ä½ å¯èƒ½ä¼šé—®ï¼šâ€œè¿™æ€ä¹ˆå°±æ›´å¥½äº†ï¼Ÿâ€ç­”æ¡ˆæ˜¯<strong>Reactä¼šä¿è¯dispatchåœ¨ç»„ä»¶çš„å£°æ˜å‘¨æœŸå†…ä¿æŒä¸å˜</strong>ã€‚æ‰€ä»¥ä¸Šé¢ä¾‹å­ä¸­ä¸å†éœ€è¦é‡æ–°è®¢é˜…å®šæ—¶å™¨ã€‚</p><p>æˆ‘ä»¬è§£å†³äº†é—®é¢˜!</p><p>ï¼ˆä½ å¯ä»¥ä»ä¾èµ–ä¸­å»é™¤dispatch, setState, å’ŒuseRefåŒ…è£¹çš„å€¼å› ä¸ºReactä¼šç¡®ä¿å®ƒä»¬æ˜¯é™æ€çš„ã€‚ä¸è¿‡ä½ è®¾ç½®äº†å®ƒä»¬ä½œä¸ºä¾èµ–ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ã€‚ï¼‰</p><p>ç›¸æ¯”äºç›´æ¥åœ¨effecté‡Œé¢è¯»å–çŠ¶æ€ï¼Œå®ƒdispatchäº†ä¸€ä¸ªactionæ¥æè¿°å‘ç”Ÿäº†ä»€ä¹ˆã€‚è¿™ä½¿å¾—æˆ‘ä»¬çš„effectå’ŒstepçŠ¶æ€è§£è€¦ã€‚æˆ‘ä»¬çš„effectä¸å†å…³å¿ƒæ€ä¹ˆæ›´æ–°çŠ¶æ€ï¼Œå®ƒåªè´Ÿè´£å‘Šè¯‰æˆ‘ä»¬å‘ç”Ÿäº†ä»€ä¹ˆã€‚æ›´æ–°çš„é€»è¾‘å…¨éƒ½äº¤ç”±reducerå»ç»Ÿä¸€å¤„ç†:</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const initialState = {</span><br><span class="line">  count: 0,</span><br><span class="line">  step: 1,</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">function reducer(state, action) {</span><br><span class="line">  const { count, step } = state;</span><br><span class="line">  if (action.type === 'tick') {</span><br><span class="line">    return { count: count + step, step };</span><br><span class="line">  } else if (action.type === 'step') {</span><br><span class="line">    return { count, step: action.step };</span><br><span class="line">  } else {</span><br><span class="line">    throw new Error();</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(è¿™é‡Œæ˜¯<a href="https://codesandbox.io/s/xzr480k0np" target="_blank" rel="noopener">demo</a>å¦‚æœä½ ä¹‹å‰é”™è¿‡äº†ã€‚)</p><h3 id="ä¸ºä»€ä¹ˆuseReduceræ˜¯Hooksçš„ä½œå¼Šæ¨¡å¼"><a href="#ä¸ºä»€ä¹ˆuseReduceræ˜¯Hooksçš„ä½œå¼Šæ¨¡å¼" class="headerlink" title="ä¸ºä»€ä¹ˆuseReduceræ˜¯Hooksçš„ä½œå¼Šæ¨¡å¼"></a>ä¸ºä»€ä¹ˆuseReduceræ˜¯Hooksçš„ä½œå¼Šæ¨¡å¼</h3><p>æˆ‘ä»¬å·²ç»å­¦ä¹ åˆ°å¦‚ä½•ç§»é™¤effectçš„ä¾èµ–ï¼Œä¸ç®¡çŠ¶æ€æ›´æ–°æ˜¯ä¾èµ–ä¸Šä¸€ä¸ªçŠ¶æ€è¿˜æ˜¯ä¾èµ–å¦ä¸€ä¸ªçŠ¶æ€ã€‚ä½†å‡å¦‚æˆ‘ä»¬éœ€è¦ä¾èµ–propså»è®¡ç®—ä¸‹ä¸€ä¸ªçŠ¶æ€å‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œä¹Ÿè®¸æˆ‘ä»¬çš„APIæ˜¯<code>&lt;Counter step={1} /&gt;</code>ã€‚ç¡®å®šçš„æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ²¡æ³•é¿å…ä¾èµ–props.step ã€‚æ˜¯å—ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œ æˆ‘ä»¬å¯ä»¥é¿å…ï¼æˆ‘ä»¬å¯ä»¥æŠŠreducerå‡½æ•°æ”¾åˆ°ç»„ä»¶å†…å»è¯»å–propsï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function Counter({ step }) {</span><br><span class="line">  const [count, dispatch] = useReducer(reducer, 0);</span><br><span class="line"></span><br><span class="line">  function reducer(state, action) {</span><br><span class="line">    if (action.type === 'tick') {</span><br><span class="line">      return state + step;</span><br><span class="line">    } else {</span><br><span class="line">      throw new Error();</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    const id = setInterval(() =&gt; {</span><br><span class="line">      dispatch({ type: 'tick' });</span><br><span class="line">    }, 1000);</span><br><span class="line">    return () =&gt; clearInterval(id);</span><br><span class="line">  }, [dispatch]);</span><br><span class="line"></span><br><span class="line">  return &lt;h1&gt;{count}&lt;/h1&gt;;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>è¿™ç§æ¨¡å¼ä¼šä½¿ä¸€äº›ä¼˜åŒ–å¤±æ•ˆï¼Œæ‰€ä»¥ä½ åº”è¯¥é¿å…æ»¥ç”¨å®ƒï¼Œä¸è¿‡å¦‚æœä½ éœ€è¦ä½ å®Œå…¨å¯ä»¥åœ¨reduceré‡Œé¢è®¿é—®propsã€‚ï¼ˆè¿™é‡Œæ˜¯<a href="https://codesandbox.io/s/7ypm405o8q" target="_blank" rel="noopener">demo</a>ï¼‰</p><p>å³ä½¿æ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒReactä¹Ÿä¿è¯dispatchåœ¨æ¯æ¬¡æ¸²æŸ“ä¸­éƒ½æ˜¯ä¸€æ ·çš„ã€‚ æ‰€ä»¥ä½ å¯ä»¥åœ¨ä¾èµ–ä¸­å»æ‰å®ƒã€‚å®ƒä¸ä¼šå¼•èµ·effectä¸å¿…è¦çš„é‡å¤æ‰§è¡Œã€‚</p><p>ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼šè¿™æ€ä¹ˆå¯èƒ½ï¼Ÿåœ¨ä¹‹å‰æ¸²æŸ“ä¸­è°ƒç”¨çš„reduceræ€ä¹ˆâ€œçŸ¥é“â€æ–°çš„propsï¼Ÿç­”æ¡ˆæ˜¯å½“ä½ dispatchçš„æ—¶å€™ï¼ŒReactåªæ˜¯è®°ä½äº†action - å®ƒä¼šåœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“ä¸­å†æ¬¡è°ƒç”¨reducerã€‚åœ¨é‚£ä¸ªæ—¶å€™ï¼Œæ–°çš„propså°±å¯ä»¥è¢«è®¿é—®åˆ°ï¼Œè€Œä¸”reducerè°ƒç”¨ä¹Ÿä¸æ˜¯åœ¨effecté‡Œã€‚</p><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘å€¾å‘è®¤ä¸ºuseReduceræ˜¯Hooksçš„â€œä½œå¼Šæ¨¡å¼â€ã€‚å®ƒå¯ä»¥æŠŠæ›´æ–°é€»è¾‘å’Œæè¿°å‘ç”Ÿäº†ä»€ä¹ˆåˆ†å¼€ã€‚ç»“æœæ˜¯ï¼Œè¿™å¯ä»¥å¸®åŠ©æˆ‘ç§»é™¤ä¸å¿…éœ€çš„ä¾èµ–ï¼Œé¿å…ä¸å¿…è¦çš„effectè°ƒç”¨ã€‚</p><h3 id="æŠŠå‡½æ•°ç§»åˆ°Effectsé‡Œ"><a href="#æŠŠå‡½æ•°ç§»åˆ°Effectsé‡Œ" class="headerlink" title="æŠŠå‡½æ•°ç§»åˆ°Effectsé‡Œ"></a>æŠŠå‡½æ•°ç§»åˆ°Effectsé‡Œ</h3><p>ä¸€ä¸ªå…¸å‹çš„è¯¯è§£æ˜¯è®¤ä¸ºå‡½æ•°ä¸åº”è¯¥æˆä¸ºä¾èµ–ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢çš„ä»£ç çœ‹ä¸Šå»å¯ä»¥è¿è¡Œæ­£å¸¸ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() {</span><br><span class="line">  const [data, setData] = useState({ hits: [] });</span><br><span class="line"></span><br><span class="line">  async function fetchData() {</span><br><span class="line">    const result = await axios(</span><br><span class="line">      'https://hn.algolia.com/api/v1/search?query=react',</span><br><span class="line">    );</span><br><span class="line">    setData(result.data);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    fetchData();</span><br><span class="line">  }, []); // Is this okay?</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(<a href="https://codesandbox.io/s/8j4ykjyv0" target="_blank" rel="noopener">è¿™ä¸ªä¾‹å­</a>æ”¹ç¼–è‡ªRobin Wieruchè¿™ç¯‡å¾ˆæ£’çš„æ–‡ç«  â€” <a href="https://www.robinwieruch.de/react-hooks-fetch-data" target="_blank" rel="noopener">ç‚¹å‡»æŸ¥çœ‹</a>ï¼)</p><p>éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ä½†è¿™æ ·åšåœ¨ç»„ä»¶æ—¥æ¸å¤æ‚çš„è¿­ä»£è¿‡ç¨‹ä¸­æˆ‘ä»¬å¾ˆéš¾ç¡®ä¿å®ƒåœ¨å„ç§æƒ…å†µä¸‹è¿˜èƒ½æ­£å¸¸è¿è¡Œã€‚</p><p>æƒ³è±¡ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç åšä¸‹é¢è¿™æ ·çš„åˆ†ç¦»ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªå‡½æ•°çš„ä½“é‡æ˜¯ç°åœ¨çš„äº”å€ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() {</span><br><span class="line">  // Imagine this function is long</span><br><span class="line">  function getFetchUrl() {</span><br><span class="line">    return 'https://hn.algolia.com/api/v1/search?query=react';</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  // Imagine this function is also long</span><br><span class="line">  async function fetchData() {</span><br><span class="line">    const result = await axios(getFetchUrl());</span><br><span class="line">    setData(result.data);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    fetchData();</span><br><span class="line">  }, []);</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ç„¶åæˆ‘ä»¬åœ¨æŸäº›å‡½æ•°å†…ä½¿ç”¨äº†æŸäº›stateæˆ–è€…propï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() {</span><br><span class="line">  const [query, setQuery] = useState('react');</span><br><span class="line"></span><br><span class="line">  // Imagine this function is also long</span><br><span class="line">  function getFetchUrl() {</span><br><span class="line">    return 'https://hn.algolia.com/api/v1/search?query=' + query;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  // Imagine this function is also long</span><br><span class="line">  async function fetchData() {</span><br><span class="line">    const result = await axios(getFetchUrl());</span><br><span class="line">    setData(result.data);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    fetchData();</span><br><span class="line">  }, []);</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å¦‚æœæˆ‘ä»¬å¿˜è®°å»æ›´æ–°ä½¿ç”¨è¿™äº›å‡½æ•°ï¼ˆå¾ˆå¯èƒ½é€šè¿‡å…¶ä»–å‡½æ•°è°ƒç”¨ï¼‰çš„effectsçš„ä¾èµ–ï¼Œæˆ‘ä»¬çš„effectså°±ä¸ä¼šåŒæ­¥propså’Œstateå¸¦æ¥çš„å˜æ›´ã€‚è¿™å½“ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜æœ‰ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚å¦‚æœæŸäº›å‡½æ•°ä»…åœ¨effectä¸­è°ƒç”¨ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬çš„å®šä¹‰ç§»åˆ°effectä¸­ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() {</span><br><span class="line">  // ...</span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    // We moved these functions inside!</span><br><span class="line">    function getFetchUrl() {</span><br><span class="line">      return 'https://hn.algolia.com/api/v1/search?query=react';</span><br><span class="line">    }</span><br><span class="line">    async function fetchData() {</span><br><span class="line">      const result = await axios(getFetchUrl());</span><br><span class="line">      setData(result.data);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    fetchData();</span><br><span class="line">  }, []); // âœ… Deps are OK</span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(è¿™é‡Œæ˜¯<a href="https://codesandbox.io/s/04kp3jwwql" target="_blank" rel="noopener">demo</a>)</p><p>è¿™ä¹ˆåšæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿæˆ‘ä»¬ä¸å†éœ€è¦å»è€ƒè™‘è¿™äº›â€œé—´æ¥ä¾èµ–â€ã€‚æˆ‘ä»¬çš„ä¾èµ–æ•°ç»„ä¹Ÿä¸å†æ’’è°ï¼šåœ¨æˆ‘ä»¬çš„effectä¸­ç¡®å®æ²¡æœ‰å†ä½¿ç”¨ç»„ä»¶èŒƒå›´å†…çš„ä»»ä½•ä¸œè¥¿ã€‚</p><p>å¦‚æœæˆ‘ä»¬åé¢ä¿®æ”¹ getFetchUrlå»ä½¿ç”¨queryçŠ¶æ€ï¼Œæˆ‘ä»¬æ›´å¯èƒ½ä¼šæ„è¯†åˆ°æˆ‘ä»¬æ­£åœ¨effecté‡Œé¢ç¼–è¾‘å®ƒ - å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŠŠqueryæ·»åŠ åˆ°effectçš„ä¾èµ–é‡Œï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() {</span><br><span class="line">  const [query, setQuery] = useState('react');</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    function getFetchUrl() {</span><br><span class="line">      return 'https://hn.algolia.com/api/v1/search?query=' + query;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    async function fetchData() {</span><br><span class="line">      const result = await axios(getFetchUrl());</span><br><span class="line">      setData(result.data);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    fetchData();</span><br><span class="line">  }, [query]); // âœ… Deps are OK</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(è¿™é‡Œæ˜¯<a href="https://codesandbox.io/s/pwm32zx7z7" target="_blank" rel="noopener">demo</a>)</p><p>æ·»åŠ è¿™ä¸ªä¾èµ–ï¼Œæˆ‘ä»¬ä¸ä»…ä»…æ˜¯åœ¨â€œå–æ‚¦Reactâ€ã€‚åœ¨queryæ”¹å˜åå»é‡æ–°è¯·æ±‚æ•°æ®æ˜¯åˆç†çš„ã€‚useEffectçš„è®¾è®¡æ„å›¾å°±æ˜¯è¦å¼ºè¿«ä½ å…³æ³¨æ•°æ®æµçš„æ”¹å˜ï¼Œç„¶åå†³å®šæˆ‘ä»¬çš„effectsè¯¥å¦‚ä½•å’Œå®ƒåŒæ­¥ - è€Œä¸æ˜¯å¿½è§†å®ƒç›´åˆ°æˆ‘ä»¬çš„ç”¨æˆ·é‡åˆ°äº†bugã€‚</p><p>æ„Ÿè°¢eslint-plugin-react-hooks æ’ä»¶çš„exhaustive-depslintè§„åˆ™ï¼Œå®ƒä¼šåœ¨ä½ <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="noopener">ç¼–ç çš„æ—¶å€™å°±åˆ†æeffects</a>å¹¶ä¸”æä¾›å¯èƒ½é—æ¼ä¾èµ–çš„å»ºè®®ã€‚æ¢å¥è¯è¯´ï¼Œæœºå™¨ä¼šå‘Šè¯‰ä½ ç»„ä»¶ä¸­å“ªäº›æ•°æ®æµå˜æ›´æ²¡æœ‰è¢«æ­£ç¡®åœ°å¤„ç†ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://overreacted.io/exhaustive-deps-04a90dcbacb01105d634964880ebed19.gif" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>éå¸¸æ£’ã€‚</p><h3 id="ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åˆ°Effecté‡Œ"><a href="#ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åˆ°Effecté‡Œ" class="headerlink" title="ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åˆ°Effecté‡Œ"></a>ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åˆ°Effecté‡Œ</h3><p>æœ‰æ—¶å€™ä½ å¯èƒ½ä¸æƒ³æŠŠå‡½æ•°ç§»å…¥effecté‡Œã€‚æ¯”å¦‚ï¼Œç»„ä»¶å†…æœ‰å‡ ä¸ªeffectä½¿ç”¨äº†ç›¸åŒçš„å‡½æ•°ï¼Œä½ ä¸æƒ³åœ¨æ¯ä¸ªeffecté‡Œå¤åˆ¶é»è´´ä¸€éè¿™ä¸ªé€»è¾‘ã€‚ä¹Ÿæˆ–è®¸è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªpropã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ä½ åº”è¯¥å¿½ç•¥å¯¹å‡½æ•°çš„ä¾èµ–å—ï¼Ÿæˆ‘ä¸è¿™ä¹ˆè®¤ä¸ºã€‚å†æ¬¡å¼ºè°ƒï¼Œefffectsä¸åº”è¯¥å¯¹å®ƒçš„ä¾èµ–æ’’è°ã€‚é€šå¸¸æˆ‘ä»¬è¿˜æœ‰æ›´å¥½çš„è§£å†³åŠæ³•ã€‚ä¸€ä¸ªå¸¸è§çš„è¯¯è§£æ˜¯ï¼Œâ€œå‡½æ•°ä»æ¥ä¸ä¼šæ”¹å˜â€ã€‚ä½†æ˜¯è¿™ç¯‡æ–‡ç« ä½ è¯»åˆ°ç°åœ¨ï¼Œä½ çŸ¥é“è¿™æ˜¾ç„¶ä¸æ˜¯äº‹å®ã€‚å®é™…ä¸Šï¼Œåœ¨ç»„ä»¶å†…å®šä¹‰çš„å‡½æ•°æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½åœ¨å˜ã€‚</p><p>å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ”¹å˜è¿™ä¸ªäº‹å®æœ¬èº«å°±æ˜¯ä¸ªé—®é¢˜ã€‚ æ¯”å¦‚æœ‰ä¸¤ä¸ªeffectsä¼šè°ƒç”¨ getFetchUrl:</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() {</span><br><span class="line">  function getFetchUrl(query) {</span><br><span class="line">    return 'https://hn.algolia.com/api/v1/search?query=' + query;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    const url = getFetchUrl('react');</span><br><span class="line">    // ... Fetch data and do something ...</span><br><span class="line">  }, []); // ğŸ”´ Missing dep: getFetchUrl</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    const url = getFetchUrl('redux');</span><br><span class="line">    // ... Fetch data and do something ...</span><br><span class="line">  }, []); // ğŸ”´ Missing dep: getFetchUrl</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ å¯èƒ½ä¸æƒ³æŠŠgetFetchUrl ç§»åˆ°effectsä¸­ï¼Œå› ä¸ºä½ æƒ³å¤ç”¨é€»è¾‘ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ å¯¹ä¾èµ–å¾ˆâ€œè¯šå®â€ï¼Œä½ å¯èƒ½ä¼šæ‰åˆ°é™·é˜±é‡Œã€‚æˆ‘ä»¬çš„ä¸¤ä¸ªeffectséƒ½ä¾èµ–getFetchUrlï¼Œè€Œå®ƒæ¯æ¬¡æ¸²æŸ“éƒ½ä¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¾èµ–æ•°ç»„ä¼šå˜å¾—æ— ç”¨ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() {</span><br><span class="line">  // ğŸ”´ Re-triggers all effects on every render</span><br><span class="line">  function getFetchUrl(query) {</span><br><span class="line">    return 'https://hn.algolia.com/api/v1/search?query=' + query;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    const url = getFetchUrl('react');</span><br><span class="line">    // ... Fetch data and do something ...</span><br><span class="line">  }, [getFetchUrl]); // ğŸš§ Deps are correct but they change too often</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    const url = getFetchUrl('redux');</span><br><span class="line">    // ... Fetch data and do something ...</span><br><span class="line">  }, [getFetchUrl]); // ğŸš§ Deps are correct but they change too often</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ä¸€ä¸ªå¯èƒ½çš„è§£å†³åŠæ³•æ˜¯æŠŠgetFetchUrlä»ä¾èµ–ä¸­å»æ‰ã€‚ä½†æ˜¯ï¼Œæˆ‘ä¸è®¤ä¸ºè¿™æ˜¯å¥½çš„è§£å†³æ–¹å¼ã€‚è¿™ä¼šä½¿æˆ‘ä»¬åé¢å¯¹æ•°æ®æµçš„æ”¹å˜å¾ˆéš¾è¢«å‘ç°ä»è€Œå¿˜è®°å»å¤„ç†ã€‚è¿™ä¼šå¯¼è‡´ç±»ä¼¼äºä¸Šé¢â€œå®šæ—¶å™¨ä¸æ›´æ–°å€¼â€çš„é—®é¢˜ã€‚</p><p>ç›¸åçš„ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ›´ç®€å•çš„è§£å†³åŠæ³•ã€‚</p><p>ç¬¬ä¸€ä¸ªï¼Œ å¦‚æœä¸€ä¸ªå‡½æ•°æ²¡æœ‰ä½¿ç”¨ç»„ä»¶å†…çš„ä»»ä½•å€¼ï¼Œä½ åº”è¯¥æŠŠå®ƒæåˆ°ç»„ä»¶å¤–é¢å»å®šä¹‰ï¼Œç„¶åå°±å¯ä»¥è‡ªç”±åœ°åœ¨effectsä¸­ä½¿ç”¨ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// âœ… Not affected by the data flow</span><br><span class="line">function getFetchUrl(query) {</span><br><span class="line">  return 'https://hn.algolia.com/api/v1/search?query=' + query;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">function SearchResults() {</span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    const url = getFetchUrl('react');</span><br><span class="line">    // ... Fetch data and do something ...</span><br><span class="line">  }, []); // âœ… Deps are OK</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    const url = getFetchUrl('redux');</span><br><span class="line">    // ... Fetch data and do something ...</span><br><span class="line">  }, []); // âœ… Deps are OK</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ä½ ä¸å†éœ€è¦æŠŠå®ƒè®¾ä¸ºä¾èµ–ï¼Œå› ä¸ºå®ƒä»¬ä¸åœ¨æ¸²æŸ“èŒƒå›´å†…ï¼Œå› æ­¤ä¸ä¼šè¢«æ•°æ®æµå½±å“ã€‚å®ƒä¸å¯èƒ½çªç„¶æ„å¤–åœ°ä¾èµ–äºpropsæˆ–stateã€‚</p><p>æˆ–è€…ï¼Œ ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒåŒ…è£…æˆ<a href="https://reactjs.org/docs/hooks-reference.html#usecallback" target="_blank" rel="noopener">useCallback Hook</a>:</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() {</span><br><span class="line">  // âœ… Preserves identity when its own deps are the same</span><br><span class="line">  const getFetchUrl = useCallback((query) =&gt; {</span><br><span class="line">    return 'https://hn.algolia.com/api/v1/search?query=' + query;</span><br><span class="line">  }, []);  // âœ… Callback deps are OK</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    const url = getFetchUrl(â€˜reactâ€™);</span><br><span class="line">    // â€¦ Fetch data and do something â€¦</span><br><span class="line">  }, [getFetchUrl]); // âœ… Effect deps are OK</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    const url = getFetchUrl(â€˜reduxâ€™);</span><br><span class="line">    // â€¦ Fetch data and do something â€¦</span><br><span class="line">  }, [getFetchUrl]); // âœ… Effect deps are OK</span><br><span class="line"></span><br><span class="line">  // â€¦</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>useCallbackæœ¬è´¨ä¸Šæ˜¯æ·»åŠ äº†ä¸€å±‚ä¾èµ–æ£€æŸ¥ã€‚å®ƒä»¥å¦ä¸€ç§æ–¹å¼è§£å†³äº†é—®é¢˜ - æˆ‘ä»¬ä½¿å‡½æ•°æœ¬èº«åªåœ¨éœ€è¦çš„æ—¶å€™æ‰æ”¹å˜ï¼Œè€Œä¸æ˜¯å»æ‰å¯¹å‡½æ•°çš„ä¾èµ–ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆè¿™ç§æ–¹å¼æ˜¯æœ‰ç”¨çš„ã€‚ä¹‹å‰ï¼Œæˆ‘ä»¬çš„ä¾‹å­ä¸­å±•ç¤ºäº†ä¸¤ç§æœç´¢ç»“æœï¼ˆæŸ¥è¯¢æ¡ä»¶åˆ†åˆ«ä¸ºâ€™reactâ€™å’Œâ€™reduxâ€™ï¼‰ã€‚ä½†å¦‚æœæˆ‘ä»¬æƒ³æ·»åŠ ä¸€ä¸ªè¾“å…¥æ¡†å…è®¸ä½ è¾“å…¥ä»»æ„çš„æŸ¥è¯¢æ¡ä»¶(query)ã€‚ä¸åŒäºä¼ é€’queryå‚æ•°çš„æ–¹å¼ï¼Œç°åœ¨getFetchUrlä¼šä»çŠ¶æ€ä¸­è¯»å–ã€‚</p><p>æˆ‘ä»¬å¾ˆå¿«å‘ç°å®ƒé—æ¼äº†queryä¾èµ–ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() {</span><br><span class="line">  const [query, setQuery] = useState(â€˜reactâ€™);</span><br><span class="line">  const getFetchUrl = useCallback(() =&gt; { // No query argument</span><br><span class="line">    return â€˜https://hn.algolia.com/api/v1/search?query=â€˜ + query;</span><br><span class="line">  }, []); // ğŸ”´ Missing dep: query</span><br><span class="line">  // â€¦</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å¦‚æœæˆ‘æŠŠqueryæ·»åŠ åˆ°useCallbackçš„ä¾èµ–ä¸­ï¼Œä»»ä½•è°ƒç”¨äº†getFetchUrlçš„effectåœ¨queryæ”¹å˜åéƒ½ä¼šé‡æ–°è¿è¡Œï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() {</span><br><span class="line">  const [query, setQuery] = useState(â€˜reactâ€™);</span><br><span class="line"></span><br><span class="line">  // âœ… Preserves identity until query changes</span><br><span class="line">  const getFetchUrl = useCallback(() =&gt; {</span><br><span class="line">    return â€˜https://hn.algolia.com/api/v1/search?query=â€˜ + query;</span><br><span class="line">  }, [query]);  // âœ… Callback deps are OK</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    const url = getFetchUrl();</span><br><span class="line">    // â€¦ Fetch data and do something â€¦</span><br><span class="line">  }, [getFetchUrl]); // âœ… Effect deps are OK</span><br><span class="line"></span><br><span class="line">  // â€¦</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æˆ‘ä»¬è¦æ„Ÿè°¢useCallbackï¼Œå› ä¸ºå¦‚æœqueryä¿æŒä¸å˜ï¼ŒgetFetchUrlä¹Ÿä¼šä¿æŒä¸å˜ï¼Œæˆ‘ä»¬çš„effectä¹Ÿä¸ä¼šé‡æ–°è¿è¡Œã€‚ä½†æ˜¯å¦‚æœqueryä¿®æ”¹äº†ï¼ŒgetFetchUrlä¹Ÿä¼šéšä¹‹æ”¹å˜ï¼Œå› æ­¤ä¼šé‡æ–°è¯·æ±‚æ•°æ®ã€‚è¿™å°±åƒä½ åœ¨Excelé‡Œä¿®æ”¹äº†ä¸€ä¸ªå•å…ƒæ ¼çš„å€¼ï¼Œå¦ä¸€ä¸ªä½¿ç”¨å®ƒçš„å•å…ƒæ ¼ä¼šè‡ªåŠ¨é‡æ–°è®¡ç®—ä¸€æ ·ã€‚</p><p>è¿™æ­£æ˜¯æ‹¥æŠ±æ•°æ®æµå’ŒåŒæ­¥æ€ç»´çš„ç»“æœã€‚å¯¹äºé€šè¿‡å±æ€§ä»çˆ¶ç»„ä»¶ä¼ å…¥çš„å‡½æ•°è¿™ä¸ªæ–¹æ³•ä¹Ÿé€‚ç”¨ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function Parent() {</span><br><span class="line">  const [query, setQuery] = useState(â€˜reactâ€™);</span><br><span class="line"></span><br><span class="line">  // âœ… Preserves identity until query changes</span><br><span class="line">  const fetchData = useCallback(() =&gt; {</span><br><span class="line">    const url = â€˜https://hn.algolia.com/api/v1/search?query=â€˜ + query;</span><br><span class="line">    // â€¦ Fetch data and return it â€¦</span><br><span class="line">  }, [query]);  // âœ… Callback deps are OK</span><br><span class="line"></span><br><span class="line">  return &lt;Child fetchData={fetchData} /&gt;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">function Child({ fetchData }) {</span><br><span class="line">  let [data, setData] = useState(null);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    fetchData().then(setData);</span><br><span class="line">  }, [fetchData]); // âœ… Effect deps are OK</span><br><span class="line"></span><br><span class="line">  // â€¦</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å› ä¸ºfetchDataåªæœ‰åœ¨Parentçš„queryçŠ¶æ€å˜æ›´æ—¶æ‰ä¼šæ”¹å˜ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„Childåªä¼šåœ¨éœ€è¦çš„æ—¶å€™æ‰å»é‡æ–°è¯·æ±‚æ•°æ®ã€‚</p><h3 id="å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿ"><a href="#å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿ" class="headerlink" title="å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿ"></a>å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿ</h3><p>æœ‰è¶£çš„æ˜¯ï¼Œè¿™ç§æ¨¡å¼åœ¨classç»„ä»¶ä¸­è¡Œä¸é€šï¼Œå¹¶ä¸”è¿™ç§è¡Œä¸é€šæ°åˆ°å¥½å¤„åœ°æ­ç¤ºäº†effectå’Œç”Ÿå‘½å‘¨æœŸèŒƒå¼ä¹‹é—´çš„åŒºåˆ«ã€‚è€ƒè™‘ä¸‹é¢çš„è½¬æ¢ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">class Parent extends Component {</span><br><span class="line">  state = {</span><br><span class="line">    query: â€˜reactâ€™</span><br><span class="line">  };</span><br><span class="line">  fetchData = () =&gt; {</span><br><span class="line">    const url = â€˜https://hn.algolia.com/api/v1/search?query=â€˜ + this.state.query;</span><br><span class="line">    // â€¦ Fetch data and do something â€¦</span><br><span class="line">  };</span><br><span class="line">  render() {</span><br><span class="line">    return &lt;Child fetchData={this.fetchData} /&gt;;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">class Child extends Component {</span><br><span class="line">  state = {</span><br><span class="line">    data: null</span><br><span class="line">  };</span><br><span class="line">  componentDidMount() {</span><br><span class="line">    this.props.fetchData();</span><br><span class="line">  }</span><br><span class="line">  render() {</span><br><span class="line">    // â€¦</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œå°‘æ¥äº†Danï¼Œæˆ‘ä»¬éƒ½çŸ¥é“useEffectå°±åƒcomponentDidMountå’ŒcomponentDidUpdateçš„ç»“åˆï¼Œä½ ä¸èƒ½è€æ˜¯ç ´åè¿™ä¸€æ¡ï¼â€å¥½å§ï¼Œå°±ç®—åŠ äº†componentDidUpdateç…§æ ·æ— ç”¨ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class Child extends Component {</span><br><span class="line">  state = {</span><br><span class="line">    data: null</span><br><span class="line">  };</span><br><span class="line">  componentDidMount() {</span><br><span class="line">    this.props.fetchData();</span><br><span class="line">  }</span><br><span class="line">  componentDidUpdate(prevProps) {</span><br><span class="line">    // ğŸ”´ This condition will never be true</span><br><span class="line">    if (this.props.fetchData !== prevProps.fetchData) {</span><br><span class="line">      this.props.fetchData();</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  render() {</span><br><span class="line">    // â€¦</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å½“ç„¶å¦‚æ­¤ï¼ŒfetchDataæ˜¯ä¸€ä¸ªclassæ–¹æ³•ï¼ï¼ˆæˆ–è€…ä½ ä¹Ÿå¯ä»¥è¯´æ˜¯classå±æ€§ - ä½†è¿™ä¸èƒ½æ”¹å˜ä»€ä¹ˆã€‚ï¼‰å®ƒä¸ä¼šå› ä¸ºçŠ¶æ€çš„æ”¹å˜è€Œä¸åŒï¼Œæ‰€ä»¥this.props.fetchDataå’Œ prevProps.fetchDataå§‹ç»ˆç›¸ç­‰ï¼Œå› æ­¤ä¸ä¼šé‡æ–°è¯·æ±‚ã€‚é‚£æˆ‘ä»¬åˆ æ‰æ¡ä»¶åˆ¤æ–­æ€ä¹ˆæ ·ï¼Ÿ</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">componentDidUpdate(prevProps) {</span><br><span class="line">  this.props.fetchData();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ç­‰ç­‰ï¼Œè¿™æ ·ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½å»è¯·æ±‚ã€‚(æ·»åŠ ä¸€ä¸ªåŠ è½½åŠ¨ç”»å¯èƒ½æ˜¯ä¸€ç§æœ‰è¶£çš„å‘ç°è¿™ç§æƒ…å†µçš„æ–¹å¼ã€‚)ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥ç»‘å®šä¸€ä¸ªç‰¹å®šçš„query?</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">render() {</span><br><span class="line">  return &lt;Child fetchData={this.fetchData.bind(this, this.state.query)} /&gt;;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ä½†è¿™æ ·ä¸€æ¥ï¼Œthis.props.fetchData !== prevProps.fetchDataè¡¨è¾¾å¼æ°¸è¿œæ˜¯trueï¼Œå³ä½¿queryå¹¶æœªæ”¹å˜ã€‚è¿™ä¼šå¯¼è‡´æˆ‘ä»¬æ€»æ˜¯å»è¯·æ±‚ã€‚</p><p>æƒ³è¦è§£å†³è¿™ä¸ªclassç»„ä»¶ä¸­çš„éš¾é¢˜ï¼Œå”¯ä¸€ç°å®å¯è¡Œçš„åŠæ³•æ˜¯ç¡¬ç€å¤´çš®æŠŠqueryæœ¬èº«ä¼ å…¥Childç»„ä»¶ã€‚ Childè™½ç„¶å®é™…å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨è¿™ä¸ªqueryçš„å€¼ï¼Œä½†èƒ½åœ¨å®ƒæ”¹å˜çš„æ—¶å€™è§¦å‘ä¸€æ¬¡é‡æ–°è¯·æ±‚ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">class Parent extends Component {</span><br><span class="line">  state = {</span><br><span class="line">    query: â€˜reactâ€™</span><br><span class="line">  };</span><br><span class="line">  fetchData = () =&gt; {</span><br><span class="line">    const url = â€˜https://hn.algolia.com/api/v1/search?query=â€˜ + this.state.query;</span><br><span class="line">    // â€¦ Fetch data and do something â€¦</span><br><span class="line">  };</span><br><span class="line">  render() {</span><br><span class="line">    return &lt;Child fetchData={this.fetchData} query={this.state.query} /&gt;;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">class Child extends Component {</span><br><span class="line">  state = {</span><br><span class="line">    data: null</span><br><span class="line">  };</span><br><span class="line">  componentDidMount() {</span><br><span class="line">    this.props.fetchData();</span><br><span class="line">  }</span><br><span class="line">  componentDidUpdate(prevProps) {</span><br><span class="line">    if (this.props.query !== prevProps.query) {</span><br><span class="line">      this.props.fetchData();</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  render() {</span><br><span class="line">    // â€¦</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>åœ¨ä½¿ç”¨Reactçš„classç»„ä»¶è¿™ä¹ˆå¤šå¹´åï¼Œæˆ‘å·²ç»å¦‚æ­¤ä¹ æƒ¯äºæŠŠä¸å¿…è¦çš„propsä¼ é€’ä¸‹å»å¹¶ä¸”ç ´åçˆ¶ç»„ä»¶çš„å°è£…ä»¥è‡³äºæˆ‘åœ¨ä¸€å‘¨ä¹‹å‰æ‰æ„è¯†åˆ°æˆ‘ä¸ºä»€ä¹ˆä¸€å®šè¦è¿™æ ·åšã€‚</p><p>åœ¨classç»„ä»¶ä¸­ï¼Œå‡½æ•°å±æ€§æœ¬èº«å¹¶ä¸æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†ã€‚ç»„ä»¶çš„æ–¹æ³•ä¸­åŒ…å«äº†å¯å˜çš„thiså˜é‡å¯¼è‡´æˆ‘ä»¬ä¸èƒ½ç¡®å®šæ— ç–‘åœ°è®¤ä¸ºå®ƒæ˜¯ä¸å˜çš„ã€‚å› æ­¤ï¼Œå³ä½¿æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»æŠŠä¸€å †æ•°æ®ä¼ é€’ä¸‹å»ä»…ä»…æ˜¯ä¸ºäº†åšâ€œdiffâ€ã€‚æˆ‘ä»¬æ— æ³•çŸ¥é“ä¼ å…¥çš„this.props.fetchDataæ˜¯å¦ä¾èµ–çŠ¶æ€ï¼Œå¹¶ä¸”ä¸çŸ¥é“å®ƒä¾èµ–çš„çŠ¶æ€æ˜¯å¦æ”¹å˜äº†ã€‚</p><p>ä½¿ç”¨useCallbackï¼Œå‡½æ•°å®Œå…¨å¯ä»¥å‚ä¸åˆ°æ•°æ®æµä¸­ã€‚æˆ‘ä»¬å¯ä»¥è¯´å¦‚æœä¸€ä¸ªå‡½æ•°çš„è¾“å…¥æ”¹å˜äº†ï¼Œè¿™ä¸ªå‡½æ•°å°±æ”¹å˜äº†ã€‚å¦‚æœæ²¡æœ‰ï¼Œå‡½æ•°ä¹Ÿä¸ä¼šæ”¹å˜ã€‚æ„Ÿè°¢å‘¨åˆ°çš„useCallbackï¼Œå±æ€§æ¯”å¦‚props.fetchDataçš„æ”¹å˜ä¹Ÿä¼šè‡ªåŠ¨ä¼ é€’ä¸‹å»ã€‚</p><p>ç±»ä¼¼çš„ï¼Œ<a href="https://reactjs.org/docs/hooks-reference.html#usememo" target="_blank" rel="noopener">useMemo</a>å¯ä»¥è®©æˆ‘ä»¬å¯¹å¤æ‚å¯¹è±¡åšç±»ä¼¼çš„äº‹æƒ…ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function ColorPicker() {</span><br><span class="line">  // Doesnâ€™t break Childâ€™s shallow equality prop check</span><br><span class="line">  // unless the color actually changes.</span><br><span class="line">  const [color, setColor] = useState(â€˜pinkâ€™);</span><br><span class="line">  const style = useMemo(() =&gt; ({ color }), [color]);</span><br><span class="line">  return &lt;Child style={style} /&gt;;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æˆ‘æƒ³å¼ºè°ƒçš„æ˜¯ï¼Œåˆ°å¤„ä½¿ç”¨useCallbackæ˜¯ä»¶æŒºç¬¨æ‹™çš„äº‹ã€‚å½“æˆ‘ä»¬éœ€è¦å°†å‡½æ•°ä¼ é€’ä¸‹å»å¹¶ä¸”å‡½æ•°ä¼šåœ¨å­ç»„ä»¶çš„effectä¸­è¢«è°ƒç”¨çš„æ—¶å€™ï¼ŒuseCallbackæ˜¯å¾ˆå¥½çš„æŠ€å·§ä¸”éå¸¸æœ‰ç”¨ã€‚æˆ–è€…ä½ æƒ³è¯•å›¾å‡å°‘å¯¹å­ç»„ä»¶çš„è®°å¿†è´Ÿæ‹…ï¼Œä¹Ÿä¸å¦¨ä¸€è¯•ã€‚ä½†æ€»çš„æ¥è¯´Hooksæœ¬èº«èƒ½æ›´å¥½åœ°<a href="https://reactjs.org/docs/hooks-faq.html#how-to-avoid-passing-callbacks-down" target="_blank" rel="noopener">é¿å…ä¼ é€’å›è°ƒå‡½æ•°</a>ã€‚</p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘æ›´å€¾å‘äºæŠŠfetchDataæ”¾åœ¨æˆ‘çš„effecté‡Œï¼ˆå®ƒå¯ä»¥æŠ½ç¦»æˆä¸€ä¸ªè‡ªå®šä¹‰Hookï¼‰æˆ–è€…æ˜¯ä»é¡¶å±‚å¼•å…¥ã€‚æˆ‘æƒ³è®©effectsä¿æŒç®€å•ï¼Œè€Œåœ¨é‡Œé¢è°ƒç”¨å›è°ƒä¼šè®©äº‹æƒ…å˜å¾—å¤æ‚ã€‚ï¼ˆâ€œå¦‚æœæŸä¸ªprops.onCompleteå›è°ƒæ”¹å˜äº†è€Œè¯·æ±‚è¿˜åœ¨è¿›è¡Œä¸­ä¼šæ€ä¹ˆæ ·ï¼Ÿâ€ï¼‰ä½ å¯ä»¥æ¨¡æ‹Ÿclassçš„è¡Œä¸ºä½†é‚£æ ·å¹¶ä¸èƒ½è§£å†³ç«æ€çš„é—®é¢˜ã€‚</p><h3 id="è¯´è¯´ç«æ€"><a href="#è¯´è¯´ç«æ€" class="headerlink" title="è¯´è¯´ç«æ€"></a>è¯´è¯´ç«æ€</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„åœ¨classç»„ä»¶é‡Œå‘è¯·æ±‚çš„ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Article extends Component {</span><br><span class="line">  state = {</span><br><span class="line">    article: null</span><br><span class="line">  };</span><br><span class="line">  componentDidMount() {</span><br><span class="line">    this.fetchData(this.props.id);</span><br><span class="line">  }</span><br><span class="line">  async fetchData(id) {</span><br><span class="line">    const article = await API.fetchArticle(id);</span><br><span class="line">    this.setState({ article });</span><br><span class="line">  }</span><br><span class="line">  // â€¦</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ä½ å¾ˆå¯èƒ½å·²ç»çŸ¥é“ï¼Œä¸Šé¢çš„ä»£ç åŸ‹ä¼äº†ä¸€äº›é—®é¢˜ã€‚å®ƒå¹¶æ²¡æœ‰å¤„ç†æ›´æ–°çš„æƒ…å†µã€‚æ‰€ä»¥ç¬¬äºŒä¸ªä½ èƒ½å¤Ÿåœ¨ç½‘ä¸Šæ‰¾åˆ°çš„ç»å…¸ä¾‹å­æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class Article extends Component {</span><br><span class="line">  state = {</span><br><span class="line">    article: null</span><br><span class="line">  };</span><br><span class="line">  componentDidMount() {</span><br><span class="line">    this.fetchData(this.props.id);</span><br><span class="line">  }</span><br><span class="line">  componentDidUpdate(prevProps) {</span><br><span class="line">    if (prevProps.id !== this.props.id) {</span><br><span class="line">      this.fetchData(this.props.id);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  async fetchData(id) {</span><br><span class="line">    const article = await API.fetchArticle(id);</span><br><span class="line">    this.setState({ article });</span><br><span class="line">  }</span><br><span class="line">  // â€¦</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>è¿™æ˜¾ç„¶å¥½å¤šäº†ï¼ä½†ä¾æ—§æœ‰é—®é¢˜ã€‚æœ‰é—®é¢˜çš„åŸå› æ˜¯è¯·æ±‚ç»“æœè¿”å›çš„é¡ºåºä¸èƒ½ä¿è¯ä¸€è‡´ã€‚æ¯”å¦‚æˆ‘å…ˆè¯·æ±‚ {id: 10}ï¼Œç„¶åæ›´æ–°åˆ°{id: 20}ï¼Œä½†{id: 20}çš„è¯·æ±‚æ›´å…ˆè¿”å›ã€‚è¯·æ±‚æ›´æ—©ä½†è¿”å›æ›´æ™šçš„æƒ…å†µä¼šé”™è¯¯åœ°è¦†ç›–çŠ¶æ€å€¼ã€‚</p><p>è¿™è¢«å«åšç«æ€ï¼Œè¿™åœ¨æ··åˆäº†async / awaitï¼ˆå‡è®¾åœ¨ç­‰å¾…ç»“æœè¿”å›ï¼‰å’Œè‡ªé¡¶å‘ä¸‹æ•°æ®æµçš„ä»£ç ä¸­éå¸¸å…¸å‹ï¼ˆpropså’Œstateå¯èƒ½ä¼šåœ¨asyncå‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­å‘ç”Ÿæ”¹å˜ï¼‰ã€‚</p><p>Effectså¹¶æ²¡æœ‰ç¥å¥‡åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°½ç®¡å®ƒä¼šè­¦å‘Šä½ å¦‚æœä½ ç›´æ¥ä¼ äº†ä¸€ä¸ªasyncå‡½æ•°ç»™effectã€‚ï¼ˆæˆ‘ä»¬ä¼šæ”¹å–„è¿™ä¸ªè­¦å‘Šæ¥æ›´å¥½åœ°è§£é‡Šä½ å¯èƒ½ä¼šé‡åˆ°çš„è¿™äº›é—®é¢˜ã€‚ï¼‰</p><p>å¦‚æœä½ ä½¿ç”¨çš„å¼‚æ­¥æ–¹å¼æ”¯æŒå–æ¶ˆï¼Œé‚£å¤ªæ£’äº†ã€‚ä½ å¯ä»¥ç›´æ¥åœ¨æ¸…é™¤å‡½æ•°ä¸­å–æ¶ˆå¼‚æ­¥è¯·æ±‚ã€‚</p><p>æˆ–è€…ï¼Œæœ€ç®€å•çš„æƒå®œä¹‹è®¡æ˜¯ç”¨ä¸€ä¸ªå¸ƒå°”å€¼æ¥è·Ÿè¸ªå®ƒï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function Article({ id }) {</span><br><span class="line">  const [article, setArticle] = useState(null);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    let didCancel = false;</span><br><span class="line"></span><br><span class="line">    async function fetchData() {</span><br><span class="line">      const article = await API.fetchArticle(id);</span><br><span class="line">      if (!didCancel) {</span><br><span class="line">        setArticle(article);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    fetchData();</span><br><span class="line"></span><br><span class="line">    return () =&gt; {</span><br><span class="line">      didCancel = true;</span><br><span class="line">    };</span><br><span class="line">  }, [id]);</span><br><span class="line"></span><br><span class="line">  // â€¦</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><a href="https://www.robinwieruch.de/react-hooks-fetch-data" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>è®¨è®ºäº†æ›´å¤šå…³äºå¦‚ä½•å¤„ç†é”™è¯¯å’ŒåŠ è½½çŠ¶æ€ï¼Œä»¥åŠæŠ½ç¦»é€»è¾‘åˆ°è‡ªå®šä¹‰çš„Hookã€‚æˆ‘æ¨èä½ è®¤çœŸé˜…è¯»ä¸€ä¸‹å¦‚æœä½ æƒ³å­¦ä¹ æ›´å¤šå…³äºå¦‚ä½•åœ¨Hooksé‡Œè¯·æ±‚æ•°æ®çš„å†…å®¹ã€‚</p><h3 id="æé«˜æ°´å‡†"><a href="#æé«˜æ°´å‡†" class="headerlink" title="æé«˜æ°´å‡†"></a>æé«˜æ°´å‡†</h3><p>åœ¨classç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ€ç»´æ¨¡å‹ä¸­ï¼Œå‰¯ä½œç”¨çš„è¡Œä¸ºå’Œæ¸²æŸ“è¾“å‡ºæ˜¯ä¸åŒçš„ã€‚UIæ¸²æŸ“æ˜¯è¢«propså’Œstateé©±åŠ¨çš„ï¼Œå¹¶ä¸”èƒ½ç¡®ä¿æ­¥è°ƒä¸€è‡´ï¼Œä½†å‰¯ä½œç”¨å¹¶ä¸æ˜¯è¿™æ ·ã€‚è¿™æ˜¯ä¸€ç±»å¸¸è§é—®é¢˜çš„æ¥æºã€‚</p><p>è€Œåœ¨useEffectçš„æ€ç»´æ¨¡å‹ä¸­ï¼Œé»˜è®¤éƒ½æ˜¯åŒæ­¥çš„ã€‚å‰¯ä½œç”¨å˜æˆäº†Reactæ•°æ®æµçš„ä¸€éƒ¨åˆ†ã€‚å¯¹äºæ¯ä¸€ä¸ªuseEffectè°ƒç”¨ï¼Œä¸€æ—¦ä½ å¤„ç†æ­£ç¡®ï¼Œä½ çš„ç»„ä»¶èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†è¾¹ç¼˜æƒ…å†µã€‚</p><p>ç„¶è€Œï¼Œç”¨å¥½useEffectçš„å‰æœŸå­¦ä¹ æˆæœ¬æ›´é«˜ã€‚è¿™å¯èƒ½è®©äººæ°”æ¼ã€‚ç”¨åŒæ­¥çš„ä»£ç å»å¤„ç†è¾¹ç¼˜æƒ…å†µå¤©ç„¶å°±æ¯”è§¦å‘ä¸€æ¬¡ä¸ç”¨å’Œæ¸²æŸ“ç»“æœæ­¥è°ƒä¸€è‡´çš„å‰¯ä½œç”¨æ›´éš¾ã€‚</p><p>è¿™éš¾å…è®©äººæ‹…å¿§å¦‚æœuseEffectæ˜¯ä½ ç°åœ¨ä½¿ç”¨æœ€å¤šçš„å·¥å…·ã€‚ä¸è¿‡ï¼Œç›®å‰å¤§æŠµè¿˜å¤„ç†ä½æ°´å¹³ä½¿ç”¨é˜¶æ®µã€‚å› ä¸ºHookså¤ªæ–°äº†æ‰€ä»¥å¤§å®¶éƒ½è¿˜åœ¨ä½æ°´å¹³åœ°ä½¿ç”¨å®ƒï¼Œå°¤å…¶æ˜¯åœ¨ä¸€äº›æ•™ç¨‹ç¤ºä¾‹ä¸­ã€‚ä½†åœ¨å®è·µä¸­ï¼Œç¤¾åŒºå¾ˆå¯èƒ½å³å°†å¼€å§‹é«˜æ°´å¹³åœ°ä½¿ç”¨Hooksï¼Œå› ä¸ºå¥½çš„APIä¼šæœ‰æ›´å¥½çš„åŠ¨é‡å’Œå†²åŠ²ã€‚</p><p>æˆ‘çœ‹åˆ°ä¸åŒçš„åº”ç”¨åœ¨åˆ›é€ ä»–ä»¬è‡ªå·±çš„Hooksï¼Œæ¯”å¦‚å°è£…äº†åº”ç”¨é‰´æƒé€»è¾‘çš„useFetchæˆ–è€…ä½¿ç”¨theme contextçš„useTheme ã€‚ä½ ä¸€æ—¦æœ‰äº†åŒ…å«è¿™äº›çš„å·¥å…·ç®±ï¼Œä½ å°±ä¸ä¼šé‚£ä¹ˆé¢‘ç¹åœ°ç›´æ¥ä½¿ç”¨useEffectã€‚ä½†æ¯ä¸€ä¸ªåŸºäºå®ƒçš„Hookéƒ½èƒ½ä»å®ƒçš„é€‚åº”èƒ½åŠ›ä¸­å¾—åˆ°ç›Šå¤„ã€‚</p><p>ç›®å‰ä¸ºæ­¢ï¼ŒuseEffectä¸»è¦ç”¨äºæ•°æ®è¯·æ±‚ã€‚ä½†æ˜¯æ•°æ®è¯·æ±‚å‡†ç¡®è¯´å¹¶ä¸æ˜¯ä¸€ä¸ªåŒæ­¥é—®é¢˜ã€‚å› ä¸ºæˆ‘ä»¬çš„ä¾èµ–ç»å¸¸æ˜¯[]æ‰€ä»¥è¿™ä¸€ç‚¹å°¤å…¶æ˜æ˜¾ã€‚é‚£æˆ‘ä»¬ç©¶ç«Ÿåœ¨åŒæ­¥ä»€ä¹ˆï¼Ÿ</p><p>é•¿è¿œæ¥çœ‹ï¼Œ <a href="https://reactjs.org/blog/2018/11/27/react-16-roadmap.html#react-16x-mid-2019-the-one-with-suspense-for-data-fetching" target="_blank" rel="noopener">Suspenseç”¨äºæ•°æ®è¯·æ±‚</a>ä¼šå…è®¸ç¬¬ä¸‰æ–¹åº“é€šè¿‡ç¬¬ä¸€ç­‰çš„é€”å¾„å‘Šè¯‰Reactæš‚åœæ¸²æŸ“ç›´åˆ°æŸäº›å¼‚æ­¥äº‹ç‰©ï¼ˆä»»ä½•ä¸œè¥¿ï¼šä»£ç ï¼Œæ•°æ®ï¼Œå›¾ç‰‡ï¼‰å·²ç»å‡†å¤‡å°±ç»ªã€‚</p><p>å½“Suspenseé€æ¸åœ°è¦†ç›–åˆ°æ›´å¤šçš„æ•°æ®è¯·æ±‚ä½¿ç”¨åœºæ™¯ï¼Œæˆ‘é¢„æ–™useEffectä¼šé€€å±…å¹•åä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºåŒæ­¥propså’Œstateåˆ°æŸäº›å‰¯ä½œç”¨ã€‚ä¸åƒæ•°æ®è¯·æ±‚ï¼Œå®ƒå¯ä»¥å¾ˆå¥½åœ°å¤„ç†è¿™äº›åœºæ™¯å› ä¸ºå®ƒå°±æ˜¯ä¸ºæ­¤è€Œè®¾è®¡çš„ã€‚ä¸è¿‡åœ¨é‚£ä¹‹å‰ï¼Œè‡ªå®šä¹‰çš„Hooksæ¯”å¦‚<a href="https://www.robinwieruch.de/react-hooks-fetch-data" target="_blank" rel="noopener">è¿™å„¿æåˆ°çš„</a>æ˜¯å¤ç”¨æ•°æ®è¯·æ±‚é€»è¾‘å¾ˆå¥½çš„æ–¹å¼ã€‚</p><h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><blockquote><p>åŸæ–‡ä½œè€…ï¼šDan Abramov<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://overreacted.io/a-complete-guide-to-useeffect/" target="_blank" rel="noopener">https://overreacted.io/a-complete-guide-to-useeffect/</a></p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;React Hooksç³»åˆ—ä¹‹useEffectï¼ˆä¸‰ï¼‰&lt;/p&gt;
    
    </summary>
    
      <category term="React" scheme="http://Lry0504.github.io/categories/React/"/>
    
    
      <category term="å‰ç«¯" scheme="http://Lry0504.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>React Hooksç³»åˆ—ä¹‹useEffectï¼ˆäºŒï¼‰</title>
    <link href="http://Lry0504.github.io//posts/7/"/>
    <id>http://Lry0504.github.io//posts/7/</id>
    <published>2019-12-25T05:36:10.603Z</published>
    <updated>2019-12-25T08:35:32.205Z</updated>
    
    <content type="html"><![CDATA[<p>React Hooksç³»åˆ—ä¹‹useEffectï¼ˆäºŒï¼‰</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥æ˜ç¡®åœ°å–Šå‡ºä¸‹é¢é‡è¦çš„äº‹å®ï¼šæ¯ä¸€ä¸ªç»„ä»¶å†…çš„å‡½æ•°ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffectsï¼Œå®šæ—¶å™¨æˆ–è€…APIè°ƒç”¨ç­‰ç­‰ï¼‰ä¼šæ•è·æŸæ¬¡æ¸²æŸ“ä¸­å®šä¹‰çš„propså’Œstateã€‚</p><p>æ‰€ä»¥ä¸‹é¢çš„ä¸¤ä¸ªä¾‹å­æ˜¯ç›¸ç­‰çš„ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function Example(props) {</span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    setTimeout(() =&gt; {</span><br><span class="line">      console.log(props.counter);</span><br><span class="line">    }, 1000);</span><br><span class="line">  });</span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function Example(props) {</span><br><span class="line">  const counter = props.counter;</span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    setTimeout(() =&gt; {</span><br><span class="line">      console.log(counter);</span><br><span class="line">    }, 1000);</span><br><span class="line">  });</span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>åœ¨ç»„ä»¶å†…ä»€ä¹ˆæ—¶å€™å»è¯»å–propsæˆ–è€…stateæ˜¯æ— å…³ç´§è¦çš„ã€‚å› ä¸ºå®ƒä»¬ä¸ä¼šæ”¹å˜ã€‚åœ¨å•æ¬¡æ¸²æŸ“çš„èŒƒå›´å†…ï¼Œpropså’Œstateå§‹ç»ˆä¿æŒä¸å˜ã€‚ï¼ˆè§£æ„èµ‹å€¼çš„propsä½¿å¾—è¿™ä¸€ç‚¹æ›´æ˜æ˜¾ã€‚ï¼‰</p><p>å½“ç„¶ï¼Œæœ‰æ—¶å€™ä½ å¯èƒ½æƒ³åœ¨effectçš„å›è°ƒå‡½æ•°é‡Œè¯»å–æœ€æ–°çš„å€¼è€Œä¸æ˜¯æ•è·çš„å€¼ã€‚æœ€ç®€å•çš„å®ç°æ–¹æ³•æ˜¯ä½¿ç”¨refsï¼Œ<a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>çš„æœ€åä¸€éƒ¨åˆ†ä»‹ç»äº†ç›¸å…³å†…å®¹ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯å½“ä½ æƒ³è¦ä»è¿‡å»æ¸²æŸ“ä¸­çš„å‡½æ•°é‡Œè¯»å–æœªæ¥çš„propså’Œstateï¼Œä½ æ˜¯åœ¨é€†æ½®è€ŒåŠ¨ã€‚è™½ç„¶å®ƒå¹¶æ²¡æœ‰é”™ï¼ˆæœ‰æ—¶å€™å¯èƒ½ä¹Ÿéœ€è¦è¿™æ ·åšï¼‰ï¼Œä½†å®ƒå› ä¸ºæ‰“ç ´äº†é»˜è®¤èŒƒå¼ä¼šä½¿ä»£ç æ˜¾å¾—ä¸å¤Ÿâ€œå¹²å‡€â€ã€‚è¿™æ˜¯æˆ‘ä»¬æœ‰æ„ä¸ºä¹‹çš„ï¼Œå› ä¸ºå®ƒèƒ½å¸®åŠ©çªå‡ºå“ªäº›ä»£ç æ˜¯è„†å¼±çš„ï¼Œæ˜¯éœ€è¦ä¾èµ–æ—¶é—´æ¬¡åºçš„ã€‚åœ¨classä¸­ï¼Œå¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µå°±æ²¡é‚£ä¹ˆæ˜¾è€Œæ˜“è§äº†ã€‚</p><p>ä¸‹é¢è¿™ä¸ª<a href="https://codesandbox.io/s/rm7z22qnlp" target="_blank" rel="noopener">è®¡æ•°å™¨ç‰ˆæœ¬</a>æ¨¡æ‹Ÿäº†classä¸­çš„è¡Œä¸ºï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Example() {</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  const latestCount = useRef(count);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    // Set the mutable latest value</span><br><span class="line">    latestCount.current = count;</span><br><span class="line">    setTimeout(() =&gt; {</span><br><span class="line">      // Read the mutable latest value</span><br><span class="line">      console.log(`You clicked ${latestCount.current} times`);</span><br><span class="line">    }, 3000);</span><br><span class="line">  });</span><br><span class="line">  // ...</span><br></pre></td></tr></tbody></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://overreacted.io/timeout_counter_refs-78f7948263dd13b023498b23cb99f4fc.gif" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>åœ¨Reactä¸­å»ç›´æ¥ä¿®æ”¹å€¼çœ‹ä¸Šå»æœ‰ç‚¹æ€ªå¼‚ã€‚ç„¶è€Œï¼Œåœ¨classç»„ä»¶ä¸­Reactæ­£æ˜¯è¿™æ ·å»ä¿®æ”¹this.stateçš„ã€‚ä¸åƒæ•è·çš„propså’Œstateï¼Œä½ æ²¡æ³•ä¿è¯åœ¨ä»»æ„ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­è¯»å–çš„latestCount.currentæ˜¯ä¸å˜çš„ã€‚æ ¹æ®å®šä¹‰ï¼Œä½ å¯ä»¥éšæ—¶ä¿®æ”¹å®ƒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä¸æ˜¯é»˜è®¤è¡Œä¸ºï¼Œè€Œæ˜¯éœ€è¦ä½ ä¸»åŠ¨é€‰æ‹©è¿™æ ·åšã€‚</p><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><h3 id="Effectä¸­çš„æ¸…ç†"><a href="#Effectä¸­çš„æ¸…ç†" class="headerlink" title="Effectä¸­çš„æ¸…ç†"></a>Effectä¸­çš„æ¸…ç†</h3><p>åƒ<a href="https://reactjs.org/docs/hooks-effect.html#effects-with-cleanup" target="_blank" rel="noopener">æ–‡æ¡£ä¸­è§£é‡Šçš„</a>, æœ‰äº›effectså¯èƒ½éœ€è¦æœ‰ä¸€ä¸ªæ¸…ç†æ­¥éª¤ã€‚æœ¬è´¨ä¸Šï¼Œå®ƒçš„ç›®çš„æ˜¯æ¶ˆé™¤å‰¯ä½œç”¨ï¼ˆeffect)ï¼Œæ¯”å¦‚å–æ¶ˆè®¢é˜…ã€‚</p><p>æ€è€ƒä¸‹é¢çš„ä»£ç :</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; {</span><br><span class="line">  ChatAPI.subscribeToFriendStatus(props.id, handleStatusChange);</span><br><span class="line">  return () =&gt; {</span><br><span class="line">    ChatAPI.unsubscribeFromFriendStatus(props.id, handleStatusChange);</span><br><span class="line">  };</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p>å‡è®¾ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™propsæ˜¯{id: 10}ï¼Œç¬¬äºŒæ¬¡æ¸²æŸ“çš„æ—¶å€™æ˜¯{id: 20}ã€‚ä½ å¯èƒ½ä¼šè®¤ä¸ºå‘ç”Ÿäº†ä¸‹é¢çš„è¿™äº›äº‹ï¼š</p><ul><li>React æ¸…é™¤äº† {id: 10}çš„effectã€‚</li><li>React æ¸²æŸ“{id: 20}çš„UIã€‚</li><li>React è¿è¡Œ{id: 20}çš„effectã€‚</li></ul><p>(äº‹å®å¹¶ä¸æ˜¯è¿™æ ·ã€‚)</p><p>å¦‚æœä¾èµ–è¿™ç§å¿ƒæ™ºæ¨¡å‹ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºæ¸…é™¤è¿‡ç¨‹â€œçœ‹åˆ°â€çš„æ˜¯æ—§çš„propså› ä¸ºå®ƒæ˜¯åœ¨é‡æ–°æ¸²æŸ“ä¹‹å‰è¿è¡Œçš„ï¼Œæ–°çš„effectâ€œçœ‹åˆ°â€çš„æ˜¯æ–°çš„propså› ä¸ºå®ƒæ˜¯åœ¨é‡æ–°æ¸²æŸ“ä¹‹åè¿è¡Œçš„ã€‚è¿™ç§å¿ƒæ™ºæ¨¡å‹ç›´æ¥æ¥æºäºclassç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¸è¿‡å®ƒå¹¶ä¸ç²¾ç¡®ã€‚è®©æˆ‘ä»¬æ¥ä¸€æ¢ç©¶ç«Ÿã€‚</p><p>Reactåªä¼šåœ¨<a href="https://medium.com/@dan_abramov/this-benchmark-is-indeed-flawed-c3d6b5b6f97f" target="_blank" rel="noopener">æµè§ˆå™¨ç»˜åˆ¶</a>åè¿è¡Œeffectsã€‚è¿™ä½¿å¾—ä½ çš„åº”ç”¨æ›´æµç•…å› ä¸ºå¤§å¤šæ•°effectså¹¶ä¸ä¼šé˜»å¡å±å¹•çš„æ›´æ–°ã€‚Effectçš„æ¸…é™¤åŒæ ·è¢«å»¶è¿Ÿäº†ã€‚<strong>ä¸Šä¸€æ¬¡çš„effectä¼šåœ¨é‡æ–°æ¸²æŸ“åè¢«æ¸…é™¤</strong>ï¼š</p><ul><li>React æ¸²æŸ“{id: 20}çš„UIã€‚</li><li>æµè§ˆå™¨ç»˜åˆ¶ã€‚æˆ‘ä»¬åœ¨å±å¹•ä¸Šçœ‹åˆ°{id: 20}çš„UIã€‚</li><li>React æ¸…é™¤{id: 10}çš„effectã€‚</li><li>React è¿è¡Œ{id: 20}çš„effectã€‚</li></ul><p>ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼šå¦‚æœæ¸…é™¤ä¸Šä¸€æ¬¡çš„effectå‘ç”Ÿåœ¨propså˜æˆ{id: 20}ä¹‹åï¼Œé‚£å®ƒä¸ºä»€ä¹ˆè¿˜èƒ½â€œçœ‹åˆ°â€æ—§çš„{id: 10}ï¼Ÿ</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://overreacted.io/deja_vu-5fe238cf03a21dfa32af624124fcdcff.gif" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>å¼•ç”¨ä¸Šä¸€ç« å¾—åˆ°çš„ç»“è®º:</p><blockquote><p>ç»„ä»¶å†…çš„æ¯ä¸€ä¸ªå‡½æ•°ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffectsï¼Œå®šæ—¶å™¨æˆ–è€…APIè°ƒç”¨ç­‰ç­‰ï¼‰ä¼šæ•è·å®šä¹‰å®ƒä»¬çš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„propså’Œstateã€‚</p></blockquote><p>ç°åœ¨ç­”æ¡ˆæ˜¾è€Œæ˜“è§ã€‚effectçš„æ¸…é™¤å¹¶ä¸ä¼šè¯»å–â€œæœ€æ–°â€çš„propsã€‚å®ƒåªèƒ½è¯»å–åˆ°å®šä¹‰å®ƒçš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„propså€¼ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// First render, props are {id: 10}</span><br><span class="line">function Example() {</span><br><span class="line">  // ...</span><br><span class="line">  useEffect(</span><br><span class="line">    // Effect from first render</span><br><span class="line">    () =&gt; {</span><br><span class="line">      ChatAPI.subscribeToFriendStatus(10, handleStatusChange);</span><br><span class="line">      // Cleanup for effect from first render</span><br><span class="line">      return () =&gt; {</span><br><span class="line">        ChatAPI.unsubscribeFromFriendStatus(10, handleStatusChange);</span><br><span class="line">      };</span><br><span class="line">    }</span><br><span class="line">  );</span><br><span class="line">  // ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// Next render, props are {id: 20}</span><br><span class="line">function Example() {</span><br><span class="line">  // ...</span><br><span class="line">  useEffect(</span><br><span class="line">    // Effect from second render</span><br><span class="line">    () =&gt; {</span><br><span class="line">      ChatAPI.subscribeToFriendStatus(20, handleStatusChange);</span><br><span class="line">      // Cleanup for effect from second render</span><br><span class="line">      return () =&gt; {</span><br><span class="line">        ChatAPI.unsubscribeFromFriendStatus(20, handleStatusChange);</span><br><span class="line">      };</span><br><span class="line">    }</span><br><span class="line">  );</span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ç‹å›½ä¼šå´›èµ·è½¬è€Œå¤å½’å°˜åœŸï¼Œå¤ªé˜³ä¼šè„±è½å¤–å±‚å˜ä¸ºç™½çŸ®æ˜Ÿï¼Œæœ€åçš„æ–‡æ˜ä¹Ÿè¿Ÿæ—©ä¼šç»“æŸã€‚ä½†æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­effectçš„æ¸…é™¤å‡½æ•°åªèƒ½çœ‹åˆ°{id: 10}è¿™ä¸ªpropsã€‚</p><p>è¿™æ­£æ˜¯ä¸ºä»€ä¹ˆReactèƒ½åšåˆ°åœ¨ç»˜åˆ¶åç«‹å³å¤„ç†effects â€” å¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹ä½¿ä½ çš„åº”ç”¨è¿è¡Œæ›´æµç•…ã€‚å¦‚æœä½ çš„ä»£ç éœ€è¦ä¾ç„¶å¯ä»¥è®¿é—®åˆ°è€çš„propsã€‚</p><h3 id="åŒæ­¥ï¼Œ-è€Œéç”Ÿå‘½å‘¨æœŸ"><a href="#åŒæ­¥ï¼Œ-è€Œéç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="åŒæ­¥ï¼Œ è€Œéç”Ÿå‘½å‘¨æœŸ"></a>åŒæ­¥ï¼Œ è€Œéç”Ÿå‘½å‘¨æœŸ</h3><p>æˆ‘æœ€å–œæ¬¢Reactçš„ä¸€ç‚¹æ˜¯å®ƒç»Ÿä¸€æè¿°äº†åˆå§‹æ¸²æŸ“å’Œä¹‹åçš„æ›´æ–°ã€‚è¿™é™ä½äº†ä½ ç¨‹åºçš„<a href="https://overreacted.io/the-bug-o-notation/" target="_blank" rel="noopener">ç†µ</a>ã€‚</p><p>æ¯”å¦‚æˆ‘æœ‰ä¸ªç»„ä»¶åƒä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Greeting({ name }) {</span><br><span class="line">  return (</span><br><span class="line">    &lt;h1 className="Greeting"&gt;</span><br><span class="line">      Hello, {name}</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">  );</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æˆ‘å…ˆæ¸²æŸ“<code>&lt;Greeting name="Dan" /&gt;</code>ç„¶åæ¸²æŸ“<code>&lt;Greeting name="Yuzhi" /&gt;</code>ï¼Œå’Œæˆ‘ç›´æ¥æ¸²æŸ“<code>&lt;Greeting name="Yuzhi" /&gt;</code>å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸­ï¼Œæˆ‘æœ€åçœ‹åˆ°çš„éƒ½æ˜¯â€œHello, Yuzhiâ€ã€‚</p><p>äººä»¬æ€»æ˜¯è¯´ï¼šâ€œé‡è¦çš„æ˜¯æ—…è¡Œè¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ç›®çš„åœ°â€ã€‚åœ¨Reactä¸–ç•Œä¸­ï¼Œæ°å¥½ç›¸åã€‚é‡è¦çš„æ˜¯ç›®çš„ï¼Œè€Œä¸æ˜¯è¿‡ç¨‹ã€‚è¿™å°±æ˜¯JQueryä»£ç ä¸­<code>$.addClass</code>æˆ–<code>$.removeClass</code>è¿™æ ·çš„è°ƒç”¨ï¼ˆè¿‡ç¨‹ï¼‰å’ŒReactä»£ç ä¸­å£°æ˜CSSç±»ååº”è¯¥æ˜¯ä»€ä¹ˆï¼ˆç›®çš„ï¼‰ä¹‹é—´çš„åŒºåˆ«ã€‚</p><p>Reactä¼šæ ¹æ®æˆ‘ä»¬å½“å‰çš„propså’ŒstateåŒæ­¥åˆ°DOMã€‚â€œmountâ€å’Œâ€œupdateâ€ä¹‹äºæ¸²æŸ“å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p><p>ä½ åº”è¯¥ä»¥ç›¸åŒçš„æ–¹å¼å»æ€è€ƒeffectsã€‚useEffectä½¿ä½ èƒ½å¤Ÿæ ¹æ®propså’ŒstateåŒæ­¥React treeä¹‹å¤–çš„ä¸œè¥¿ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function Greeting({ name }) {</span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    document.title = 'Hello, ' + name;</span><br><span class="line">  });</span><br><span class="line">  return (</span><br><span class="line">    &lt;h1 className="Greeting"&gt;</span><br><span class="line">      Hello, {name}</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">  );</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>è¿™å°±æ˜¯å’Œå¤§å®¶ç†ŸçŸ¥çš„mount/update/unmountå¿ƒæ™ºæ¨¡å‹ä¹‹é—´ç»†å¾®çš„åŒºåˆ«ã€‚ç†è§£å’Œå†…åŒ–è¿™ç§åŒºåˆ«æ˜¯éå¸¸é‡è¦çš„ã€‚å¦‚æœä½ è¯•å›¾å†™ä¸€ä¸ªeffectä¼šæ ¹æ®æ˜¯å¦ç¬¬ä¸€æ¬¡æ¸²æŸ“è€Œè¡¨ç°ä¸ä¸€è‡´ï¼Œä½ æ­£åœ¨é€†æ½®è€ŒåŠ¨ã€‚å¦‚æœæˆ‘ä»¬çš„ç»“æœä¾èµ–äºè¿‡ç¨‹è€Œä¸æ˜¯ç›®çš„ï¼Œæˆ‘ä»¬ä¼šåœ¨åŒæ­¥ä¸­çŠ¯é”™ã€‚</p><p>å…ˆæ¸²æŸ“å±æ€§Aï¼ŒBå†æ¸²æŸ“Cï¼Œå’Œç«‹å³æ¸²æŸ“Cå¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚è™½ç„¶ä»–ä»¬å¯èƒ½çŸ­æš‚åœ°ä¼šæœ‰ç‚¹ä¸åŒï¼ˆæ¯”å¦‚è¯·æ±‚æ•°æ®æ—¶ï¼‰ï¼Œä½†æœ€ç»ˆçš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚</p><p>ä¸è¿‡è¯è¯´å›æ¥ï¼Œåœ¨æ¯ä¸€æ¬¡æ¸²æŸ“åéƒ½å»è¿è¡Œæ‰€æœ‰çš„effectså¯èƒ½å¹¶ä¸é«˜æ•ˆã€‚ï¼ˆå¹¶ä¸”åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ— é™å¾ªç¯ã€‚ï¼‰</p><p>æ‰€ä»¥æˆ‘ä»¬è¯¥æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</p><h3 id="å‘Šè¯‰Reactå»æ¯”å¯¹ä½ çš„Effects"><a href="#å‘Šè¯‰Reactå»æ¯”å¯¹ä½ çš„Effects" class="headerlink" title="å‘Šè¯‰Reactå»æ¯”å¯¹ä½ çš„Effects"></a>å‘Šè¯‰Reactå»æ¯”å¯¹ä½ çš„Effects</h3><p>å…¶å®æˆ‘ä»¬å·²ç»ä»Reactå¤„ç†DOMçš„æ–¹å¼ä¸­å­¦ä¹ åˆ°äº†è§£å†³åŠæ³•ã€‚Reactåªä¼šæ›´æ–°DOMçœŸæ­£å‘ç”Ÿæ”¹å˜çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ¸²æŸ“éƒ½å¤§åŠ¨å¹²æˆˆã€‚</p><p>å½“ä½ æŠŠ</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 className="Greeting"&gt;</span><br><span class="line">  Hello, Dan</span><br><span class="line">&lt;/h1&gt;</span><br></pre></td></tr></tbody></table></figure><p>æ›´æ–°åˆ°</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 className="Greeting"&gt;</span><br><span class="line">  Hello, Yuzhi</span><br><span class="line">&lt;/h1&gt;</span><br></pre></td></tr></tbody></table></figure><p>React èƒ½å¤Ÿçœ‹åˆ°ä¸¤ä¸ªå¯¹è±¡:</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const oldProps = {className: 'Greeting', children: 'Hello, Dan'};</span><br><span class="line">const newProps = {className: 'Greeting', children: 'Hello, Yuzhi'};</span><br></pre></td></tr></tbody></table></figure><p>å®ƒä¼šæ£€æµ‹æ¯ä¸€ä¸ªpropsï¼Œå¹¶ä¸”å‘ç°childrenå‘ç”Ÿæ”¹å˜éœ€è¦æ›´æ–°DOMï¼Œä½†classNameå¹¶æ²¡æœ‰ã€‚æ‰€ä»¥å®ƒåªéœ€è¦è¿™æ ·åšï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">domNode.innerText = 'Hello, Yuzhi';</span><br><span class="line">// No need to touch domNode.className</span><br></pre></td></tr></tbody></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹å¼å¤„ç†effectså—ï¼Ÿå¦‚æœèƒ½å¤Ÿåœ¨ä¸éœ€è¦çš„æ—¶å€™é¿å…è°ƒç”¨effectå°±å¤ªå¥½äº†ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çš„ç»„ä»¶å¯èƒ½å› ä¸ºçŠ¶æ€å˜æ›´è€Œé‡æ–°æ¸²æŸ“ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function Greeting({ name }) {</span><br><span class="line">  const [counter, setCounter] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    document.title = 'Hello, ' + name;</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;h1 className="Greeting"&gt;</span><br><span class="line">      Hello, {name}</span><br><span class="line">      &lt;button onClick={() =&gt; setCounter(counter + 1)}&gt;</span><br><span class="line">        Increment</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">  );</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ä½†æ˜¯æˆ‘ä»¬çš„effectå¹¶æ²¡æœ‰ä½¿ç”¨counterè¿™ä¸ªçŠ¶æ€ã€‚æˆ‘ä»¬çš„effectåªä¼šåŒæ­¥nameå±æ€§ç»™document.titleï¼Œä½†nameå¹¶æ²¡æœ‰å˜ã€‚åœ¨æ¯ä¸€æ¬¡counteræ”¹å˜åé‡æ–°ç»™document.titleèµ‹å€¼å¹¶ä¸æ˜¯ç†æƒ³çš„åšæ³•ã€‚</p><p>å¥½äº†ï¼Œé‚£Reactå¯ä»¥åŒºåˆ†effectsçš„ä¸åŒå—ï¼Ÿ</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let oldEffect = () =&gt; { document.title = 'Hello, Dan'; };</span><br><span class="line">let newEffect = () =&gt; { document.title = 'Hello, Dan'; };</span><br><span class="line">// Can React see these functions do the same thing?</span><br></pre></td></tr></tbody></table></figure><p>å¹¶ä¸èƒ½ã€‚Reactå¹¶ä¸èƒ½çŒœæµ‹åˆ°å‡½æ•°åšäº†ä»€ä¹ˆå¦‚æœä¸å…ˆè°ƒç”¨çš„è¯ã€‚ï¼ˆæºç ä¸­å¹¶æ²¡æœ‰åŒ…å«ç‰¹æ®Šçš„å€¼ï¼Œå®ƒä»…ä»…æ˜¯å¼•ç”¨äº†nameå±æ€§ã€‚ï¼‰</p><p>è¿™æ˜¯ä¸ºä»€ä¹ˆä½ å¦‚æœæƒ³è¦é¿å…effectsä¸å¿…è¦çš„é‡å¤è°ƒç”¨ï¼Œä½ å¯ä»¥æä¾›ç»™useEffectä¸€ä¸ªä¾èµ–æ•°ç»„å‚æ•°(deps)ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; {</span><br><span class="line">  document.title = 'Hello, ' + name;</span><br><span class="line">}, [name]); // Our deps</span><br></pre></td></tr></tbody></table></figure><p>è¿™å¥½æ¯”ä½ å‘Šè¯‰Reactï¼šâ€œHeyï¼Œæˆ‘çŸ¥é“ä½ çœ‹ä¸åˆ°è¿™ä¸ªå‡½æ•°é‡Œçš„ä¸œè¥¿ï¼Œä½†æˆ‘å¯ä»¥ä¿è¯åªä½¿ç”¨äº†æ¸²æŸ“ä¸­çš„nameï¼Œåˆ«æ— å…¶ä»–ã€‚â€</p><p>å¦‚æœå½“å‰æ¸²æŸ“ä¸­çš„è¿™äº›ä¾èµ–é¡¹å’Œä¸Šä¸€æ¬¡è¿è¡Œè¿™ä¸ªeffectçš„æ—¶å€™å€¼ä¸€æ ·ï¼Œå› ä¸ºæ²¡æœ‰ä»€ä¹ˆéœ€è¦åŒæ­¥Reactä¼šè‡ªåŠ¨è·³è¿‡è¿™æ¬¡effectï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const oldEffect = () =&gt; { document.title = 'Hello, Dan'; };</span><br><span class="line">const oldDeps = ['Dan'];</span><br><span class="line"></span><br><span class="line">const newEffect = () =&gt; { document.title = 'Hello, Dan'; };</span><br><span class="line">const newDeps = ['Dan'];</span><br><span class="line"></span><br><span class="line">// React can't peek inside of functions, but it can compare deps.</span><br><span class="line">// Since all deps are the same, it doesnâ€™t need to run the new effect.</span><br></pre></td></tr></tbody></table></figure><p>å³ä½¿ä¾èµ–æ•°ç»„ä¸­åªæœ‰ä¸€ä¸ªå€¼åœ¨ä¸¤æ¬¡æ¸²æŸ“ä¸­ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½è·³è¿‡effectçš„è¿è¡Œã€‚è¦åŒæ­¥æ‰€æœ‰ï¼</p><h3 id="å…³äºä¾èµ–é¡¹ä¸è¦å¯¹Reactæ’’è°"><a href="#å…³äºä¾èµ–é¡¹ä¸è¦å¯¹Reactæ’’è°" class="headerlink" title="å…³äºä¾èµ–é¡¹ä¸è¦å¯¹Reactæ’’è°"></a>å…³äºä¾èµ–é¡¹ä¸è¦å¯¹Reactæ’’è°</h3><p>å…³äºä¾èµ–é¡¹å¯¹Reactæ’’è°ä¼šæœ‰ä¸å¥½çš„ç»“æœã€‚ç›´è§‰ä¸Šï¼Œè¿™å¾ˆå¥½ç†è§£ï¼Œä½†æˆ‘æ›¾çœ‹åˆ°å‡ ä¹æ‰€æœ‰ä¾èµ–classå¿ƒæ™ºæ¨¡å‹ä½¿ç”¨useEffectçš„äººéƒ½è¯•å›¾è¿åè¿™ä¸ªè§„åˆ™ã€‚ï¼ˆæˆ‘åˆšå¼€å§‹ä¹Ÿè¿™ä¹ˆå¹²äº†ï¼ï¼‰</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() {</span><br><span class="line">  async function fetchData() {</span><br><span class="line">    // ...</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    fetchData();</span><br><span class="line">  }, []); // Is this okay? Not always -- and there's a better way to write it.</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(å®˜ç½‘çš„<a href="https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="noopener">Hooks FAQ</a>è§£é‡Šäº†åº”è¯¥æ€ä¹ˆåšã€‚ æˆ‘ä»¬åœ¨ä¸‹é¢ä¼šé‡æ–°å›é¡¾è¿™ä¸ªä¾‹å­ã€‚)</p><p>â€œä½†æˆ‘åªæ˜¯æƒ³åœ¨æŒ‚è½½çš„æ—¶å€™è¿è¡Œå®ƒï¼â€ï¼Œä½ å¯èƒ½ä¼šè¯´ã€‚ç°åœ¨åªéœ€è¦è®°ä½ï¼šå¦‚æœä½ è®¾ç½®äº†ä¾èµ–é¡¹ï¼Œeffectä¸­ç”¨åˆ°çš„æ‰€æœ‰ç»„ä»¶å†…çš„å€¼éƒ½è¦åŒ…å«åœ¨ä¾èµ–ä¸­ã€‚è¿™åŒ…æ‹¬propsï¼Œstateï¼Œå‡½æ•° â€” ç»„ä»¶å†…çš„ä»»ä½•ä¸œè¥¿ã€‚</p><p>æœ‰æ—¶å€™ä½ æ˜¯è¿™æ ·åšäº†ï¼Œä½†å¯èƒ½ä¼šå¼•èµ·ä¸€ä¸ªé—®é¢˜ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°æ— é™è¯·æ±‚çš„é—®é¢˜ï¼Œæˆ–è€…socketè¢«é¢‘ç¹åˆ›å»ºçš„é—®é¢˜ã€‚è§£å†³é—®é¢˜çš„æ–¹æ³•ä¸æ˜¯ç§»é™¤ä¾èµ–é¡¹ã€‚æˆ‘ä»¬ä¼šå¾ˆå¿«äº†è§£å…·ä½“çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>ä¸è¿‡åœ¨æˆ‘ä»¬æ·±å…¥è§£å†³æ–¹æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå°è¯•æ›´å¥½åœ°ç†è§£é—®é¢˜ã€‚</p><h3 id="å¦‚æœè®¾ç½®äº†é”™è¯¯çš„ä¾èµ–ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ"><a href="#å¦‚æœè®¾ç½®äº†é”™è¯¯çš„ä¾èµ–ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ" class="headerlink" title="å¦‚æœè®¾ç½®äº†é”™è¯¯çš„ä¾èµ–ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ"></a>å¦‚æœè®¾ç½®äº†é”™è¯¯çš„ä¾èµ–ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</h3><p>å¦‚æœä¾èµ–é¡¹åŒ…å«äº†æ‰€æœ‰effectä¸­ä½¿ç”¨åˆ°çš„å€¼ï¼ŒReactå°±èƒ½çŸ¥é“ä½•æ—¶éœ€è¦è¿è¡Œå®ƒï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; {</span><br><span class="line">  document.title = 'Hello, ' + name;</span><br><span class="line">}, [name]);</span><br></pre></td></tr></tbody></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://overreacted.io/deps-compare-correct-fae247cd068eedbd4b62ba50592d2b3d.gif" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>(ä¾èµ–å‘ç”Ÿäº†å˜æ›´ï¼Œæ‰€ä»¥ä¼šé‡æ–°è¿è¡Œeffectã€‚)</p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬å°†[]è®¾ä¸ºeffectçš„ä¾èµ–ï¼Œæ–°çš„effectå‡½æ•°ä¸ä¼šè¿è¡Œï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; {</span><br><span class="line">  document.title = 'Hello, ' + name;</span><br><span class="line">}, []); // Wrong: name is missing in deps</span><br></pre></td></tr></tbody></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://overreacted.io/deps-compare-wrong-25f75db3f9f57ffe1426912093577445.gif" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>(ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œeffectã€‚)</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé—®é¢˜çœ‹èµ·æ¥æ˜¾è€Œæ˜“è§ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹å¦‚æœä½ è„‘å­é‡Œâ€œè·³å‡ºâ€classç»„ä»¶çš„è§£å†³åŠæ³•ï¼Œä½ çš„ç›´è§‰å¾ˆå¯èƒ½ä¼šæ¬ºéª—ä½ ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æ¥å†™ä¸€ä¸ªæ¯ç§’é€’å¢çš„è®¡æ•°å™¨ã€‚åœ¨Classç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬çš„ç›´è§‰æ˜¯ï¼šâ€œå¼€å¯ä¸€æ¬¡å®šæ—¶å™¨ï¼Œæ¸…é™¤ä¹Ÿæ˜¯ä¸€æ¬¡â€ã€‚è¿™é‡Œæœ‰ä¸€ä¸ª<a href="https://codesandbox.io/s/n5mjzjy9kl" target="_blank" rel="noopener">ä¾‹å­</a>è¯´æ˜æ€ä¹ˆå®ç°å®ƒã€‚å½“æˆ‘ä»¬ç†æ‰€å½“ç„¶åœ°æŠŠå®ƒç”¨useEffectçš„æ–¹å¼ç¿»è¯‘ï¼Œç›´è§‰ä¸Šæˆ‘ä»¬ä¼šè®¾ç½®ä¾èµ–ä¸º[]ã€‚â€œæˆ‘åªæƒ³è¿è¡Œä¸€æ¬¡effectâ€ï¼Œå¯¹å—ï¼Ÿ</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function Counter() {</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    const id = setInterval(() =&gt; {</span><br><span class="line">      setCount(count + 1);</span><br><span class="line">    }, 1000);</span><br><span class="line">    return () =&gt; clearInterval(id);</span><br><span class="line">  }, []);</span><br><span class="line"></span><br><span class="line">  return &lt;h1&gt;{count}&lt;/h1&gt;;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ç„¶è€Œï¼Œè¿™ä¸ªä¾‹å­<a href="https://codesandbox.io/s/91n5z8jo7r" target="_blank" rel="noopener">åªä¼šé€’å¢ä¸€æ¬¡</a>ã€‚å¤©äº†å™œã€‚</p><p>å¦‚æœä½ çš„å¿ƒæ™ºæ¨¡å‹æ˜¯â€œåªæœ‰å½“æˆ‘æƒ³é‡æ–°è§¦å‘effectçš„æ—¶å€™æ‰éœ€è¦å»è®¾ç½®ä¾èµ–â€ï¼Œè¿™ä¸ªä¾‹å­å¯èƒ½ä¼šè®©ä½ äº§ç”Ÿå­˜åœ¨å±æœºã€‚ä½ æƒ³è¦è§¦å‘ä¸€æ¬¡å› ä¸ºå®ƒæ˜¯å®šæ—¶å™¨ â€” ä½†ä¸ºä»€ä¹ˆä¼šæœ‰é—®é¢˜ï¼Ÿ</p><p>å¦‚æœä½ çŸ¥é“ä¾èµ–æ˜¯æˆ‘ä»¬ç»™Reactçš„æš—ç¤ºï¼Œå‘Šè¯‰å®ƒeffectæ‰€æœ‰éœ€è¦ä½¿ç”¨çš„æ¸²æŸ“ä¸­çš„å€¼ï¼Œä½ å°±ä¸ä¼šåƒæƒŠäº†ã€‚effectä¸­ä½¿ç”¨äº†countä½†æˆ‘ä»¬æ’’è°è¯´å®ƒæ²¡æœ‰ä¾èµ–ã€‚å¦‚æœæˆ‘ä»¬è¿™æ ·åšè¿Ÿæ—©ä¼šå‡ºå¹ºè›¾å­ã€‚</p><p>åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œcountæ˜¯0ã€‚å› æ­¤ï¼ŒsetCount(count + 1)åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ç­‰ä»·äºsetCount(0 + 1)ã€‚æ—¢ç„¶æˆ‘ä»¬è®¾ç½®äº†[]ä¾èµ–ï¼Œeffectä¸ä¼šå†é‡æ–°è¿è¡Œï¼Œå®ƒåé¢æ¯ä¸€ç§’éƒ½ä¼šè°ƒç”¨setCount(0 + 1) ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// First render, state is 0</span><br><span class="line">function Counter() {</span><br><span class="line">  // ...</span><br><span class="line">  useEffect(</span><br><span class="line">    // Effect from first render</span><br><span class="line">    () =&gt; {</span><br><span class="line">      const id = setInterval(() =&gt; {</span><br><span class="line">        setCount(0 + 1); // Always setCount(1)</span><br><span class="line">      }, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    },</span><br><span class="line">    [] // Never re-runs</span><br><span class="line">  );</span><br><span class="line">  // ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// Every next render, state is 1</span><br><span class="line">function Counter() {</span><br><span class="line">  // ...</span><br><span class="line">  useEffect(</span><br><span class="line">    // This effect is always ignored because</span><br><span class="line">    // we lied to React about empty deps.</span><br><span class="line">    () =&gt; {</span><br><span class="line">      const id = setInterval(() =&gt; {</span><br><span class="line">        setCount(1 + 1);</span><br><span class="line">      }, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    },</span><br><span class="line">    []</span><br><span class="line">  );</span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æˆ‘ä»¬å¯¹Reactæ’’è°è¯´æˆ‘ä»¬çš„effectä¸ä¾èµ–ç»„ä»¶å†…çš„ä»»ä½•å€¼ï¼Œå¯å®é™…ä¸Šæˆ‘ä»¬çš„effectæœ‰ä¾èµ–ï¼</p><p>æˆ‘ä»¬çš„effectä¾èµ–count - å®ƒæ˜¯ç»„ä»¶å†…çš„å€¼ï¼ˆä¸è¿‡åœ¨effectå¤–é¢å®šä¹‰ï¼‰ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const count = // ...</span><br><span class="line"></span><br><span class="line">useEffect(() =&gt; {</span><br><span class="line">  const id = setInterval(() =&gt; {</span><br><span class="line">    setCount(count + 1);</span><br><span class="line">  }, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">}, []);</span><br></pre></td></tr></tbody></table></figure><p>å› æ­¤ï¼Œè®¾ç½®[]ä¸ºä¾èµ–ä¼šå¼•å…¥ä¸€ä¸ªbugã€‚Reactä¼šå¯¹æ¯”ä¾èµ–ï¼Œå¹¶ä¸”è·³è¿‡åé¢çš„effectï¼š</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://overreacted.io/interval-wrong-29e53bd0c9b7d2ac70d3cd924886b030.gif" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>(ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œeffectã€‚)</p><p>ç±»ä¼¼äºè¿™æ ·çš„é—®é¢˜æ˜¯å¾ˆéš¾è¢«æƒ³åˆ°çš„ã€‚å› æ­¤ï¼Œæˆ‘é¼“åŠ±ä½ å°†è¯šå®åœ°å‘ŠçŸ¥effectä¾èµ–ä½œä¸ºä¸€æ¡ç¡¬æ€§è§„åˆ™ï¼Œå¹¶ä¸”è¦åˆ—å‡ºæ‰€ä»¥ä¾èµ–ã€‚ï¼ˆæˆ‘ä»¬æä¾›äº†ä¸€ä¸ª<a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="noopener">lintè§„åˆ™</a>å¦‚æœä½ æƒ³åœ¨ä½ çš„å›¢é˜Ÿå†…åšç¡¬æ€§è§„å®šã€‚ï¼‰</p><h3 id="ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„æ–¹æ³•"><a href="#ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„æ–¹æ³•" class="headerlink" title="ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„æ–¹æ³•"></a>ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„æ–¹æ³•</h3><p>æœ‰ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„ç­–ç•¥ã€‚ä½ åº”è¯¥ä»ç¬¬ä¸€ç§å¼€å§‹ï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™åº”ç”¨ç¬¬äºŒç§ã€‚</p><p>ç¬¬ä¸€ç§ç­–ç•¥æ˜¯åœ¨ä¾èµ–ä¸­åŒ…å«æ‰€æœ‰effectä¸­ç”¨åˆ°çš„ç»„ä»¶å†…çš„å€¼ã€‚è®©æˆ‘ä»¬åœ¨ä¾èµ–ä¸­åŒ…å«countï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; {</span><br><span class="line">  const id = setInterval(() =&gt; {</span><br><span class="line">    setCount(count + 1);</span><br><span class="line">  }, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">}, [count]);</span><br></pre></td></tr></tbody></table></figure><p>ç°åœ¨ä¾èµ–æ•°ç»„æ­£ç¡®äº†ã€‚è™½ç„¶å®ƒå¯èƒ½ä¸æ˜¯å¤ªç†æƒ³ä½†ç¡®å®è§£å†³äº†ä¸Šé¢çš„é—®é¢˜ã€‚ç°åœ¨ï¼Œæ¯æ¬¡countä¿®æ”¹éƒ½ä¼šé‡æ–°è¿è¡Œeffectï¼Œå¹¶ä¸”å®šæ—¶å™¨ä¸­çš„setCount(count + 1)ä¼šæ­£ç¡®å¼•ç”¨æŸæ¬¡æ¸²æŸ“ä¸­çš„ countå€¼ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// First render, state is 0</span><br><span class="line">function Counter() {</span><br><span class="line">  // ...</span><br><span class="line">  useEffect(</span><br><span class="line">    // Effect from first render</span><br><span class="line">    () =&gt; {</span><br><span class="line">      const id = setInterval(() =&gt; {</span><br><span class="line">        setCount(0 + 1); // setCount(count + 1)</span><br><span class="line">      }, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    },</span><br><span class="line">    [0] // [count]</span><br><span class="line">  );</span><br><span class="line">  // ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// Second render, state is 1</span><br><span class="line">function Counter() {</span><br><span class="line">  // ...</span><br><span class="line">  useEffect(</span><br><span class="line">    // Effect from second render</span><br><span class="line">    () =&gt; {</span><br><span class="line">      const id = setInterval(() =&gt; {</span><br><span class="line">        setCount(1 + 1); // setCount(count + 1)</span><br><span class="line">      }, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    },</span><br><span class="line">    [1] // [count]</span><br><span class="line">  );</span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>è¿™èƒ½<a href="https://codesandbox.io/s/0x0mnlyq8l" target="_blank" rel="noopener">è§£å†³é—®é¢˜</a>ä½†æ˜¯æˆ‘ä»¬çš„å®šæ—¶å™¨ä¼šåœ¨æ¯ä¸€æ¬¡countæ”¹å˜åæ¸…é™¤å’Œé‡æ–°è®¾å®šã€‚è¿™åº”è¯¥ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼š</p><p><a href="https://overreacted.io/interval-rightish-5734271ddfa94d2d65ac6160515e0069.gif" target="_blank" rel="noopener"></a></p><p>(ä¾èµ–å‘ç”Ÿäº†å˜æ›´ï¼Œæ‰€ä»¥ä¼šé‡æ–°è¿è¡Œeffectã€‚)</p><p>ç¬¬äºŒç§ç­–ç•¥æ˜¯ä¿®æ”¹effectå†…éƒ¨çš„ä»£ç ä»¥ç¡®ä¿å®ƒåŒ…å«çš„å€¼åªä¼šåœ¨éœ€è¦çš„æ—¶å€™å‘ç”Ÿå˜æ›´ã€‚æˆ‘ä»¬ä¸æƒ³å‘ŠçŸ¥é”™è¯¯çš„ä¾èµ– - æˆ‘ä»¬åªæ˜¯ä¿®æ”¹effectä½¿å¾—ä¾èµ–æ›´å°‘ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›ç§»é™¤ä¾èµ–çš„å¸¸ç”¨æŠ€å·§ã€‚</p><h3 id="è®©Effectsè‡ªç»™è‡ªè¶³"><a href="#è®©Effectsè‡ªç»™è‡ªè¶³" class="headerlink" title="è®©Effectsè‡ªç»™è‡ªè¶³"></a>è®©Effectsè‡ªç»™è‡ªè¶³</h3><p>æˆ‘ä»¬æƒ³å»æ‰effectçš„countä¾èµ–ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; {</span><br><span class="line">  const id = setInterval(() =&gt; {</span><br><span class="line">    setCount(count + 1);</span><br><span class="line">  }, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">}, [count]);</span><br></pre></td></tr></tbody></table></figure><p>ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦é—®è‡ªå·±ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨countï¼Ÿå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªåœ¨setCountè°ƒç”¨ä¸­ç”¨åˆ°äº†countã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å…¶å®å¹¶ä¸éœ€è¦åœ¨effectä¸­ä½¿ç”¨countã€‚å½“æˆ‘ä»¬æƒ³è¦æ ¹æ®å‰ä¸€ä¸ªçŠ¶æ€æ›´æ–°çŠ¶æ€çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨setStateçš„<a href="https://reactjs.org/docs/hooks-reference.html#functional-updates" target="_blank" rel="noopener">å‡½æ•°å½¢å¼</a>ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; {</span><br><span class="line">  const id = setInterval(() =&gt; {</span><br><span class="line">    setCount(c =&gt; c + 1);</span><br><span class="line">  }, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">}, []);</span><br></pre></td></tr></tbody></table></figure><p>æˆ‘å–œæ¬¢æŠŠç±»ä¼¼è¿™ç§æƒ…å†µç§°ä¸ºâ€œé”™è¯¯çš„ä¾èµ–â€ã€‚æ˜¯çš„ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨effectä¸­å†™äº†setCount(count + 1)æ‰€ä»¥countæ˜¯ä¸€ä¸ªå¿…éœ€çš„ä¾èµ–ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çœŸæ­£æƒ³è¦çš„æ˜¯æŠŠcountè½¬æ¢ä¸ºcount+1ï¼Œç„¶åè¿”å›ç»™Reactã€‚å¯æ˜¯Reactå…¶å®å·²ç»çŸ¥é“å½“å‰çš„countã€‚æˆ‘ä»¬éœ€è¦å‘ŠçŸ¥Reactçš„ä»…ä»…æ˜¯å»é€’å¢çŠ¶æ€ - ä¸ç®¡å®ƒç°åœ¨å…·ä½“æ˜¯ä»€ä¹ˆå€¼ã€‚</p><p>è¿™æ­£æ˜¯setCount(c =&gt; c + 1)åšçš„äº‹æƒ…ã€‚ä½ å¯ä»¥è®¤ä¸ºå®ƒæ˜¯åœ¨ç»™Reactâ€œå‘é€æŒ‡ä»¤â€å‘ŠçŸ¥å¦‚ä½•æ›´æ–°çŠ¶æ€ã€‚è¿™ç§â€œæ›´æ–°å½¢å¼â€åœ¨å…¶ä»–æƒ…å†µä¸‹ä¹Ÿæœ‰å¸®åŠ©ï¼Œæ¯”å¦‚ä½ éœ€è¦<a href="https://overreacted.io/react-as-a-ui-runtime/#batching" target="_blank" rel="noopener">æ‰¹é‡æ›´æ–°</a>ã€‚</p><p>æ³¨æ„æˆ‘ä»¬åšåˆ°äº†ç§»é™¤ä¾èµ–ï¼Œå¹¶ä¸”æ²¡æœ‰æ’’è°ã€‚æˆ‘ä»¬çš„effectä¸å†è¯»å–æ¸²æŸ“ä¸­çš„countå€¼ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://overreacted.io/interval-right-f128ad20c28317ed27a3cb68197fc906.gif" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>(ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œeffectã€‚)</p><p>ä½ å¯ä»¥è‡ªå·±<a href="https://codesandbox.io/s/q3181xz1pj" target="_blank" rel="noopener">è¯•è¯•</a>ã€‚</p><p>å°½ç®¡effectåªè¿è¡Œäº†ä¸€æ¬¡ï¼Œç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­çš„å®šæ—¶å™¨å›è°ƒå‡½æ•°å¯ä»¥å®Œç¾åœ°åœ¨æ¯æ¬¡è§¦å‘çš„æ—¶å€™ç»™Reactå‘é€c =&gt; c + 1æ›´æ–°æŒ‡ä»¤ã€‚å®ƒä¸å†éœ€è¦çŸ¥é“å½“å‰çš„countå€¼ã€‚å› ä¸ºReactå·²ç»çŸ¥é“äº†ã€‚</p><h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><blockquote><p>åŸæ–‡ä½œè€…ï¼šDan Abramov<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://overreacted.io/a-complete-guide-to-useeffect/" target="_blank" rel="noopener">https://overreacted.io/a-complete-guide-to-useeffect/</a></p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;React Hooksç³»åˆ—ä¹‹useEffectï¼ˆäºŒï¼‰&lt;/p&gt;
    
    </summary>
    
      <category term="React" scheme="http://Lry0504.github.io/categories/React/"/>
    
    
      <category term="å‰ç«¯" scheme="http://Lry0504.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>React Hooksç³»åˆ—ä¹‹useEffectï¼ˆä¸€ï¼‰</title>
    <link href="http://Lry0504.github.io//posts/6/"/>
    <id>http://Lry0504.github.io//posts/6/</id>
    <published>2019-12-17T11:47:08.984Z</published>
    <updated>2019-12-25T05:23:56.927Z</updated>
    
    <content type="html"><![CDATA[<p>React Hooksç³»åˆ—ä¹‹useEffectï¼ˆä¸€ï¼‰</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä½ ç”¨Hookså†™äº†ä¸€äº›ç»„ä»¶ï¼Œç”šæˆ–å†™äº†ä¸€ä¸ªå°å‹åº”ç”¨ã€‚ä½ å¯èƒ½å¾ˆæ»¡æ„ï¼Œä½¿ç”¨å®ƒçš„APIå¾ˆèˆ’æœå¹¶ä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è·å¾—äº†ä¸€äº›å°æŠ€å·§ã€‚ä½ ç”šè‡³å¯èƒ½å†™äº†ä¸€äº›<a href="https://reactjs.org/docs/hooks-custom.html" target="_blank" rel="noopener">custom Hooks</a>å»æŠ½ç¦»é‡å¤çš„é€»è¾‘ï¼ˆç²¾ç®€æ‰äº†300è¡Œä»£ç ï¼‰ï¼Œå¹¶ä¸”å¾—æ„åœ°å±•ç¤ºç»™ä½ çš„åŒäº‹çœ‹ï¼Œâ€œå¹²å¾—æ¼‚äº®â€ï¼Œä»–ä»¬å¦‚æ˜¯è¯´ã€‚</p><p>ä½†æœ‰æ—¶å€™å½“ä½ ä½¿ç”¨useEffectä½ æ€»è§‰å¾—å“ªå„¿æœ‰ç‚¹ä¸å¯¹åŠ²ã€‚ä½ ä¼šå˜€å’•ä½ å¯èƒ½é—æ¼äº†ä»€ä¹ˆã€‚å®ƒçœ‹èµ·æ¥åƒclassçš„ç”Ÿå‘½å‘¨æœŸâ€¦ä½†çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿä½ å‘è§‰è‡ªå·±åœ¨é—®ç±»ä¼¼ä¸‹é¢çš„è¿™äº›é—®é¢˜ï¼š</p><ul><li>ğŸ¤” å¦‚ä½•ç”¨useEffectæ¨¡æ‹ŸcomponentDidMountç”Ÿå‘½å‘¨æœŸï¼Ÿ</li><li>ğŸ¤” å¦‚ä½•æ­£ç¡®åœ°åœ¨useEffecté‡Œè¯·æ±‚æ•°æ®ï¼Ÿ[]åˆæ˜¯ä»€ä¹ˆï¼Ÿ</li><li>ğŸ¤” æˆ‘åº”è¯¥æŠŠå‡½æ•°å½“åšeffectçš„ä¾èµ–å—ï¼Ÿ</li><li>ğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šå‡ºç°æ— é™é‡å¤è¯·æ±‚çš„é—®é¢˜ï¼Ÿ</li><li>ğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™åœ¨effecté‡Œæ‹¿åˆ°çš„æ˜¯æ—§çš„stateæˆ–propï¼Ÿ</li></ul><p>å½“æˆ‘åˆšå¼€å§‹ä½¿ç”¨Hooksçš„æ—¶å€™ï¼Œæˆ‘ä¹ŸåŒæ ·è¢«ä¸Šé¢è¿™äº›é—®é¢˜æ‰€å›°æ‰°ã€‚ç”šè‡³å½“æˆ‘å†™æœ€åˆçš„æ–‡æ¡£æ—¶ï¼Œæˆ‘ä¹Ÿå¹¶æ²¡æœ‰æ‰å®åœ°æŒæ¡æŸäº›ç»†èŠ‚ã€‚æˆ‘ç»å†äº†ä¸€äº›â€œå•Šå“ˆâ€çš„å¼€çªæ—¶åˆ»ï¼Œæˆ‘æƒ³æŠŠè¿™äº›åˆ†äº«ç»™ä½ ã€‚</p><p>åœ¨çœ‹ç­”æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¾€åé€€ä¸€æ­¥ã€‚è¿™ç¯‡æ–‡ç« çš„ç›®çš„ä¸æ˜¯ç»™ä½ ä¸€ä¸ªè¦ç‚¹æ¸…å•ï¼Œè€Œæ˜¯æƒ³å¸®ä½ çœŸæ­£åœ°é¢†ä¼šuseEffectã€‚å…¶å®æˆ‘ä»¬å¹¶æ²¡æœ‰å¤ªå¤šéœ€è¦å­¦ä¹ çš„ï¼Œäº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¼šèŠ±å¾ˆå¤šæ—¶é—´è¯•å›¾å¿˜è®°æŸäº›å·²ç»ä¹ å¾—çš„æ¦‚å¿µï¼ˆunlearningï¼‰ã€‚</p><p>å½“æˆ‘ä¸å†é€è¿‡ç†Ÿæ‚‰çš„classç”Ÿå‘½å‘¨æœŸæ–¹æ³•å»çª¥è§†useEffectè¿™ä¸ªHookçš„æ—¶å€™ï¼Œæˆ‘æ‰å¾—ä»¥èä¼šè´¯é€šã€‚</p><blockquote><p>â€œå¿˜è®°ä½ å·²ç»å­¦åˆ°çš„ã€‚â€ â€” Yoda</p></blockquote><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://overreacted.io/static/6203a1f1f2c771816a5ba0969baccd12/5645f/yoda.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>å¦‚æœä½ å¯¹äºæ·±å…¥ç ”ç©¶æ„Ÿè§‰ä¸æ˜¯å¾ˆé€‚åº”çš„è¯ï¼Œä½ æˆ–è®¸å¯ä»¥ç­‰ä¸‹é¢è¿™äº›è§£é‡Šå‡ºç°åœ¨å…¶ä»–æ–‡ç« ä¸­å†å»äº†è§£ä¹Ÿè¡Œã€‚å°±åƒ2013å¹´Reactåˆšå‡ºä¸–çš„æ—¶å€™ï¼Œå¤§å®¶éœ€è¦æ—¶é—´å»ç†è§£æ¶ˆåŒ–ä¸€ç§ä¸åŒçš„å¿ƒæ™ºæ¨¡å‹ã€‚çŸ¥è¯†ä¹Ÿéœ€è¦æ—¶é—´å»æ™®åŠã€‚</p><h2 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h2><p>å¦‚æœä½ ä¸æƒ³é˜…è¯»æ•´ç¯‡æ–‡ç« ï¼Œå¯ä»¥å¿«é€Ÿæµè§ˆè¿™ä»½æ‘˜è¦ã€‚è¦æ˜¯æŸäº›éƒ¨åˆ†ä¸å®¹æ˜“ç†è§£ï¼Œä½ å¯ä»¥å¾€ä¸‹æ»šåŠ¨å¯»æ‰¾ç›¸å…³çš„å†…å®¹å»é˜…è¯»ã€‚</p><p>ğŸ¤” <em>Question</em>: å¦‚ä½•ç”¨useEffectæ¨¡æ‹ŸcomponentDidMountç”Ÿå‘½å‘¨æœŸï¼Ÿ</p><p>è™½ç„¶å¯ä»¥ä½¿ç”¨useEffect(fn, [])ï¼Œä½†å®ƒä»¬å¹¶ä¸å®Œå…¨ç›¸ç­‰ã€‚å’ŒcomponentDidMountä¸ä¸€æ ·ï¼ŒuseEffectä¼šæ•è·propså’Œstateã€‚æ‰€ä»¥å³ä¾¿åœ¨å›è°ƒå‡½æ•°é‡Œï¼Œä½ æ‹¿åˆ°çš„è¿˜æ˜¯åˆå§‹çš„propså’Œstateã€‚å¦‚æœä½ æƒ³å¾—åˆ°â€œæœ€æ–°â€çš„å€¼ï¼Œä½ å¯ä»¥ä½¿ç”¨refã€‚ä¸è¿‡ï¼Œé€šå¸¸ä¼šæœ‰æ›´ç®€å•çš„å®ç°æ–¹å¼ï¼Œæ‰€ä»¥ä½ å¹¶ä¸ä¸€å®šè¦ç”¨refã€‚è®°ä½ï¼Œeffectsçš„å¿ƒæ™ºæ¨¡å‹å’ŒcomponentDidMountä»¥åŠå…¶ä»–ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸åŒçš„ï¼Œè¯•å›¾æ‰¾åˆ°å®ƒä»¬ä¹‹é—´å®Œå…¨ä¸€è‡´çš„è¡¨è¾¾åè€Œæ›´å®¹æ˜“ä½¿ä½ æ··æ·†ã€‚æƒ³è¦æ›´æœ‰æ•ˆï¼Œä½ éœ€è¦â€œthink in effectsâ€ï¼Œå®ƒçš„å¿ƒæ™ºæ¨¡å‹æ›´æ¥è¿‘äºå®ç°çŠ¶æ€åŒæ­¥ï¼Œè€Œä¸æ˜¯å“åº”ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚</p><p>ğŸ¤” <em>Question</em>: å¦‚ä½•æ­£ç¡®åœ°åœ¨useEffecté‡Œè¯·æ±‚æ•°æ®ï¼Ÿ[]åˆæ˜¯ä»€ä¹ˆï¼Ÿ</p><p><a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>æ˜¯å¾ˆå¥½çš„å…¥é—¨ï¼Œä»‹ç»äº†å¦‚ä½•åœ¨useEffecté‡Œåšæ•°æ®è¯·æ±‚ã€‚è¯·åŠ¡å¿…è¯»å®Œå®ƒï¼å®ƒæ²¡æœ‰æˆ‘çš„è¿™ç¯‡è¿™ä¹ˆé•¿ã€‚[] è¡¨ç¤ºeffectæ²¡æœ‰ä½¿ç”¨ä»»ä½•Reactæ•°æ®æµé‡Œçš„å€¼ï¼Œå› æ­¤è¯¥effectä»…è¢«è°ƒç”¨ä¸€æ¬¡æ˜¯å®‰å…¨çš„ã€‚[]åŒæ ·ä¹Ÿæ˜¯ä¸€ç±»å¸¸è§é—®é¢˜çš„æ¥æºï¼Œä¹Ÿå³ä½ ä»¥ä¸ºæ²¡ä½¿ç”¨æ•°æ®æµé‡Œçš„å€¼ä½†å…¶å®ä½¿ç”¨äº†ã€‚ä½ éœ€è¦å­¦ä¹ ä¸€äº›ç­–ç•¥ï¼ˆä¸»è¦æ˜¯useReducer å’Œ useCallbackï¼‰æ¥ç§»é™¤è¿™äº›effectä¾èµ–ï¼Œè€Œä¸æ˜¯é”™è¯¯åœ°å¿½ç•¥å®ƒä»¬ã€‚</p><p>ğŸ¤” <em>Question</em>: æˆ‘åº”è¯¥æŠŠå‡½æ•°å½“åšeffectçš„ä¾èµ–å—ï¼Ÿ</p><p>ä¸€èˆ¬å»ºè®®æŠŠä¸ä¾èµ–propså’Œstateçš„å‡½æ•°æåˆ°ä½ çš„ç»„ä»¶å¤–é¢ï¼Œå¹¶ä¸”æŠŠé‚£äº›ä»…è¢«effectä½¿ç”¨çš„å‡½æ•°æ”¾åˆ°effecté‡Œé¢ã€‚å¦‚æœè¿™æ ·åšäº†ä»¥åï¼Œä½ çš„effectè¿˜æ˜¯éœ€è¦ç”¨åˆ°ç»„ä»¶å†…çš„å‡½æ•°ï¼ˆåŒ…æ‹¬é€šè¿‡propsä¼ è¿›æ¥çš„å‡½æ•°ï¼‰ï¼Œå¯ä»¥åœ¨å®šä¹‰å®ƒä»¬çš„åœ°æ–¹ç”¨useCallbackåŒ…ä¸€å±‚ã€‚ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢ï¼Ÿå› ä¸ºè¿™äº›å‡½æ•°å¯ä»¥è®¿é—®åˆ°propså’Œstateï¼Œå› æ­¤å®ƒä»¬ä¼šå‚ä¸åˆ°æ•°æ®æµä¸­ã€‚æˆ‘ä»¬å®˜ç½‘çš„FAQæœ‰<a href="https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="noopener">æ›´è¯¦ç»†çš„ç­”æ¡ˆ</a>ã€‚</p><p>ğŸ¤” <em>Question</em>: ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šå‡ºç°æ— é™é‡å¤è¯·æ±‚çš„é—®é¢˜ï¼Ÿ</p><p>è¿™ä¸ªé€šå¸¸å‘ç”Ÿäºä½ åœ¨effecté‡Œåšæ•°æ®è¯·æ±‚å¹¶ä¸”æ²¡æœ‰è®¾ç½®effectä¾èµ–å‚æ•°çš„æƒ…å†µã€‚æ²¡æœ‰è®¾ç½®ä¾èµ–ï¼Œeffectä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åæ‰§è¡Œä¸€æ¬¡ï¼Œç„¶ååœ¨effectä¸­æ›´æ–°äº†çŠ¶æ€å¼•èµ·æ¸²æŸ“å¹¶å†æ¬¡è§¦å‘effectã€‚æ— é™å¾ªç¯çš„å‘ç”Ÿä¹Ÿå¯èƒ½æ˜¯å› ä¸ºä½ è®¾ç½®çš„ä¾èµ–æ€»æ˜¯ä¼šæ”¹å˜ã€‚ä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªä¸€ä¸ªç§»é™¤çš„æ–¹å¼æ’æŸ¥å‡ºå“ªä¸ªä¾èµ–å¯¼è‡´äº†é—®é¢˜ã€‚ä½†æ˜¯ï¼Œç§»é™¤ä½ ä½¿ç”¨çš„ä¾èµ–ï¼ˆæˆ–è€…ç›²ç›®åœ°ä½¿ç”¨[]ï¼‰é€šå¸¸æ˜¯ä¸€ç§é”™è¯¯çš„è§£å†³æ–¹å¼ã€‚ä½ åº”è¯¥åšçš„æ˜¯è§£å†³é—®é¢˜çš„æ ¹æºã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡½æ•°å¯èƒ½ä¼šå¯¼è‡´è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬æ”¾åˆ°effecté‡Œï¼Œæˆ–è€…æåˆ°ç»„ä»¶å¤–é¢ï¼Œæˆ–è€…ç”¨useCallbackåŒ…ä¸€å±‚ã€‚useMemoå¯ä»¥åšç±»ä¼¼çš„äº‹æƒ…ä»¥é¿å…é‡å¤ç”Ÿæˆå¯¹è±¡ã€‚</p><p>ğŸ¤” <em>Question</em>: ä¸ºä»€ä¹ˆæœ‰æ—¶å€™åœ¨effecté‡Œæ‹¿åˆ°çš„æ˜¯æ—§çš„stateæˆ–propå‘¢ï¼Ÿ</p><p><strong>Effectæ‹¿åˆ°çš„æ€»æ˜¯å®šä¹‰å®ƒçš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„propså’Œstate</strong>ã€‚è¿™èƒ½å¤Ÿé¿å…ä¸€äº›bugsï¼Œä½†åœ¨ä¸€äº›åœºæ™¯ä¸­åˆä¼šæœ‰äº›è®¨äººå«Œã€‚å¯¹äºè¿™äº›åœºæ™¯ï¼Œä½ å¯ä»¥æ˜ç¡®åœ°ä½¿ç”¨å¯å˜çš„refä¿å­˜ä¸€äº›å€¼ï¼ˆä¸Šé¢æ–‡ç« çš„æœ«å°¾è§£é‡Šäº†è¿™ä¸€ç‚¹ï¼‰ã€‚å¦‚æœä½ è§‰å¾—åœ¨æ¸²æŸ“ä¸­æ‹¿åˆ°äº†ä¸€äº›æ—§çš„propså’Œstateï¼Œä¸”ä¸æ˜¯ä½ æƒ³è¦çš„ï¼Œä½ å¾ˆå¯èƒ½é—æ¼äº†ä¸€äº›ä¾èµ–ã€‚å¯ä»¥å°è¯•ä½¿ç”¨è¿™ä¸ª<a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="noopener">lintè§„åˆ™</a>æ¥è®­ç»ƒä½ å‘ç°è¿™äº›ä¾èµ–ã€‚å¯èƒ½æ²¡è¿‡å‡ å¤©ï¼Œè¿™ç§èƒ½åŠ›ä¼šå˜å¾—åƒæ˜¯ä½ çš„ç¬¬äºŒå¤©æ€§ã€‚åŒæ ·å¯ä»¥çœ‹æˆ‘ä»¬å®˜ç½‘FAQä¸­çš„<a href="https://reactjs.org/docs/hooks-faq.html#why-am-i-seeing-stale-props-or-state-inside-my-function" target="_blank" rel="noopener">è¿™ä¸ªå›ç­”</a>ã€‚</p><p>æˆ‘å¸Œæœ›è¿™ä¸ªæ‘˜è¦å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼è¦ä¸ï¼Œæˆ‘ä»¬å¼€å§‹æ­£æ–‡ã€‚</p><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><h3 id="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„Props-and-State"><a href="#æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„Props-and-State" class="headerlink" title="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„Props and State"></a>æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„Props and State</h3><p>åœ¨æˆ‘ä»¬è®¨è®ºeffectsä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè®¨è®ºä¸€ä¸‹æ¸²æŸ“ï¼ˆrenderingï¼‰ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªè®¡æ•°å™¨ç»„ä»¶Counterï¼Œæ³¨æ„<code>&lt;p&gt;You clicked {count} times&lt;/p&gt;</code>è¿™ä¸€è¡Œï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function Counter() {</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked {count} times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æ³¨æ„çš„ä»£ç ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿcount ä¼šâ€œç›‘å¬â€çŠ¶æ€çš„å˜åŒ–å¹¶è‡ªåŠ¨æ›´æ–°å—ï¼Ÿè¿™ä¹ˆæƒ³å¯èƒ½æ˜¯å­¦ä¹ Reactçš„æ—¶å€™æœ‰ç”¨çš„ç¬¬ä¸€ç›´è§‰ï¼Œä½†å®ƒå¹¶ä¸æ˜¯<a href="https://overreacted.io/react-as-a-ui-runtime/" target="_blank" rel="noopener">ç²¾ç¡®çš„å¿ƒæ™ºæ¨¡å‹</a>ã€‚</p><p>ä¸Šé¢ä¾‹å­ä¸­ï¼Œcountä»…æ˜¯ä¸€ä¸ªæ•°å­—è€Œå·²ã€‚å®ƒä¸æ˜¯ç¥å¥‡çš„â€œdata bindingâ€, â€œwatcherâ€, â€œproxyâ€ï¼Œæˆ–è€…å…¶ä»–ä»»ä½•ä¸œè¥¿ã€‚å®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•°å­—åƒä¸‹é¢è¿™ä¸ªä¸€æ ·ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const count = 42;</span><br><span class="line">// ...</span><br><span class="line">&lt;p&gt;You clicked {count} times&lt;/p&gt;</span><br><span class="line">// ...</span><br></pre></td></tr></tbody></table></figure><p>æˆ‘ä»¬çš„ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼Œä»useState()æ‹¿åˆ°countçš„åˆå§‹å€¼0ã€‚å½“æˆ‘ä»¬è°ƒç”¨setCount(1)ï¼ŒReactä¼šå†æ¬¡æ¸²æŸ“ç»„ä»¶ï¼Œè¿™ä¸€æ¬¡countæ˜¯1ã€‚å¦‚æ­¤ç­‰ç­‰ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// During first render</span><br><span class="line">function Counter() {</span><br><span class="line">  const count = 0; // Returned by useState()</span><br><span class="line">  // ...</span><br><span class="line">  &lt;p&gt;You clicked {count} times&lt;/p&gt;</span><br><span class="line">  // ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// After a click, our function is called again</span><br><span class="line">function Counter() {</span><br><span class="line">  const count = 1; // Returned by useState()</span><br><span class="line">  // ...</span><br><span class="line">  &lt;p&gt;You clicked {count} times&lt;/p&gt;</span><br><span class="line">  // ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// After another click, our function is called again</span><br><span class="line">function Counter() {</span><br><span class="line">  const count = 2; // Returned by useState()</span><br><span class="line">  // ...</span><br><span class="line">  &lt;p&gt;You clicked {count} times&lt;/p&gt;</span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>å½“æˆ‘ä»¬æ›´æ–°çŠ¶æ€çš„æ—¶å€™ï¼ŒReactä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½èƒ½æ‹¿åˆ°ç‹¬ç«‹çš„count çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€å€¼æ˜¯å‡½æ•°ä¸­çš„ä¸€ä¸ªå¸¸é‡ã€‚</strong></p><p>æ‰€ä»¥ä¸‹é¢çš„è¿™è¡Œä»£ç æ²¡æœ‰åšä»»ä½•ç‰¹æ®Šçš„æ•°æ®ç»‘å®šï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;You clicked {count} times&lt;/p&gt;</span><br></pre></td></tr></tbody></table></figure><p>å®ƒä»…ä»…åªæ˜¯åœ¨æ¸²æŸ“è¾“å‡ºä¸­æ’å…¥äº†countè¿™ä¸ªæ•°å­—ã€‚è¿™ä¸ªæ•°å­—ç”±Reactæä¾›ã€‚å½“setCountçš„æ—¶å€™ï¼ŒReactä¼šå¸¦ç€ä¸€ä¸ªä¸åŒçš„countå€¼å†æ¬¡è°ƒç”¨ç»„ä»¶ã€‚ç„¶åï¼ŒReactä¼šæ›´æ–°DOMä»¥ä¿æŒå’Œæ¸²æŸ“è¾“å‡ºä¸€è‡´ã€‚</p><p>è¿™é‡Œå…³é”®çš„ç‚¹åœ¨äºä»»æ„ä¸€æ¬¡æ¸²æŸ“ä¸­çš„countå¸¸é‡éƒ½ä¸ä¼šéšç€æ—¶é—´æ”¹å˜ã€‚æ¸²æŸ“è¾“å‡ºä¼šå˜æ˜¯å› ä¸ºæˆ‘ä»¬çš„ç»„ä»¶è¢«ä¸€æ¬¡æ¬¡è°ƒç”¨ï¼Œè€Œæ¯ä¸€æ¬¡è°ƒç”¨å¼•èµ·çš„æ¸²æŸ“ä¸­ï¼Œå®ƒåŒ…å«çš„countå€¼ç‹¬ç«‹äºå…¶ä»–æ¸²æŸ“ã€‚</p><p>ï¼ˆå…³äºè¿™ä¸ªè¿‡ç¨‹æ›´æ·±å…¥çš„æ¢è®¨å¯ä»¥æŸ¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« <a href="https://overreacted.io/react-as-a-ui-runtime/" target="_blank" rel="noopener">React as a UI Runtime</a>ï¼‰</p><h3 id="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°"><a href="#æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°" class="headerlink" title="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°"></a>æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ä¸€åˆ‡éƒ½è¿˜å¥½ã€‚é‚£ä¹ˆäº‹ä»¶å¤„ç†å‡½æ•°å‘¢ï¼Ÿ</p><p>çœ‹ä¸‹é¢çš„è¿™ä¸ªä¾‹å­ã€‚å®ƒåœ¨ä¸‰ç§’åä¼šalertç‚¹å‡»æ¬¡æ•°countï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function Counter() {</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  function handleAlertClick() {</span><br><span class="line">    setTimeout(() =&gt; {</span><br><span class="line">      alert('You clicked on: ' + count);</span><br><span class="line">    }, 3000);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked {count} times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;button onClick={handleAlertClick}&gt;</span><br><span class="line">        Show alert</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å¦‚æœæˆ‘æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤å»æ“ä½œï¼š</p><ul><li>ç‚¹å‡»å¢åŠ countåˆ°3</li><li>ç‚¹å‡»ä¸€ä¸‹ â€œShow alertâ€</li><li>ç‚¹å‡»å¢åŠ countåˆ°5å¹¶ä¸”åœ¨å®šæ—¶å™¨å›è°ƒè§¦å‘å‰å®Œæˆ<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://overreacted.io/counter-46c55d5f1f749462b7a173f1e748e41e.gif" alt="" title="">                </div>                <div class="image-caption"></div>            </figure>ä½ çŒœalertä¼šå¼¹å‡ºä»€ä¹ˆå‘¢ï¼Ÿä¼šæ˜¯5å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯alertçš„æ—¶å€™countçš„å®æ—¶çŠ¶æ€ã€‚æˆ–è€…ä¼šæ˜¯3å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯æˆ‘ç‚¹å‡»æ—¶å€™çš„çŠ¶æ€ã€‚</li></ul><p>æ¥è‡ªå·±<a href="https://codesandbox.io/s/w2wxl3yo0l" target="_blank" rel="noopener">è¯•è¯•å§ï¼</a></p><p>å¦‚æœç»“æœå’Œä½ é¢„æ–™ä¸ä¸€æ ·ï¼Œä½ å¯ä»¥æƒ³è±¡ä¸€ä¸ªæ›´å®é™…çš„ä¾‹å­ï¼šä¸€ä¸ªèŠå¤©åº”ç”¨åœ¨stateä¸­ä¿å­˜äº†å½“å‰æ¥æ”¶è€…çš„IDï¼Œä»¥åŠä¸€ä¸ªå‘é€æŒ‰é’®ã€‚<a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>æ·±å…¥æ¢ç´¢äº†ä¸ªä¸­ç¼˜ç”±ã€‚æ­£ç¡®çš„ç­”æ¡ˆå°±æ˜¯3ã€‚</p><p>alertä¼šâ€œæ•è·â€æˆ‘ç‚¹å‡»æŒ‰é’®æ—¶å€™çš„çŠ¶æ€ã€‚</p><p>ï¼ˆè™½ç„¶æœ‰å…¶ä»–åŠæ³•å¯ä»¥å®ç°ä¸åŒçš„è¡Œä¸ºï¼Œä½†ç°åœ¨æˆ‘ä¼šä¸“æ³¨äºè¿™ä¸ªé»˜è®¤çš„åœºæ™¯ã€‚å½“æˆ‘ä»¬åœ¨æ„å»ºä¸€ç§å¿ƒæ™ºæ¨¡å‹çš„æ—¶å€™ï¼Œåœ¨å¯é€‰çš„ç­–ç•¥ä¸­åˆ†è¾¨å‡ºâ€œæœ€å°é˜»åŠ›è·¯å¾„â€æ˜¯éå¸¸é‡è¦çš„ã€‚ï¼‰</p><p>ä½†å®ƒç©¶ç«Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å‘ç°countåœ¨æ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­éƒ½æ˜¯ä¸€ä¸ªå¸¸é‡å€¼ã€‚å€¼å¾—å¼ºè°ƒçš„æ˜¯ â€” <em>æˆ‘ä»¬çš„ç»„ä»¶å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¢«è°ƒç”¨ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡è°ƒç”¨ä¸­countå€¼éƒ½æ˜¯å¸¸é‡ï¼Œå¹¶ä¸”å®ƒè¢«èµ‹äºˆäº†å½“å‰æ¸²æŸ“ä¸­çš„çŠ¶æ€å€¼ã€‚</em></p><p>è¿™å¹¶ä¸æ˜¯Reactç‰¹æœ‰çš„ï¼Œæ™®é€šçš„å‡½æ•°ä¹Ÿæœ‰ç±»ä¼¼çš„è¡Œä¸ºï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function sayHi(person) {</span><br><span class="line">  const name = person.name;</span><br><span class="line">  setTimeout(() =&gt; {</span><br><span class="line">    alert('Hello, ' + name);</span><br><span class="line">  }, 3000);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">let someone = {name: 'Dan'};</span><br><span class="line">sayHi(someone);</span><br><span class="line"></span><br><span class="line">someone = {name: 'Yuzhi'};</span><br><span class="line">sayHi(someone);</span><br><span class="line"></span><br><span class="line">someone = {name: 'Dominic'};</span><br><span class="line">sayHi(someone);</span><br></pre></td></tr></tbody></table></figure><p>åœ¨<a href="https://codesandbox.io/s/mm6ww11lk8" target="_blank" rel="noopener">è¿™ä¸ªä¾‹å­</a>ä¸­, å¤–å±‚çš„someoneä¼šè¢«èµ‹å€¼å¾ˆå¤šæ¬¡ï¼ˆå°±åƒåœ¨Reactä¸­ï¼Œå½“å‰çš„ç»„ä»¶çŠ¶æ€ä¼šæ”¹å˜ä¸€æ ·ï¼‰ã€‚ç„¶åï¼Œåœ¨sayHiå‡½æ•°ä¸­ï¼Œå±€éƒ¨å¸¸é‡nameä¼šå’ŒæŸæ¬¡è°ƒç”¨ä¸­çš„personå…³è”ã€‚å› ä¸ºè¿™ä¸ªå¸¸é‡æ˜¯å±€éƒ¨çš„ï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡è°ƒç”¨éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ç»“æœå°±æ˜¯ï¼Œå½“å®šæ—¶å™¨å›è°ƒè§¦å‘çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªalertéƒ½ä¼šå¼¹å‡ºå®ƒæ‹¥æœ‰çš„nameã€‚</p><p>è¿™å°±è§£é‡Šäº†æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†å‡½æ•°å¦‚ä½•æ•è·äº†ç‚¹å‡»æ—¶å€™çš„countå€¼ã€‚å¦‚æœæˆ‘ä»¬åº”ç”¨ç›¸åŒçš„æ›¿æ¢åŸç†ï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“â€œçœ‹åˆ°â€çš„æ˜¯å®ƒè‡ªå·±çš„countï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">// During first render</span><br><span class="line">function Counter() {</span><br><span class="line">  const count = 0; // Returned by useState()</span><br><span class="line">  // ...</span><br><span class="line">  function handleAlertClick() {</span><br><span class="line">    setTimeout(() =&gt; {</span><br><span class="line">      alert('You clicked on: ' + count);</span><br><span class="line">    }, 3000);</span><br><span class="line">  }</span><br><span class="line">  // ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// After a click, our function is called again</span><br><span class="line">function Counter() {</span><br><span class="line">  const count = 1; // Returned by useState()</span><br><span class="line">  // ...</span><br><span class="line">  function handleAlertClick() {</span><br><span class="line">    setTimeout(() =&gt; {</span><br><span class="line">      alert('You clicked on: ' + count);</span><br><span class="line">    }, 3000);</span><br><span class="line">  }</span><br><span class="line">  // ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// After another click, our function is called again</span><br><span class="line">function Counter() {</span><br><span class="line">  const count = 2; // Returned by useState()</span><br><span class="line">  // ...</span><br><span class="line">  function handleAlertClick() {</span><br><span class="line">    setTimeout(() =&gt; {</span><br><span class="line">      alert('You clicked on: ' + count);</span><br><span class="line">    }, 3000);</span><br><span class="line">  }</span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æ‰€ä»¥å®é™…ä¸Šï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰ä¸€ä¸ªâ€œæ–°ç‰ˆæœ¬â€çš„handleAlertClickã€‚æ¯ä¸€ä¸ªç‰ˆæœ¬çš„handleAlertClickâ€œè®°ä½â€ äº†å®ƒè‡ªå·±çš„ countï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">// During first render</span><br><span class="line">function Counter() {</span><br><span class="line">  // ...</span><br><span class="line">  function handleAlertClick() {</span><br><span class="line">    setTimeout(() =&gt; {</span><br><span class="line">      alert('You clicked on: ' + 0);</span><br><span class="line">    }, 3000);</span><br><span class="line">  }</span><br><span class="line">  // ...</span><br><span class="line">  &lt;button onClick={handleAlertClick} /&gt; // The one with 0 inside</span><br><span class="line">  // ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// After a click, our function is called again</span><br><span class="line">function Counter() {</span><br><span class="line">  // ...</span><br><span class="line">  function handleAlertClick() {</span><br><span class="line">    setTimeout(() =&gt; {</span><br><span class="line">      alert('You clicked on: ' + 1);</span><br><span class="line">    }, 3000);</span><br><span class="line">  }</span><br><span class="line">  // ...</span><br><span class="line">  &lt;button onClick={handleAlertClick} /&gt; // The one with 1 inside</span><br><span class="line">  // ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// After another click, our function is called again</span><br><span class="line">function Counter() {</span><br><span class="line">  // ...</span><br><span class="line">  function handleAlertClick() {</span><br><span class="line">    setTimeout(() =&gt; {</span><br><span class="line">      alert('You clicked on: ' + 2);</span><br><span class="line">    }, 3000);</span><br><span class="line">  }</span><br><span class="line">  // ...</span><br><span class="line">  &lt;button onClick={handleAlertClick} /&gt; // The one with 2 inside</span><br><span class="line">  // ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨<a href="https://codesandbox.io/s/w2wxl3yo0l" target="_blank" rel="noopener">è¿™ä¸ªdemoä¸­</a>ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°â€œå±äºâ€æŸä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ï¼Œå½“ä½ ç‚¹å‡»çš„æ—¶å€™ï¼Œå®ƒä¼šä½¿ç”¨é‚£æ¬¡æ¸²æŸ“ä¸­countçš„çŠ¶æ€å€¼ã€‚</p><p><strong>åœ¨ä»»æ„ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œpropså’Œstateæ˜¯å§‹ç»ˆä¿æŒä¸å˜çš„ã€‚</strong>å¦‚æœpropså’Œstateåœ¨ä¸åŒçš„æ¸²æŸ“ä¸­æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œé‚£ä¹ˆä½¿ç”¨åˆ°å®ƒä»¬çš„ä»»ä½•å€¼ä¹Ÿæ˜¯ç‹¬ç«‹çš„ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼‰ã€‚å®ƒä»¬éƒ½â€œå±äºâ€ä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ã€‚å³ä¾¿æ˜¯äº‹ä»¶å¤„ç†ä¸­çš„å¼‚æ­¥å‡½æ•°è°ƒç”¨â€œçœ‹åˆ°â€çš„ä¹Ÿæ˜¯è¿™æ¬¡æ¸²æŸ“ä¸­çš„countå€¼ã€‚</p><p>å¤‡æ³¨ï¼šä¸Šé¢æˆ‘å°†å…·ä½“çš„countå€¼ç›´æ¥å†…è”åˆ°äº†handleAlertClickå‡½æ•°ä¸­ã€‚è¿™ç§å¿ƒæ™ºä¸Šçš„æ›¿æ¢æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºcountå€¼åœ¨æŸæ¬¡ç‰¹å®šæ¸²æŸ“ä¸­ä¸å¯èƒ½è¢«æ”¹å˜ã€‚å®ƒè¢«å£°æ˜æˆäº†ä¸€ä¸ªå¸¸é‡å¹¶ä¸”æ˜¯ä¸€ä¸ªæ•°å­—ã€‚è¿™æ ·å»æ€è€ƒå…¶ä»–ç±»å‹çš„å€¼æ¯”å¦‚å¯¹è±¡ä¹ŸåŒæ ·æ˜¯å®‰å…¨çš„ï¼Œå½“ç„¶éœ€è¦åœ¨æˆ‘ä»¬éƒ½åŒæ„åº”è¯¥é¿å…ç›´æ¥ä¿®æ”¹stateè¿™ä¸ªå‰æä¸‹ã€‚é€šè¿‡è°ƒç”¨setSomething(newObj)çš„æ–¹å¼å»ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡è€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹å®ƒæ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºè¿™æ ·èƒ½ä¿è¯ä¹‹å‰æ¸²æŸ“ä¸­çš„stateä¸ä¼šè¢«æ±¡æŸ“ã€‚</p><h3 id="æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„Effects"><a href="#æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„Effects" class="headerlink" title="æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„Effects"></a>æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„Effects</h3><p>è¿™ç¯‡æ–‡ç« æ˜¯å…³äºeffectsçš„ï¼Œä½†ç›®å‰æˆ‘ä»¬å±…ç„¶è¿˜æ²¡æœ‰è®¨è®ºeffectsï¼ è¨€å½’æ­£ä¼ ï¼Œç”±ä¸Šé¢çš„åˆ†æå¾—å‡ºä¸€ä¸ªç»“æœï¼Œeffectså…¶å®å¹¶æ²¡æœ‰ä»€ä¹ˆä¸¤æ ·ã€‚</p><p>è®©æˆ‘ä»¬å›åˆ°<a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="noopener">å®˜ç½‘æ–‡æ¡£</a>ä¸­çš„è¿™ä¸ªä¾‹å­ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function Counter() {</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    document.title = `You clicked ${count} times`;</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked {count} times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æŠ›ä¸€ä¸ªé—®é¢˜ç»™ä½ ï¼šeffectæ˜¯å¦‚ä½•è¯»å–åˆ°æœ€æ–°çš„count çŠ¶æ€å€¼çš„å‘¢ï¼Ÿ</p><p>ä¹Ÿè®¸ï¼Œæ˜¯æŸç§â€œdata bindingâ€æˆ–â€œwatchingâ€æœºåˆ¶ä½¿å¾—countèƒ½å¤Ÿåœ¨effectå‡½æ•°å†…æ›´æ–°ï¼Ÿä¹Ÿæˆ–è®¸countæ˜¯ä¸€ä¸ªå¯å˜çš„å€¼ï¼ŒReactä¼šåœ¨æˆ‘ä»¬ç»„ä»¶å†…éƒ¨ä¿®æ”¹å®ƒä»¥ä½¿æˆ‘ä»¬çš„effectå‡½æ•°æ€»èƒ½æ‹¿åˆ°æœ€æ–°çš„å€¼ï¼Ÿ</p><p>éƒ½ä¸æ˜¯ã€‚</p><p>æˆ‘ä»¬å·²ç»çŸ¥é“countæ˜¯æŸä¸ªç‰¹å®šæ¸²æŸ“ä¸­çš„å¸¸é‡ã€‚äº‹ä»¶å¤„ç†å‡½æ•°â€œçœ‹åˆ°â€çš„æ˜¯å±äºå®ƒé‚£æ¬¡ç‰¹å®šæ¸²æŸ“ä¸­çš„countçŠ¶æ€å€¼ã€‚å¯¹äºeffectsä¹ŸåŒæ ·å¦‚æ­¤ï¼š</p><p>å¹¶ä¸æ˜¯countçš„å€¼åœ¨â€œä¸å˜â€çš„effectä¸­å‘ç”Ÿäº†æ”¹å˜ï¼Œè€Œæ˜¯effectå‡½æ•°æœ¬èº«åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“ä¸­éƒ½ä¸ç›¸åŒã€‚</p><p>æ¯ä¸€ä¸ªeffectç‰ˆæœ¬â€œçœ‹åˆ°â€çš„countå€¼éƒ½æ¥è‡ªäºå®ƒå±äºçš„é‚£æ¬¡æ¸²æŸ“ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">// During first render</span><br><span class="line">function Counter() {</span><br><span class="line">  // ...</span><br><span class="line">  useEffect(</span><br><span class="line">    // Effect function from first render</span><br><span class="line">    () =&gt; {</span><br><span class="line">      document.title = `You clicked ${0} times`;</span><br><span class="line">    }</span><br><span class="line">  );</span><br><span class="line">  // ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// After a click, our function is called again</span><br><span class="line">function Counter() {</span><br><span class="line">  // ...</span><br><span class="line">  useEffect(</span><br><span class="line">    // Effect function from second render</span><br><span class="line">    () =&gt; {</span><br><span class="line">      document.title = `You clicked ${1} times`;</span><br><span class="line">    }</span><br><span class="line">  );</span><br><span class="line">  // ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// After another click, our function is called again</span><br><span class="line">function Counter() {</span><br><span class="line">  // ...</span><br><span class="line">  useEffect(</span><br><span class="line">    // Effect function from third render</span><br><span class="line">    () =&gt; {</span><br><span class="line">      document.title = `You clicked ${2} times`;</span><br><span class="line">    }</span><br><span class="line">  );</span><br><span class="line">  // ..</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Reactä¼šè®°ä½ä½ æä¾›çš„effectå‡½æ•°ï¼Œå¹¶ä¸”ä¼šåœ¨æ¯æ¬¡æ›´æ”¹ä½œç”¨äºDOMå¹¶è®©æµè§ˆå™¨ç»˜åˆ¶å±å¹•åå»è°ƒç”¨å®ƒã€‚</p><p>æ‰€ä»¥è™½ç„¶æˆ‘ä»¬è¯´çš„æ˜¯ä¸€ä¸ªeffectï¼ˆè¿™é‡ŒæŒ‡æ›´æ–°documentçš„titleï¼‰ï¼Œä½†å…¶å®æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯ä¸€ä¸ªä¸åŒçš„å‡½æ•° â€” å¹¶ä¸”æ¯ä¸ªeffectå‡½æ•°â€œçœ‹åˆ°â€çš„propså’Œstateéƒ½æ¥è‡ªäºå®ƒå±äºçš„é‚£æ¬¡ç‰¹å®šæ¸²æŸ“ã€‚</p><p>æ¦‚å¿µä¸Šï¼Œä½ å¯ä»¥æƒ³è±¡effectsæ˜¯æ¸²æŸ“ç»“æœçš„ä¸€éƒ¨åˆ†ã€‚</p><p>ä¸¥æ ¼åœ°è¯´ï¼Œå®ƒä»¬å¹¶ä¸æ˜¯ï¼ˆä¸ºäº†<a href="https://overreacted.io/why-do-hooks-rely-on-call-order/" target="_blank" rel="noopener">å…è®¸Hookçš„ç»„åˆ</a>å¹¶ä¸”ä¸å¼•å…¥ç¬¨æ‹™çš„è¯­æ³•æˆ–è€…è¿è¡Œæ—¶ï¼‰ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬æ„å»ºçš„å¿ƒæ™ºæ¨¡å‹ä¸Šï¼Œeffectå‡½æ•°å±äºæŸä¸ªç‰¹å®šçš„æ¸²æŸ“ï¼Œå°±åƒäº‹ä»¶å¤„ç†å‡½æ•°ä¸€æ ·ã€‚</p><p>ä¸ºäº†ç¡®ä¿æˆ‘ä»¬å·²ç»æœ‰äº†æ‰å®çš„ç†è§£ï¼Œæˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹ç¬¬ä¸€æ¬¡çš„æ¸²æŸ“è¿‡ç¨‹ï¼š</p><ul><li>React: ç»™æˆ‘çŠ¶æ€ä¸º0æ—¶å€™çš„UIã€‚</li><li>ä½ çš„ç»„ä»¶:<ul><li>ç»™ä½ éœ€è¦æ¸²æŸ“çš„å†…å®¹: <code>&lt;p&gt;You clicked 0 times&lt;/p&gt;</code>ã€‚</li><li>è®°å¾—åœ¨æ¸²æŸ“å®Œäº†ä¹‹åè°ƒç”¨è¿™ä¸ªeffect: () =&gt; { document.title = â€˜You clicked 0 timesâ€™ }ã€‚</li></ul></li><li>React: æ²¡é—®é¢˜ã€‚å¼€å§‹æ›´æ–°UIï¼Œå–‚æµè§ˆå™¨ï¼Œæˆ‘è¦ç»™DOMæ·»åŠ ä¸€äº›ä¸œè¥¿ã€‚</li><li>æµè§ˆå™¨: é…·ï¼Œæˆ‘å·²ç»æŠŠå®ƒç»˜åˆ¶åˆ°å±å¹•ä¸Šäº†ã€‚</li><li>React: å¥½çš„ï¼Œ æˆ‘ç°åœ¨å¼€å§‹è¿è¡Œç»™æˆ‘çš„effect<ul><li>è¿è¡Œ () =&gt; { document.title = â€˜You clicked 0 timesâ€™ }ã€‚</li></ul></li></ul><p>ç°åœ¨æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æˆ‘ä»¬ç‚¹å‡»ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆï¼š</p><ul><li>ä½ çš„ç»„ä»¶: å–‚ React, æŠŠæˆ‘çš„çŠ¶æ€è®¾ç½®ä¸º1ã€‚</li><li>React: ç»™æˆ‘çŠ¶æ€ä¸º1æ—¶å€™çš„UIã€‚</li><li>ä½ çš„ç»„ä»¶:<ul><li>ç»™ä½ éœ€è¦æ¸²æŸ“çš„å†…å®¹: <code>&lt;p&gt;You clicked 1 times&lt;/p&gt;</code>ã€‚</li><li>è®°å¾—åœ¨æ¸²æŸ“å®Œäº†ä¹‹åè°ƒç”¨è¿™ä¸ªeffectï¼š () =&gt; { document.title = â€˜You clicked 1 timesâ€™ }ã€‚</li></ul></li><li>React: æ²¡é—®é¢˜ã€‚å¼€å§‹æ›´æ–°UIï¼Œå–‚æµè§ˆå™¨ï¼Œæˆ‘ä¿®æ”¹äº†DOMã€‚</li><li>Browser: é…·ï¼Œæˆ‘å·²ç»å°†æ›´æ”¹ç»˜åˆ¶åˆ°å±å¹•ä¸Šäº†ã€‚</li><li>React: å¥½çš„ï¼Œ æˆ‘ç°åœ¨å¼€å§‹è¿è¡Œå±äºè¿™æ¬¡æ¸²æŸ“çš„effect<ul><li>è¿è¡Œ () =&gt; { document.title = â€˜You clicked 1 timesâ€™ }ã€‚</li></ul></li></ul><h3 id="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„â€¦"><a href="#æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„â€¦" class="headerlink" title="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„â€¦"></a>æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„â€¦</h3><p>æˆ‘ä»¬ç°åœ¨çŸ¥é“effectsä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åè¿è¡Œï¼Œå¹¶ä¸”æ¦‚å¿µä¸Šå®ƒæ˜¯ç»„ä»¶è¾“å‡ºçš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥â€œçœ‹åˆ°â€å±äºæŸæ¬¡ç‰¹å®šæ¸²æŸ“çš„propså’Œstateã€‚</p><p>æˆ‘ä»¬æ¥åšä¸€ä¸ªæ€æƒ³å®éªŒï¼Œæ€è€ƒä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function Counter() {</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; {</span><br><span class="line">    setTimeout(() =&gt; {</span><br><span class="line">      console.log(`You clicked ${count} times`);</span><br><span class="line">    }, 3000);</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked {count} times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å¦‚æœæˆ‘ç‚¹å‡»äº†å¾ˆå¤šæ¬¡å¹¶ä¸”åœ¨effecté‡Œè®¾ç½®äº†å»¶æ—¶ï¼Œæ‰“å°å‡ºæ¥çš„ç»“æœä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä½ å¯èƒ½ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¾ˆç»•çš„é¢˜å¹¶ä¸”ç»“æœæ˜¯åç›´è§‰çš„ã€‚å®Œå…¨é”™äº†ï¼æˆ‘ä»¬çœ‹åˆ°çš„å°±æ˜¯é¡ºåºçš„æ‰“å°è¾“å‡º â€” æ¯ä¸€ä¸ªéƒ½å±äºæŸæ¬¡ç‰¹å®šçš„æ¸²æŸ“ï¼Œå› æ­¤æœ‰å®ƒè¯¥æœ‰çš„countå€¼ã€‚ä½ å¯ä»¥<a href="https://codesandbox.io/s/lyx20m1ol" target="_blank" rel="noopener">è‡ªå·±è¯•ä¸€è¯•</a>ï¼š</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://overreacted.io/timeout_counter-a5727d333c270e05942f508707265378.gif" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œå®ƒå½“ç„¶åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚å¦åˆ™è¿˜ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿâ€</p><p>ä¸è¿‡ï¼Œclassä¸­çš„this.stateå¹¶ä¸æ˜¯è¿™æ ·è¿ä½œçš„ã€‚ä½ å¯èƒ½ä¼šæƒ³å½“ç„¶ä»¥ä¸ºä¸‹é¢çš„<a href="https://codesandbox.io/s/kkymzwjqz3" target="_blank" rel="noopener">classå®ç°</a>å’Œä¸Šé¢æ˜¯ç›¸ç­‰çš„ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">componentDidUpdate() {</span><br><span class="line">  setTimeout(() =&gt; {</span><br><span class="line">    console.log(`You clicked ${this.state.count} times`);</span><br><span class="line">  }, 3000);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ç„¶è€Œï¼Œ<strong>this.state.countæ€»æ˜¯æŒ‡å‘æœ€æ–°çš„countå€¼ï¼Œè€Œä¸æ˜¯å±äºæŸæ¬¡ç‰¹å®šæ¸²æŸ“çš„å€¼</strong>ã€‚æ‰€ä»¥ä½ ä¼šçœ‹åˆ°æ¯æ¬¡æ‰“å°è¾“å‡ºéƒ½æ˜¯5ï¼š</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://overreacted.io/timeout_counter_class-264b329edc111a1973003bdf2bcacd65.gif" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>æˆ‘è§‰å¾—Hooksè¿™ä¹ˆä¾èµ–Javascripté—­åŒ…æ˜¯æŒºè®½åˆºçš„ä¸€ä»¶äº‹ã€‚æœ‰æ—¶å€™ç»„ä»¶çš„classå®ç°æ–¹å¼ä¼šå—é—­åŒ…ç›¸å…³çš„è‹¦ï¼ˆ<a href="https://wsvincent.com/javascript-closure-settimeout-for-loop/" target="_blank" rel="noopener">the canonical wrong-value-in-a-timeout confusion</a>ï¼‰ï¼Œä½†å…¶å®è¿™ä¸ªä¾‹å­ä¸­çœŸæ­£çš„æ··ä¹±æ¥æºæ˜¯å¯å˜æ•°æ®ï¼ˆReactä¿®æ”¹äº†classä¸­çš„this.stateä½¿å…¶æŒ‡å‘æœ€æ–°çŠ¶æ€ï¼‰ï¼Œå¹¶ä¸æ˜¯é—­åŒ…æœ¬èº«çš„é”™ã€‚</p><p>å½“å°é—­çš„å€¼å§‹ç»ˆä¸ä¼šå˜çš„æƒ…å†µä¸‹é—­åŒ…æ˜¯éå¸¸æ£’çš„ã€‚è¿™ä½¿å®ƒä»¬éå¸¸å®¹æ˜“æ€è€ƒå› ä¸ºä½ æœ¬è´¨ä¸Šåœ¨å¼•ç”¨å¸¸é‡ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€è®¨è®ºçš„ï¼Œpropså’Œstateåœ¨æŸä¸ªç‰¹å®šæ¸²æŸ“ä¸­æ˜¯ä¸ä¼šæ”¹å˜çš„ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥<a href="https://codesandbox.io/s/w7vjo07055" target="_blank" rel="noopener">ä½¿ç”¨é—­åŒ…</a>ä¿®å¤ä¸Šé¢çš„classç‰ˆæœ¬â€¦</p><h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><blockquote><p>åŸæ–‡ä½œè€…ï¼šDan Abramov<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://overreacted.io/a-complete-guide-to-useeffect/" target="_blank" rel="noopener">https://overreacted.io/a-complete-guide-to-useeffect/</a></p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;React Hooksç³»åˆ—ä¹‹useEffectï¼ˆä¸€ï¼‰&lt;/p&gt;
    
    </summary>
    
      <category term="React" scheme="http://Lry0504.github.io/categories/React/"/>
    
    
      <category term="å‰ç«¯" scheme="http://Lry0504.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>React Hooksåˆæ¢</title>
    <link href="http://Lry0504.github.io//posts/5/"/>
    <id>http://Lry0504.github.io//posts/5/</id>
    <published>2019-12-06T02:24:43.194Z</published>
    <updated>2019-12-17T11:44:57.102Z</updated>
    
    <content type="html"><![CDATA[<p>React Hooksåˆæ¢</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Hook æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/react%20hook/hooks.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><h3 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h3><p>å¦‚æœä½ ä½¿ç”¨è¿‡Reactä¸€æ®µæ—¶é—´ï¼Œä½ ä¼šå‘ç°åœ¨Reactç»„ä»¶ä¹‹é—´å¤ç”¨é€»è¾‘çŠ¶æ€å¾ˆéš¾ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡render props å’ŒHOCé«˜é˜¶ç»„ä»¶è¿™ç±»æ–¹æ¡ˆè§£å†³ï¼Œä½†æ˜¯å¾ˆå®¹æ˜“è®©ä»£ç å˜å¾—éš¾ä»¥ç†è§£ã€‚</p><p>Hookç»™äºˆäº†å‡½æ•°å¼ç»„ä»¶ç±»ä¼¼äºç±»ç»„ä»¶<strong>ç”Ÿå‘½å‘¨æœŸ</strong>çš„æ¦‚å¿µï¼Œæ‰©å¤§äº†å‡½æ•°å¼ç»„ä»¶çš„åº”ç”¨èŒƒå›´ã€‚Hooks çš„å‡ºç°ä½¿å¾—å‡½æ•°ç»„ä»¶ä¹Ÿæœ‰äº†è‡ªå·±çš„çŠ¶æ€ä¸ä¸šåŠ¡é€»è¾‘ï¼Œç®€å•é€»è¾‘åœ¨è‡ªå·±å†…éƒ¨å¤„ç†å³å¯ï¼Œä¸å†éœ€è¦é€šè¿‡ Props çš„ä¼ é€’ï¼Œä½¿ç®€å•é€»è¾‘ç»„ä»¶æŠ½ç¦»æ›´åŠ æ–¹ä¾¿ï¼Œä¹Ÿä½¿ä½¿ç”¨è€…æ— éœ€å…³å¿ƒç»„ä»¶å†…éƒ¨çš„é€»è¾‘ï¼Œåªå…³å¿ƒ Hooks ç»„ä»¶è¿”å›çš„ç»“æœå³å¯</p><h3 id="Hookåˆæ¢"><a href="#Hookåˆæ¢" class="headerlink" title="Hookåˆæ¢"></a>Hookåˆæ¢</h3><p>æˆ‘ä»¬é€šè¿‡å®˜ç½‘è®¡æ•°å™¨çš„ä¾‹å­ï¼Œæ¥çœ‹çœ‹ class ç»„ä»¶ä¸ hooks çš„åŒºåˆ«ã€‚</p><p>é‡‡ç”¨classç»„ä»¶å†™æ³•:</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/react%20hook/1.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>é‡‡ç”¨hooksåä»£ç :</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/react%20hook/1_1.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>é€šè¿‡ä¸Šè¯‰ä¸¤ç§æ–¹æ³•æ¯”è¾ƒå¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨Hooksï¼Œç›¸å…³çš„çŠ¶æ€é€»è¾‘å¯ä»¥æ”¾åœ¨å•ä¸ªæ–¹æ³•ä¸­ç®¡ç†ï¼Œè€Œä¸”ä¸éœ€è¦å†™æˆReact.Componentç»„ä»¶å½¢å¼ï¼Œè€Œæ˜¯ä½œä¸ºä¸€ä¸ªé€»è¾‘çŠ¶æ€ç®¡ç†çš„æ–¹æ³•ï¼Œæ–¹ä¾¿åæœŸå¤ç”¨ã€‚</p><h3 id="åŸºç¡€Hooks"><a href="#åŸºç¡€Hooks" class="headerlink" title="åŸºç¡€Hooks"></a>åŸºç¡€Hooks</h3><h4 id="â€»-useState"><a href="#â€»-useState" class="headerlink" title="â€» useState"></a>â€» useState</h4><p><code>useState</code>æ˜¯ä¸€ä¸ªåŸºç¡€çš„çŠ¶æ€ç®¡ç†Hooksï¼Œå®ƒå°†åˆ†æ•£çš„åˆå§‹çŠ¶æ€ã€è·å–çŠ¶æ€å’Œä¿®æ”¹çŠ¶æ€ç»Ÿä¸€åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œè¿™æ ·æœ‰åˆ©äºå°†å•ä¸ªçŠ¶æ€çš„ç›¸å…³å†…å®¹ç»Ÿä¸€ç»´æŠ¤ï¼Œå¤ç”¨æ›´åŠ ç®€ä¾¿ã€‚å…·ä½“ä½¿ç”¨å¦‚ä¸‹:</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const [count, setCount] = useState(initialState);</span><br></pre></td></tr></tbody></table></figure><p><code>initialState</code>æ˜¯åˆå§‹åŒ–çŠ¶æ€ï¼Œä¸Šè¿°ä»£ç æœ‰ä¸¤ä¸ªè¿”å›å€¼<code>count</code>å’Œ<code>setCount()</code>ã€‚ä¸€ä¸ªç”¨æ¥è·å–æœ€æ–°çš„çŠ¶æ€å€¼ï¼Œä¸€ä¸ªç”¨æ¥ä¿®æ”¹çŠ¶æ€ï¼Œåé¢æ‰€æœ‰ä¸è¯¥çŠ¶æ€ç›¸å…³çš„ä»£ç éƒ½åœ¨åŒä¸€ä¸ªæ–¹æ³•ä¸­ã€‚å¦‚æœä½ éœ€è¦å¤šä¸ªçŠ¶æ€ï¼Œä½ å¯ä»¥ä½¿ç”¨å¤šä¸ªuseStateç®¡ç†ç›¸å¯¹åº”çš„çŠ¶æ€ã€‚<br>å¦‚æœæˆ‘ä»¬æƒ³è¦è·å–ä¸Šä¸€è½®è¯¥stateçš„å€¼ï¼Œåªéœ€è¦åœ¨setCountä½¿ç”¨æ—¶ï¼Œä¼ å…¥ä¸Šä¸€è½®çš„stateå€¼ï¼Œå³setCount(count =&gt; count + 1)</p><h4 id="â€»-useEffect"><a href="#â€»-useEffect" class="headerlink" title="â€» useEffect"></a>â€» useEffect</h4><p><code>useEffect</code>å…¶å®å°±æ˜¯ä¸€ä¸ªEffect Hookï¼Œå®ƒç»™å‡½æ•°ç»„ä»¶å¢åŠ äº†æ“ä½œå‰¯ä½œç”¨ï¼ˆåœ¨Reactç»„ä»¶ä¸­æœ‰è¿‡æ•°æ®è·å–ã€è®¢é˜…æˆ–æ‰‹åŠ¨ä¿®æ”¹DOMï¼‰çš„èƒ½åŠ›ã€‚å®ƒä¸classç»„ä»¶ä¸­çš„componentDidMountã€componentDidUpdateã€componentWillUnMountå…·æœ‰ç›¸åŒçš„ç”¨é€”ï¼Œåªä¸è¿‡è¢«åˆå¹¶æˆäº†ä¸€ä¸ªAPIã€‚å…·ä½“ä½¿ç”¨å¦‚ä¸‹:</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; {</span><br><span class="line">  //è¿™é‡Œæ“ä½œå‰¯ä½œç”¨</span><br><span class="line">  return () =&gt; {</span><br><span class="line">    //æ¸…é™¤effectï¼Œç»„ä»¶å¸è½½æ—¶æ‰§è¡Œ</span><br><span class="line">  }</span><br><span class="line">}, Drip)</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šè¿°ä»£ç ä¸­returnè¿”å›çš„å‡½æ•°ï¼Œå…¶å®æ˜¯effectå¯é€‰çš„<code>æ¸…é™¤æœºåˆ¶</code>ã€‚æ¯ä¸ªeffectéƒ½å¯ä»¥è¿”å›ä¸€ä¸ªæ¸…é™¤å‡½æ•°ï¼ŒReactä¼šåœ¨ç»„ä»¶å¸è½½æ—¶æ‰§è¡Œå®ƒä»¬ã€‚<code>Drip</code>æ˜¯effectçš„ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¯é€‰ï¼‰ï¼Œå®ƒå¯ä»¥ç”¨æ¥æ§åˆ¶effectæ˜¯å¦æ¯æ¬¡æ›´æ–°æ¸²æŸ“éƒ½éœ€è¦æ‰§è¡Œã€‚effectåœ¨æ¯æ¬¡æ¸²æŸ“çš„æ—¶å€™éƒ½ä¼šæ‰§è¡Œã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆReactä¼šåœ¨æ‰§è¡Œå½“å‰effectä¹‹å‰å¯¹ä¸Šä¸€ä¸ªeffectè¿›è¡Œæ¸…é™¤ã€‚åŒstateä¸€æ ·ï¼Œeffectä¹Ÿå¯ä»¥ä½¿ç”¨å¤šæ¬¡ï¼Œä½†éœ€è¦æ³¨æ„<em>Reactä¼šæŒ‰ç…§effectå£°æ˜çš„é¡ºåºä¾æ¬¡è°ƒç”¨ç»„ä»¶ä¸­çš„effect</em></p><h4 id="â€»-useContext"><a href="#â€»-useContext" class="headerlink" title="â€» useContext"></a>â€» useContext</h4><p>åœ¨Reactä¸­ï¼Œä¸ºäº†é¿å…å‚æ•°æ·±å±‚æ¬¡çš„ä¼ é€’ï¼Œä¸€èˆ¬ä¼šåœ¨çˆ¶ç»„ä»¶ä¸Šåˆ›å»ºä¸€ä¸ªContextï¼Œåœ¨å­å­™ç»„ä»¶éƒ½å¯ä»¥è·å–åˆ°è¿™ä¸ªContextï¼Œè¿™æ ·å°±é¿å…äº†å‚æ•°éœ€è¦ä¸€å±‚å±‚ä¼ é€’ä¸‹å»ã€‚å…·ä½“ä½¿ç”¨å¦‚ä¸‹:</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const context = useContext(Context)</span><br></pre></td></tr></tbody></table></figure><p>useContextæ¥æ”¶ä¸€ä¸ª<code>Contextå¯¹è±¡</code>(React.createContextçš„è¿”å›å€¼)ï¼Œè¿”å›è¯¥contextçš„å½“å‰å€¼ã€‚contextçš„å½“å‰å€¼ç”±ä¸Šå±‚ç»„ä»¶ä¸­è·ç¦»å½“å‰ç»„ä»¶æœ€è¿‘çš„<code>&lt;Context.Provider&gt;</code>çš„<code>value</code> propå†³å®šã€‚</p><h3 id="é¢å¤–çš„Hooks"><a href="#é¢å¤–çš„Hooks" class="headerlink" title="é¢å¤–çš„Hooks"></a>é¢å¤–çš„Hooks</h3><h4 id="â€»-useReducer"><a href="#â€»-useReducer" class="headerlink" title="â€» useReducer"></a>â€» useReducer</h4><p><code>useReducer</code>æ˜¯useStateçš„æ›¿ä»£æ–¹æ¡ˆï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå½¢å¦‚<code>(state, action) =&gt; newState</code>çš„reducer(ä¸Reduxç±»ä¼¼)ï¼Œå¹¶è¿”å›å½“å‰çš„stateå€¼ä»¥åŠé…å¥—çš„dispatchæ–¹æ³•ã€‚å…·ä½“ä½¿ç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const [state, dispatch] = useReducer(reducer, initialState)</span><br></pre></td></tr></tbody></table></figure><p>åœ¨æŸäº›åº”ç”¨åœºæ™¯ä¸‹ï¼ŒuseReduceræ¯”useStateæ›´é€‚ç”¨ã€‚ä¾‹å¦‚stateé€»è¾‘å¤æ‚å¹¶ä¸”åŒ…å«å¤šä¸ªå­å€¼ï¼Œæˆ–è€…ä¸‹ä¸€ä¸ªstateä¾èµ–ä¹‹å‰çš„stateã€‚<br>Reactä¼šç¡®ä¿dispatchå‡½æ•°çš„æ ‡è¯†æ˜¯ç¨³å®šçš„ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶æ”¹å˜ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¯ä»¥å®‰å…¨åœ°ä»useEffectæˆ–useCallbackçš„ä¾èµ–åˆ—è¡¨ä¸­çœç•¥dispatch</p><h4 id="â€»-useMemo"><a href="#â€»-useMemo" class="headerlink" title="â€» useMemo"></a>â€» useMemo</h4><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨æ¸²æŸ“æ—¶è®¡ç®—ä¸€ä¸ªå€¼éœ€è¦è¿›è¡Œé«˜å¼€é”€çš„è®¡ç®—ï¼Œè€Œè¿™ä¸ªå€¼ä¼šå—ä¸€äº›å‚æ•°çš„å½±å“ã€‚å½“å‚æ•°æ²¡æœ‰å˜åŒ–æ—¶ï¼Œè¿™ä¸ªå€¼ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼›å½“å‚æ•°å˜åŒ–æ—¶ï¼Œéœ€è¦é‡æ–°è®¡ç®—ã€‚ä¸ºäº†æå‡æ•ˆç‡ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>useMemo</code>è¿™ä¸ªHooksã€‚useMemoæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯è®¡ç®—å€¼çš„æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯ä¾èµ–é¡¹æ•°ç»„(é‡Œé¢æ˜¯å½±å“å€¼çš„å‚æ•°)ã€‚å…·ä½“ä½¿ç”¨å¦‚ä¸‹:</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const memoizedValue = useMemo(() =&gt; computeExpensiveValue(a, b), [a, b])</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œè®¡ç®—å¾—åˆ°çš„memoizedValueä¼šå—ä¾èµ–é¡¹æ•°ç»„ä¸­çš„å‚æ•°a, bå½±å“ã€‚å½“å‚æ•°ä¸å˜æ—¶ï¼Œä¸ä¼šé‡æ–°è®¡ç®—memoizedValueçš„å€¼ï¼›å½“ä»»ä¸€å‚æ•°å˜åŒ–æ—¶ï¼Œéƒ½ä¼šè§¦å‘é‡æ–°æ‰§è¡ŒcomputeExpensiveValueæ–¹æ³•è®¡ç®—æ–°çš„memoizedValueã€‚<em>å¦‚æœæ²¡æœ‰æä¾›ä¾èµ–é¡¹æ•°ç»„ï¼ŒuseMemoåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šæ‰§è¡Œè®¡ç®—æ–°çš„å€¼</em></p><h4 id="â€»-useCallback"><a href="#â€»-useCallback" class="headerlink" title="â€» useCallback"></a>â€» useCallback</h4><p><code>useCallback</code>æ–¹æ³•ä¸useMemoæ–¹æ³•ç±»ä¼¼ï¼Œä¹Ÿæ˜¯é¿å…é‡å¤è®¡ç®—ï¼ŒåŒºåˆ«åœ¨äºuseCallbackè¿”å›çš„æ˜¯ä¸€ä¸ªmemoizedå›è°ƒå‡½æ•°ã€‚è¯¥å›è°ƒå‡½æ•°åªæœ‰åœ¨æŸä¸ªä¾èµ–é¡¹æ”¹å˜æ—¶æ‰ä¼šæ›´æ–°ã€‚å…·ä½“ä½¿ç”¨å¦‚ä¸‹:</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const callbackFn = useCallback(() =&gt; doSomething(a, b), [a, b])</span><br></pre></td></tr></tbody></table></figure><p>ç›´æ¥è°ƒç”¨callbackFn()æ–¹æ³•ï¼Œæœ€ç»ˆæ‰§è¡Œçš„æ˜¯doSomething()çš„ä»£ç </p><h4 id="â€»-useRef"><a href="#â€»-useRef" class="headerlink" title="â€» useRef"></a>â€» useRef</h4><p>åœ¨Hooksä¹‹å‰ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨refå»æ‰¾ç‰¹å®šçš„DOMå…ƒç´ ï¼Œå¦‚æœä½ å°†refä»¥<code>&lt;div ref={myRef}&gt;&lt;/div&gt;</code>è¿™ç§æ–¹å¼ä¼ å…¥ç»„ä»¶ï¼Œåˆ™æ— è®ºè¯¥èŠ‚ç‚¹å¦‚ä½•æ”¹å˜ï¼ŒReactéƒ½ä¼šå°†refå¯¹è±¡çš„<code>.current</code>å±æ€§è®¾ç½®ä¸ºå¯¹åº”çš„DOMèŠ‚ç‚¹ã€‚<code>useRef</code>è¿”å›ä¸€ä¸ªå¯å˜çš„refå¯¹è±¡ï¼Œå…¶<code>.current</code>å±æ€§åˆå§‹åŒ–ä¸ºä¼ å…¥çš„å‚æ•°(initialValue),è¿”å›çš„refå¯¹è±¡åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä¿æŒä¸å˜ã€‚å…·ä½“ä½¿ç”¨å¦‚ä¸‹:</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const ref = useRef(initialValue)</span><br></pre></td></tr></tbody></table></figure><p>useRefä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶è¿”å›åŒä¸€ä¸ªrefå¯¹è±¡ï¼Œå˜æ›´<code>.current</code>å±æ€§ä¸ä¼šå¼•å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚å¦‚æœæƒ³è¦åœ¨Reactç»‘å®šæˆ–è§£ç»‘DOMèŠ‚ç‚¹çš„refæ—¶è¿è¡ŒæŸäº›ä»£ç ï¼Œåˆ™éœ€è¦ä½¿ç”¨å›è°ƒrefæ¥å®ç°ã€‚</p><h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><blockquote><p>å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£</p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;React Hooksåˆæ¢&lt;/p&gt;
    
    </summary>
    
      <category term="React" scheme="http://Lry0504.github.io/categories/React/"/>
    
    
      <category term="å‰ç«¯" scheme="http://Lry0504.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>Jsæ•°ç»„å»é‡</title>
    <link href="http://Lry0504.github.io//posts/4/"/>
    <id>http://Lry0504.github.io//posts/4/</id>
    <published>2019-10-15T02:08:22.198Z</published>
    <updated>2019-10-16T07:47:13.884Z</updated>
    
    <content type="html"><![CDATA[<p>Jsæ•°ç»„å»é‡çš„å‡ ç§å®ç°æ–¹å¼</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Jsæ•°ç»„å»é‡é—®é¢˜ï¼Œæ˜¯é¢è¯•å½“ä¸­çš„ç»å…¸é—®é¢˜ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒåŸºç¡€çš„é—®é¢˜äº†ï¼Œä¸‹é¢æ€»ç»“å‡ ç§æ¯”è¾ƒå¸¸è§çš„æ“ä½œ</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/unique.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><h3 id="åŒå±‚å¾ªç¯"><a href="#åŒå±‚å¾ªç¯" class="headerlink" title="åŒå±‚å¾ªç¯"></a>åŒå±‚å¾ªç¯</h3><blockquote><p>æ€è·¯ï¼šåˆ©ç”¨åŒå±‚å¾ªç¯åµŒå¥—ï¼Œç„¶åç”¨spliceå»é‡ã€‚å½“å¾ªç¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå€¼å’Œç¬¬äºŒä¸ªå€¼ç›¸åŒçš„æ—¶å€™ï¼Œç”¨spliceåˆ é™¤ç¬¬äºŒä¸ªå€¼</p></blockquote><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,1,"true",true,"false",false,NaN,null,NaN,"NaN",null,undefined,15,undefined,15,{},0,"a",{},0,"a"];</span><br><span class="line">function unique(arr) {</span><br><span class="line">  for(var i = 0; i &lt; arr.length; i++) {</span><br><span class="line">    for(var j = i + 1; j &lt; arr.length; j++) {</span><br><span class="line">      if(arr[i] === arr[j]) {</span><br><span class="line">        arr.splice(j, 1);</span><br><span class="line">        j--;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  return arr;</span><br><span class="line">}</span><br><span class="line">console.log(unique(arr)); //[1, "true", true, "false", false, NaN, null, NaN, "NaN", undefined, 15, {â€¦}, 0, "a", {â€¦}]</span><br></pre></td></tr></tbody></table></figure><p>ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼ŒåŒå±‚å¾ªç¯<em>ä¸èƒ½å»é‡ NaN å’Œ {}</em></p><h3 id="indexOfå¾ªç¯"><a href="#indexOfå¾ªç¯" class="headerlink" title="indexOfå¾ªç¯"></a>indexOfå¾ªç¯</h3><blockquote><p>æ€è·¯ï¼šåˆ©ç”¨indexOfå¾ªç¯æ•°ç»„ï¼Œåˆ¤æ–­ç»“æœæ•°ç»„resä¸­æ˜¯å¦å­˜åœ¨å½“å‰å…ƒç´ ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è·³è¿‡ï¼Œå¦åˆ™æŠŠå½“å‰å…ƒç´ æ·»åŠ åˆ°ç»“æœæ•°ç»„resä¸­</p></blockquote><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,1,"true",true,"false",false,NaN,null,NaN,"NaN",null,undefined,15,undefined,15,{},0,"a",{},0,"a"];</span><br><span class="line">function unique(arr) {</span><br><span class="line">  var res = [];</span><br><span class="line">  for(var i = 0; i &lt; arr.length; i++) {</span><br><span class="line">    if(res.indexOf(arr[i]) === -1) {</span><br><span class="line">      res.push(arr[i]);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  return res;</span><br><span class="line">}</span><br><span class="line">console.log(unique(arr)); //[1, "true", true, "false", false, NaN, null, NaN, "NaN", undefined, 15, {â€¦}, 0, "a", {â€¦}]</span><br></pre></td></tr></tbody></table></figure><p>ä»æ‰“å°ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨indexOfå¾ªç¯æ•°ç»„ï¼Œä¹Ÿ<em>ä¸èƒ½å»é‡ NaN å’Œ {}</em></p><h3 id="æ’åºåå»é‡"><a href="#æ’åºåå»é‡" class="headerlink" title="æ’åºåå»é‡"></a>æ’åºåå»é‡</h3><blockquote><p>æ€è·¯ï¼šå°†æ•°ç»„ä½¿ç”¨sortæ’åºåï¼Œç›¸åŒçš„å€¼ä¾¿ä¼šæ’åœ¨ä¸€èµ·ï¼Œè¿™æ ·æˆ‘ä»¬åªéœ€è¦åˆ¤æ–­å½“å‰çš„å…ƒç´ ä¸ä¸Šä¸€ä¸ªå…ƒç´ æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒï¼Œå°±è¯´æ˜é‡å¤ï¼Œå¦åˆ™pushè¿›res</p></blockquote><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,1,"true",true,"false",false,NaN,null,NaN,"NaN",null,undefined,15,undefined,15,{},0,"a",{},0,"a"];</span><br><span class="line">function unique(arr) {</span><br><span class="line">  arr = arr.sort();</span><br><span class="line">  var res = [arr[0]];</span><br><span class="line">  for(var i = 1; i &lt; arr.length; i++) {</span><br><span class="line">    if(arr[i] !== arr[i-1]) {</span><br><span class="line">      res.push(arr[i]);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  return res;</span><br><span class="line">}</span><br><span class="line">console.log(unique(arr)); //[0, 1, 15, NaN, NaN, "NaN", {â€¦}, {â€¦}, "a", "false", false, null, "true", true, undefined]</span><br></pre></td></tr></tbody></table></figure><p>ä»æ‰“å°ç»“æœæ¥çœ‹ï¼Œä½¿ç”¨sortæ’åºåå»é‡ï¼Œä¹Ÿ<em>ä¸èƒ½å»é‡ NaN å’Œ {}</em></p><h3 id="åˆ©ç”¨includes"><a href="#åˆ©ç”¨includes" class="headerlink" title="åˆ©ç”¨includes"></a>åˆ©ç”¨includes</h3><blockquote><p>æ€è·¯ï¼šincludesä¸»è¦ç”¨æ¥æµ‹è¯•æ•°ç»„ä¸­æ˜¯å¦å«æœ‰æŸä¸ªå€¼</p></blockquote><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,1,"true",true,"false",false,NaN,null,NaN,"NaN",null,undefined,15,undefined,15,{},0,"a",{},0,"a"];</span><br><span class="line">function unique(arr) {</span><br><span class="line">  var res = [];</span><br><span class="line">  for(var i = 0; i &lt; arr.length; i++) {</span><br><span class="line">    if(!res.includes(arr[i])) {</span><br><span class="line">      res.push(arr[i]);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  return res;</span><br><span class="line">}</span><br><span class="line">console.log(unique(arr)); //[1, "true", true, "false", false, NaN, null, "NaN", undefined, 15, {â€¦}, 0, "a", {â€¦}]</span><br></pre></td></tr></tbody></table></figure><p>ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåˆ©ç”¨includeså»é‡ï¼Œ<em>ä¸èƒ½å»é‡ {}</em></p><h3 id="åˆ©ç”¨filter"><a href="#åˆ©ç”¨filter" class="headerlink" title="åˆ©ç”¨filter"></a>åˆ©ç”¨filter</h3><blockquote><p>æ€è·¯ï¼šfåˆ¤æ–­æ•°ç»„ä¸­ï¼Œå½“å‰å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªç´¢å¼•æ˜¯å¦æ˜¯filterä¸­å½“å‰ç´¢å¼•å€¼</p></blockquote><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,1,"true",true,"false",false,NaN,null,NaN,"NaN",null,undefined,15,undefined,15,{},0,"a",{},0,"a"];</span><br><span class="line">function unique(arr) {</span><br><span class="line">  return arr.filter(function(item, index, arr) {</span><br><span class="line">    return arr.indexOf(item) === index;</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line">console.log(unique(arr)); //[1, "true", true, "false", false, null, "NaN", undefined, 15, {â€¦}, 0, "a", {â€¦}]</span><br></pre></td></tr></tbody></table></figure><p>ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåˆ©ç”¨filterå»é‡ï¼Œ<em>æŠŠ NaN å»æ‰äº†ï¼Œå¹¶ä¸”ä¸èƒ½å»é‡ {}</em></p><h3 id="åˆ©ç”¨reduce-includes"><a href="#åˆ©ç”¨reduce-includes" class="headerlink" title="åˆ©ç”¨reduce+includes"></a>åˆ©ç”¨reduce+includes</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,1,"true",true,"false",false,NaN,null,NaN,"NaN",null,undefined,15,undefined,15,{},0,"a",{},0,"a"];</span><br><span class="line">function unique(arr) {</span><br><span class="line">  return arr.reduce((acc, cur) =&gt; </span><br><span class="line">    acc.includes(cur) ? acc : [...acc, cur], []</span><br><span class="line">  )</span><br><span class="line">}</span><br><span class="line">console.log(unique(arr)); //[1, "true", true, "false", false, NaN, null, "NaN", undefined, 15, {â€¦}, 0, "a", {â€¦}]</span><br></pre></td></tr></tbody></table></figure><p>ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåˆ©ç”¨reduce+includeså»é‡ï¼Œ<em>ä¸èƒ½å»é‡ {}</em></p><h3 id="åˆ©ç”¨Set"><a href="#åˆ©ç”¨Set" class="headerlink" title="åˆ©ç”¨Set"></a>åˆ©ç”¨Set</h3><blockquote><p>æ€è·¯ï¼šSetå¯¹è±¡æ˜¯å€¼çš„é›†åˆï¼Œä½ å¯ä»¥æŒ‰ç…§æ’å…¥çš„é¡ºåºè¿­ä»£å®ƒçš„å…ƒç´ ã€‚ Setä¸­çš„å…ƒç´ åªä¼šå‡ºç°ä¸€æ¬¡ï¼Œå³ Set ä¸­çš„å…ƒç´ æ˜¯å”¯ä¸€çš„</p></blockquote><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,1,"true",true,"false",false,NaN,null,NaN,"NaN",null,undefined,15,undefined,15,{},0,"a",{},0,"a"];</span><br><span class="line">function unique(arr) {</span><br><span class="line">  return Array.from(new Set(arr));</span><br><span class="line">}</span><br><span class="line">console.log(unique(arr)); // [1, "true", true, "false", false, NaN, null, "NaN", undefined, 15, {â€¦}, 0, "a", {â€¦}]</span><br></pre></td></tr></tbody></table></figure><p>ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåˆ©ç”¨ES6æ–°è¯­æ³•Setå»é‡ï¼Œ<em>ä¸èƒ½å»é‡ {}</em>ã€‚ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>Array.from(new Set(arr))</code>å¯ä»¥ç®€åŒ–ä¸º<code>[... new Set(arr)]</code></p><h3 id="åˆ©ç”¨hasOwnProperty"><a href="#åˆ©ç”¨hasOwnProperty" class="headerlink" title="åˆ©ç”¨hasOwnProperty"></a>åˆ©ç”¨hasOwnProperty</h3><p>hasOwnPropertyæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºå¯¹è±¡è‡ªèº«å±æ€§ä¸­æ˜¯å¦å…·æœ‰æŒ‡å®šçš„å±æ€§ï¼ˆæ˜¯å¦æœ‰æŒ‡å®šçš„é”®ï¼‰ï¼Œæ­¤æ–¹æ³•æ— æ³•æ£€æŸ¥è¯¥å¯¹è±¡çš„åŸå‹é“¾ä¸­æ˜¯å¦å…·æœ‰è¯¥å±æ€§ï¼Œè¯¥å±æ€§å¿…é¡»æ˜¯å¯¹è±¡æœ¬èº«çš„ä¸€ä¸ªæˆå‘˜ã€‚</p><blockquote><p>æ€è·¯ï¼šåˆ©ç”¨ä¸€ä¸ªç©ºå¯¹è±¡objï¼ŒæŠŠæ•°ç»„çš„å€¼å­˜æˆobjå¯¹è±¡çš„keyå€¼ï¼Œå¦‚obj[arr[item1]] = trueï¼Œåˆ¤æ–­å¦ä¸€ä¸ªå€¼obj[arr[item2]]æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ˜¯ç›¸åŒçš„å€¼</p></blockquote><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,"1",2,2,1];</span><br><span class="line">function unique(arr) {</span><br><span class="line">  var obj = {};</span><br><span class="line">  return arr.filter(function(item, index, arr) {</span><br><span class="line">    return obj.hasOwnProperty(item) ? false : (obj[item] = true)</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line">console.log(unique(arr)); //[1,2]</span><br></pre></td></tr></tbody></table></figure><p>ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å­˜åœ¨é—®é¢˜çš„ã€‚â€1â€å’Œ1æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯<strong>Object[1]å’ŒObject[â€œ1â€]å´æ˜¯åŒä¸€ä¸ªå¼•ç”¨ï¼ˆå¯¹è±¡keyå€¼åªèƒ½æ˜¯å­—ç¬¦ä¸²ï¼‰</strong><br>è§£å†³åŠæ³•ï¼šä½¿ç”¨<code>typeof item + item</code>æ‹¼æˆå­—ç¬¦ä¸²ä½œä¸ºkeyå€¼</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,"1",2,2,1,{value: 1},{value: 1},{value: 2}];</span><br><span class="line">function unique(arr) {</span><br><span class="line">  var obj = {};</span><br><span class="line">  return arr.filter(function(item, index, arr) {</span><br><span class="line">    return obj.hasOwnProperty(typeof item + item) ? false : (obj[typeof item + item] = true)</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line">console.log(unique(arr)); //[1, "1", 2, {value: 1}]</span><br></pre></td></tr></tbody></table></figure><p>ä»æ‰“å°ç»“æœä»èƒ½çœ‹å‡ºï¼Œå¦‚æœæ•°ç»„ä¸­å­˜åœ¨å¯¹è±¡æ—¶ï¼Œå¦‚{value: 1}ï¼Œtypeof item + itemçš„ç»“æœéƒ½æ˜¯<code>object[object Object]</code><br>è§£å†³æ–¹æ³•ï¼šä½¿ç”¨JSON.stringify()å°†å¯¹è±¡åºåˆ—åŒ–æ¥é¿å…ç›¸åŒçš„é”®å€¼</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,"1",2,2,1,{value: 1},{value: 1},{value: 2}];</span><br><span class="line">function unique(arr) {</span><br><span class="line">  var obj = {};</span><br><span class="line">  return arr.filter(function(item, index, arr) {</span><br><span class="line">    return obj.hasOwnProperty(typeof item + JSON.stringify(item)) ? false : (obj[typeof item + JSON.stringify(item)] = true)</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line">console.log(unique(arr)); //[1, "1", 2, {value: 1}, {value: 2}]</span><br></pre></td></tr></tbody></table></figure><p>åˆ©ç”¨hasOwnPropertyå»é‡ï¼Œ<em>å¯ä»¥å»é‡æ‰€æœ‰æƒ…å†µ</em></p><h3 id="åˆ©ç”¨Map"><a href="#åˆ©ç”¨Map" class="headerlink" title="åˆ©ç”¨Map"></a>åˆ©ç”¨Map</h3><blockquote><p>æ€è·¯ï¼šåˆ›å»ºä¸€ä¸ªç©ºçš„Mapæ•°æ®ç»“æ„ï¼Œéå†éœ€è¦å»é‡çš„æ•°ç»„ï¼ŒæŠŠæ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ ä½œä¸ºkeyå­˜åˆ°Mapä¸­ã€‚ç”±äºMapä¸­ä¸ä¼šå‡ºç°ç›¸åŒçš„keyå€¼ï¼Œæ‰€ä»¥æœ€ç»ˆå¾—åˆ°çš„å°±æ˜¯å»é‡åçš„ç»“æœ</p></blockquote><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,1,"true",true,"false",false,NaN,null,NaN,"NaN",null,undefined,15,undefined,15,{},0,"a",{},0,"a"];</span><br><span class="line">function unique(arr) {</span><br><span class="line">  let map = new Map();</span><br><span class="line">  let array = [];</span><br><span class="line">  for(let i = 0; i &lt; arr.length; i++) {</span><br><span class="line">    if(map.has(arr[i])) { //å¦‚æœæœ‰è¯¥keyå€¼</span><br><span class="line">      map.set(arr[i], true);</span><br><span class="line">    } else {</span><br><span class="line">      map.set(arr[i], false);</span><br><span class="line">      array.push(arr[i]);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  return array;</span><br><span class="line">}</span><br><span class="line">console.log(unique(arr)); //[1, "true", true, "false", false, NaN, null, "NaN", undefined, 15, {â€¦}, 0, "a", {â€¦}]</span><br></pre></td></tr></tbody></table></figure><p>ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåˆ©ç”¨mapæ•°æ®ç»“æ„ <em>ä¸èƒ½å»é‡ {}</em></p><h3 id="åˆ©ç”¨é€’å½’"><a href="#åˆ©ç”¨é€’å½’" class="headerlink" title="åˆ©ç”¨é€’å½’"></a>åˆ©ç”¨é€’å½’</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,1,"true",true,"false",false,NaN,null,NaN,"NaN",null,undefined,15,undefined,15,{},0,"a",{},0,"a"];</span><br><span class="line">function unique(arr) {</span><br><span class="line">  arr.sort(function(a, b) {</span><br><span class="line">    return a- b;</span><br><span class="line">  })</span><br><span class="line">  function loop(index) {</span><br><span class="line">    if(index &gt;= 1) {</span><br><span class="line">      if(arr[index] === arr[index - 1]) {</span><br><span class="line">        arr.splice(index, 1);</span><br><span class="line">      }</span><br><span class="line">      loop(index - 1); //é€’å½’loop</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  loop(arr.length - 1);</span><br><span class="line">  return arr;</span><br><span class="line">}</span><br><span class="line">console.log(unique(arr)); //[1, "true", true, "false", false, NaN, null, NaN, "NaN", null, 15, {â€¦}, 0, "a", {â€¦}, 0, "a", undefined]</span><br></pre></td></tr></tbody></table></figure><p>ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåˆ©ç”¨é€’å½’å»é‡æ•°ç»„ï¼Œ<em>ä¸èƒ½å»é‡ NaN null 0 â€œaâ€ {}</em></p><h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><blockquote><p>å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£~</p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Jsæ•°ç»„å»é‡çš„å‡ ç§å®ç°æ–¹å¼&lt;/p&gt;
    
    </summary>
    
      <category term="Js" scheme="http://Lry0504.github.io/categories/Js/"/>
    
    
      <category term="å‰ç«¯" scheme="http://Lry0504.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>Jsæ•°ç»„æ‰å¹³åŒ–</title>
    <link href="http://Lry0504.github.io//posts/3/"/>
    <id>http://Lry0504.github.io//posts/3/</id>
    <published>2019-10-14T03:12:25.688Z</published>
    <updated>2020-01-02T11:02:23.021Z</updated>
    
    <content type="html"><![CDATA[<p>Jsæ•°ç»„æ‰å¹³åŒ–çš„å‡ ç§å®ç°æ–¹å¼</p><a id="more"></a><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/flatten.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ•°ç»„æ‰å¹³åŒ–ï¼Œå°±æ˜¯å°†ä¸€ä¸ªå­˜åœ¨å¤šå±‚åµŒå¥—çš„æ•°ç»„arrayï¼Œè½¬åŒ–ä¸ºåªæœ‰ä¸€å±‚çš„æ•°ç»„ã€‚å‡è®¾å­˜åœ¨ä¸€ä¸ªå‡½æ•°flattenå¯ä»¥å°†æ•°ç»„æ‰å¹³åŒ–ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾—åˆ°å¦‚ä¸‹æ•ˆæœï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var array = [1, [2], [[3]]];</span><br><span class="line">console.log(flatten(array)); //[1,2,3]</span><br></pre></td></tr></tbody></table></figure><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><h3 id="é€’å½’è°ƒç”¨"><a href="#é€’å½’è°ƒç”¨" class="headerlink" title="é€’å½’è°ƒç”¨"></a>é€’å½’è°ƒç”¨</h3><blockquote><p>æ€è·¯ï¼šå¾ªç¯éå†è¯¥æ•°ç»„ï¼Œåˆ¤æ–­å¾ªç¯çš„å…ƒç´ æ˜¯å¦ä»æ˜¯æ•°ç»„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™é€’å½’è°ƒç”¨è¯¥æ–¹æ³•</p></blockquote><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var array = [[1,2,3],4,5,6,[[7]],[]];</span><br><span class="line">function flatten(arr, result = []) {</span><br><span class="line">  for(let item of arr) {</span><br><span class="line">    if(Array.isArray(item)) {</span><br><span class="line">      flatten(item, result);</span><br><span class="line">    } else {</span><br><span class="line">      result.push(item);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  return result;</span><br><span class="line">}</span><br><span class="line">console.log(flatten(array)); //[1,2,3,4,5,6,7]</span><br></pre></td></tr></tbody></table></figure><h3 id="reduceè°ƒç”¨"><a href="#reduceè°ƒç”¨" class="headerlink" title="reduceè°ƒç”¨"></a>reduceè°ƒç”¨</h3><blockquote><p>æ€è·¯ï¼šåˆ©ç”¨reduceæ­é…concatã€‚reduceéå†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå¦‚æœè¯¥å…ƒç´ ä»ç„¶æ˜¯æ•°ç»„ï¼Œåˆ™é‡æ–°è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¦åˆ™å°†è¯¥å…ƒç´ concatåˆ°æ•°ç»„ä¸­</p></blockquote><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var array = [[1,2,3],4,5,6,[[7]],[]];</span><br><span class="line">function flatten(arr) {</span><br><span class="line">  return arr.reduce(function(acc, cur) {</span><br><span class="line">    return acc.concat(Array.isArray(cur) ? flatten(cur) : cur);</span><br><span class="line">  }, [])</span><br><span class="line">}</span><br><span class="line">console.log(flatten(array));</span><br></pre></td></tr></tbody></table></figure><h3 id="ES6æ‰©å±•è¿ç®—ç¬¦"><a href="#ES6æ‰©å±•è¿ç®—ç¬¦" class="headerlink" title="ES6æ‰©å±•è¿ç®—ç¬¦"></a>ES6æ‰©å±•è¿ç®—ç¬¦</h3><p>ES6ä¸­çš„æ‰©å±•è¿ç®—ç¬¦ç”¨æ¥å–å‡ºå‚æ•°å¯¹è±¡ä¸­çš„æ‰€æœ‰å¯éå†å±æ€§ï¼Œæ‹·è´åˆ°å½“å‰å¯¹è±¡ä¸­</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,2,[3,[4]]];</span><br><span class="line">console.log([].concat(...arr)); //[1,2,3,[4]]</span><br></pre></td></tr></tbody></table></figure><p><code>[].concat(...arr)</code>åªèƒ½æ‹‰å¹³ä¸€å±‚æ•°ç»„ï¼Œä½†æ˜¯æˆ‘ä»¬å¾ˆå®¹æ˜“æ®æ­¤æƒ³åˆ°ï¼Œåˆ©ç”¨<code>while</code>å¾ªç¯åˆ¤æ–­æ•°ç»„ä¸­æŸä¸ªå…ƒç´ æ˜¯å¦ä»ä¸ºæ•°ç»„ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªå…ƒç´ ä¸ºæ•°ç»„ï¼Œåˆ™ç»§ç»­æ‹‰å¹³</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var array = [[1,2,3],4,5,6,[[7]],[]];</span><br><span class="line">function flatten(arr) {</span><br><span class="line">  while(arr.some(item =&gt; Array.isArray(item))) {</span><br><span class="line">    arr = [].concat(...arr);</span><br><span class="line">  }</span><br><span class="line">  return arr;</span><br><span class="line">}</span><br><span class="line">console.log(flatten(array)); //[1,2,3,4,5,6,7]</span><br></pre></td></tr></tbody></table></figure><h3 id="flatè°ƒç”¨"><a href="#flatè°ƒç”¨" class="headerlink" title="flatè°ƒç”¨"></a>flatè°ƒç”¨</h3><p>arr.flat(index)å¯ä»¥æ‹‰å¹³æ•°ç»„ï¼Œå…¶ä¸­indexè¡¨ç¤ºæ‹‰å¹³å¤šå°‘å±‚æ•°ç»„ï¼Œå¦‚æœè¦æ‹‰å¹³æ— é™å±‚æ•°ç»„ï¼Œåˆ™å¯ä»¥è¡¨ç¤ºä¸º<code>arr.flat(Infinity)</code></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,[2,[3,4,[]]]];</span><br><span class="line">console.log(arr.flat(Infinity)); //[1,2,3,4]</span><br></pre></td></tr></tbody></table></figure><h3 id="toStringè°ƒç”¨"><a href="#toStringè°ƒç”¨" class="headerlink" title="toStringè°ƒç”¨"></a>toStringè°ƒç”¨</h3><p>å¦‚æœæ•°ç»„ä¸­çš„å…ƒç´ éƒ½æ˜¯æ•°å­—ï¼Œæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘toStringæ–¹æ³•</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1,[2,[3,4]]].toString(); //"1,2,3,4"</span><br></pre></td></tr></tbody></table></figure><blockquote><p>æ€è·¯ï¼šè°ƒç”¨toStringæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªç”¨é€—å·åˆ†éš”çš„æ‰å¹³å­—ç¬¦ä¸²ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨splitåˆ†éš”é€—å·ï¼Œå¾—åˆ°ä¸€ä¸ªstringç±»å‹çš„æ•°ç»„ï¼Œå†éå†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå°†å…¶è½¬åŒ–æˆnumberç±»å‹</p></blockquote><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,[2,[3,4]]];</span><br><span class="line">function flatten(arr) {</span><br><span class="line">  return arr.toString().split(",").map(function(item) {</span><br><span class="line">    return +item;</span><br><span class="line">  })</span><br><span class="line">}</span><br><span class="line">console.log(flatten(arr)); //[1,2,3,4]</span><br></pre></td></tr></tbody></table></figure><p>ç„¶è€Œï¼Œä¸Šé¢çš„æ–¹æ³•å­˜åœ¨å¾ˆå¤§çš„å±€é™æ€§ï¼š</p><ol><li>å¦‚æœarrä¸­å­˜åœ¨ç©ºæ•°ç»„ï¼Œåˆ™ç©ºæ•°ç»„å°†ä¼šè¢«è½¬æ¢ä¸ºç©ºå­—ç¬¦ä¸²</li><li>å¦‚æœæ•°ç»„ä¸­å­˜åœ¨éæ•°å­—ï¼Œæ¯”å¦‚[1,â€1â€]ï¼Œåˆ™ä¼šäº§ç”Ÿé”™è¯¯çš„ç»“æœ</li></ol><h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><blockquote><p>å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£</p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Jsæ•°ç»„æ‰å¹³åŒ–çš„å‡ ç§å®ç°æ–¹å¼&lt;/p&gt;
    
    </summary>
    
      <category term="Js" scheme="http://Lry0504.github.io/categories/Js/"/>
    
    
      <category term="å‰ç«¯" scheme="http://Lry0504.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>å‡½æ•°é˜²æŠ–ä¸èŠ‚æµ</title>
    <link href="http://Lry0504.github.io//posts/2/"/>
    <id>http://Lry0504.github.io//posts/2/</id>
    <published>2019-10-12T03:07:29.083Z</published>
    <updated>2019-10-12T08:42:57.351Z</updated>
    
    <content type="html"><![CDATA[<p>é˜²æŠ–debounceä¸èŠ‚æµthrottleçš„å®ç°</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°ä¸€äº›é¢‘ç¹çš„äº‹ä»¶è§¦å‘ï¼ˆæ»šåŠ¨æ¡æ»‘åŠ¨ã€é¼ æ ‡äº‹ä»¶ã€æœç´¢æ¡†æœç´¢â€¦ï¼‰ï¼Œå¦‚æœä¸åŠ ä»¥é™åˆ¶çš„è¯ï¼Œå¯èƒ½ä¼šé€ æˆæµè§ˆå™¨å¡é¡¿ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå‡ºç°äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>debounceé˜²æŠ–</li><li>throttleèŠ‚æµ</li></ol><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/debounce_throttle.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><h3 id="é˜²æŠ–å‡½æ•°"><a href="#é˜²æŠ–å‡½æ•°" class="headerlink" title="é˜²æŠ–å‡½æ•°"></a>é˜²æŠ–å‡½æ•°</h3><p>å®šä¹‰ï¼šè§¦å‘äº‹ä»¶åï¼Œåœ¨nç§’åæ‰ä¼šæ‰§è¡Œï¼›å¦‚æœåœ¨nç§’å†…åˆé‡æ–°è§¦å‘äº†è¯¥äº‹ä»¶ï¼Œåˆ™ä»¥é‡æ–°è§¦å‘è¯¥äº‹ä»¶çš„æ—¶é—´ä¸ºå‡†ï¼Œnç§’åå†æ‰§è¡Œã€‚æ€»ä¹‹å°±æ˜¯ï¼š<em>è§¦å‘äº‹ä»¶nç§’å†…ä¸å†è§¦å‘è¯¥äº‹ä»¶æ‰æ‰§è¡Œï¼Œå¦‚æœnç§’å†…å†æ¬¡è§¦å‘è¯¥äº‹ä»¶ï¼Œåˆ™é‡æ–°è®¡ç®—nç§’åå†æ‰§è¡Œ</em>ï¼ˆä»»æ€§å•Šâ€¦ï¼‰</p><h4 id="åˆç‰ˆé˜²æŠ–å‡½æ•°çš„å®ç°"><a href="#åˆç‰ˆé˜²æŠ–å‡½æ•°çš„å®ç°" class="headerlink" title="åˆç‰ˆé˜²æŠ–å‡½æ•°çš„å®ç°"></a>åˆç‰ˆé˜²æŠ–å‡½æ•°çš„å®ç°</h4><blockquote><p>å®ç°æ€è·¯ï¼šé€šè¿‡å®šæ—¶å™¨æ§åˆ¶funcæ˜¯å¦å®ç°<br>1ã€æ¯æ¬¡è§¦å‘é˜²æŠ–å‡½æ•°æ—¶ï¼Œå…ˆæ¸…é™¤ä¸Šä¸€æ¬¡çš„å®šæ—¶å™¨ï¼Œå†å¼€å¯æœ¬æ¬¡è§¦å‘å®šæ—¶å™¨<br>2ã€ç»‘å®šthisæŒ‡å‘ï¼šä½¿ç”¨é˜²æŠ–å‡½æ•°åï¼Œfuncä¸­çš„thisä¼šæŒ‡å‘windowï¼Œè¦è®©thisæŒ‡å‘funcä¸Šä¸‹æ–‡ï¼Œåˆ™éœ€è¦ç»‘å®šthisæŒ‡å‘ -&gt; func.apply(context)<br>3ã€ç»‘å®ševentäº‹ä»¶ï¼šäº‹ä»¶å¤„ç†å‡½æ•°ä¸­ä¼šæä¾›äº‹ä»¶å¯¹è±¡eventï¼Œä½†æ˜¯åœ¨debounceå‡½æ•°ä¸­æ‰“å°ä¼šæ˜¯undefinedï¼Œæ‰€ä»¥éœ€è¦å¯¹eventå¯¹è±¡ç‰¹æ®Šå¤„ç† -&gt; func.apply(context, args)</p></blockquote><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function debounce(func, wait) {</span><br><span class="line">  var timeout;</span><br><span class="line">  return function() {</span><br><span class="line">    var context = this;</span><br><span class="line">    var args = arguments;</span><br><span class="line">    clearTimeout(timeout);</span><br><span class="line">    timeout = setTimeout(function() {</span><br><span class="line">      func.apply(context, args);</span><br><span class="line">    },wait);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="é˜²æŠ–å‡½æ•°çš„ç«‹å³æ‰§è¡Œ"><a href="#é˜²æŠ–å‡½æ•°çš„ç«‹å³æ‰§è¡Œ" class="headerlink" title="é˜²æŠ–å‡½æ•°çš„ç«‹å³æ‰§è¡Œ"></a>é˜²æŠ–å‡½æ•°çš„ç«‹å³æ‰§è¡Œ</h4><p>åœ¨åˆç‰ˆå‡½æ•°çš„åŸºç¡€ä¸Šï¼Œè€ƒè™‘ä¸ªæ–°çš„éœ€æ±‚ï¼šæˆ‘ä¸å¸Œæœ›è¦ç­‰åˆ°äº‹ä»¶åœæ­¢è§¦å‘nç§’åæ‰æ‰§è¡Œï¼Œæˆ‘å¸Œæœ›å®ƒèƒ½å¤Ÿç«‹å³æ‰§è¡Œï¼Œç„¶ååœæ­¢è§¦å‘nç§’åæ‰å¯ä»¥é‡æ–°è§¦å‘æ‰§è¡Œ</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function debounce(func, wait, immediate) {</span><br><span class="line">  var timeout,result;</span><br><span class="line">  return function() {</span><br><span class="line">    var context = this;</span><br><span class="line">    var args = arguments;</span><br><span class="line">    if(timeout) clearTimeout(timeout);</span><br><span class="line">    if(immediate) {</span><br><span class="line">      //å¦‚æœå·²ç»æ‰§è¡Œè¿‡ï¼Œä¸å†æ‰§è¡Œ</span><br><span class="line">      var callNow = !timeout;</span><br><span class="line">      //å®šæ—¶å™¨ç»“æŸå¹¶è®¾ç½®ä¸ºnullï¼Œåˆ™å¯ä»¥å†æ¬¡ç‚¹å‡»æ‰§è¡Œäº†</span><br><span class="line">      timeout = setTimeout(function() {</span><br><span class="line">        timeout = null;</span><br><span class="line">      }, wait);</span><br><span class="line">      if(callNow) result = func.apply(context, args);</span><br><span class="line">    } else {</span><br><span class="line">      timeout = setTimeout(function() {</span><br><span class="line">        func.apply(context, args);</span><br><span class="line">      }, wait);</span><br><span class="line">    }</span><br><span class="line">    return result;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šfuncå‡½æ•°æ—¶å¯èƒ½æœ‰è¿”å›å€¼çš„ï¼Œæ‰€ä»¥debounceå‡½æ•°æˆ‘ä»¬ä¹Ÿéœ€è¦æ·»åŠ è¿”å›ç»“æœresultã€‚å½“immediateä¸ºfalseæ—¶ï¼Œå› ä¸ºsetTimeoutå‡½æ•°çš„å­˜åœ¨ï¼Œreturnå‡ºæ¥çš„å€¼ä¸€ç›´éƒ½æ˜¯undefinedï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åœ¨immediateä¸ºtrueçš„æ—¶å€™æ‰æ·»åŠ è¿”å›ç»“æœã€‚</p><h3 id="èŠ‚æµå‡½æ•°"><a href="#èŠ‚æµå‡½æ•°" class="headerlink" title="èŠ‚æµå‡½æ•°"></a>èŠ‚æµå‡½æ•°</h3><p>å®šä¹‰ï¼šåœ¨è§„å®šçš„æ—¶é—´å†…ï¼Œåªèƒ½è§¦å‘ä¸€æ¬¡äº‹ä»¶ï¼›å¦‚æœè§„å®šæ—¶é—´å†…å†è§¦å‘å¤šæ¬¡ï¼Œåˆ™ä»€ä¹ˆä¹Ÿä¸åšã€‚</p><h4 id="ä½¿ç”¨æ—¶é—´æˆ³"><a href="#ä½¿ç”¨æ—¶é—´æˆ³" class="headerlink" title="ä½¿ç”¨æ—¶é—´æˆ³"></a>ä½¿ç”¨æ—¶é—´æˆ³</h4><blockquote><p>å®ç°æ€è·¯ï¼š<br>è®¾ç½®æ—¶é—´æˆ³previouså¼€å§‹å€¼ä¸º0ï¼Œå½“è§¦å‘äº‹ä»¶æ—¶ï¼Œå–å‡ºå½“å‰çš„æ—¶é—´æˆ³nowï¼Œå‡å»ä¹‹å‰çš„æ—¶é—´æˆ³previousï¼Œå¦‚æœå¾—åˆ°çš„å€¼å¤§äºè®¾ç½®çš„è§„å®šæ—¶é—´waitï¼Œåˆ™æ‰§è¡Œå‡½æ•°funcï¼Œå¹¶æ›´æ–°æ—¶é—´æˆ³previousä¸ºå½“å‰æ—¶é—´nowï¼›å¦‚æœå°äºï¼Œåˆ™ä¸æ‰§è¡Œã€‚</p></blockquote><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function throttle(func, wait) {</span><br><span class="line">  var context,args;</span><br><span class="line">  var previous = 0;</span><br><span class="line">  return function() {</span><br><span class="line">    var now = +new Date();</span><br><span class="line">    context = this;</span><br><span class="line">    args = arguments;</span><br><span class="line">    if(now - previous &gt; wait) {</span><br><span class="line">      func.apply(context, args);</span><br><span class="line">      previous = now;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="ä½¿ç”¨å®šæ—¶å™¨"><a href="#ä½¿ç”¨å®šæ—¶å™¨" class="headerlink" title="ä½¿ç”¨å®šæ—¶å™¨"></a>ä½¿ç”¨å®šæ—¶å™¨</h4><blockquote><p>å®ç°æ€è·¯ï¼š<br>å½“è§¦å‘äº‹ä»¶çš„æ—¶å€™ï¼Œè®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå†æ¬¡è§¦å‘è¯¥äº‹ä»¶çš„æ—¶å€™ï¼Œå¦‚æœå®šæ—¶å™¨å­˜åœ¨ï¼Œå°±ä¸æ‰§è¡Œfuncï¼Œç›´åˆ°ä¸Šä¸€è½®å®šæ—¶å™¨æ‰§è¡Œå®Œå¹¶ä¸”ä¸ºnullï¼Œæ‰ä¼šæ‰§è¡Œfuncï¼Œå¹¶æ¸…é™¤æœ¬æ¬¡å®šæ—¶å™¨ã€‚</p></blockquote><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function throttle(func, wait) {</span><br><span class="line">  var timeout;</span><br><span class="line">  return function() {</span><br><span class="line">    var context = this;</span><br><span class="line">    var args = arguments;</span><br><span class="line">    if(!timeout) {</span><br><span class="line">      timeout = setTimeout(function() {</span><br><span class="line">        timeout = null;</span><br><span class="line">        func.apply(context, args);</span><br><span class="line">      }, wait);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æ¯”è¾ƒä¸Šé¢<code>ä½¿ç”¨æ—¶é—´æˆ³</code>å’Œ<code>ä½¿ç”¨å®šæ—¶å™¨</code>ä¸¤ä¸ªæ–¹æ³•ä½ ä¼šå‘ç°ï¼š<br>1ã€ä½¿ç”¨æ—¶é—´æˆ³ï¼šè§¦å‘äº‹ä»¶ä¼šç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œåœæ­¢è§¦å‘äº‹ä»¶ä¾¿ä¸å†æ‰§è¡Œ<br>2ã€ä½¿ç”¨å®šæ—¶å™¨ï¼šè§¦å‘äº‹ä»¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œåœ¨nç§’åæ‰æ‰§è¡Œç¬¬ä¸€æ¬¡ï¼›åœæ­¢è§¦å‘äº‹ä»¶åä»ä¼šå†æ‰§è¡Œä¸€æ¬¡<br>ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºä¸€ä¸ªâ€œåŒå‰‘åˆç’§â€ç‰ˆçš„èŠ‚æµå‡½æ•°ï¼šè§¦å‘äº‹ä»¶èƒ½å¤Ÿç«‹å³æ‰§è¡Œï¼Œåœæ­¢è§¦å‘è¿˜èƒ½å†æ‰§è¡Œä¸€æ¬¡</p><h4 id="åŒå‰‘åˆç’§ç‰ˆèŠ‚æµ"><a href="#åŒå‰‘åˆç’§ç‰ˆèŠ‚æµ" class="headerlink" title="åŒå‰‘åˆç’§ç‰ˆèŠ‚æµ"></a>åŒå‰‘åˆç’§ç‰ˆèŠ‚æµ</h4><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">function throttle(func, wait) {</span><br><span class="line">  var timeout, context, args;</span><br><span class="line">  var previous = 0;</span><br><span class="line"></span><br><span class="line">  var later = function() {</span><br><span class="line">    previous = +new Date();</span><br><span class="line">    timeout = null;</span><br><span class="line">    func.apply(context, args)</span><br><span class="line">  };</span><br><span class="line"></span><br><span class="line">  var throttled = function() {</span><br><span class="line">    var now = +new Date();</span><br><span class="line">    //ä¸‹æ¬¡è§¦å‘ func å‰©ä½™çš„æ—¶é—´</span><br><span class="line">    var remaining = wait - (now - previous);</span><br><span class="line">    context = this;</span><br><span class="line">    args = arguments;</span><br><span class="line">    if (remaining &lt;= 0) {</span><br><span class="line">      if (timeout) {</span><br><span class="line">        clearTimeout(timeout);</span><br><span class="line">        timeout = null;</span><br><span class="line">      }</span><br><span class="line">      previous = now;</span><br><span class="line">      func.apply(context, args);</span><br><span class="line">    } else if (!timeout) {</span><br><span class="line">      timeout = setTimeout(later, remaining);</span><br><span class="line">    }</span><br><span class="line">  };</span><br><span class="line">  return throttled;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><blockquote><p>å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£~</p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é˜²æŠ–debounceä¸èŠ‚æµthrottleçš„å®ç°&lt;/p&gt;
    
    </summary>
    
      <category term="Js" scheme="http://Lry0504.github.io/categories/Js/"/>
    
    
      <category term="å‰ç«¯" scheme="http://Lry0504.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>æ­£åˆ™è¡¨è¾¾å¼å­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰</title>
    <link href="http://Lry0504.github.io//posts/1/"/>
    <id>http://Lry0504.github.io//posts/1/</id>
    <published>2019-09-29T00:58:23.390Z</published>
    <updated>2019-10-01T09:34:39.516Z</updated>
    
    <content type="html"><![CDATA[<p>æ­£åˆ™è¡¨è¾¾å¼çš„å­¦ä¹ ä¹‹è·¯â€¦</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨æˆ‘çš„å·¥ä½œå½“ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ˜¯ä½¿ç”¨éå¸¸é¢‘ç¹çš„ï¼Œä½†æ˜¯æœ¬äººå¯¹äºæ­£åˆ™è¡¨è¾¾å¼çš„ç ”ç©¶æ¯”è¾ƒæµ…æ˜¾ï¼Œä¾¿åªå¥½æŠŠå¯¹æ­£åˆ™çš„ä¸€äº›å­¦ä¹ ç†è§£è®°å½•ä¸‹æ¥ï¼Œæ–¹ä¾¿ä»¥åç¿»é˜…ã€‚ï¼ˆæ„Ÿå…´è¶£çš„æœ‹å‹å¯è‡ªè¡Œæœç´¢è€å§šçš„JavaScriptæ­£åˆ™è¡¨è¾¾å¼ç³»åˆ—æ–‡ç« ï¼‰</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/regexp.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><p><em>æ­£åˆ™è¡¨è¾¾å¼æ˜¯åŒ¹é…æ¨¡å¼ï¼Œè¦ä¹ˆåŒ¹é…å­—ç¬¦ï¼Œè¦ä¹ˆåŒ¹é…ä½ç½®</em></p><h3 id="ä¸¤ç§æ¨¡ç³ŠåŒ¹é…"><a href="#ä¸¤ç§æ¨¡ç³ŠåŒ¹é…" class="headerlink" title="ä¸¤ç§æ¨¡ç³ŠåŒ¹é…"></a>ä¸¤ç§æ¨¡ç³ŠåŒ¹é…</h3><ol><li><p>æ¨ªå‘æ¨¡ç³ŠåŒ¹é…ï¼šå¯åŒ¹é…çš„å­—ç¬¦ä¸²é•¿åº¦æ˜¯ä¸å›ºå®šçš„ã€‚å®ç°æ–¹å¼æ˜¯ä½¿ç”¨<code>é‡è¯</code><br>eg1ï¼š{m, n}è¡¨ç¤ºè¿ç»­å‡ºç°æœ€å°‘mæ¬¡ï¼Œæœ€å¤šnæ¬¡<br>eg2ï¼š/ab{2,3}c/è¡¨ç¤ºç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯â€œaâ€ï¼Œåé¢æ˜¯2åˆ°5ä¸ªâ€bâ€ï¼Œæœ€åæ˜¯â€câ€</p></li><li><p>çºµå‘æ¨¡ç³ŠåŒ¹é…ï¼šåŒ¹é…çš„å­—ç¬¦ä¸²å…·ä½“åˆ°æŸä¸€ä½æ—¶ï¼Œå¯ä»¥ä¸æ˜¯æŸä¸ªç¡®å®šçš„å­—ç¬¦ã€‚å®ç°æ–¹å¼æ˜¯ä½¿ç”¨<code>å­—ç¬¦ç»„</code><br>eg1ï¼š[abc]è¡¨ç¤ºåŒ¹é…â€aâ€ã€â€bâ€ã€â€câ€ä¸­çš„ä»»ä¸€å­—ç¬¦<br>eg2ï¼š/a[123]b/å¯ä»¥åŒ¹é…ä¸‰ç§å­—ç¬¦ï¼šâ€a1bâ€ã€â€a2bâ€ã€â€a3bâ€</p></li></ol><h3 id="å­—ç¬¦ç»„"><a href="#å­—ç¬¦ç»„" class="headerlink" title="å­—ç¬¦ç»„"></a>å­—ç¬¦ç»„</h3><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè™½ç„¶å«åšå­—ç¬¦ç»„ï¼ˆå­—ç¬¦ç±»ï¼‰ï¼Œä½†åªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªå­—ç¬¦ã€‚è­¬å¦‚[abc]åŒ¹é…çš„æ˜¯â€aâ€ã€â€bâ€ã€â€câ€å…¶ä¸­ä¹‹ä¸€</p><ol><li><p>èŒƒå›´è¡¨ç¤ºæ³•<br>å¦‚æœä¸€ä¸ªå­—ç¬¦ç»„é‡Œé¢å­—ç¬¦å¤ªå¤šçš„è¯ï¼Œå¯ä»¥ç”¨è¿å­—ç¬¦â€œ-â€æ¥çœç•¥å’Œç®€å†™ã€‚<br>è­¬å¦‚åŒ¹é…å­—æ¯ï¼Œå¯ä»¥å†™ä¸ºï¼š[a-zA-Z]</p><blockquote><p>å¦‚æœéœ€è¦åŒ¹é…çš„å­—ç¬¦å¸¦æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œåˆ™åº”è¯¥æ”¾åœ¨å¼€å¤´ã€ç»“å°¾æˆ–è€…è½¬ä¹‰ï¼Œé¿å…å¼•æ“è®¤ä¸ºæ˜¯ç‰¹æ®Šç”¨æ³•</p></blockquote></li><li><p>æ’é™¤å­—ç¬¦ç»„ï¼ˆå–åï¼‰<br>[^abc]è¡¨ç¤ºä¸€ä¸ªé™¤â€aâ€ã€â€bâ€ã€â€câ€ä¹‹å¤–çš„ä»»æ„å­—ç¬¦ã€‚å­—ç¬¦ç»„ç¬¬ä¸€ä½æ”¾^ï¼ˆè„±å­—ç¬¦ï¼‰è¡¨ç¤ºå–å</p></li><li><p>å¸¸è§ç®€å†™å½¢å¼</p><table><thead><tr><th align="center">å­—ç¬¦ç»„</th><th>å…·ä½“å«ä¹‰</th></tr></thead><tbody><tr><td align="center">\d</td><td>[0-9]ï¼Œè¡¨ç¤ºä¸€ä½æ•°å­—</td></tr><tr><td align="center">\D</td><td>[^0-9]ï¼Œè¡¨ç¤ºé™¤æ•°å­—å¤–çš„ä»»æ„å­—ç¬¦</td></tr><tr><td align="center">\w</td><td>[0-9a-zA-Z_]ï¼Œè¡¨ç¤ºæ•°å­—ã€å¤§å°å†™å­—æ¯ã€ä¸‹åˆ’çº¿</td></tr><tr><td align="center">\W</td><td>[^0-9a-zA-Z]ï¼Œè¡¨ç¤ºéå•è¯å­—ç¬¦</td></tr><tr><td align="center">\s</td><td>[\t\n\v\r\f]ï¼Œè¡¨ç¤ºç©ºç™½ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€æ°´å¹³å‚ç›´åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ã€æ¢é¡µç¬¦ã€å›è½¦ç¬¦</td></tr><tr><td align="center">\S</td><td>[^\t\n\v\r\f]ï¼Œè¡¨ç¤ºéç©ºç™½ç¬¦</td></tr><tr><td align="center">.</td><td>é€šé…ç¬¦ï¼Œè¡¨ç¤ºå‡ ä¹ä»»æ„å­—ç¬¦</td></tr></tbody></table></li></ol><h3 id="é‡è¯"><a href="#é‡è¯" class="headerlink" title="é‡è¯"></a>é‡è¯</h3><ol><li><p>ç®€å†™å½¢å¼</p><table><thead><tr><th align="center">é‡è¯</th><th>å…·ä½“å«ä¹‰</th></tr></thead><tbody><tr><td align="center">{m,}</td><td>è¡¨ç¤ºè‡³å°‘å‡ºç°mæ¬¡</td></tr><tr><td align="center">{m}</td><td>è¡¨ç¤ºå‡ºç°mæ¬¡</td></tr><tr><td align="center">?</td><td>ç­‰ä»·äº{0,1}ï¼Œè¡¨ç¤ºå‡ºç°æˆ–è€…ä¸å‡ºç°</td></tr><tr><td align="center">+</td><td>ç­‰ä»·äº{1,}ï¼Œè¡¨ç¤ºè‡³å°‘å‡ºç°ä¸€æ¬¡</td></tr><tr><td align="center">*</td><td>ç­‰ä»·äº{0,}ï¼Œè¡¨ç¤ºæœ‰å¯èƒ½ä¸å‡ºç°ï¼Œæˆ–å‡ºç°ä»»æ„æ¬¡</td></tr></tbody></table></li><li><p>è´ªå©ªåŒ¹é…ä¸æƒ°æ€§åŒ¹é…<br>è´ªå©ªåŒ¹é…ï¼šåœ¨æ»¡è¶³æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œå°½å¯èƒ½å¤šçš„åŒ¹é…<br>æƒ°æ€§åŒ¹é…ï¼šåœ¨æ»¡è¶³æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œå°½å¯èƒ½å°‘çš„åŒ¹é…</p></li></ol><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var reg1 = /\d{2,5}/g;</span><br><span class="line">var reg2 = /\d{2,5}?/g;</span><br><span class="line">var str = "123 1234 12345 123456";</span><br><span class="line">console.log(str.match(reg1)); //["123", "1234", "12345", "12345"]</span><br><span class="line">console.log(str.match(reg2)); //["12", "12", "34" "12", "34", "12", "34", "56"]</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç å•ç‹¬è¿ç®—æ—¶ï¼Œå‘ˆç°å‡ºäº†ä¸¤ç§ä¸åŒçš„ç»“æœï¼›å…¶ä¸­reg1è¿ç®—æ˜¯è´ªå©ªåŒ¹é…ï¼Œreg2æ˜¯æƒ°æ€§åŒ¹é…(é€šè¿‡åœ¨é‡è¯åé¢åŠ â€ï¼Ÿâ€œå°±èƒ½å®ç°ï¼‰</p><ol start="3"><li>å¤šé€‰åˆ†æ”¯<br>å¤šé€‰åˆ†æ”¯å¯ä»¥æ”¯æŒå¤šä¸ªå­æ¨¡å¼ä»»é€‰å…¶ä¸€ã€‚è­¬å¦‚(p1|p2|p3)ï¼Œå…¶ä¸­p1ï¼Œp2ï¼Œp3æ˜¯å­æ¨¡å¼ï¼Œç”¨ç®¡é“ç¬¦ï¼ˆ|ï¼‰åˆ†éš”è¡¨ç¤ºå…¶ä¸­ä»»ä½•ä¹‹ä¸€ã€‚</li></ol><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var reg = /good|nice/g;</span><br><span class="line">var str = "good idea, nice boy.";</span><br><span class="line">console.log(str.match(reg)); //["good","nice"]</span><br></pre></td></tr></tbody></table></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<em>åˆ†æ”¯ç»“æ„å±äºæƒ°æ€§åŒ¹é…ï¼Œå°±æ˜¯å½“å‰é¢çš„åŒ¹é…ä¸Šäº†ï¼Œåé¢çš„å°±ä¸åœ¨å°è¯•äº†</em></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var reg = /good|goodbye/g;</span><br><span class="line">var str = "goodbye";</span><br><span class="line">console.log(str.match(reg)); //["good"]</span><br></pre></td></tr></tbody></table></figure><h3 id="ç»å…¸æ¡ˆä¾‹åˆ†æ"><a href="#ç»å…¸æ¡ˆä¾‹åˆ†æ" class="headerlink" title="ç»å…¸æ¡ˆä¾‹åˆ†æ"></a>ç»å…¸æ¡ˆä¾‹åˆ†æ</h3><p>åŒ¹é…å­—ç¬¦ï¼Œå…¶å®å°±æ˜¯å­—ç¬¦ä¸²ã€é‡è¯ã€åˆ†æ”¯ç»“æ„çš„ç»„åˆä½¿ç”¨(æ³¨æ„ï¼šæ¡ˆä¾‹ä»£ç ä½¿ç”¨äº†å…¨å±€åŒ¹é…gï¼Œéœ€è¦å•ç‹¬éªŒè¯ï¼Œå¦åˆ™ä¼šå‡ºé”™)</p><ol><li>åŒ¹é…16è¿›åˆ¶é¢œè‰²<blockquote><p>åˆ†æï¼š<br>è¡¨ç¤ºä¸€ä¸ª16è¿›åˆ¶å­—ç¬¦ï¼Œå¯ä»¥ç”¨å­—ç¬¦ç»„[0-9a-fA-F]<br>å…¶ä¸­å­—ç¬¦å¯ä»¥å‡ºç°3æ¬¡æˆ–è€…6æ¬¡ï¼Œéœ€è¦ç”¨é‡è¯å’Œåˆ†æ”¯ç»“æ„ï¼Œä½¿ç”¨åˆ†æ”¯ç»“æ„æ—¶éœ€è¦æ³¨æ„é¡ºåº</p></blockquote></li></ol><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var reg = /#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})/g;</span><br><span class="line">var str = "#FF6600 #fff #CCc";</span><br><span class="line">console.log(str.match(reg)); //["#FF6600","#fff","#CCc"]</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>åŒ¹é…24å°æ—¶åˆ¶æ—¶é—´<blockquote><p>åˆ†æï¼š<br>24å°æ—¶åˆ¶æ—¶é—´å±•ç¤ºä¸»è¦å¦‚ï¼š23ï¼š59ã€02ï¼š01<br>å…±æœ‰4ä¸ªæ•°å­—ï¼Œç¬¬ä¸€ä½æ•°å­—å¯ä»¥æ˜¯[0-2]<br>å½“ç¬¬ä¸€ä½æ•°å­—æ˜¯â€2â€æ—¶ï¼Œç¬¬äºŒä½å¯ä»¥æ˜¯[0-3]ï¼Œå¦åˆ™ç¬¬äºŒä½æ˜¯[0-9]<br>ç¬¬ä¸‰ä½å¯ä»¥æ˜¯[0-5]ï¼Œç¬¬å››ä½å¯æ˜¯æ˜¯[0-9]<br>å¦‚æœè¦æ±‚åŒ¹é…â€2:2â€è¿™ç§æ—¶é—´æ ¼å¼ï¼Œåˆ™å‰é¢çš„0æ˜¯å¯ä»¥çœç•¥çš„</p></blockquote></li></ol><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var reg = /^(0?[0-9]|1[0-9]|[2][0-3]):(0?[0-9]|[1-5][0-9])$/g;</span><br><span class="line">console.log(reg.test("23:59")); //true</span><br><span class="line">console.log(reg.test("02:03")); //true</span><br><span class="line">console.log(reg.test("2:2")); //true</span><br></pre></td></tr></tbody></table></figure><ol start="3"><li>åŒ¹é…æ—¥æœŸï¼ˆyyyy-mm-ddæ ¼å¼ï¼‰<blockquote><p>åˆ†æï¼š<br>å¹´ï¼šå››ä½æ•°å³å¯ï¼Œå¯ä»¥è¡¨ç¤ºä¸º[0-9]{4}<br>æœˆï¼šåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼šâ€01â€ã€â€02â€ã€â€¦ã€â€09â€å’Œâ€10â€ã€â€11â€ã€â€12â€ï¼Œå¯ä»¥è¡¨ç¤ºä¸º(0[1-9]|1[0-2])<br>æ—¥ï¼šæœ€å¤§ä¸º31æ—¥ï¼Œå¯ä»¥è¡¨ç¤ºä¸º(0[1-9]|[12][0-9]|3[01])</p></blockquote></li></ol><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var reg = /^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])$/g;</span><br><span class="line">console.log(reg.test("2017-02-05")); //true</span><br></pre></td></tr></tbody></table></figure><h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><p>æŒæ¡å­—ç¬¦ç»„å’Œé‡è¯çš„å¤§è‡´çŸ¥è¯†ï¼ŒåŸºæœ¬ä¸Šå°±ç®—æ˜¯æ­£åˆ™å…¥é—¨äº†â€¦åç»­å†å­¦ä¹ æœ‰å…³äºæ­£åˆ™è¡¨è¾¾å¼çš„ä½ç½®åŒ¹é…~</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ­£åˆ™è¡¨è¾¾å¼çš„å­¦ä¹ ä¹‹è·¯â€¦&lt;/p&gt;
    
    </summary>
    
      <category term="RegExp" scheme="http://Lry0504.github.io/categories/RegExp/"/>
    
    
      <category term="æ­£åˆ™" scheme="http://Lry0504.github.io/tags/%E6%AD%A3%E5%88%99/"/>
    
  </entry>
  
  <entry>
    <title>ArrayçŸ¥è¯†æ¸…å•</title>
    <link href="http://Lry0504.github.io//posts/0/"/>
    <id>http://Lry0504.github.io//posts/0/</id>
    <published>2019-09-24T14:18:08.775Z</published>
    <updated>2020-01-02T02:17:59.104Z</updated>
    
    <content type="html"><![CDATA[<p>ArrayçŸ¥è¯†æ¸…å•</p><a id="more"></a><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/font-end/Array.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><h3 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h3><p>Arrayæ˜¯JSçš„åŸç”Ÿå¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¯ä»¥ç”¨å®ƒæ¥ç”Ÿæˆæ–°æ•°ç»„</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var arr = new Array(3);</span><br><span class="line">arr.length;  //3</span><br><span class="line">arr;  //[empty x 3]</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒArrayæ„é€ å‡½æ•°çš„å‚æ•°3ï¼Œè¡¨ç¤ºç”Ÿæˆä¸€ä¸ªä¸‰ä½æˆå‘˜çš„æ•°ç»„ï¼Œæ¯ä¸ªä½ç½®éƒ½æ˜¯ç©ºå€¼ã€‚<code>var arr = new Array(3)</code>ç­‰åŒäº<code>var arr = Array(3)</code></p><h3 id="é™æ€æ–¹æ³•-isArray"><a href="#é™æ€æ–¹æ³•-isArray" class="headerlink" title="é™æ€æ–¹æ³• .isArray"></a>é™æ€æ–¹æ³• .isArray</h3><p>Array.isArray()æ–¹æ³•è¿”å›ä¸€ä¸ªBooleanå€¼ï¼Œè¡¨ç¤ºå‚æ•°æ˜¯å¦ä¸ºæ•°ç»„</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,2,3];</span><br><span class="line">typeof arr;  //"object"</span><br><span class="line">Array.isArray(arr);  //true</span><br></pre></td></tr></tbody></table></figure><h3 id="valueOfã€toString"><a href="#valueOfã€toString" class="headerlink" title="valueOfã€toString"></a>valueOfã€toString</h3><p>æ•°ç»„çš„valueOfæ–¹æ³•è¿”å›æ•°ç»„æœ¬èº«ï¼Œè€ŒtoStringæ–¹æ³•è¿”å›æ•°ç»„çš„å­—ç¬¦ä¸²å½¢å¼</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1, 2, 3];</span><br><span class="line">arr.valueOf(); //[1, 2, 3]</span><br><span class="line">arr.toString(); //"1, 2, 3"</span><br></pre></td></tr></tbody></table></figure><h3 id="popã€push"><a href="#popã€push" class="headerlink" title="popã€push"></a>popã€push</h3><p>pushæ–¹æ³•ç”¨äºåœ¨æ•°ç»„çš„æœ«ç«¯æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›æ·»åŠ æ–°å…ƒç´ åçš„æ•°ç»„é•¿åº¦ã€‚<em>è¯¥æ–¹æ³•ä¼šæ”¹å˜åŸæ•°ç»„</em></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var arr = [];</span><br><span class="line">arr.push(1); //1</span><br><span class="line">arr.push("a"); //2</span><br><span class="line">arr.push(true,{}); //4</span><br><span class="line">arr; //[1,"a",true,{}]</span><br></pre></td></tr></tbody></table></figure><p>popæ–¹æ³•ç”¨äºåˆ é™¤æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ ã€‚<em>è¯¥æ–¹æ³•ä¼šæ”¹å˜åŸæ•°ç»„</em></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,2,3];</span><br><span class="line">arr.pop(); //3</span><br><span class="line">arr; //[1,2]</span><br></pre></td></tr></tbody></table></figure><p>å¯¹ç©ºæ•°ç»„ä½¿ç”¨popæ–¹æ³•ï¼Œä¸ä¼šæŠ¥é”™ï¼Œè¿”å›undefined</p><blockquote><p>[ ].pop(); //undefined</p></blockquote><h3 id="shiftã€unshift"><a href="#shiftã€unshift" class="headerlink" title="shiftã€unshift"></a>shiftã€unshift</h3><p>shiftæ–¹æ³•ç”¨äºåˆ é™¤æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ ã€‚<em>è¯¥æ–¹æ³•ä¼šæ”¹å˜åŸæ•°ç»„</em></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,2,3];</span><br><span class="line">arr.shift(); //1</span><br><span class="line">arr; //[2,3]</span><br></pre></td></tr></tbody></table></figure><p>unshiftæ–¹æ³•ç”¨äºåœ¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®æ·»åŠ å…ƒç´ ï¼Œå¹¶è¿”å›æ·»åŠ æ–°å…ƒç´ åçš„æ•°ç»„é•¿åº¦ã€‚<em>è¯¥æ–¹æ³•ä¼šæ”¹å˜åŸæ•°ç»„</em></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1,2,3];</span><br><span class="line">arr.unshift(4); //4</span><br><span class="line">arr; //[4,1,2,3]</span><br></pre></td></tr></tbody></table></figure><h3 id="join"><a href="#join" class="headerlink" title="join"></a>join</h3><p>joinæ–¹æ³•ä»¥æŒ‡å®šå‚æ•°ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå°†æ‰€æœ‰æ•°ç»„æˆå‘˜è¿æ¥ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›ã€‚å¦‚æœä¸æä¾›å‚æ•°ï¼Œé»˜è®¤ç”¨é€—å·åˆ†éš”ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var a = [1, 2, 3, 4];</span><br><span class="line">a.join(' '); //"1 2 3 4"</span><br><span class="line">a.join(' | '); //"1 | 2 | 3 | 4"</span><br><span class="line">a.join(); //"1,2,3,4"</span><br></pre></td></tr></tbody></table></figure><p>å¦‚æœæ•°ç»„æˆå‘˜æ˜¯undefinedæˆ–nullæˆ–ç©ºä½ï¼Œä¼šè¢«è½¬æˆç©ºå­—ç¬¦ä¸²ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[undefined, null].join(' '); //' '</span><br><span class="line">['a',, 'b'].join('-'); //'a--b'</span><br></pre></td></tr></tbody></table></figure><p>é€šè¿‡callæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥ç”¨äºå­—ç¬¦ä¸²æˆ–ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Array.prototype.join.call('hello', '-'); // "h-e-l-l-o"</span><br><span class="line">var obj = { 0: 'a', 1: 'b', length: 2 };</span><br><span class="line">Array.prototype.join.call(obj, '-'); // 'a-b'</span><br></pre></td></tr></tbody></table></figure><h3 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h3><p>concatæ–¹æ³•ç”¨äºå¤šä¸ªæ•°ç»„çš„åˆå¹¶ã€‚å®ƒå°†æ–°æ•°ç»„çš„æˆå‘˜ï¼Œæ·»åŠ åˆ°åŸæ•°ç»„æˆå‘˜çš„åéƒ¨ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œ<em>åŸæ•°ç»„ä¸å˜</em></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">['hello'].concat(['world']); //["hello", "world"]</span><br><span class="line">['hello'].concat(['world'], ['!']); //["hello", "world", "!"]</span><br><span class="line">[].concat({a: 1}, {b: 2}); //[{ a: 1 }, { b: 2 }]</span><br><span class="line">[2].concat({a: 1}); //[2, {a: 1}]</span><br><span class="line"></span><br><span class="line">var arr1 = [1,2];</span><br><span class="line">var arr2 = [3,4];</span><br><span class="line">var arr3 = arr1.concat(arr2);</span><br><span class="line">console.log(arr1); //[1,2]</span><br><span class="line">console.log(arr3); //[1,2,3,4]</span><br></pre></td></tr></tbody></table></figure><p>é™¤äº†æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œconcatä¹Ÿæ¥å—å…¶ä»–ç±»å‹çš„å€¼ä½œä¸ºå‚æ•°ï¼Œæ·»åŠ åˆ°ç›®æ ‡æ•°ç»„å°¾éƒ¨ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1, 2, 3].concat(4, 5, 6); // [1, 2, 3, 4, 5, 6]</span><br></pre></td></tr></tbody></table></figure><p>å¦‚æœæ•°ç»„æˆå‘˜åŒ…æ‹¬å¯¹è±¡ï¼Œconcatæ–¹æ³•è¿”å›å½“å‰æ•°ç»„çš„ä¸€ä¸ªæµ…æ‹·è´ã€‚æ‰€è°“â€œæµ…æ‹·è´â€ï¼ŒæŒ‡çš„æ˜¯æ–°æ•°ç»„æ‹·è´çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var obj = { a: 1 };</span><br><span class="line">var oldArray = [obj];</span><br><span class="line">var newArray = oldArray.concat();</span><br><span class="line">obj.a = 2;</span><br><span class="line">newArray[0].a; //2</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒåŸæ•°ç»„åŒ…å«ä¸€ä¸ªå¯¹è±¡ï¼Œconcatæ–¹æ³•ç”Ÿæˆçš„æ–°æ•°ç»„åŒ…å«è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚æ‰€ä»¥ï¼Œæ”¹å˜åŸå¯¹è±¡ä»¥åï¼Œæ–°æ•°ç»„è·Ÿç€æ”¹å˜ã€‚</p><h3 id="reverse"><a href="#reverse" class="headerlink" title="reverse"></a>reverse</h3><p>reverseæ–¹æ³•ç”¨äºé¢ å€’æ’åˆ—æ•°ç»„å…ƒç´ ï¼Œè¿”å›æ”¹å˜åçš„æ•°ç»„ã€‚<em>è¯¥æ–¹æ³•å°†æ”¹å˜åŸæ•°ç»„</em></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var a = ['a', 'b', 'c'];</span><br><span class="line">a.reverse(); //["c", "b", "a"]</span><br><span class="line">a; //["c", "b", "a"]</span><br></pre></td></tr></tbody></table></figure><h3 id="slice"><a href="#slice" class="headerlink" title="slice"></a>slice</h3><p>sliceæ–¹æ³•ç”¨äºæå–ç›®æ ‡æ•°ç»„çš„ä¸€éƒ¨åˆ†ï¼Œè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œ<em>åŸæ•°ç»„ä¸å˜</em><br>1.<code>arr.slice(start, end)</code><br>å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºèµ·å§‹ä½ç½®ï¼ˆä»0å¼€å§‹ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç»ˆæ­¢ä½ç½®ï¼ˆä½†è¯¥ä½ç½®çš„å…ƒç´ æœ¬èº«ä¸åŒ…æ‹¬åœ¨å†…ï¼‰ã€‚å¦‚æœçœç•¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™ä¸€ç›´è¿”å›åˆ°åŸæ•°ç»„çš„æœ€åä¸€ä¸ªæˆå‘˜ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var a = ['a', 'b', 'c'];</span><br><span class="line">a.slice(0); //["a", "b", "c"]</span><br><span class="line">a.slice(1); //["b", "c"]</span><br><span class="line">a.slice(1, 2); //["b"]</span><br><span class="line">a.slice(2, 6); //["c"]</span><br><span class="line">a.slice(); //["a", "b", "c"]</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œæœ€åä¸€ä¸ªä¾‹å­sliceæ²¡æœ‰å‚æ•°ï¼Œå®é™…ä¸Šç­‰äºè¿”å›ä¸€ä¸ªåŸæ•°ç»„çš„æ‹·è´ã€‚</p><p>å¦‚æœsliceæ–¹æ³•çš„å‚æ•°æ˜¯è´Ÿæ•°ï¼Œåˆ™è¡¨ç¤ºå€’æ•°è®¡ç®—çš„ä½ç½®ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var a = ['a', 'b', 'c'];</span><br><span class="line">a.slice(-2); //["b", "c"]</span><br><span class="line">a.slice(-2, -1); //["b"]</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ-2è¡¨ç¤ºå€’æ•°è®¡ç®—çš„ç¬¬äºŒä¸ªä½ç½®ï¼Œ-1è¡¨ç¤ºå€’æ•°è®¡ç®—çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚</p><p>å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å¤§äºç­‰äºæ•°ç»„é•¿åº¦ï¼Œæˆ–è€…ç¬¬äºŒä¸ªå‚æ•°å°äºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåˆ™è¿”å›ç©ºæ•°ç»„ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var a = ['a', 'b', 'c'];</span><br><span class="line">a.slice(4); //[]</span><br><span class="line">a.slice(2, 1); //[]</span><br></pre></td></tr></tbody></table></figure><p>2.<code>Array.prototype.slice.callï¼ˆthisï¼‰</code><br>sliceæ–¹æ³•çš„ä¸€ä¸ªé‡è¦åº”ç”¨ï¼Œæ˜¯<em>å°†ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡è½¬ä¸ºçœŸæ­£çš„æ•°ç»„</em></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Array.prototype.slice.call({ 0: 'a', 1: 'b', length: 2 }); //['a', 'b']</span><br><span class="line">Array.prototype.slice.call(document.querySelectorAll("div"));</span><br><span class="line">Array.prototype.slice.call(arguments);</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç çš„å‚æ•°éƒ½ä¸æ˜¯æ•°ç»„ï¼Œä½†æ˜¯é€šè¿‡callæ–¹æ³•ï¼Œåœ¨å®ƒä»¬ä¸Šé¢è°ƒç”¨sliceæ–¹æ³•ï¼Œå°±å¯ä»¥æŠŠå®ƒä»¬è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚</p><h3 id="splice"><a href="#splice" class="headerlink" title="splice"></a>splice</h3><p>spliceæ–¹æ³•ç”¨äºåˆ é™¤åŸæ•°ç»„çš„ä¸€éƒ¨åˆ†æˆå‘˜ï¼Œå¹¶å¯ä»¥åœ¨åˆ é™¤çš„ä½ç½®æ·»åŠ æ–°çš„æ•°ç»„æˆå‘˜ï¼Œè¿”å›å€¼æ˜¯è¢«åˆ é™¤çš„å…ƒç´ ã€‚<em>è¯¥æ–¹æ³•ä¼šæ”¹å˜åŸæ•°ç»„</em><br><code>arr.splice(start, count, addElement1, addElement2, ...)</code><br>spliceçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åˆ é™¤çš„èµ·å§‹ä½ç½®ï¼ˆä»0å¼€å§‹ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¢«åˆ é™¤çš„å…ƒç´ ä¸ªæ•°ã€‚å¦‚æœåé¢è¿˜æœ‰æ›´å¤šçš„å‚æ•°ï¼Œåˆ™è¡¨ç¤ºè¿™äº›å°±æ˜¯è¦è¢«æ’å…¥æ•°ç»„çš„æ–°å…ƒç´ ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var a = ['a', 'b', 'c', 'd', 'e', 'f'];</span><br><span class="line">a.splice(4, 2); //["e", "f"]</span><br><span class="line">a; //["a", "b", "c", "d"]</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä»åŸæ•°ç»„4å·ä½ç½®ï¼Œåˆ é™¤äº†ä¸¤ä¸ªæ•°ç»„æˆå‘˜ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var a = ['a', 'b', 'c', 'd', 'e', 'f'];</span><br><span class="line">a.splice(4, 2, 1, 2); //["e", "f"]</span><br><span class="line">a; //["a", "b", "c", "d", 1, 2]</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç é™¤äº†åˆ é™¤æˆå‘˜ï¼Œè¿˜æ’å…¥äº†ä¸¤ä¸ªæ–°æˆå‘˜ã€‚</p><p>èµ·å§‹ä½ç½®å¦‚æœæ˜¯è´Ÿæ•°ï¼Œå°±è¡¨ç¤ºä»å€’æ•°ä½ç½®å¼€å§‹åˆ é™¤ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var a = ['a', 'b', 'c', 'd', 'e', 'f'];</span><br><span class="line">a.splice(-4, 2); //["c", "d"]</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œä»å€’æ•°ç¬¬å››ä¸ªä½ç½®cå¼€å§‹åˆ é™¤ä¸¤ä¸ªæˆå‘˜ã€‚</p><p>å¦‚æœåªæ˜¯å•çº¯åœ°æ’å…¥å…ƒç´ ï¼Œspliceæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥è®¾ä¸º0ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var a = [1, 1, 1];</span><br><span class="line">a.splice(1, 0, 2); //[]</span><br><span class="line">a; //[1, 2, 1, 1]</span><br></pre></td></tr></tbody></table></figure><p>å¦‚æœåªæä¾›ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç­‰åŒäºå°†åŸæ•°ç»„åœ¨æŒ‡å®šä½ç½®æ‹†åˆ†æˆä¸¤ä¸ªæ•°ç»„ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var a = [1, 2, 3, 4];</span><br><span class="line">a.splice(2); //[3, 4]</span><br><span class="line">a; //[1, 2]</span><br></pre></td></tr></tbody></table></figure><h3 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h3><p>sortæ–¹æ³•å¯¹æ•°ç»„æˆå‘˜è¿›è¡Œæ’åºï¼Œé»˜è®¤æ˜¯æŒ‰ç…§å­—å…¸é¡ºåºæ’åºã€‚<em>æ’åºåï¼ŒåŸæ•°ç»„å°†è¢«æ”¹å˜</em></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">['d', 'c', 'b', 'a'].sort(); //['a', 'b', 'c', 'd']</span><br><span class="line">[4, 3, 2, 1].sort(); //[1, 2, 3, 4]</span><br><span class="line">[11, 101].sort(); //[101, 11]</span><br><span class="line">[10111, 1101, 111].sort(); //[10111, 1101, 111]</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç çš„æœ€åä¸¤ä¸ªä¾‹å­ï¼Œéœ€è¦ç‰¹æ®Šæ³¨æ„ã€‚sortæ–¹æ³•ä¸æ˜¯æŒ‰ç…§å¤§å°æ’åºï¼Œè€Œæ˜¯æŒ‰ç…§å­—å…¸é¡ºåºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°å€¼ä¼šè¢«å…ˆè½¬æˆå­—ç¬¦ä¸²ï¼Œå†æŒ‰ç…§å­—å…¸é¡ºåºè¿›è¡Œæ¯”è¾ƒï¼Œæ‰€ä»¥101æ’åœ¨11çš„å‰é¢ã€‚</p><p>å¦‚æœæƒ³è®©sortæ–¹æ³•æŒ‰ç…§è‡ªå®šä¹‰æ–¹å¼æ’åºï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[10111, 1101, 111].sort(function (a, b) {</span><br><span class="line">return a - b;</span><br><span class="line">}); //[111, 1101, 10111]</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œsortçš„å‚æ•°å‡½æ•°æœ¬èº«æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºè¿›è¡Œæ¯”è¾ƒçš„ä¸¤ä¸ªæ•°ç»„æˆå‘˜ã€‚å¦‚æœè¯¥å‡½æ•°çš„è¿”å›å€¼å¤§äº0ï¼Œè¡¨ç¤ºç¬¬ä¸€ä¸ªæˆå‘˜æ’åœ¨ç¬¬äºŒä¸ªæˆå‘˜åé¢ï¼›å…¶ä»–æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ æ’åœ¨ç¬¬äºŒä¸ªå…ƒç´ å‰é¢ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">{ name: "å¼ ä¸‰", age: 30 },</span><br><span class="line">{ name: "æå››", age: 24 },</span><br><span class="line">{ name: "ç‹äº”", age: 28 }</span><br><span class="line">].sort(function (o1, o2) {</span><br><span class="line">return o1.age - o2.age;</span><br><span class="line">});</span><br><span class="line">//[</span><br><span class="line">//{ name: "æå››", age: 24 },</span><br><span class="line">//{ name: "ç‹äº”", age: 28 },</span><br><span class="line">//{ name: "å¼ ä¸‰", age: 30 }</span><br><span class="line">//]</span><br></pre></td></tr></tbody></table></figure><h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p>mapæ–¹æ³•å°†æ•°ç»„çš„æ‰€æœ‰æˆå‘˜ä¾æ¬¡ä¼ å…¥å‚æ•°å‡½æ•°ï¼Œç„¶åæŠŠæ¯ä¸€æ¬¡çš„æ‰§è¡Œç»“æœç»„æˆä¸€ä¸ªæ–°æ•°ç»„è¿”å›ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var numbers = [1, 2, 3];</span><br><span class="line">numbers.map(function (n) {</span><br><span class="line">return n + 1;</span><br><span class="line">}); //[2, 3, 4]</span><br><span class="line">numbers; //[1, 2, 3]</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œnumbersæ•°ç»„çš„æ‰€æœ‰æˆå‘˜ä¾æ¬¡æ‰§è¡Œå‚æ•°å‡½æ•°ï¼Œè¿è¡Œç»“æœç»„æˆä¸€ä¸ªæ–°æ•°ç»„è¿”å›ã€‚<em>åŸæ•°ç»„æ²¡æœ‰å˜åŒ–</em></p><p>mapæ–¹æ³•æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€‚è¯¥å‡½æ•°è°ƒç”¨æ—¶ï¼Œmapæ–¹æ³•å‘å®ƒä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼šå½“å‰æˆå‘˜ã€å½“å‰ä½ç½®å’Œæ•°ç»„æœ¬èº«ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[1, 2, 3].map(function(elem, index, arr) {</span><br><span class="line">  return elem * index;</span><br><span class="line">}); //[0, 2, 6]</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œmapæ–¹æ³•çš„å›è°ƒå‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œelemä¸ºå½“å‰æˆå‘˜çš„å€¼ï¼Œindexä¸ºå½“å‰æˆå‘˜çš„ä½ç½®ï¼Œarrä¸ºåŸæ•°ç»„ï¼ˆ[1, 2, 3]ï¼‰</p><p>mapæ–¹æ³•è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šå›è°ƒå‡½æ•°å†…éƒ¨çš„thiså˜é‡ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var arr = ['a', 'b', 'c'];</span><br><span class="line">[1, 2].map(function (e) {</span><br><span class="line">return this[e];</span><br><span class="line">}, arr); //['b', 'c']</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç é€šè¿‡mapæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œå°†å›è°ƒå‡½æ•°å†…éƒ¨çš„thiså¯¹è±¡ï¼ŒæŒ‡å‘arræ•°ç»„ã€‚</p><p>å¦‚æœæ•°ç»„æœ‰ç©ºä½ï¼Œmapæ–¹æ³•çš„å›è°ƒå‡½æ•°åœ¨è¿™ä¸ªä½ç½®ä¸ä¼šæ‰§è¡Œï¼Œä¼šè·³è¿‡æ•°ç»„çš„ç©ºä½ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var f = function (n) { return 'a' };</span><br><span class="line">[1, undefined, 2].map(f); //["a", "a", "a"]</span><br><span class="line">[1, null, 2].map(f); //["a", "a", "a"]</span><br><span class="line">[1, , 2].map(f); //["a", , "a"]</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œmapæ–¹æ³•ä¸ä¼šè·³è¿‡undefinedå’Œnullï¼Œä½†æ˜¯ä¼šè·³è¿‡ç©ºä½</p><h3 id="forEach"><a href="#forEach" class="headerlink" title="forEach"></a>forEach</h3><p>forEachæ–¹æ³•ä¸mapæ–¹æ³•å¾ˆç›¸ä¼¼ï¼Œä¹Ÿæ˜¯å¯¹æ•°ç»„çš„æ‰€æœ‰æˆå‘˜ä¾æ¬¡æ‰§è¡Œå‚æ•°å‡½æ•°ã€‚ä½†æ˜¯ï¼ŒforEachæ–¹æ³•ä¸è¿”å›å€¼ï¼Œåªç”¨æ¥æ“ä½œæ•°æ®ã€‚è¿™å°±æ˜¯è¯´ï¼Œå¦‚æœæ•°ç»„éå†çš„ç›®çš„æ˜¯ä¸ºäº†å¾—åˆ°è¿”å›å€¼ï¼Œé‚£ä¹ˆä½¿ç”¨mapæ–¹æ³•ï¼Œå¦åˆ™ä½¿ç”¨forEachæ–¹æ³•ã€‚<br>forEachçš„ç”¨æ³•ä¸mapæ–¹æ³•ä¸€è‡´ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°åŒæ ·æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šå½“å‰å€¼ã€å½“å‰ä½ç½®ã€æ•´ä¸ªæ•°ç»„ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function log(element, index, array) {</span><br><span class="line">console.log('[' + index + '] = ' + element);</span><br><span class="line">}</span><br><span class="line">[2, 5, 9].forEach(log);</span><br><span class="line">//[0] = 2</span><br><span class="line">//[1] = 5</span><br><span class="line">//[2] = 9</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒforEachéå†æ•°ç»„ä¸æ˜¯ä¸ºäº†å¾—åˆ°è¿”å›å€¼ï¼Œè€Œæ˜¯ä¸ºäº†åœ¨å±å¹•è¾“å‡ºå†…å®¹ï¼Œæ‰€ä»¥ä¸å¿…ä½¿ç”¨mapæ–¹æ³•ã€‚</p><p>forEachæ–¹æ³•ä¹Ÿå¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œç»‘å®šå‚æ•°å‡½æ•°çš„thiså˜é‡ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var out = [];</span><br><span class="line">[1, 2, 3].forEach(function(elem) {</span><br><span class="line">this.push(elem * elem);</span><br><span class="line">}, out);</span><br><span class="line">out; //[1, 4, 9]</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œç©ºæ•°ç»„outæ˜¯forEachæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œç»“æœï¼Œå›è°ƒå‡½æ•°å†…éƒ¨çš„thiså…³é”®å­—å°±æŒ‡å‘outã€‚</p><p>æ³¨æ„ï¼Œ<em>forEachæ–¹æ³•æ— æ³•ä¸­æ–­æ‰§è¡Œï¼Œæ€»æ˜¯ä¼šå°†æ‰€æœ‰æˆå‘˜éå†å®Œ</em>ã€‚å¦‚æœå¸Œæœ›ç¬¦åˆæŸç§æ¡ä»¶æ—¶ï¼Œå°±ä¸­æ–­éå†ï¼Œè¦ä½¿ç”¨forå¾ªç¯ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1, 2, 3];</span><br><span class="line">for (var i = 0; i &lt; arr.length; i++) {</span><br><span class="line">if (arr[i] === 2) break;</span><br><span class="line">console.log(arr[i]);</span><br><span class="line">} //1</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ‰§è¡Œåˆ°æ•°ç»„çš„ç¬¬äºŒä¸ªæˆå‘˜æ—¶ï¼Œå°±ä¼šä¸­æ–­æ‰§è¡Œã€‚forEachæ–¹æ³•åšä¸åˆ°è¿™ä¸€ç‚¹ã€‚</p><p>forEachæ–¹æ³•ä¹Ÿä¼šè·³è¿‡æ•°ç»„çš„ç©ºä½ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var log = function (n) {</span><br><span class="line">console.log(n + 1);</span><br><span class="line">};</span><br><span class="line">[1, undefined, 2].forEach(log);</span><br><span class="line">//2</span><br><span class="line">//NaN</span><br><span class="line">//3</span><br><span class="line">[1, null, 2].forEach(log);</span><br><span class="line">//2</span><br><span class="line">//1</span><br><span class="line">//3</span><br><span class="line">[1, , 2].forEach(log);</span><br><span class="line">//2</span><br><span class="line">//3</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒforEachæ–¹æ³•ä¸ä¼šè·³è¿‡undefinedå’Œnullï¼Œä½†ä¼šè·³è¿‡ç©ºä½ã€‚</p><h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p>filteræ–¹æ³•ç”¨äºè¿‡æ»¤æ•°ç»„æˆå‘˜ï¼Œæ»¡è¶³æ¡ä»¶çš„æˆå‘˜ç»„æˆä¸€ä¸ªæ–°æ•°ç»„è¿”å›ã€‚<br>å®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€æœ‰æ•°ç»„æˆå‘˜ä¾æ¬¡æ‰§è¡Œè¯¥å‡½æ•°ï¼Œè¿”å›ç»“æœä¸ºtrueçš„æˆå‘˜ç»„æˆä¸€ä¸ªæ–°æ•°ç»„è¿”å›ã€‚<em>è¯¥æ–¹æ³•ä¸ä¼šæ”¹å˜åŸæ•°ç»„</em></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[1, 2, 3, 4, 5].filter(function (elem) {</span><br><span class="line">return (elem &gt; 3);</span><br><span class="line">});</span><br><span class="line">//[4, 5]</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç å°†å¤§äº3çš„æ•°ç»„æˆå‘˜ï¼Œä½œä¸ºä¸€ä¸ªæ–°æ•°ç»„è¿”å›ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var arr = [0, 1, 'a', false];</span><br><span class="line">arr.filter(Boolean);</span><br><span class="line">//[1, "a"]</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œfilteræ–¹æ³•è¿”å›æ•°ç»„arré‡Œé¢æ‰€æœ‰å¸ƒå°”å€¼ä¸ºtrueçš„æˆå‘˜ã€‚</p><p>filteræ–¹æ³•çš„å‚æ•°å‡½æ•°å¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šå½“å‰æˆå‘˜ï¼Œå½“å‰ä½ç½®å’Œæ•´ä¸ªæ•°ç»„ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[1, 2, 3, 4, 5].filter(function (elem, index, arr) {</span><br><span class="line">return index % 2 === 0;</span><br><span class="line">});</span><br><span class="line">//[1, 3, 5]</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç è¿”å›å¶æ•°ä½ç½®çš„æˆå‘˜ç»„æˆçš„æ–°æ•°ç»„ã€‚</p><p>filteræ–¹æ³•è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šå‚æ•°å‡½æ•°å†…éƒ¨çš„thiså˜é‡ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var obj = { MAX: 3 };</span><br><span class="line">var myFilter = function (item) {</span><br><span class="line">if (item &gt; this.MAX) return true;</span><br><span class="line">};</span><br><span class="line">var arr = [2, 8, 3, 4, 1, 3, 2, 9];</span><br><span class="line">arr.filter(myFilter, obj); //[8, 4, 9]</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œè¿‡æ»¤å™¨myFilterå†…éƒ¨æœ‰thiså˜é‡ï¼Œå®ƒå¯ä»¥è¢«filteræ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°objç»‘å®šï¼Œè¿”å›å¤§äº3çš„æˆå‘˜ã€‚</p><h3 id="someã€every"><a href="#someã€every" class="headerlink" title="someã€every"></a>someã€every</h3><p>è¿™ä¸¤ä¸ªæ–¹æ³•ç±»ä¼¼â€œæ–­è¨€â€ï¼ˆassertï¼‰ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºåˆ¤æ–­æ•°ç»„æˆå‘˜æ˜¯å¦ç¬¦åˆæŸç§æ¡ä»¶ã€‚<br>å®ƒä»¬æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæ‰€æœ‰æ•°ç»„æˆå‘˜ä¾æ¬¡æ‰§è¡Œè¯¥å‡½æ•°ã€‚è¯¥å‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šå½“å‰æˆå‘˜ã€å½“å‰ä½ç½®å’Œæ•´ä¸ªæ•°ç»„ï¼Œç„¶åè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚<br>someæ–¹æ³•æ˜¯åªè¦ä¸€ä¸ªæˆå‘˜çš„è¿”å›å€¼æ˜¯trueï¼Œåˆ™æ•´ä¸ªsomeæ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯trueï¼Œå¦åˆ™è¿”å›falseã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1, 2, 3, 4, 5];</span><br><span class="line">arr.some(function (elem, index, arr) {</span><br><span class="line">return elem &gt;= 3;</span><br><span class="line">});</span><br><span class="line">//true</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœæ•°ç»„arræœ‰ä¸€ä¸ªæˆå‘˜å¤§äºç­‰äº3ï¼Œsomeæ–¹æ³•å°±è¿”å›trueã€‚</p><p>everyæ–¹æ³•æ˜¯æ‰€æœ‰æˆå‘˜çš„è¿”å›å€¼éƒ½æ˜¯trueï¼Œæ•´ä¸ªeveryæ–¹æ³•æ‰è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1, 2, 3, 4, 5];</span><br><span class="line">arr.every(function (elem, index, arr) {</span><br><span class="line">  return elem &gt;= 3;</span><br><span class="line">});</span><br><span class="line">//false</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°ç»„arrå¹¶éæ‰€æœ‰æˆå‘˜å¤§äºç­‰äº3ï¼Œæ‰€ä»¥è¿”å›falseã€‚</p><p>æ³¨æ„ï¼Œå¯¹äºç©ºæ•°ç»„ï¼Œsomeæ–¹æ³•è¿”å›falseï¼Œeveryæ–¹æ³•è¿”å›trueï¼Œå›è°ƒå‡½æ•°éƒ½ä¸ä¼šæ‰§è¡Œã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function isEven(x) { return x % 2 === 0 }</span><br><span class="line">[].some(isEven); //false</span><br><span class="line">[].every(isEven); //true</span><br></pre></td></tr></tbody></table></figure><p>someå’Œeveryæ–¹æ³•è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šå‚æ•°å‡½æ•°å†…éƒ¨çš„thiså˜é‡ã€‚</p><h3 id="reduceã€reduceRight"><a href="#reduceã€reduceRight" class="headerlink" title="reduceã€reduceRight"></a>reduceã€reduceRight</h3><p>reduceæ–¹æ³•å’ŒreduceRightæ–¹æ³•ä¾æ¬¡å¤„ç†æ•°ç»„çš„æ¯ä¸ªæˆå‘˜ï¼Œæœ€ç»ˆç´¯è®¡ä¸ºä¸€ä¸ªå€¼ã€‚å®ƒä»¬çš„å·®åˆ«æ˜¯ï¼Œreduceæ˜¯ä»å·¦åˆ°å³å¤„ç†ï¼ˆä»ç¬¬ä¸€ä¸ªæˆå‘˜åˆ°æœ€åä¸€ä¸ªæˆå‘˜ï¼‰ï¼ŒreduceRightåˆ™æ˜¯ä»å³åˆ°å·¦ï¼ˆä»æœ€åä¸€ä¸ªæˆå‘˜åˆ°ç¬¬ä¸€ä¸ªæˆå‘˜ï¼‰ï¼Œå…¶ä»–å®Œå…¨ä¸€æ ·ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[1, 2, 3, 4, 5].reduce(function (a, b) {</span><br><span class="line">console.log(a, b);</span><br><span class="line">return a + b;</span><br><span class="line">});</span><br><span class="line">//1 2</span><br><span class="line">//3 3</span><br><span class="line">//6 4</span><br><span class="line">//10 5</span><br><span class="line">//æœ€åç»“æœï¼š15</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œreduceæ–¹æ³•æ±‚å‡ºæ•°ç»„æ‰€æœ‰æˆå‘˜çš„å’Œã€‚ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œaæ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªæˆå‘˜1ï¼Œbæ˜¯æ•°ç»„çš„ç¬¬äºŒä¸ªæˆå‘˜2ã€‚ç¬¬äºŒæ¬¡æ‰§è¡Œï¼Œaä¸ºä¸Šä¸€è½®çš„è¿”å›å€¼3ï¼Œbä¸ºç¬¬ä¸‰ä¸ªæˆå‘˜3ã€‚ç¬¬ä¸‰æ¬¡æ‰§è¡Œï¼Œaä¸ºä¸Šä¸€è½®çš„è¿”å›å€¼6ï¼Œbä¸ºç¬¬å››ä¸ªæˆå‘˜4ã€‚ç¬¬å››æ¬¡æ‰§è¡Œï¼Œaä¸ºä¸Šä¸€è½®è¿”å›å€¼10ï¼Œbä¸ºç¬¬äº”ä¸ªæˆå‘˜5ã€‚è‡³æ­¤æ‰€æœ‰æˆå‘˜éå†å®Œæˆï¼Œæ•´ä¸ªæ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯æœ€åä¸€è½®çš„è¿”å›å€¼15ã€‚</p><p>reduceæ–¹æ³•å’ŒreduceRightæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚è¯¥å‡½æ•°æ¥å—ä»¥ä¸‹å››ä¸ªå‚æ•°ã€‚<br>ç´¯ç§¯å˜é‡ï¼šé»˜è®¤ä¸ºæ•°ç»„çš„ç¬¬ä¸€ä¸ªæˆå‘˜ï¼›<br>å½“å‰å˜é‡ï¼šé»˜è®¤ä¸ºæ•°ç»„çš„ç¬¬äºŒä¸ªæˆå‘˜ï¼›<br>å½“å‰ä½ç½®ï¼ˆä»0å¼€å§‹ï¼‰ï¼›<br>åŸæ•°ç»„<br>è¿™å››ä¸ªå‚æ•°ä¹‹ä¸­ï¼Œåªæœ‰å‰ä¸¤ä¸ªæ˜¯å¿…é¡»çš„ï¼Œåä¸¤ä¸ªåˆ™æ˜¯å¯é€‰çš„ã€‚<br>å¦‚æœè¦å¯¹ç´¯ç§¯å˜é‡æŒ‡å®šåˆå€¼ï¼Œå¯ä»¥æŠŠå®ƒæ”¾åœ¨reduceæ–¹æ³•å’ŒreduceRightæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[1, 2, 3, 4, 5].reduce(function (a, b) {</span><br><span class="line">return a + b;</span><br><span class="line">}, 10);</span><br><span class="line">//25</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç æŒ‡å®šå‚æ•°açš„åˆå€¼ä¸º10ï¼Œæ‰€ä»¥æ•°ç»„ä»10å¼€å§‹ç´¯åŠ ï¼Œæœ€ç»ˆç»“æœä¸º25ã€‚æ³¨æ„ï¼Œè¿™æ—¶bæ˜¯ä»æ•°ç»„çš„ç¬¬ä¸€ä¸ªæˆå‘˜å¼€å§‹éå†ã€‚<br>ä¸Šé¢çš„ç¬¬äºŒä¸ªå‚æ•°ç›¸å½“äºè®¾å®šäº†é»˜è®¤å€¼ï¼Œå¤„ç†ç©ºæ•°ç»„æ—¶å°¤å…¶æœ‰ç”¨ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function add(prev, cur) {</span><br><span class="line">return prev + cur;</span><br><span class="line">}</span><br><span class="line">[].reduce(add);</span><br><span class="line">//TypeError: Reduce of empty array with no initial value</span><br><span class="line">[].reduce(add, 1);</span><br><span class="line">//1</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œç”±äºç©ºæ•°ç»„å–ä¸åˆ°åˆå§‹å€¼ï¼Œreduceæ–¹æ³•ä¼šæŠ¥é”™ã€‚è¿™æ—¶ï¼ŒåŠ ä¸Šç¬¬äºŒä¸ªå‚æ•°ï¼Œå°±èƒ½ä¿è¯æ€»æ˜¯ä¼šè¿”å›ä¸€ä¸ªå€¼ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªreduceRightæ–¹æ³•çš„ä¾‹å­ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function subtract(prev, cur) {</span><br><span class="line">return prev - cur;</span><br><span class="line">}</span><br><span class="line">[3, 2, 1].reduce(subtract); //0</span><br><span class="line">[3, 2, 1].reduceRight(subtract); //-4</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œreduceæ–¹æ³•ç›¸å½“äº3å‡å»2å†å‡å»1ï¼ŒreduceRightæ–¹æ³•ç›¸å½“äº1å‡å»2å†å‡å»3ã€‚</p><p>ç”±äºè¿™ä¸¤ä¸ªæ–¹æ³•ä¼šéå†æ•°ç»„ï¼Œæ‰€ä»¥å®é™…ä¸Šè¿˜å¯ä»¥ç”¨æ¥åšä¸€äº›éå†ç›¸å…³çš„æ“ä½œã€‚æ¯”å¦‚ï¼Œæ‰¾å‡ºå­—ç¬¦é•¿åº¦æœ€é•¿çš„æ•°ç»„æˆå‘˜ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function findLongest(entries) {</span><br><span class="line">return entries.reduce(function (longest, entry) {</span><br><span class="line">return entry.length &gt; longest.length ? entry : longest;</span><br><span class="line">}, '');</span><br><span class="line">}</span><br><span class="line">findLongest(['aaa', 'bb', 'c']); //"aaa"</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œreduceçš„å‚æ•°å‡½æ•°ä¼šå°†å­—ç¬¦é•¿åº¦è¾ƒé•¿çš„é‚£ä¸ªæ•°ç»„æˆå‘˜ï¼Œä½œä¸ºç´¯ç§¯å€¼ã€‚è¿™å¯¼è‡´éå†æ‰€æœ‰æˆå‘˜ä¹‹åï¼Œç´¯ç§¯å€¼å°±æ˜¯å­—ç¬¦é•¿åº¦æœ€é•¿çš„é‚£ä¸ªæˆå‘˜ã€‚</p><h3 id="indexOfã€lastIndexOf"><a href="#indexOfã€lastIndexOf" class="headerlink" title="indexOfã€lastIndexOf"></a>indexOfã€lastIndexOf</h3><p>indexOfæ–¹æ³•è¿”å›ç»™å®šå…ƒç´ åœ¨æ•°ç»„ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰å‡ºç°åˆ™è¿”å›-1ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var a = ['a', 'b', 'c'];</span><br><span class="line">a.indexOf('b'); //1</span><br><span class="line">a.indexOf('y'); //-1</span><br></pre></td></tr></tbody></table></figure><p>indexOfæ–¹æ³•è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨ç¤ºæœç´¢çš„å¼€å§‹ä½ç½®ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">['a', 'b', 'c'].indexOf('a', 1); //-1</span><br></pre></td></tr></tbody></table></figure><p>ä¸Šé¢ä»£ç ä»1å·ä½ç½®å¼€å§‹æœç´¢å­—ç¬¦aï¼Œç»“æœä¸º-1ï¼Œè¡¨ç¤ºæ²¡æœ‰æœç´¢åˆ°ã€‚</p><p>lastIndexOfæ–¹æ³•è¿”å›ç»™å®šå…ƒç´ åœ¨æ•°ç»„ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰å‡ºç°åˆ™è¿”å›-1ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var a = [2, 5, 9, 2];</span><br><span class="line">a.lastIndexOf(2); //3</span><br><span class="line">a.lastIndexOf(7); //-1</span><br></pre></td></tr></tbody></table></figure><p>æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¸èƒ½ç”¨æ¥æœç´¢NaNçš„ä½ç½®ï¼Œå³å®ƒä»¬æ— æ³•ç¡®å®šæ•°ç»„æˆå‘˜æ˜¯å¦åŒ…å«NaNã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[NaN].indexOf(NaN); //-1</span><br><span class="line">[NaN].lastIndexOf(NaN); //-1</span><br></pre></td></tr></tbody></table></figure><p>è¿™æ˜¯å› ä¸ºè¿™ä¸¤ä¸ªæ–¹æ³•å†…éƒ¨ï¼Œä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ===ï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œè€ŒNaNæ˜¯å”¯ä¸€ä¸€ä¸ªä¸ç­‰äºè‡ªèº«çš„å€¼ã€‚</p><h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><p>ArrayçŸ¥è¯†æ¸…å•å°†ä¸å®šæ—¶æ›´æ–°æ‰€åŒ…å«çš„çŸ¥è¯†ï¼Œå¦‚æœæœ‰ä¹¦å†™é”™è¯¯è¯·æŒ‡æ­£~</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ArrayçŸ¥è¯†æ¸…å•&lt;/p&gt;
    
    </summary>
    
      <category term="Js" scheme="http://Lry0504.github.io/categories/Js/"/>
    
    
      <category term="å‰ç«¯" scheme="http://Lry0504.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>æ¬¢è¿æ¥åˆ°ç‹—å­èµ–çš„åšå®¢</title>
    <link href="http://Lry0504.github.io//posts/fbf759eb/"/>
    <id>http://Lry0504.github.io//posts/fbf759eb/</id>
    <published>2019-08-22T07:14:46.311Z</published>
    <updated>2019-09-25T02:11:46.858Z</updated>
    
    <content type="html"><![CDATA[<p>æ¬¢è¿æ¥åˆ°ç‹—å­èµ–çš„åšå®¢</p><a id="more"></a><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/Lry0504/image_resources/master/blog/welcome/blog_welcome.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç»ˆäºå¼€é€šäº†è‡ªå·±çš„åšå®¢äº†~å¾ˆä¹…ä¹‹å‰å°±èŒç”Ÿäº†å†™åšå®¢çš„æƒ³æ³•ï¼Œå¥ˆä½•ä¸€ç›´æ²¡æœ‰å®ç°ã€‚å‡ å‘¨å‰åœ¨å­¦ä¹ æŸä¸ªçŸ¥è¯†ç‚¹çš„æ—¶å€™åˆšå¥½çœ‹åˆ°ä¸€ä¸ªåšä¸»çš„åšå®¢ï¼Œè§‰å¾—å®åœ¨æ˜¯å¤ªå¸å¼•æˆ‘äº†(âœªÏ‰âœª)ï¼Œäºæ˜¯åœ¨ç½‘ä¸Šå‚è€ƒäº†è®¸å¤šæ–¹å¼æ­äº†è¿™ä¸ªåšå®¢</p><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><h3 id="åšå®¢ä¸»é¢˜"><a href="#åšå®¢ä¸»é¢˜" class="headerlink" title="åšå®¢ä¸»é¢˜"></a>åšå®¢ä¸»é¢˜</h3><p>åšå®¢ä½¿ç”¨çš„æ˜¯<a href="https://tomotoes.com/" target="_blank" rel="noopener">Simon Ma</a>å¤§ä½¬çš„ä¸»é¢˜<a href="https://github.com/Tomotoes/hexo-theme-tomotoes" target="_blank" rel="noopener">tomotoes</a>ï¼Œé…è‰²ä»€ä¹ˆçš„æ„Ÿè§‰éƒ½ç¾ç¾å“’~</p><h3 id="åšå®¢åå­—"><a href="#åšå®¢åå­—" class="headerlink" title="åšå®¢åå­—"></a>åšå®¢åå­—</h3><p>åšå®¢é¦–é¡µçš„åå­—æ˜¯Dog Laiï¼ˆç‹—å­èµ–ï¼‰ emmmmâ€¦å…¶å®æŒºå¥½å¬çš„ï¼Œè¢«æœ‹å‹å«ä¹ æƒ¯äº†ï¼Œæ„Ÿè§‰ä¹ŸæŒºå¥½çš„åå­—æ˜¯å§~</p><h3 id="åšå®¢å†…å®¹"><a href="#åšå®¢å†…å®¹" class="headerlink" title="åšå®¢å†…å®¹"></a>åšå®¢å†…å®¹</h3><ol><li>è®°å½•æ—¥å¸¸å·¥ä½œé‡åˆ°çš„é—®é¢˜åŠè§£ç­”æ€è·¯</li><li>è®°å½•æ—¥å¸¸å­¦ä¹ èµ„æ–™å’Œè½¬è½½ä¼˜ç§€åšæ–‡</li><li>è®°å½•çœ‹åˆ°çš„ç¾æ–‡åŠæ„Ÿæ‚Ÿ</li><li>è®°å½•ç”Ÿæ´»çš„é…¸ç”œè‹¦è¾£</li><li>â€¦â€¦</li></ol><h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><blockquote><p>ä¸€èµ·å­¦ä¹ ï¼Œå…±å‹‰<del>~</del></p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ¬¢è¿æ¥åˆ°ç‹—å­èµ–çš„åšå®¢&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
</feed>
